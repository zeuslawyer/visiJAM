!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=174)}([function(e,t,n){"use strict";const r=n(2).MongoError,o=n(2).ReadPreference;var s=t.formatSortValue=function(e){switch((""+e).toLowerCase()){case"ascending":case"asc":case"1":return 1;case"descending":case"desc":case"-1":return-1;default:throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]")}},i=t.formattedOrderClause=function(e){var t={};if(null==e)return null;if(Array.isArray(e)){if(0===e.length)return null;for(var n=0;n<e.length;n++)e[n].constructor===String?t[e[n]]=1:t[e[n][0]]=s(e[n][1])}else if(null!=e&&"object"==typeof e)t=e;else{if("string"!=typeof e)throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");t[e]=1}return t},a=t.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},c=["w","j","wtimeout","fsync"];const u=process.emitWarning?e=>process.emitWarning(e,"DeprecationWarning"):e=>console.error(e);function l(e,t){return`${e} option [${t}] is deprecated and will be removed in a later version.`}e.exports={filterOptions:function(e,t){var n={};for(var r in e)-1!==t.indexOf(r)&&(n[r]=e[r]);return n},mergeOptions:function(e,t){for(var n in t)e[n]=t[n];return e},translateOptions:function(e,t){var n={sslCA:"ca",sslCRL:"crl",sslValidate:"rejectUnauthorized",sslKey:"key",sslCert:"cert",sslPass:"passphrase",socketTimeoutMS:"socketTimeout",connectTimeoutMS:"connectionTimeout",replicaSet:"setName",rs_name:"setName",secondaryAcceptableLatencyMS:"acceptableLatency",connectWithNoPrimary:"secondaryOnlyConnectionAllowed",acceptableLatencyMS:"localThresholdMS"};for(var r in t)n[r]?e[n[r]]=t[r]:e[r]=t[r];return e},shallowClone:function(e){var t={};for(var n in e)t[n]=e[n];return t},getSingleProperty:function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},checkCollectionName:function(e){if("string"!=typeof e)throw new r("collection name must be a String");if(!e||-1!==e.indexOf(".."))throw new r("collection names cannot be empty");if(-1!==e.indexOf("$")&&null==e.match(/((^\$cmd)|(oplog\.\$main))/))throw new r("collection names must not contain '$'");if(null!=e.match(/^\.|\.$/))throw new r("collection names must not start or end with '.'");if(-1!==e.indexOf("\0"))throw new r("collection names cannot contain a null character")},toError:function(e){if(e instanceof Error)return e;for(var t=e.err||e.errmsg||e.errMessage||e,n=r.create({message:t,driver:!0}),o="object"==typeof e?Object.keys(e):[],s=0;s<o.length;s++)try{n[o[s]]=e[o[s]]}catch(e){}return n},formattedOrderClause:i,parseIndexOptions:function(e){var t,n={},r=[];return"string"==typeof e?(r.push(e+"_1"),n[e]=1):Array.isArray(e)?e.forEach(function(e){"string"==typeof e?(r.push(e+"_1"),n[e]=1):Array.isArray(e)?(r.push(e[0]+"_"+(e[1]||1)),n[e[0]]=e[1]||1):a(e)&&(t=Object.keys(e)).forEach(function(t){r.push(t+"_"+e[t]),n[t]=e[t]})}):a(e)&&(t=Object.keys(e)).forEach(function(t){r.push(t+"_"+e[t]),n[t]=e[t]}),{name:r.join("_"),keys:t,fieldHash:n}},normalizeHintField:function(e){var t=null;if("string"==typeof e)t=e;else if(Array.isArray(e))t={},e.forEach(function(e){t[e]=1});else if(null!=e&&"object"==typeof e)for(var n in t={},e)t[n]=e[n];return t},handleCallback:function(e,t,n,r){try{if(null==e)return;if(e)return r?e(t,n,r):e(t,n)}catch(t){return process.nextTick(function(){throw t}),!1}return!0},decorateCommand:function(e,t,n){for(var r in t)-1===n.indexOf(r)&&(e[r]=t[r]);return e},isObject:a,debugOptions:function(e,t){var n={};return e.forEach(function(e){n[e]=t[e]}),n},MAX_JS_INT:Number.MAX_SAFE_INTEGER+1,mergeOptionsAndWriteConcern:function(e,t,n,r){for(var o=0;o<n.length;o++)e[n[o]]||void 0===t[n[o]]||(e[n[o]]=t[n[o]]);if(!r)return e;var s=!1;for(o=0;o<c.length;o++)if(e[c[o]]){s=!0;break}if(!s)for(o=0;o<c.length;o++)t[c[o]]&&(e[c[o]]=t[c[o]]);return e},translateReadPreference:function(e){var t=null;if(!e.readPreference)return e;if("string"==typeof(t=e.readPreference))e.readPreference=new o(t);else if(!t||t instanceof o||"object"!=typeof t){if(!(t instanceof o))throw new TypeError("Invalid read preference: "+t)}else{const n=t.mode||t.preference;n&&"string"==typeof n&&(e.readPreference=new o(n,t.tags,{maxStalenessSeconds:t.maxStalenessSeconds}))}return e},executeOperation:(e,t,n,o)=>{if(null==e)throw new TypeError("This method requires a valid topology instance");if(!Array.isArray(n))throw new TypeError("This method requires an array of arguments to apply");o=o||{};const s=e.s.promiseLibrary;let i,a,c,u=o.resultMutator,l=n[n.length-1];if(!o.skipSessions&&e.hasSessionSupport())if(null==(a=n[n.length-2])||null==a.session){c=Symbol(),i=e.startSession({owner:c});const t=n.length-2;n[t]=Object.assign({},n[t],{session:i})}else if(a.session&&a.session.hasEnded)throw new r("Use of expired sessions is not permitted");const p=(e,t)=>(function(n,r){if(i&&i.owner===c&&!o.returnsCursor)i.endSession(()=>(delete a.session,n?t(n):u?e(u(r)):void e(r)));else{if(n)return t(n);if(u)return e(u(r));e(r)}});if("function"==typeof l){l=n.pop();const e=p(e=>l(null,e),e=>l(e,null));n.push(e);try{return t.apply(null,n)}catch(t){throw e(t),t}}if(null!=n[n.length-1])throw new TypeError("final argument to `executeOperation` must be a callback");return new s(function(e,r){const o=p(e,r);n[n.length-1]=o;try{return t.apply(null,n)}catch(e){o(e)}})},applyRetryableWrites:function(e,t){return t&&t.s.options.retryWrites&&(e.retryWrites=!0),e},applyWriteConcern:function(e,t,n){n=n||{};const r=t.db,o=t.collection;if(n.session&&n.session.inTransaction())return e.writeConcern&&delete e.writeConcern,e;if(null!=n.w||null!=n.j||null!=n.fsync){const t={};return null!=n.w&&(t.w=n.w),null!=n.wtimeout&&(t.wtimeout=n.wtimeout),null!=n.j&&(t.j=n.j),null!=n.fsync&&(t.fsync=n.fsync),Object.assign(e,{writeConcern:t})}return!o||null==o.writeConcern.w&&null==o.writeConcern.j&&null==o.writeConcern.fsync?!r||null==r.writeConcern.w&&null==r.writeConcern.j&&null==r.writeConcern.fsync?e:Object.assign(e,{writeConcern:Object.assign({},r.writeConcern)}):Object.assign(e,{writeConcern:Object.assign({},o.writeConcern)})},resolveReadPreference:function(e,t){e=e||{};const n=(t=t||{}).db,r=t.collection,s=t.default,i=e.session;let a;if(e.readPreference?a=e.readPreference:i&&i.inTransaction()&&i.transaction.options.readPreference?a=i.transaction.options.readPreference:r&&r.s.readPreference?a=r.s.readPreference:n&&n.s.readPreference?a=n.s.readPreference:s&&(a=s),null==a)return null;if("string"==typeof a)a=new o(a);else if(!a||a instanceof o||"object"!=typeof a){if(!(a instanceof o))throw new TypeError("Invalid read preference: "+a)}else{const e=a.mode||a.preference;e&&"string"==typeof e&&(a=new o(e,a.tags,{maxStalenessSeconds:a.maxStalenessSeconds}))}return a},isPromiseLike:function(e){return e&&"function"==typeof e.then},decorateWithCollation:function(e,t,n){const o=t.s&&t.s.topology;if(!o)throw new TypeError('parameter "target" is missing a topology');const s=t.s.topology.capabilities();if(n.collation&&"object"==typeof n.collation){if(!s||!s.commandsTakeCollation)throw new r(`server ${o.s.coreTopology.name} does not support collation`);e.collation=n.collation}},decorateWithReadConcern:function(e,t){let n=Object.assign({},e.readConcern||{});t.s.readConcern&&Object.assign(n,t.s.readConcern),Object.keys(n).length>0&&Object.assign(e,{readConcern:n})},deprecateOptions:function(e,t){if(!0===process.noDeprecation)return t;const n=e.msgHandler?e.msgHandler:l,r=new Set;function o(){const o=arguments[e.optionsIndex];return a(o)&&0!==Object.keys(o).length?(e.deprecatedOptions.forEach(t=>{if(o.hasOwnProperty(t)&&!r.has(t)){r.add(t);const o=n(e.name,t);if(u(o),this&&this.getLogger){const e=this.getLogger();e&&e.warn(o)}}}),t.apply(this,arguments)):t.apply(this,arguments)}return Object.setPrototypeOf(o,t),t.prototype&&(o.prototype=t.prototype),o}}},function(e,t){e.exports=require("util")},function(e,t,n){"use strict";var r=n(75),o=n(60);const s=n(16).retrieveEJSON();try{var i=o("bson-ext");i&&(r=i)}catch(e){}e.exports={MongoError:n(4).MongoError,MongoNetworkError:n(4).MongoNetworkError,MongoParseError:n(4).MongoParseError,MongoTimeoutError:n(4).MongoTimeoutError,MongoWriteConcernError:n(4).MongoWriteConcernError,mongoErrorContextSymbol:n(4).mongoErrorContextSymbol,Connection:n(77),Server:n(62),ReplSet:n(133),Mongos:n(135),Logger:n(23),Cursor:n(49),ReadPreference:n(22),Sessions:n(136),BSON:r,EJSON:s,Query:n(12).Query,defaultAuthProviders:n(47).defaultAuthProviders,MongoCR:n(78),X509:n(79),Plain:n(80),GSSAPI:n(81),ScramSHA1:n(48).ScramSHA1,ScramSHA256:n(48).ScramSHA256,parseConnectionString:n(137)}},function(e,t,n){"use strict";const r=n(0).applyWriteConcern,o=n(0).applyRetryableWrites,s=n(0).checkCollectionName,i=n(2).BSON.Code,a=n(7).createIndex,c=n(0).decorateCommand,u=n(0).decorateWithCollation,l=n(0).decorateWithReadConcern,p=n(7).ensureIndex,f=n(7).evaluate,h=n(7).executeCommand,d=n(7).executeDbAdminCommand,m=n(0).formattedOrderClause,y=n(0).resolveReadPreference,g=n(0).handleCallback,b=n(7).indexInformation,v=n(0).isObject,S=n(2).BSON.Long,w=n(2).MongoError,O=n(2).ReadPreference,_=n(0).toError,T='function () {\nvar c = db[ns].find(condition);\nvar map = new Map();\nvar reduce_function = reduce;\n\nwhile (c.hasNext()) {\nvar obj = c.next();\nvar key = {};\n\nfor (var i = 0, len = keys.length; i < len; ++i) {\nvar k = keys[i];\nkey[k] = obj[k];\n}\n\nvar aggObj = map.get(key);\n\nif (aggObj == null) {\nvar newObj = Object.extend({}, key);\naggObj = Object.extend(newObj, initial);\nmap.put(key, aggObj);\n}\n\nreduce_function(obj, aggObj);\n}\n\nreturn { "result": map.values() };\n}';function C(e,t,n){const r=n.skip,o=n.limit;let s=n.hint;const i=n.maxTimeMS;t=t||{};const a={count:n.collectionName,query:t};return e.s.numberOfRetries?(e.s.options.hint?s=e.s.options.hint:e.s.cmd.hint&&(s=e.s.cmd.hint),u(a,e,e.s.cmd)):u(a,e,n),"number"==typeof r&&(a.skip=r),"number"==typeof o&&(a.limit=o),"number"==typeof i&&(a.maxTimeMS=i),s&&(a.hint=s),l(a,e),a}function E(e,t,n){if(null!=n){if(e&&n)return n(e);if(null==t)return n(null,{result:{ok:1}});t.deletedCount=t.result.n,n&&n(null,t)}}function N(e,t,n,o){const s={dropIndexes:e.s.name,index:t};r(s,{db:e.s.db,collection:e},n),h(e.s.db,s,n,(e,t)=>{if("function"==typeof o)return e?g(o,e,null):void g(o,null,t)})}function I(e,t,n,s,i,a){const c={findAndModify:e.s.name,query:t};(n=m(n))&&(c.sort=n),c.new=!!i.new,c.remove=!!i.remove,c.upsert=!!i.upsert;const l=i.projection||i.fields;l&&(c.fields=l),i.arrayFilters&&(c.arrayFilters=i.arrayFilters,delete i.arrayFilters),s&&!i.remove&&(c.update=s),i.maxTimeMS&&(c.maxTimeMS=i.maxTimeMS),i.serializeFunctions=i.serializeFunctions||e.s.serializeFunctions,i.checkKeys=!1;let p=Object.assign({},i);p=o(p,e.s.db),(p=r(p,{db:e.s.db,collection:e},i)).writeConcern&&(c.writeConcern=p.writeConcern),!0===p.bypassDocumentValidation&&(c.bypassDocumentValidation=p.bypassDocumentValidation),p.readPreference=O.primary;try{u(c,e,p)}catch(e){return a(e,null)}h(e.s.db,c,p,(e,t)=>e?g(a,e,null):g(a,null,t))}function x(e,t,n){b(e.s.db,e.s.name,t,n)}function A(e,t,n,s){"function"==typeof n&&(s=n,n={}),n=n||{},t=Array.isArray(t)?t:[t];let i=Object.assign({},n);i=o(i,e.s.db),!0===(i=r(i,{db:e.s.db,collection:e},n)).keepGoing&&(i.ordered=!1),i.serializeFunctions=n.serializeFunctions||e.s.serializeFunctions,t=B(e,t,n),e.s.topology.insert(e.s.namespace,t,i,(e,n)=>{if(null!=s){if(e)return g(s,e);if(null==n)return g(s,null,null);if(n.result.code)return g(s,_(n.result));if(n.result.writeErrors)return g(s,_(n.result.writeErrors[0]));n.ops=t,g(s,null,n)}})}function k(e,t,n){e.s.db.listCollections({name:e.s.name},t).toArray((t,r)=>t?g(n,t):0===r.length?g(n,w.create({message:`collection ${e.s.namespace} not found`,driver:!0})):void g(n,t,r[0].options||null))}function B(e,t,n){const r="boolean"==typeof n.forceServerObjectId?n.forceServerObjectId:e.s.db.options.forceServerObjectId;return!0===r?t:t.map(t=>(!0!==r&&null==t._id&&(t._id=e.s.pkFactory.createPk()),t))}function M(e){if(!v(e)||"ObjectID"===e._bsontype)return e;const t=Object.keys(e);let n;const r={};for(let o=t.length-1;o>=0;o--)"function"==typeof e[n=t[o]]?r[n]=new i(String(e[n])):r[n]=M(e[n]);return r}function D(e,t,n,s){"function"==typeof n?(s=n,n={}):"function"==typeof t&&(s=t,n={},t={}),n=n||{};let i=Object.assign({},n);i=o(i,e.s.db),i=r(i,{db:e.s.db,collection:e},n),null==t&&(t={});const a={q:t,limit:0};n.single?a.limit=1:i.retryWrites&&(i.retryWrites=!1);try{u(i,e,n)}catch(e){return s(e,null)}e.s.topology.remove(e.s.namespace,[a],i,(e,t)=>{if(null!=s)return e?g(s,e,null):null==t?g(s,null,null):t.result.code?g(s,_(t.result)):t.result.writeErrors?g(s,_(t.result.writeErrors[0])):void g(s,null,t)})}function R(e,t,n){if(null!=n){if(e)return n(e);if(null==t)return n(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,n(null,t)}}function P(e,t,n,s,i){if("function"==typeof s&&(i=s,s=null),null==s&&(s={}),"function"!=typeof i&&(i=null),null==t||"object"!=typeof t)return i(_("selector must be a valid JavaScript object"));if(null==n||"object"!=typeof n)return i(_("document must be a valid JavaScript object"));let a=Object.assign({},s);a=o(a,e.s.db),(a=r(a,{db:e.s.db,collection:e},s)).serializeFunctions=s.serializeFunctions||e.s.serializeFunctions;const c={q:t,u:n};c.upsert=void 0!==s.upsert&&!!s.upsert,c.multi=void 0!==s.multi&&!!s.multi,a.arrayFilters&&(c.arrayFilters=a.arrayFilters,delete a.arrayFilters),a.retryWrites&&c.multi&&(a.retryWrites=!1);try{u(a,e,s)}catch(e){return i(e,null)}e.s.topology.update(e.s.namespace,[c],a,(e,t)=>{if(null!=i)return e?g(i,e,null):null==t?g(i,null,null):t.result.code?g(i,_(t.result)):t.result.writeErrors?g(i,_(t.result.writeErrors[0])):void g(i,null,t)})}e.exports={bulkWrite:function(e,t,n,s){e.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=e.s.options.ignoreUndefined);const i=!0===n.ordered||null==n.ordered?e.initializeOrderedBulkOp(n):e.initializeUnorderedBulkOp(n);let a=!1;try{for(let e=0;e<t.length;e++){const n=Object.keys(t[e])[0];t[e][n].collation&&(a=!0),i.raw(t[e])}}catch(e){return s(e,null)}let c=Object.assign({},n);c=o(c,e.s.db);const u=(c=r(c,{db:e.s.db,collection:e},n)).writeConcern?c.writeConcern:{},l=e.s.topology.capabilities();if(a&&l&&!l.commandsTakeCollation)return s(new w("server/primary/mongos does not support collation"));i.execute(u,c,(e,t)=>{if(!t&&e)return s(e,null);t.insertedCount=t.nInserted,t.matchedCount=t.nMatched,t.modifiedCount=t.nModified||0,t.deletedCount=t.nRemoved,t.upsertedCount=t.getUpsertedIds().length,t.upsertedIds={},t.insertedIds={},t.n=t.insertedCount;const n=t.getInsertedIds();for(let e=0;e<n.length;e++)t.insertedIds[n[e].index]=n[e]._id;const r=t.getUpsertedIds();for(let e=0;e<r.length;e++)t.upsertedIds[r[e].index]=r[e]._id;s(null,t)})},checkForAtomicOperators:function(e){const t=Object.keys(e);return 0===t.length?_("The update operation document must contain at least one atomic operator."):"$"!==t[0][0]?_("the update operation document must contain atomic operators."):void 0},count:function(e,t,n,r){let o;"function"==typeof n&&(r=n,n={}),(n=Object.assign({},n)).collectionName=e.s.name,n.readPreference=y(n,{db:e.s.db,collection:e});try{o=C(e,t,n)}catch(e){return r(e)}h(e.s.db,o,n,(e,t)=>{if(e)return g(r,e);g(r,null,t.n)})},countDocuments:function(e,t,n,r){const o=n.skip,s=n.limit;n=Object.assign({},n);const i=[{$match:t}];"number"==typeof o&&i.push({$skip:o}),"number"==typeof s&&i.push({$limit:s}),i.push({$group:{_id:null,n:{$sum:1}}}),delete n.limit,delete n.skip,e.aggregate(i,n).toArray((e,t)=>{if(e)return g(r,e);g(r,null,t.length?t[0].n:0)})},buildCountCommand:C,createIndex:function(e,t,n,r){a(e.s.db,e.s.name,t,n,r)},createIndexes:function(e,t,n,r){const o=e.s.topology.capabilities();for(let e=0;e<t.length;e++)if(null==t[e].name){const n=[];if(t[e].collation&&o&&!o.commandsTakeCollation)return r(new w("server/primary/mongos does not support collation"));for(let r in t[e].key)n.push(`${r}_${t[e].key[r]}`);t[e].name=n.join("_")}n=Object.assign({},n,{readPreference:O.PRIMARY}),h(e.s.db,{createIndexes:e.s.name,indexes:t},n,r)},deleteMany:function(e,t,n,r){n.single=!1,D(e,t,n,(e,t)=>E(e,t,r))},deleteOne:function(e,t,n,r){n.single=!0,D(e,t,n,(e,t)=>E(e,t,r))},distinct:function(e,t,n,r,o){const s=r.maxTimeMS,i={distinct:e.s.name,key:t,query:n};(r=Object.assign({},r)).readPreference=y(r,{db:e.s.db,collection:e}),"number"==typeof s&&(i.maxTimeMS=s),l(i,e,r);try{u(i,e,r)}catch(e){return o(e,null)}h(e.s.db,i,r,(e,t)=>{if(e)return g(o,e);g(o,null,t.values)})},dropIndex:N,dropIndexes:function(e,t,n){N(e,"*",t,e=>{if(e)return g(n,e,!1);g(n,null,!0)})},ensureIndex:function(e,t,n,r){p(e.s.db,e.s.name,t,n,r)},findAndModify:I,findAndRemove:function(e,t,n,r,o){r.remove=!0,I(e,t,n,null,r,o)},findOne:function(e,t,n,r){e.find(t,n).limit(-1).batchSize(1).next((e,t)=>{if(null!=e)return g(r,_(e),null);g(r,null,t)})},findOneAndDelete:function(e,t,n,r){const o=Object.assign({},n);o.fields=n.projection,o.remove=!0,I(e,t,n.sort,null,o,r)},findOneAndReplace:function(e,t,n,r,o){const s=Object.assign({},r);s.fields=r.projection,s.update=!0,s.new=void 0!==r.returnOriginal&&!r.returnOriginal,s.upsert=void 0!==r.upsert&&!!r.upsert,I(e,t,r.sort,n,s,o)},findOneAndUpdate:function(e,t,n,r,o){const s=Object.assign({},r);s.fields=r.projection,s.update=!0,s.new="boolean"==typeof r.returnOriginal&&!r.returnOriginal,s.upsert="boolean"==typeof r.upsert&&r.upsert,I(e,t,r.sort,n,s,o)},geoHaystackSearch:function(e,t,n,r,o){let s={geoSearch:e.s.name,near:[t,n]};s=c(s,r,["readPreference","session"]),(r=Object.assign({},r)).readPreference=y(r,{db:e.s.db,collection:e}),l(s,e,r),h(e.s.db,s,r,(e,t)=>{if(e)return g(o,e);(t.err||t.errmsg)&&g(o,_(t)),g(o,null,t)})},group:function(e,t,n,r,o,s,a,c,p){if(a){const a=o&&"Code"===o._bsontype?o:new i(o),f={group:{ns:e.s.name,$reduce:a,cond:n,initial:r,out:"inline"}};if(null!=s&&(f.group.finalize=s),"function"==typeof t||t&&"Code"===t._bsontype)f.group.$keyf=t&&"Code"===t._bsontype?t:new i(t);else{const e={};t.forEach(t=>{e[t]=1}),f.group.key=e}(c=Object.assign({},c)).readPreference=y(c,{db:e.s.db,collection:e}),l(f,e,c);try{u(f,e,c)}catch(e){return p(e,null)}h(e.s.db,f,c,(e,t)=>{if(e)return g(p,e,null);g(p,null,t.retval)})}else{const s=null!=o&&"Code"===o._bsontype?o.scope:{};s.ns=e.s.name,s.keys=t,s.condition=n,s.initial=r;const a=T.replace(/ reduce;/,o.toString()+";");f(e.s.db,new i(a,s),null,c,(e,t)=>{if(e)return g(p,e,null);g(p,null,t.result||t)})}},indexes:function(e,t,n){t=Object.assign({},{full:!0},t),b(e.s.db,e.s.name,t,n)},indexExists:function(e,t,n,r){x(e,n,(e,n)=>{if(null!=e)return g(r,e,null);if(!Array.isArray(t))return g(r,null,null!=n[t]);for(let e=0;e<t.length;e++)if(null==n[t[e]])return g(r,null,!1);return g(r,null,!0)})},indexInformation:x,insertOne:function(e,t,n,r){if(Array.isArray(t))return r(w.create({message:"doc parameter must be an object",driver:!0}));A(e,[t],n,(e,n)=>{if(null!=r){if(e&&r)return r(e);if(null==n)return r(null,{result:{ok:1}});n.insertedCount=n.result.n,n.insertedId=t._id,r&&r(null,n)}})},isCapped:function(e,t,n){k(e,t,(e,t)=>{if(e)return g(n,e);g(n,null,!(!t||!t.capped))})},mapReduce:function(e,t,o,s,i){const a={mapreduce:e.s.name,map:t,reduce:o},c=["readPreference","session","bypassDocumentValidation"];for(let e in s)"scope"===e?a[e]=M(s[e]):-1===c.indexOf(e)&&(a[e]=s[e]);(s=Object.assign({},s)).readPreference=y(s,{db:e.s.db,collection:e}),!1!==s.readPreference&&"primary"!==s.readPreference&&s.out&&1!==s.out.inline&&"inline"!==s.out?(s.readPreference="primary",r(a,{db:e.s.db,collection:e},s)):l(a,e,s),!0===s.bypassDocumentValidation&&(a.bypassDocumentValidation=s.bypassDocumentValidation);try{u(a,e,s)}catch(e){return i(e,null)}h(e.s.db,a,s,(t,r)=>{if(t)return g(i,t);if(1!==r.ok||r.err||r.errmsg)return g(i,_(r));const o={};if(r.timeMillis&&(o.processtime=r.timeMillis),r.counts&&(o.counts=r.counts),r.timing&&(o.timing=r.timing),r.results)return null!=s.verbose&&s.verbose?g(i,null,{results:r.results,stats:o}):g(i,null,r.results);let a=null;if(null!=r.result&&"object"==typeof r.result){const t=r.result;a=new(n(28))(t.db,e.s.db.s.topology,e.s.db.s.options).collection(t.collection)}else a=e.s.db.collection(r.result);if(null==s.verbose||!s.verbose)return g(i,t,a);g(i,t,{collection:a,stats:o})})},optionsOp:k,parallelCollectionScan:function(e,t,n){const r={parallelCollectionScan:e.s.name,numCursors:t.numCursors};l(r,e,t);const o=t.raw;delete t.raw,h(e.s.db,r,t,(r,s)=>{if(r)return g(n,r,null);if(null==s)return g(n,new Error("no result returned for parallelCollectionScan"),null);t=Object.assign({explicitlyIgnoreSession:!0},t);const i=[];o&&(t.raw=o);for(let n=0;n<s.cursors.length;n++){const r=s.cursors[n].cursor.id,o="number"==typeof r?S.fromNumber(r):r;i.push(e.s.topology.cursor(e.s.namespace,o,t))}g(n,null,i)})},prepareDocs:B,reIndex:function(e,t,n){const r={reIndex:e.s.name};h(e.s.db,r,t,(e,t)=>{if(null!=n)return e?g(n,e,null):void g(n,null,!!t.ok)})},removeDocuments:D,rename:function(e,t,o,i){const a=n(27);s(t);const c={renameCollection:`${e.s.dbName}.${e.s.name}`,to:`${e.s.dbName}.${t}`,dropTarget:"boolean"==typeof o.dropTarget&&o.dropTarget};r(c,{db:e.s.db,collection:e},o),d(e.s.db.admin().s.db,c,o,(n,r)=>{if(n)return g(i,n,null);if(r.errmsg)return g(i,_(r),null);try{return g(i,null,new a(e.s.db,e.s.topology,e.s.dbName,t,e.s.pkFactory,e.s.options))}catch(n){return g(i,_(n),null)}})},replaceOne:function(e,t,n,r,o){r.multi=!1,P(e,t,n,r,(e,t)=>{if(null!=o){if(e&&o)return o(e);if(null==t)return o(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,t.ops=[n],o&&o(null,t)}})},save:function(e,t,n,o){const s=r(Object.assign({},n),{db:e.s.db,collection:e},n);if(null!=t._id)return s.upsert=!0,P(e,{_id:t._id},t,s,o);A(e,[t],s,(e,n)=>{if(null!=o)return null==t?g(o,null,null):e?g(o,e,null):void g(o,null,n)})},stats:function(e,t,n){const r={collStats:e.s.name};null!=t.scale&&(r.scale=t.scale),(t=Object.assign({},t)).readPreference=y(t,{db:e.s.db,collection:e}),h(e.s.db,r,t,n)},updateDocuments:P,updateMany:function(e,t,n,r,o){r.multi=!0,P(e,t,n,r,(e,t)=>R(e,t,o))},updateOne:function(e,t,n,r,o){r.multi=!1,P(e,t,n,r,(e,t)=>R(e,t,o))}}},function(e,t,n){"use strict";const r=Symbol("mongoErrorContextSymbol");class o extends Error{constructor(e){if(e instanceof Error)super(e.message),this.stack=e.stack;else{if("string"==typeof e)super(e);else for(var t in super(e.message||e.errmsg||e.$err||"n/a"),e)this[t]=e[t];Error.captureStackTrace(this,this.constructor)}this.name="MongoError",this[r]=this[r]||{}}static create(e){return new o(e)}}class s extends o{constructor(e){super(e),this.name="MongoNetworkError",this.errorLabels=["TransientTransactionError"]}}const i=new Set([6,7,89,91,189,9001,10107,11600,11602,13435,13436]);e.exports={MongoError:o,MongoNetworkError:s,MongoParseError:class extends o{constructor(e){super(e),this.name="MongoParseError"}},MongoTimeoutError:class extends o{constructor(e){super(e),this.name="MongoTimeoutError"}},MongoWriteConcernError:class extends o{constructor(e,t){super(e),this.name="MongoWriteConcernError",null!=t&&(this.result=t)}},mongoErrorContextSymbol:r,isRetryableError:function(e){return i.has(e.code)||e instanceof s||e.message.match(/not master/)||e.message.match(/node is recovering/)}}},function(e,t,n){"use strict";const r=n(6).MongoError,o=n(6).ReadPreference;var s=t.formatSortValue=function(e){switch((""+e).toLowerCase()){case"ascending":case"asc":case"1":return 1;case"descending":case"desc":case"-1":return-1;default:throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]")}},i=t.formattedOrderClause=function(e){var t={};if(null==e)return null;if(Array.isArray(e)){if(0===e.length)return null;for(var n=0;n<e.length;n++)e[n].constructor===String?t[e[n]]=1:t[e[n][0]]=s(e[n][1])}else if(null!=e&&"object"==typeof e)t=e;else{if("string"!=typeof e)throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");t[e]=1}return t},a=t.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},c=["w","j","wtimeout","fsync"];const u=process.emitWarning?e=>process.emitWarning(e,"DeprecationWarning"):e=>console.error(e);function l(e,t){return`${e} option [${t}] is deprecated and will be removed in a later version.`}e.exports={filterOptions:function(e,t){var n={};for(var r in e)-1!==t.indexOf(r)&&(n[r]=e[r]);return n},mergeOptions:function(e,t){for(var n in t)e[n]=t[n];return e},translateOptions:function(e,t){var n={sslCA:"ca",sslCRL:"crl",sslValidate:"rejectUnauthorized",sslKey:"key",sslCert:"cert",sslPass:"passphrase",socketTimeoutMS:"socketTimeout",connectTimeoutMS:"connectionTimeout",replicaSet:"setName",rs_name:"setName",secondaryAcceptableLatencyMS:"acceptableLatency",connectWithNoPrimary:"secondaryOnlyConnectionAllowed",acceptableLatencyMS:"localThresholdMS"};for(var r in t)n[r]?e[n[r]]=t[r]:e[r]=t[r];return e},shallowClone:function(e){var t={};for(var n in e)t[n]=e[n];return t},getSingleProperty:function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},checkCollectionName:function(e){if("string"!=typeof e)throw new r("collection name must be a String");if(!e||-1!==e.indexOf(".."))throw new r("collection names cannot be empty");if(-1!==e.indexOf("$")&&null==e.match(/((^\$cmd)|(oplog\.\$main))/))throw new r("collection names must not contain '$'");if(null!=e.match(/^\.|\.$/))throw new r("collection names must not start or end with '.'");if(-1!==e.indexOf("\0"))throw new r("collection names cannot contain a null character")},toError:function(e){if(e instanceof Error)return e;for(var t=e.err||e.errmsg||e.errMessage||e,n=r.create({message:t,driver:!0}),o="object"==typeof e?Object.keys(e):[],s=0;s<o.length;s++)try{n[o[s]]=e[o[s]]}catch(e){}return n},formattedOrderClause:i,parseIndexOptions:function(e){var t,n={},r=[];return"string"==typeof e?(r.push(e+"_1"),n[e]=1):Array.isArray(e)?e.forEach(function(e){"string"==typeof e?(r.push(e+"_1"),n[e]=1):Array.isArray(e)?(r.push(e[0]+"_"+(e[1]||1)),n[e[0]]=e[1]||1):a(e)&&(t=Object.keys(e)).forEach(function(t){r.push(t+"_"+e[t]),n[t]=e[t]})}):a(e)&&(t=Object.keys(e)).forEach(function(t){r.push(t+"_"+e[t]),n[t]=e[t]}),{name:r.join("_"),keys:t,fieldHash:n}},normalizeHintField:function(e){var t=null;if("string"==typeof e)t=e;else if(Array.isArray(e))t={},e.forEach(function(e){t[e]=1});else if(null!=e&&"object"==typeof e)for(var n in t={},e)t[n]=e[n];return t},handleCallback:function(e,t,n,r){try{if(null==e)return;if(e)return r?e(t,n,r):e(t,n)}catch(t){return process.nextTick(function(){throw t}),!1}return!0},decorateCommand:function(e,t,n){for(var r in t)-1===n.indexOf(r)&&(e[r]=t[r]);return e},isObject:a,debugOptions:function(e,t){var n={};return e.forEach(function(e){n[e]=t[e]}),n},MAX_JS_INT:Number.MAX_SAFE_INTEGER+1,mergeOptionsAndWriteConcern:function(e,t,n,r){for(var o=0;o<n.length;o++)e[n[o]]||void 0===t[n[o]]||(e[n[o]]=t[n[o]]);if(!r)return e;var s=!1;for(o=0;o<c.length;o++)if(e[c[o]]){s=!0;break}if(!s)for(o=0;o<c.length;o++)t[c[o]]&&(e[c[o]]=t[c[o]]);return e},translateReadPreference:function(e){var t=null;if(!e.readPreference)return e;if("string"==typeof(t=e.readPreference))e.readPreference=new o(t);else if(!t||t instanceof o||"object"!=typeof t){if(!(t instanceof o))throw new TypeError("Invalid read preference: "+t)}else{const n=t.mode||t.preference;n&&"string"==typeof n&&(e.readPreference=new o(n,t.tags,{maxStalenessSeconds:t.maxStalenessSeconds}))}return e},executeOperation:(e,t,n,o)=>{if(null==e)throw new TypeError("This method requires a valid topology instance");if(!Array.isArray(n))throw new TypeError("This method requires an array of arguments to apply");o=o||{};const s=e.s.promiseLibrary;let i,a,c,u=o.resultMutator,l=n[n.length-1];if(!o.skipSessions&&e.hasSessionSupport())if(null==(a=n[n.length-2])||null==a.session){c=Symbol(),i=e.startSession({owner:c});const t=n.length-2;n[t]=Object.assign({},n[t],{session:i})}else if(a.session&&a.session.hasEnded)throw new r("Use of expired sessions is not permitted");const p=(e,t)=>(function(n,r){if(i&&i.owner===c&&!o.returnsCursor)i.endSession(()=>(delete a.session,n?t(n):u?e(u(r)):void e(r)));else{if(n)return t(n);if(u)return e(u(r));e(r)}});if("function"==typeof l){l=n.pop();const e=p(e=>l(null,e),e=>l(e,null));n.push(e);try{return t.apply(null,n)}catch(t){throw e(t),t}}if(null!=n[n.length-1])throw new TypeError("final argument to `executeOperation` must be a callback");return new s(function(e,r){const o=p(e,r);n[n.length-1]=o;try{return t.apply(null,n)}catch(e){o(e)}})},applyRetryableWrites:function(e,t){return t&&t.s.options.retryWrites&&(e.retryWrites=!0),e},applyWriteConcern:function(e,t,n){n=n||{};const r=t.db,o=t.collection;if(n.session&&n.session.inTransaction())return e.writeConcern&&delete e.writeConcern,e;if(null!=n.w||null!=n.j||null!=n.fsync){const t={};return null!=n.w&&(t.w=n.w),null!=n.wtimeout&&(t.wtimeout=n.wtimeout),null!=n.j&&(t.j=n.j),null!=n.fsync&&(t.fsync=n.fsync),Object.assign(e,{writeConcern:t})}return!o||null==o.writeConcern.w&&null==o.writeConcern.j&&null==o.writeConcern.fsync?!r||null==r.writeConcern.w&&null==r.writeConcern.j&&null==r.writeConcern.fsync?e:Object.assign(e,{writeConcern:Object.assign({},r.writeConcern)}):Object.assign(e,{writeConcern:Object.assign({},o.writeConcern)})},resolveReadPreference:function(e,t){e=e||{};const n=(t=t||{}).db,r=t.collection,s=t.default,i=e.session;let a;if(e.readPreference?a=e.readPreference:i&&i.inTransaction()&&i.transaction.options.readPreference?a=i.transaction.options.readPreference:r&&r.s.readPreference?a=r.s.readPreference:n&&n.s.readPreference?a=n.s.readPreference:s&&(a=s),null==a)return null;if("string"==typeof a)a=new o(a);else if(!a||a instanceof o||"object"!=typeof a){if(!(a instanceof o))throw new TypeError("Invalid read preference: "+a)}else{const e=a.mode||a.preference;e&&"string"==typeof e&&(a=new o(e,a.tags,{maxStalenessSeconds:a.maxStalenessSeconds}))}return a},isPromiseLike:function(e){return e&&"function"==typeof e.then},decorateWithCollation:function(e,t,n){const o=t.s&&t.s.topology;if(!o)throw new TypeError('parameter "target" is missing a topology');const s=t.s.topology.capabilities();if(n.collation&&"object"==typeof n.collation){if(!s||!s.commandsTakeCollation)throw new r(`server ${o.s.coreTopology.name} does not support collation`);e.collation=n.collation}},decorateWithReadConcern:function(e,t){let n=Object.assign({},e.readConcern||{});t.s.readConcern&&Object.assign(n,t.s.readConcern),Object.keys(n).length>0&&Object.assign(e,{readConcern:n})},deprecateOptions:function(e,t){if(!0===process.noDeprecation)return t;const n=e.msgHandler?e.msgHandler:l,r=new Set;function o(){const o=arguments[e.optionsIndex];return a(o)&&0!==Object.keys(o).length?(e.deprecatedOptions.forEach(t=>{if(o.hasOwnProperty(t)&&!r.has(t)){r.add(t);const o=n(e.name,t);if(u(o),this&&this.getLogger){const e=this.getLogger();e&&e.warn(o)}}}),t.apply(this,arguments)):t.apply(this,arguments)}return Object.setPrototypeOf(o,t),t.prototype&&(o.prototype=t.prototype),o}}},function(e,t,n){"use strict";var r=n(159),o=n(151);const s=n(35).retrieveEJSON();try{var i=o("bson-ext");i&&(r=i)}catch(e){}e.exports={MongoError:n(11).MongoError,MongoNetworkError:n(11).MongoNetworkError,MongoParseError:n(11).MongoParseError,MongoTimeoutError:n(11).MongoTimeoutError,MongoWriteConcernError:n(11).MongoWriteConcernError,mongoErrorContextSymbol:n(11).mongoErrorContextSymbol,Connection:n(161),Server:n(153),ReplSet:n(195),Mongos:n(197),Logger:n(56),Cursor:n(110),ReadPreference:n(55),Sessions:n(198),BSON:r,EJSON:s,Query:n(24).Query,defaultAuthProviders:n(108).defaultAuthProviders,MongoCR:n(162),X509:n(163),Plain:n(164),GSSAPI:n(165),ScramSHA1:n(109).ScramSHA1,ScramSHA256:n(109).ScramSHA256,parseConnectionString:n(199)}},function(e,t,n){"use strict";const r=n(0).applyWriteConcern,o=n(2).BSON.Code,s=n(0).resolveReadPreference,i=n(18),a=n(0).debugOptions,c=n(0).handleCallback,u=n(2).MongoError,l=n(0).parseIndexOptions,p=n(2).ReadPreference,f=n(0).toError,h=n(83),d=n(3).count,m=n(3).findOne,y=n(3).remove,g=n(3).updateOne,b=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"],v=["w","wtimeout","j","fsync","autoIndexId","strict","serializeFunctions","pkFactory","raw","readPreference","session"];function S(e,t,n,o,s){let i=Object.assign({},{readPreference:p.PRIMARY},o);if((i=r(i,{db:e},o)).writeConcern&&"function"!=typeof s)throw u.create({message:"Cannot use a writeConcern without a provided callback",driver:!0});if(e.serverConfig&&e.serverConfig.isDestroyed())return s(new u("topology was destroyed"));!function(e,t,n,o,s){const i=l(n),a="string"==typeof o.name?o.name:i.name,h=[{name:a,key:i.fieldHash}],d=Object.keys(h[0]).concat(["writeConcern","w","wtimeout","j","fsync","readPreference","session"]);for(let e in o)-1===d.indexOf(e)&&(h[0][e]=o[e]);const m=e.s.topology.capabilities();if(h[0].collation&&m&&!m.commandsTakeCollation){const e=new u("server/primary/mongos does not support collation");return e.code=67,s(e)}const y=r({createIndexes:t,indexes:h},{db:e},o);o.readPreference=p.PRIMARY,w(e,y,o,(e,t)=>e?c(s,e,null):0===t.ok?c(s,f(t),null):void c(s,null,a))}(e,t,n,i,(r,a)=>{if(null==r)return c(s,r,a);if(67===r.code||11e3===r.code||85===r.code||86===r.code||11600===r.code||197===r.code)return c(s,r,a);const l=_(e,t,n,o);i.checkKeys=!1,e.s.topology.insert(`${e.s.databaseName}.${h.SYSTEM_INDEX_COLLECTION}`,l,i,(e,t)=>{if(null!=s)return e?c(s,e):null==t?c(s,null,null):t.result.writeErrors?c(s,u.create(t.result.writeErrors[0]),null):void c(s,null,l.name)})})}function w(e,t,n,r){if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new u("topology was destroyed"));const o=n.dbName||n.authdb||e.s.databaseName;n.readPreference=s(n,{db:e,default:p.primary}),e.s.logger.isDebug()&&e.s.logger.debug(`executing command ${JSON.stringify(t)} against ${o}.$cmd with options [${JSON.stringify(a(b,n))}]`),e.s.topology.command(`${o}.$cmd`,t,n,(e,t)=>e?c(r,e):n.full?c(r,null,t):void c(r,null,t.result))}function O(e,t,n,r){const o=null!=n.full&&n.full;if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new u("topology was destroyed"));e.collection(t).listIndexes(n).toArray((e,t)=>e?r(f(e)):Array.isArray(t)?o?c(r,null,t):void c(r,null,function(e){let t={};for(let n=0;n<e.length;n++){const r=e[n];t[r.name]=[];for(let e in r.key)t[r.name].push([e,r.key[e]])}return t}(t)):c(r,null,[]))}function _(e,t,n,r){const o=l(n),s=o.fieldHash,i="string"==typeof r.name?r.name:o.name,a={ns:e.databaseName+"."+t,key:s,name:i},c=null!=r&&"object"!=typeof r&&r;r=null==r||"boolean"==typeof r?{}:r;const u=Object.keys(a);for(let e in r)-1===u.indexOf(e)&&(a[e]=r[e]);null==a.unique&&(a.unique=c);const p=["w","wtimeout","j","fsync","readPreference","session"];for(let e=0;e<p.length;e++)delete a[p[e]];return a}e.exports={addUser:function(e,t,o,s,a){const l=n(28);if(e.serverConfig&&e.serverConfig.isDestroyed())return a(new u("topology was destroyed"));!function(e,t,n,o,s){if("string"==typeof t&&null!=n&&"object"==typeof n&&(o=n,n=null),"function"==typeof o&&(s=o,o={}),null!=o.digestPassword)return s(f("The digestPassword option is not supported via add_user. Please use db.command('createUser', ...) instead for this option."));const a=null!=o.customData?o.customData:{};let u=Array.isArray(o.roles)?o.roles:[];const l="number"==typeof o.maxTimeMS?o.maxTimeMS:null;0===u.length&&console.log("Creating a user without roles is deprecated in MongoDB >= 2.6");const h={writeCommand:!0};o.dbName&&(h.dbName=o.dbName),null!=l&&(h.maxTimeMS=l),"admin"!==e.databaseName.toLowerCase()&&"admin"!==o.dbName||Array.isArray(o.roles)?Array.isArray(o.roles)||(u=["dbOwner"]):u=["root"];const d=e.s.topology.lastIsMaster().maxWireVersion>=7;let m={createUser:t,customData:a,roles:u,digestPassword:d};m=r(m,{db:e},o);let y=n;if(!d){const e=i.createHash("md5");e.update(t+":mongo:"+n),y=e.digest("hex")}"string"==typeof n&&(m.pwd=y),h.readPreference=p.primary,w(e,m,h,(e,n)=>e&&0===e.ok&&void 0===e.code?c(s,{code:-5e3},null):e?c(s,e,null):void c(s,n.ok?null:f(n),n.ok?[{user:t,pwd:""}]:null))}(e,t,o,s,(e,n)=>{if(e&&-5e3===e.code){const e=r(Object.assign({},s),{db:p},s),n=i.createHash("md5");n.update(t+":mongo:"+o);const u=n.digest("hex"),p=s.dbName?new l(s.dbName,p.s.topology,p.s.options):p,f=p.collection(h.SYSTEM_USER_COLLECTION);d(f,{},e,(n,r)=>{if(null!=n)return c(a,n,null);const o=Object.assign({projection:{dbName:1}},e);f.find({user:t},o).toArray(n=>{if(null!=n)return c(a,n,null);e.upsert=!0,g(f,{user:t},{$set:{user:t,pwd:u}},e,e=>0===r&&e?c(a,null,[{user:t,pwd:u}]):e?c(a,e,null):void c(a,null,[{user:t,pwd:u}]))})})}else{if(e)return c(a,e);c(a,e,n)}})},collections:function(e,t,r){const o=n(27);t=Object.assign({},t,{nameOnly:!0}),e.listCollections({},t).toArray((t,n)=>{if(null!=t)return c(r,t,null);n=n.filter(e=>-1===e.name.indexOf("$")),c(r,null,n.map(t=>new o(e,e.s.topology,e.s.databaseName,t.name,e.s.pkFactory,e.s.options)))})},createCollection:function(e,t,o,s){const i=n(27),a=r(Object.assign({},o),{db:e},o);if(e.serverConfig&&e.serverConfig.isDestroyed())return s(new u("topology was destroyed"));const l=Object.assign({},a,{nameOnly:!0});e.listCollections({name:t},l).setReadPreference(p.PRIMARY).toArray((n,l)=>{if(null!=n)return c(s,n,null);if(l.length>0&&a.strict)return c(s,u.create({message:`Collection ${t} already exists. Currently in strict mode.`,driver:!0}),null);if(l.length>0)try{return c(s,null,new i(e,e.s.topology,e.s.databaseName,t,e.s.pkFactory,o))}catch(n){return c(s,n)}const f={create:t};r(f,{db:e},o);for(let e in o)null!=o[e]&&"function"!=typeof o[e]&&-1===v.indexOf(e)&&(f[e]=o[e]);a.readPreference=p.PRIMARY,w(e,f,a,n=>{if(n)return c(s,n);c(s,null,new i(e,e.s.topology,e.s.databaseName,t,e.s.pkFactory,o))})})},createListener:function(e,t,n){return function(r){if(n.listeners(t).length>0){n.emit(t,r,e);for(let n=0;n<e.s.children.length;n++)e.s.children[n].emit(t,r,e.s.children[n])}}},createIndex:S,dropCollection:function(e,t,n,r){w(e,t,n,(t,n)=>e.serverConfig&&e.serverConfig.isDestroyed()?r(new u("topology was destroyed")):t?c(r,t):n.ok?c(r,null,!0):void c(r,null,!1))},dropDatabase:function(e,t,n,r){w(e,t,n,(t,n)=>e.serverConfig&&e.serverConfig.isDestroyed()?r(new u("topology was destroyed")):null!=r?t?c(r,t,null):void c(r,null,!!n.ok):void 0)},ensureIndex:function(e,t,n,o,s){const i=r({},{db:e},o),a=_(e,t,n,o).name;if(e.serverConfig&&e.serverConfig.isDestroyed())return s(new u("topology was destroyed"));i.readPreference=p.PRIMARY,O(e,t,i,(r,i)=>{if(null!=r&&26!==r.code)return c(s,r,null);if(null!=i&&i[a]){if("function"==typeof s)return c(s,null,a)}else S(e,t,n,o,s)})},evaluate:function(e,t,n,r,s){let i=t,a=[];if(e.serverConfig&&e.serverConfig.isDestroyed())return s(new u("topology was destroyed"));i&&"Code"===i._bsontype||(i=new o(i)),null==n||Array.isArray(n)||"function"==typeof n?null!=n&&Array.isArray(n)&&"function"!=typeof n&&(a=n):a=[n];let l={$eval:i,args:a};r.nolock&&(l.nolock=r.nolock),r.readPreference=new p(p.PRIMARY),w(e,l,r,(e,t)=>e?c(s,e,null):t&&1===t.ok?c(s,null,t.retval):t?c(s,u.create({message:`eval failed: ${t.errmsg}`,driver:!0}),null):void c(s,e,t))},executeCommand:w,executeDbAdminCommand:function(e,t,n,r){e.s.topology.command("admin.$cmd",t,n,(t,n)=>e.serverConfig&&e.serverConfig.isDestroyed()?r(new u("topology was destroyed")):t?c(r,t):void c(r,null,n.result))},listCollectionsTransforms:function(e){const t=`${e}.`;return{doc:e=>{const n=e.name.indexOf(t);return e.name&&0===n&&(e.name=e.name.substr(n+t.length)),e}}},indexInformation:O,profilingInfo:function(e,t,n){try{e.collection("system.profile").find({},t).toArray(n)}catch(e){return n(e,null)}},profilingLevel:function(e,t,n){w(e,{profile:-1},t,(e,t)=>{if(null==e&&1===t.ok){const e=t.was;return 0===e?n(null,"off"):1===e?n(null,"slow_only"):2===e?n(null,"all"):n(new Error("Error: illegal profiling level value "+e),null)}n(null!=e?e:new Error("Error with profile command"),null)})},removeUser:function(e,t,o,s){const i=n(28);!function(e,t,n,o){if("function"==typeof n&&(o=n,n={}),n=n||{},e.serverConfig&&e.serverConfig.isDestroyed())return o(new u("topology was destroyed"));const s={writeCommand:!0};n.dbName&&(s.dbName=n.dbName);const i="number"==typeof n.maxTimeMS?n.maxTimeMS:null;null!=i&&(s.maxTimeMS=i);let a={dropUser:t};a=r(a,{db:e},n),s.readPreference=p.primary,w(e,a,s,(e,t)=>e&&!e.ok&&void 0===e.code?c(o,{code:-5e3}):e?c(o,e,null):void c(o,null,!!t.ok))}(e,t,o,(e,n)=>{if(e&&-5e3===e.code){const e=r(Object.assign({},o),{db:n},o),n=o.dbName?new i(o.dbName,n.s.topology,n.s.options):n,a=n.collection(h.SYSTEM_USER_COLLECTION);m(a,{user:t},e,(n,r)=>{if(null==r)return c(s,n,!1);y(a,{user:t},e,e=>{c(s,e,!0)})})}else{if(e)return c(s,e);c(s,e,n)}})},setProfilingLevel:function(e,t,n,r){const o={};let s=0;if("off"===t)s=0;else if("slow_only"===t)s=1;else{if("all"!==t)return r(new Error("Error: illegal profiling level value "+t));s=2}o.profile=s,w(e,o,n,(e,n)=>null==e&&1===n.ok?r(null,t):r(null!=e?e:new Error("Error with profile command"),null))},validateDatabaseName:function(e){if("string"!=typeof e)throw u.create({message:"database name must be a string",driver:!0});if(0===e.length)throw u.create({message:"database name cannot be the empty string",driver:!0});if("$external"===e)return;const t=[" ",".","$","/","\\"];for(let n=0;n<t.length;n++)if(-1!==e.indexOf(t[n]))throw u.create({message:"database names cannot contain the character '"+t[n]+"'",driver:!0})}}},function(e,t,n){"use strict";const r=n(5).applyWriteConcern,o=n(5).applyRetryableWrites,s=n(5).checkCollectionName,i=n(6).BSON.Code,a=n(14).createIndex,c=n(5).decorateCommand,u=n(5).decorateWithCollation,l=n(5).decorateWithReadConcern,p=n(14).ensureIndex,f=n(14).evaluate,h=n(14).executeCommand,d=n(14).executeDbAdminCommand,m=n(5).formattedOrderClause,y=n(5).resolveReadPreference,g=n(5).handleCallback,b=n(14).indexInformation,v=n(5).isObject,S=n(6).BSON.Long,w=n(6).MongoError,O=n(6).ReadPreference,_=n(5).toError,T='function () {\nvar c = db[ns].find(condition);\nvar map = new Map();\nvar reduce_function = reduce;\n\nwhile (c.hasNext()) {\nvar obj = c.next();\nvar key = {};\n\nfor (var i = 0, len = keys.length; i < len; ++i) {\nvar k = keys[i];\nkey[k] = obj[k];\n}\n\nvar aggObj = map.get(key);\n\nif (aggObj == null) {\nvar newObj = Object.extend({}, key);\naggObj = Object.extend(newObj, initial);\nmap.put(key, aggObj);\n}\n\nreduce_function(obj, aggObj);\n}\n\nreturn { "result": map.values() };\n}';function C(e,t,n){const r=n.skip,o=n.limit;let s=n.hint;const i=n.maxTimeMS;t=t||{};const a={count:n.collectionName,query:t};return e.s.numberOfRetries?(e.s.options.hint?s=e.s.options.hint:e.s.cmd.hint&&(s=e.s.cmd.hint),u(a,e,e.s.cmd)):u(a,e,n),"number"==typeof r&&(a.skip=r),"number"==typeof o&&(a.limit=o),"number"==typeof i&&(a.maxTimeMS=i),s&&(a.hint=s),l(a,e),a}function E(e,t,n){if(null!=n){if(e&&n)return n(e);if(null==t)return n(null,{result:{ok:1}});t.deletedCount=t.result.n,n&&n(null,t)}}function N(e,t,n,o){const s={dropIndexes:e.s.name,index:t};r(s,{db:e.s.db,collection:e},n),h(e.s.db,s,n,(e,t)=>{if("function"==typeof o)return e?g(o,e,null):void g(o,null,t)})}function I(e,t,n,s,i,a){const c={findAndModify:e.s.name,query:t};(n=m(n))&&(c.sort=n),c.new=!!i.new,c.remove=!!i.remove,c.upsert=!!i.upsert;const l=i.projection||i.fields;l&&(c.fields=l),i.arrayFilters&&(c.arrayFilters=i.arrayFilters,delete i.arrayFilters),s&&!i.remove&&(c.update=s),i.maxTimeMS&&(c.maxTimeMS=i.maxTimeMS),i.serializeFunctions=i.serializeFunctions||e.s.serializeFunctions,i.checkKeys=!1;let p=Object.assign({},i);p=o(p,e.s.db),(p=r(p,{db:e.s.db,collection:e},i)).writeConcern&&(c.writeConcern=p.writeConcern),!0===p.bypassDocumentValidation&&(c.bypassDocumentValidation=p.bypassDocumentValidation),p.readPreference=O.primary;try{u(c,e,p)}catch(e){return a(e,null)}h(e.s.db,c,p,(e,t)=>e?g(a,e,null):g(a,null,t))}function x(e,t,n){b(e.s.db,e.s.name,t,n)}function A(e,t,n,s){"function"==typeof n&&(s=n,n={}),n=n||{},t=Array.isArray(t)?t:[t];let i=Object.assign({},n);i=o(i,e.s.db),!0===(i=r(i,{db:e.s.db,collection:e},n)).keepGoing&&(i.ordered=!1),i.serializeFunctions=n.serializeFunctions||e.s.serializeFunctions,t=B(e,t,n),e.s.topology.insert(e.s.namespace,t,i,(e,n)=>{if(null!=s){if(e)return g(s,e);if(null==n)return g(s,null,null);if(n.result.code)return g(s,_(n.result));if(n.result.writeErrors)return g(s,_(n.result.writeErrors[0]));n.ops=t,g(s,null,n)}})}function k(e,t,n){e.s.db.listCollections({name:e.s.name},t).toArray((t,r)=>t?g(n,t):0===r.length?g(n,w.create({message:`collection ${e.s.namespace} not found`,driver:!0})):void g(n,t,r[0].options||null))}function B(e,t,n){const r="boolean"==typeof n.forceServerObjectId?n.forceServerObjectId:e.s.db.options.forceServerObjectId;return!0===r?t:t.map(t=>(!0!==r&&null==t._id&&(t._id=e.s.pkFactory.createPk()),t))}function M(e){if(!v(e)||"ObjectID"===e._bsontype)return e;const t=Object.keys(e);let n;const r={};for(let o=t.length-1;o>=0;o--)"function"==typeof e[n=t[o]]?r[n]=new i(String(e[n])):r[n]=M(e[n]);return r}function D(e,t,n,s){"function"==typeof n?(s=n,n={}):"function"==typeof t&&(s=t,n={},t={}),n=n||{};let i=Object.assign({},n);i=o(i,e.s.db),i=r(i,{db:e.s.db,collection:e},n),null==t&&(t={});const a={q:t,limit:0};n.single?a.limit=1:i.retryWrites&&(i.retryWrites=!1);try{u(i,e,n)}catch(e){return s(e,null)}e.s.topology.remove(e.s.namespace,[a],i,(e,t)=>{if(null!=s)return e?g(s,e,null):null==t?g(s,null,null):t.result.code?g(s,_(t.result)):t.result.writeErrors?g(s,_(t.result.writeErrors[0])):void g(s,null,t)})}function R(e,t,n){if(null!=n){if(e)return n(e);if(null==t)return n(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,n(null,t)}}function P(e,t,n,s,i){if("function"==typeof s&&(i=s,s=null),null==s&&(s={}),"function"!=typeof i&&(i=null),null==t||"object"!=typeof t)return i(_("selector must be a valid JavaScript object"));if(null==n||"object"!=typeof n)return i(_("document must be a valid JavaScript object"));let a=Object.assign({},s);a=o(a,e.s.db),(a=r(a,{db:e.s.db,collection:e},s)).serializeFunctions=s.serializeFunctions||e.s.serializeFunctions;const c={q:t,u:n};c.upsert=void 0!==s.upsert&&!!s.upsert,c.multi=void 0!==s.multi&&!!s.multi,a.arrayFilters&&(c.arrayFilters=a.arrayFilters,delete a.arrayFilters),a.retryWrites&&c.multi&&(a.retryWrites=!1);try{u(a,e,s)}catch(e){return i(e,null)}e.s.topology.update(e.s.namespace,[c],a,(e,t)=>{if(null!=i)return e?g(i,e,null):null==t?g(i,null,null):t.result.code?g(i,_(t.result)):t.result.writeErrors?g(i,_(t.result.writeErrors[0])):void g(i,null,t)})}e.exports={bulkWrite:function(e,t,n,s){e.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=e.s.options.ignoreUndefined);const i=!0===n.ordered||null==n.ordered?e.initializeOrderedBulkOp(n):e.initializeUnorderedBulkOp(n);let a=!1;try{for(let e=0;e<t.length;e++){const n=Object.keys(t[e])[0];t[e][n].collation&&(a=!0),i.raw(t[e])}}catch(e){return s(e,null)}let c=Object.assign({},n);c=o(c,e.s.db);const u=(c=r(c,{db:e.s.db,collection:e},n)).writeConcern?c.writeConcern:{},l=e.s.topology.capabilities();if(a&&l&&!l.commandsTakeCollation)return s(new w("server/primary/mongos does not support collation"));i.execute(u,c,(e,t)=>{if(!t&&e)return s(e,null);t.insertedCount=t.nInserted,t.matchedCount=t.nMatched,t.modifiedCount=t.nModified||0,t.deletedCount=t.nRemoved,t.upsertedCount=t.getUpsertedIds().length,t.upsertedIds={},t.insertedIds={},t.n=t.insertedCount;const n=t.getInsertedIds();for(let e=0;e<n.length;e++)t.insertedIds[n[e].index]=n[e]._id;const r=t.getUpsertedIds();for(let e=0;e<r.length;e++)t.upsertedIds[r[e].index]=r[e]._id;s(null,t)})},checkForAtomicOperators:function(e){const t=Object.keys(e);return 0===t.length?_("The update operation document must contain at least one atomic operator."):"$"!==t[0][0]?_("the update operation document must contain atomic operators."):void 0},count:function(e,t,n,r){let o;"function"==typeof n&&(r=n,n={}),(n=Object.assign({},n)).collectionName=e.s.name,n.readPreference=y(n,{db:e.s.db,collection:e});try{o=C(e,t,n)}catch(e){return r(e)}h(e.s.db,o,n,(e,t)=>{if(e)return g(r,e);g(r,null,t.n)})},countDocuments:function(e,t,n,r){const o=n.skip,s=n.limit;n=Object.assign({},n);const i=[{$match:t}];"number"==typeof o&&i.push({$skip:o}),"number"==typeof s&&i.push({$limit:s}),i.push({$group:{_id:null,n:{$sum:1}}}),delete n.limit,delete n.skip,e.aggregate(i,n).toArray((e,t)=>{if(e)return g(r,e);g(r,null,t.length?t[0].n:0)})},buildCountCommand:C,createIndex:function(e,t,n,r){a(e.s.db,e.s.name,t,n,r)},createIndexes:function(e,t,n,r){const o=e.s.topology.capabilities();for(let e=0;e<t.length;e++)if(null==t[e].name){const n=[];if(t[e].collation&&o&&!o.commandsTakeCollation)return r(new w("server/primary/mongos does not support collation"));for(let r in t[e].key)n.push(`${r}_${t[e].key[r]}`);t[e].name=n.join("_")}n=Object.assign({},n,{readPreference:O.PRIMARY}),h(e.s.db,{createIndexes:e.s.name,indexes:t},n,r)},deleteMany:function(e,t,n,r){n.single=!1,D(e,t,n,(e,t)=>E(e,t,r))},deleteOne:function(e,t,n,r){n.single=!0,D(e,t,n,(e,t)=>E(e,t,r))},distinct:function(e,t,n,r,o){const s=r.maxTimeMS,i={distinct:e.s.name,key:t,query:n};(r=Object.assign({},r)).readPreference=y(r,{db:e.s.db,collection:e}),"number"==typeof s&&(i.maxTimeMS=s),l(i,e,r);try{u(i,e,r)}catch(e){return o(e,null)}h(e.s.db,i,r,(e,t)=>{if(e)return g(o,e);g(o,null,t.values)})},dropIndex:N,dropIndexes:function(e,t,n){N(e,"*",t,e=>{if(e)return g(n,e,!1);g(n,null,!0)})},ensureIndex:function(e,t,n,r){p(e.s.db,e.s.name,t,n,r)},findAndModify:I,findAndRemove:function(e,t,n,r,o){r.remove=!0,I(e,t,n,null,r,o)},findOne:function(e,t,n,r){e.find(t,n).limit(-1).batchSize(1).next((e,t)=>{if(null!=e)return g(r,_(e),null);g(r,null,t)})},findOneAndDelete:function(e,t,n,r){const o=Object.assign({},n);o.fields=n.projection,o.remove=!0,I(e,t,n.sort,null,o,r)},findOneAndReplace:function(e,t,n,r,o){const s=Object.assign({},r);s.fields=r.projection,s.update=!0,s.new=void 0!==r.returnOriginal&&!r.returnOriginal,s.upsert=void 0!==r.upsert&&!!r.upsert,I(e,t,r.sort,n,s,o)},findOneAndUpdate:function(e,t,n,r,o){const s=Object.assign({},r);s.fields=r.projection,s.update=!0,s.new="boolean"==typeof r.returnOriginal&&!r.returnOriginal,s.upsert="boolean"==typeof r.upsert&&r.upsert,I(e,t,r.sort,n,s,o)},geoHaystackSearch:function(e,t,n,r,o){let s={geoSearch:e.s.name,near:[t,n]};s=c(s,r,["readPreference","session"]),(r=Object.assign({},r)).readPreference=y(r,{db:e.s.db,collection:e}),l(s,e,r),h(e.s.db,s,r,(e,t)=>{if(e)return g(o,e);(t.err||t.errmsg)&&g(o,_(t)),g(o,null,t)})},group:function(e,t,n,r,o,s,a,c,p){if(a){const a=o&&"Code"===o._bsontype?o:new i(o),f={group:{ns:e.s.name,$reduce:a,cond:n,initial:r,out:"inline"}};if(null!=s&&(f.group.finalize=s),"function"==typeof t||t&&"Code"===t._bsontype)f.group.$keyf=t&&"Code"===t._bsontype?t:new i(t);else{const e={};t.forEach(t=>{e[t]=1}),f.group.key=e}(c=Object.assign({},c)).readPreference=y(c,{db:e.s.db,collection:e}),l(f,e,c);try{u(f,e,c)}catch(e){return p(e,null)}h(e.s.db,f,c,(e,t)=>{if(e)return g(p,e,null);g(p,null,t.retval)})}else{const s=null!=o&&"Code"===o._bsontype?o.scope:{};s.ns=e.s.name,s.keys=t,s.condition=n,s.initial=r;const a=T.replace(/ reduce;/,o.toString()+";");f(e.s.db,new i(a,s),null,c,(e,t)=>{if(e)return g(p,e,null);g(p,null,t.result||t)})}},indexes:function(e,t,n){t=Object.assign({},{full:!0},t),b(e.s.db,e.s.name,t,n)},indexExists:function(e,t,n,r){x(e,n,(e,n)=>{if(null!=e)return g(r,e,null);if(!Array.isArray(t))return g(r,null,null!=n[t]);for(let e=0;e<t.length;e++)if(null==n[t[e]])return g(r,null,!1);return g(r,null,!0)})},indexInformation:x,insertOne:function(e,t,n,r){if(Array.isArray(t))return r(w.create({message:"doc parameter must be an object",driver:!0}));A(e,[t],n,(e,n)=>{if(null!=r){if(e&&r)return r(e);if(null==n)return r(null,{result:{ok:1}});n.insertedCount=n.result.n,n.insertedId=t._id,r&&r(null,n)}})},isCapped:function(e,t,n){k(e,t,(e,t)=>{if(e)return g(n,e);g(n,null,!(!t||!t.capped))})},mapReduce:function(e,t,o,s,i){const a={mapreduce:e.s.name,map:t,reduce:o},c=["readPreference","session","bypassDocumentValidation"];for(let e in s)"scope"===e?a[e]=M(s[e]):-1===c.indexOf(e)&&(a[e]=s[e]);(s=Object.assign({},s)).readPreference=y(s,{db:e.s.db,collection:e}),!1!==s.readPreference&&"primary"!==s.readPreference&&s.out&&1!==s.out.inline&&"inline"!==s.out?(s.readPreference="primary",r(a,{db:e.s.db,collection:e},s)):l(a,e,s),!0===s.bypassDocumentValidation&&(a.bypassDocumentValidation=s.bypassDocumentValidation);try{u(a,e,s)}catch(e){return i(e,null)}h(e.s.db,a,s,(t,r)=>{if(t)return g(i,t);if(1!==r.ok||r.err||r.errmsg)return g(i,_(r));const o={};if(r.timeMillis&&(o.processtime=r.timeMillis),r.counts&&(o.counts=r.counts),r.timing&&(o.timing=r.timing),r.results)return null!=s.verbose&&s.verbose?g(i,null,{results:r.results,stats:o}):g(i,null,r.results);let a=null;if(null!=r.result&&"object"==typeof r.result){const t=r.result;a=new(n(73))(t.db,e.s.db.s.topology,e.s.db.s.options).collection(t.collection)}else a=e.s.db.collection(r.result);if(null==s.verbose||!s.verbose)return g(i,t,a);g(i,t,{collection:a,stats:o})})},optionsOp:k,parallelCollectionScan:function(e,t,n){const r={parallelCollectionScan:e.s.name,numCursors:t.numCursors};l(r,e,t);const o=t.raw;delete t.raw,h(e.s.db,r,t,(r,s)=>{if(r)return g(n,r,null);if(null==s)return g(n,new Error("no result returned for parallelCollectionScan"),null);t=Object.assign({explicitlyIgnoreSession:!0},t);const i=[];o&&(t.raw=o);for(let n=0;n<s.cursors.length;n++){const r=s.cursors[n].cursor.id,o="number"==typeof r?S.fromNumber(r):r;i.push(e.s.topology.cursor(e.s.namespace,o,t))}g(n,null,i)})},prepareDocs:B,reIndex:function(e,t,n){const r={reIndex:e.s.name};h(e.s.db,r,t,(e,t)=>{if(null!=n)return e?g(n,e,null):void g(n,null,!!t.ok)})},removeDocuments:D,rename:function(e,t,o,i){const a=n(72);s(t);const c={renameCollection:`${e.s.dbName}.${e.s.name}`,to:`${e.s.dbName}.${t}`,dropTarget:"boolean"==typeof o.dropTarget&&o.dropTarget};r(c,{db:e.s.db,collection:e},o),d(e.s.db.admin().s.db,c,o,(n,r)=>{if(n)return g(i,n,null);if(r.errmsg)return g(i,_(r),null);try{return g(i,null,new a(e.s.db,e.s.topology,e.s.dbName,t,e.s.pkFactory,e.s.options))}catch(n){return g(i,_(n),null)}})},replaceOne:function(e,t,n,r,o){r.multi=!1,P(e,t,n,r,(e,t)=>{if(null!=o){if(e&&o)return o(e);if(null==t)return o(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,t.ops=[n],o&&o(null,t)}})},save:function(e,t,n,o){const s=r(Object.assign({},n),{db:e.s.db,collection:e},n);if(null!=t._id)return s.upsert=!0,P(e,{_id:t._id},t,s,o);A(e,[t],s,(e,n)=>{if(null!=o)return null==t?g(o,null,null):e?g(o,e,null):void g(o,null,n)})},stats:function(e,t,n){const r={collStats:e.s.name};null!=t.scale&&(r.scale=t.scale),(t=Object.assign({},t)).readPreference=y(t,{db:e.s.db,collection:e}),h(e.s.db,r,t,n)},updateDocuments:P,updateMany:function(e,t,n,r,o){r.multi=!0,P(e,t,n,r,(e,t)=>R(e,t,o))},updateOne:function(e,t,n,r,o){r.multi=!1,P(e,t,n,r,(e,t)=>R(e,t,o))}}},function(e,t){e.exports=require("events")},function(e,t,n){"use strict";const r=n(63),o=n(1).format,s=n(22),i=n(19).Buffer;function a(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}var c=n(124).version,u=o("Node.js %s, %s",process.version,r.endianness()),l=r.type(),p=process.platform,f=process.arch,h=r.release();function d(e){return JSON.parse(JSON.stringify(e))}var m=function(e,t){e.listeners("serverDescriptionChanged").length>0&&(e.emit("serverDescriptionChanged",{topologyId:-1!==e.s.topologyId?e.s.topologyId:e.id,address:e.name,previousDescription:function(e){return e.s.serverDescription||(e.s.serverDescription={address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),e.s.serverDescription}(e),newDescription:t}),e.s.serverDescription=t)},y=function(e,t){return t||(t=e.ismaster),t?t.ismaster&&"isdbgrid"===t.msg?"Mongos":t.ismaster&&!t.hosts?"Standalone":t.ismaster?"RSPrimary":t.secondary?"RSSecondary":t.arbiterOnly?"RSArbiter":"Unknown":"Unknown"},g=function(e){return function(t){if("destroyed"!==e.s.state){var n=(new Date).getTime();a(e,"serverHeartbeatStarted",{connectionId:e.name}),e.command("admin.$cmd",{ismaster:!0},{monitoring:!0},function(r,o){if(r)a(e,"serverHeartbeatFailed",{durationMS:s,failure:r,connectionId:e.name});else{e.emit("ismaster",o,e);var s=(new Date).getTime()-n;a(e,"serverHeartbeatSucceeded",{durationMS:s,reply:o.result,connectionId:e.name}),function(e,t,n){var r=y(e,t);return y(e,n)!==r}(e,e.s.ismaster,o.result)&&m(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:e.s.inTopology?y(e):"Standalone"}),e.s.ismaster=o.result,e.s.isMasterLatencyMS=s}if("function"==typeof t)return t(r,o);e.s.inquireServerStateTimeout=setTimeout(g(e),e.s.haInterval)})}}};const b={endSessions:function(e,t){Array.isArray(e)||(e=[e]),this.command("admin.$cmd",{endSessions:e},{readPreference:s.primaryPreferred},()=>{"function"==typeof t&&t()})}};e.exports.SessionMixins=b,e.exports.resolveClusterTime=function(e,t){null==e.clusterTime?e.clusterTime=t:t.clusterTime.greaterThan(e.clusterTime.clusterTime)&&(e.clusterTime=t)},e.exports.inquireServerState=g,e.exports.getTopologyType=y,e.exports.emitServerDescriptionChanged=m,e.exports.emitTopologyDescriptionChanged=function(e,t){e.listeners("topologyDescriptionChanged").length>0&&(e.emit("topologyDescriptionChanged",{topologyId:-1!==e.s.topologyId?e.s.topologyId:e.id,address:e.name,previousDescription:function(e){return e.s.topologyDescription||(e.s.topologyDescription={topologyType:"Unknown",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}]}),e.s.topologyDescription}(e),newDescription:t}),e.s.serverDescription=t)},e.exports.cloneOptions=function(e){var t={};for(var n in e)t[n]=e[n];return t},e.exports.createClientInfo=function(e){var t=e.clientInfo?d(e.clientInfo):{driver:{name:"nodejs-core",version:c},os:{type:l,name:p,architecture:f,version:h}};if(t.platform&&-1===t.platform.indexOf("mongodb-core")?t.platform=o("%s, mongodb-core: %s",t.platform,c):t.platform||(t.platform=u),e.appname){var n=i.from(e.appname),r=n.length>128?n.slice(0,128).toString("utf8"):e.appname;t.application={name:r}}return t},e.exports.createCompressionInfo=function(e){return e.compression&&e.compression.compressors?(e.compression.compressors.forEach(function(e){if("snappy"!==e&&"zlib"!==e)throw new Error("compressors must be at least one of snappy or zlib")}),e.compression.compressors):[]},e.exports.clone=d,e.exports.diff=function(e,t){var n={servers:[]};e||(e={servers:[]});for(var r=0;r<e.servers.length;r++){for(var o=!1,s=0;s<t.servers.length;s++)if(t.servers[s].address.toLowerCase()===e.servers[r].address.toLowerCase()){o=!0;break}o||n.servers.push({address:e.servers[r].address,from:e.servers[r].type,to:"Unknown"})}for(s=0;s<t.servers.length;s++){for(o=!1,r=0;r<e.servers.length;r++)if(e.servers[r].address.toLowerCase()===t.servers[s].address.toLowerCase()){o=!0;break}o||n.servers.push({address:t.servers[s].address,from:"Unknown",to:t.servers[s].type})}for(r=0;r<e.servers.length;r++){var i=e.servers[r];for(s=0;s<t.servers.length;s++){var a=t.servers[s];i.address.toLowerCase()===a.address.toLowerCase()&&i.type!==a.type&&n.servers.push({address:i.address,from:i.type,to:a.type})}}return n},e.exports.Interval=function(e,t){var n=!1;this.start=function(){return this.isRunning()||(n=setInterval(e,t)),this},this.stop=function(){return clearInterval(n),n=!1,this},this.isRunning=function(){return!1!==n}},e.exports.Timeout=function(e,t){var n=!1;this.start=function(){return this.isRunning()||(n=setTimeout(e,t)),this},this.stop=function(){return clearTimeout(n),n=!1,this},this.isRunning=function(){return!(n&&n._called||!1===n)}},e.exports.isRetryableWritesSupported=function(e){return!(e.lastIsMaster().maxWireVersion<6||!e.logicalSessionTimeoutMinutes)}},function(e,t,n){"use strict";const r=Symbol("mongoErrorContextSymbol");class o extends Error{constructor(e){if(e instanceof Error)super(e.message),this.stack=e.stack;else{if("string"==typeof e)super(e);else for(var t in super(e.message||e.errmsg||e.$err||"n/a"),e)this[t]=e[t];Error.captureStackTrace(this,this.constructor)}this.name="MongoError",this[r]=this[r]||{}}static create(e){return new o(e)}}class s extends o{constructor(e){super(e),this.name="MongoNetworkError",this.errorLabels=["TransientTransactionError"]}}const i=new Set([6,7,89,91,189,9001,10107,11600,11602,13435,13436]);e.exports={MongoError:o,MongoNetworkError:s,MongoParseError:class extends o{constructor(e){super(e),this.name="MongoParseError"}},MongoTimeoutError:class extends o{constructor(e){super(e),this.name="MongoTimeoutError"}},MongoWriteConcernError:class extends o{constructor(e,t){super(e),this.name="MongoWriteConcernError",null!=t&&(this.result=t)}},mongoErrorContextSymbol:r,isRetryableError:function(e){return i.has(e.code)||e instanceof s||e.message.match(/not master/)||e.message.match(/node is recovering/)}}},function(e,t,n){"use strict";var r=(0,n(13).retrieveBSON)().Long;const o=n(4).MongoError,s=n(19).Buffer;var i=0,a=n(21).opcodes,c=function(e,t,n,r){if(null==t)throw new Error("ns must be specified for query");if(null==n)throw new Error("query must be specified for query");if(-1!==t.indexOf("\0"))throw new Error("namespace cannot contain a null character");this.bson=e,this.ns=t,this.query=n,this.options=r||{},this.numberToSkip=r.numberToSkip||0,this.numberToReturn=r.numberToReturn||0,this.returnFieldSelector=r.returnFieldSelector||null,this.requestId=c.getRequestId(),this.pre32Limit=r.pre32Limit,this.serializeFunctions="boolean"==typeof r.serializeFunctions&&r.serializeFunctions,this.ignoreUndefined="boolean"==typeof r.ignoreUndefined&&r.ignoreUndefined,this.maxBsonSize=r.maxBsonSize||16777216,this.checkKeys="boolean"!=typeof r.checkKeys||r.checkKeys,this.batchSize=this.numberToReturn,this.tailable=!1,this.slaveOk="boolean"==typeof r.slaveOk&&r.slaveOk,this.oplogReplay=!1,this.noCursorTimeout=!1,this.awaitData=!1,this.exhaust=!1,this.partial=!1};c.prototype.incRequestId=function(){this.requestId=i++},c.nextRequestId=function(){return i+1},c.prototype.toBin=function(){var e=[],t=null,n=0;this.tailable&&(n|=2),this.slaveOk&&(n|=4),this.oplogReplay&&(n|=8),this.noCursorTimeout&&(n|=16),this.awaitData&&(n|=32),this.exhaust&&(n|=64),this.partial&&(n|=128),this.batchSize!==this.numberToReturn&&(this.numberToReturn=this.batchSize);var r=s.alloc(20+s.byteLength(this.ns)+1+4+4);e.push(r);var o=this.bson.serialize(this.query,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});e.push(o),this.returnFieldSelector&&Object.keys(this.returnFieldSelector).length>0&&(t=this.bson.serialize(this.returnFieldSelector,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined}),e.push(t));var i=r.length+o.length+(t?t.length:0),c=4;return r[3]=i>>24&255,r[2]=i>>16&255,r[1]=i>>8&255,r[0]=255&i,r[c+3]=this.requestId>>24&255,r[c+2]=this.requestId>>16&255,r[c+1]=this.requestId>>8&255,r[c]=255&this.requestId,r[(c+=4)+3]=0,r[c+2]=0,r[c+1]=0,r[c]=0,r[(c+=4)+3]=a.OP_QUERY>>24&255,r[c+2]=a.OP_QUERY>>16&255,r[c+1]=a.OP_QUERY>>8&255,r[c]=255&a.OP_QUERY,r[(c+=4)+3]=n>>24&255,r[c+2]=n>>16&255,r[c+1]=n>>8&255,r[c]=255&n,r[(c=(c+=4)+r.write(this.ns,c,"utf8")+1)-1]=0,r[c+3]=this.numberToSkip>>24&255,r[c+2]=this.numberToSkip>>16&255,r[c+1]=this.numberToSkip>>8&255,r[c]=255&this.numberToSkip,r[(c+=4)+3]=this.numberToReturn>>24&255,r[c+2]=this.numberToReturn>>16&255,r[c+1]=this.numberToReturn>>8&255,r[c]=255&this.numberToReturn,c+=4,e},c.getRequestId=function(){return++i};var u=function(e,t,n,r){r=r||{},this.numberToReturn=r.numberToReturn||0,this.requestId=i++,this.bson=e,this.ns=t,this.cursorId=n};u.prototype.toBin=function(){var e=4+s.byteLength(this.ns)+1+4+8+16,t=0,n=s.alloc(e);return n[t+3]=e>>24&255,n[t+2]=e>>16&255,n[t+1]=e>>8&255,n[t]=255&e,n[(t+=4)+3]=this.requestId>>24&255,n[t+2]=this.requestId>>16&255,n[t+1]=this.requestId>>8&255,n[t]=255&this.requestId,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t+=4)+3]=a.OP_GETMORE>>24&255,n[t+2]=a.OP_GETMORE>>16&255,n[t+1]=a.OP_GETMORE>>8&255,n[t]=255&a.OP_GETMORE,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t=(t+=4)+n.write(this.ns,t,"utf8")+1)-1]=0,n[t+3]=this.numberToReturn>>24&255,n[t+2]=this.numberToReturn>>16&255,n[t+1]=this.numberToReturn>>8&255,n[t]=255&this.numberToReturn,n[(t+=4)+3]=this.cursorId.getLowBits()>>24&255,n[t+2]=this.cursorId.getLowBits()>>16&255,n[t+1]=this.cursorId.getLowBits()>>8&255,n[t]=255&this.cursorId.getLowBits(),n[(t+=4)+3]=this.cursorId.getHighBits()>>24&255,n[t+2]=this.cursorId.getHighBits()>>16&255,n[t+1]=this.cursorId.getHighBits()>>8&255,n[t]=255&this.cursorId.getHighBits(),t+=4,n};var l=function(e,t,n){this.ns=t,this.requestId=i++,this.cursorIds=n};l.prototype.toBin=function(){var e=24+8*this.cursorIds.length,t=0,n=s.alloc(e);n[t+3]=e>>24&255,n[t+2]=e>>16&255,n[t+1]=e>>8&255,n[t]=255&e,n[(t+=4)+3]=this.requestId>>24&255,n[t+2]=this.requestId>>16&255,n[t+1]=this.requestId>>8&255,n[t]=255&this.requestId,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t+=4)+3]=a.OP_KILL_CURSORS>>24&255,n[t+2]=a.OP_KILL_CURSORS>>16&255,n[t+1]=a.OP_KILL_CURSORS>>8&255,n[t]=255&a.OP_KILL_CURSORS,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t+=4)+3]=this.cursorIds.length>>24&255,n[t+2]=this.cursorIds.length>>16&255,n[t+1]=this.cursorIds.length>>8&255,n[t]=255&this.cursorIds.length,t+=4;for(var r=0;r<this.cursorIds.length;r++)n[t+3]=this.cursorIds[r].getLowBits()>>24&255,n[t+2]=this.cursorIds[r].getLowBits()>>16&255,n[t+1]=this.cursorIds[r].getLowBits()>>8&255,n[t]=255&this.cursorIds[r].getLowBits(),n[(t+=4)+3]=this.cursorIds[r].getHighBits()>>24&255,n[t+2]=this.cursorIds[r].getHighBits()>>16&255,n[t+1]=this.cursorIds[r].getHighBits()>>8&255,n[t]=255&this.cursorIds[r].getHighBits(),t+=4;return n};var p=function(e,t,n,o,s){s=s||{promoteLongs:!0,promoteValues:!0,promoteBuffers:!1},this.parsed=!1,this.raw=t,this.data=o,this.bson=e,this.opts=s,this.length=n.length,this.requestId=n.requestId,this.responseTo=n.responseTo,this.opCode=n.opCode,this.fromCompressed=n.fromCompressed,this.responseFlags=o.readInt32LE(0),this.cursorId=new r(o.readInt32LE(4),o.readInt32LE(8)),this.startingFrom=o.readInt32LE(12),this.numberReturned=o.readInt32LE(16),this.documents=new Array(this.numberReturned),this.cursorNotFound=0!=(0&this.responseFlags),this.queryFailure=0!=(2&this.responseFlags),this.shardConfigStale=0!=(4&this.responseFlags),this.awaitCapable=0!=(8&this.responseFlags),this.promoteLongs="boolean"!=typeof s.promoteLongs||s.promoteLongs,this.promoteValues="boolean"!=typeof s.promoteValues||s.promoteValues,this.promoteBuffers="boolean"==typeof s.promoteBuffers&&s.promoteBuffers};p.prototype.isParsed=function(){return this.parsed},p.prototype.parse=function(e){if(!this.parsed){var t,n,s=(e=e||{}).raw||!1,i=e.documentsReturnedIn||null;if(n={promoteLongs:"boolean"==typeof e.promoteLongs?e.promoteLongs:this.opts.promoteLongs,promoteValues:"boolean"==typeof e.promoteValues?e.promoteValues:this.opts.promoteValues,promoteBuffers:"boolean"==typeof e.promoteBuffers?e.promoteBuffers:this.opts.promoteBuffers},this.index=20,1===this.numberReturned&&null!=i&&s){t=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24;var a=this.data.slice(this.index,this.index+t),c={};c[i]=!0,n.fieldsAsRaw=c;var u=this.bson.deserialize(a,n);if(u instanceof Error)throw u;if(u.errmsg)throw new o(u.errmsg);if(!u.cursor)throw new o("Cursor not found");return this.documents=u.cursor[i],this.numberReturned=this.documents.length,this.cursorId="number"==typeof u.cursor.id?r.fromNumber(u.cursor.id):u.cursor.id,this.index=this.index+t,void(this.parsed=!0)}for(var l=0;l<this.numberReturned;l++)t=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24,this.documents[l]=s?this.data.slice(this.index,this.index+t):this.bson.deserialize(this.data.slice(this.index,this.index+t),n),this.index=this.index+t;this.parsed=!0}},e.exports={Query:c,GetMore:u,Response:p,KillCursor:l}},function(e,t,n){"use strict";var r=n(1).format,o=n(60),s=function(){throw new Error("Attempted to use Snappy compression, but Snappy is not installed. Install or disable Snappy compression and try again.")};t.setProperty=function(e,t,n,o){Object.defineProperty(e,t.name,{enumerable:!0,set:function(e){if("boolean"!=typeof e)throw new Error(r("%s required a boolean",t.name));!0===e&&(o.flags|=n),!1===e&&(o.flags&n)===n&&(o.flags^=n),t.value=e},get:function(){return t.value}})},t.getProperty=function(e,t,n,r,o){Object.defineProperty(e,t,{enumerable:!0,get:function(){return null==r[n]&&e.isParsed&&!e.isParsed()&&e.parse(),"function"==typeof o?o(r[n]):r[n]}})},t.getSingleProperty=function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},t.copy=function(e,t){for(var n in t=t||{},e)t[n]=e[n];return t},t.debugOptions=function(e,t){var n={};return e.forEach(function(e){n[e]=t[e]}),n},t.retrieveBSON=function(){var e=n(75);e.native=!1;try{var t=o("bson-ext");if(t)return t.native=!0,t}catch(e){}return e},t.retrieveSnappy=function(){var e=null;try{e=o("snappy")}catch(e){}return e||(e={compress:s,uncompress:s,compressSync:s,uncompressSync:s}),e}},function(e,t,n){"use strict";const r=n(5).applyWriteConcern,o=n(6).BSON.Code,s=n(5).resolveReadPreference,i=n(18),a=n(5).debugOptions,c=n(5).handleCallback,u=n(6).MongoError,l=n(5).parseIndexOptions,p=n(6).ReadPreference,f=n(5).toError,h=n(167),d=n(8).count,m=n(8).findOne,y=n(8).remove,g=n(8).updateOne,b=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"],v=["w","wtimeout","j","fsync","autoIndexId","strict","serializeFunctions","pkFactory","raw","readPreference","session"];function S(e,t,n,o,s){let i=Object.assign({},{readPreference:p.PRIMARY},o);if((i=r(i,{db:e},o)).writeConcern&&"function"!=typeof s)throw u.create({message:"Cannot use a writeConcern without a provided callback",driver:!0});if(e.serverConfig&&e.serverConfig.isDestroyed())return s(new u("topology was destroyed"));!function(e,t,n,o,s){const i=l(n),a="string"==typeof o.name?o.name:i.name,h=[{name:a,key:i.fieldHash}],d=Object.keys(h[0]).concat(["writeConcern","w","wtimeout","j","fsync","readPreference","session"]);for(let e in o)-1===d.indexOf(e)&&(h[0][e]=o[e]);const m=e.s.topology.capabilities();if(h[0].collation&&m&&!m.commandsTakeCollation){const e=new u("server/primary/mongos does not support collation");return e.code=67,s(e)}const y=r({createIndexes:t,indexes:h},{db:e},o);o.readPreference=p.PRIMARY,w(e,y,o,(e,t)=>e?c(s,e,null):0===t.ok?c(s,f(t),null):void c(s,null,a))}(e,t,n,i,(r,a)=>{if(null==r)return c(s,r,a);if(67===r.code||11e3===r.code||85===r.code||86===r.code||11600===r.code||197===r.code)return c(s,r,a);const l=_(e,t,n,o);i.checkKeys=!1,e.s.topology.insert(`${e.s.databaseName}.${h.SYSTEM_INDEX_COLLECTION}`,l,i,(e,t)=>{if(null!=s)return e?c(s,e):null==t?c(s,null,null):t.result.writeErrors?c(s,u.create(t.result.writeErrors[0]),null):void c(s,null,l.name)})})}function w(e,t,n,r){if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new u("topology was destroyed"));const o=n.dbName||n.authdb||e.s.databaseName;n.readPreference=s(n,{db:e,default:p.primary}),e.s.logger.isDebug()&&e.s.logger.debug(`executing command ${JSON.stringify(t)} against ${o}.$cmd with options [${JSON.stringify(a(b,n))}]`),e.s.topology.command(`${o}.$cmd`,t,n,(e,t)=>e?c(r,e):n.full?c(r,null,t):void c(r,null,t.result))}function O(e,t,n,r){const o=null!=n.full&&n.full;if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new u("topology was destroyed"));e.collection(t).listIndexes(n).toArray((e,t)=>e?r(f(e)):Array.isArray(t)?o?c(r,null,t):void c(r,null,function(e){let t={};for(let n=0;n<e.length;n++){const r=e[n];t[r.name]=[];for(let e in r.key)t[r.name].push([e,r.key[e]])}return t}(t)):c(r,null,[]))}function _(e,t,n,r){const o=l(n),s=o.fieldHash,i="string"==typeof r.name?r.name:o.name,a={ns:e.databaseName+"."+t,key:s,name:i},c=null!=r&&"object"!=typeof r&&r;r=null==r||"boolean"==typeof r?{}:r;const u=Object.keys(a);for(let e in r)-1===u.indexOf(e)&&(a[e]=r[e]);null==a.unique&&(a.unique=c);const p=["w","wtimeout","j","fsync","readPreference","session"];for(let e=0;e<p.length;e++)delete a[p[e]];return a}e.exports={addUser:function(e,t,o,s,a){const l=n(73);if(e.serverConfig&&e.serverConfig.isDestroyed())return a(new u("topology was destroyed"));!function(e,t,n,o,s){if("string"==typeof t&&null!=n&&"object"==typeof n&&(o=n,n=null),"function"==typeof o&&(s=o,o={}),null!=o.digestPassword)return s(f("The digestPassword option is not supported via add_user. Please use db.command('createUser', ...) instead for this option."));const a=null!=o.customData?o.customData:{};let u=Array.isArray(o.roles)?o.roles:[];const l="number"==typeof o.maxTimeMS?o.maxTimeMS:null;0===u.length&&console.log("Creating a user without roles is deprecated in MongoDB >= 2.6");const h={writeCommand:!0};o.dbName&&(h.dbName=o.dbName),null!=l&&(h.maxTimeMS=l),"admin"!==e.databaseName.toLowerCase()&&"admin"!==o.dbName||Array.isArray(o.roles)?Array.isArray(o.roles)||(u=["dbOwner"]):u=["root"];const d=e.s.topology.lastIsMaster().maxWireVersion>=7;let m={createUser:t,customData:a,roles:u,digestPassword:d};m=r(m,{db:e},o);let y=n;if(!d){const e=i.createHash("md5");e.update(t+":mongo:"+n),y=e.digest("hex")}"string"==typeof n&&(m.pwd=y),h.readPreference=p.primary,w(e,m,h,(e,n)=>e&&0===e.ok&&void 0===e.code?c(s,{code:-5e3},null):e?c(s,e,null):void c(s,n.ok?null:f(n),n.ok?[{user:t,pwd:""}]:null))}(e,t,o,s,(e,n)=>{if(e&&-5e3===e.code){const e=r(Object.assign({},s),{db:p},s),n=i.createHash("md5");n.update(t+":mongo:"+o);const u=n.digest("hex"),p=s.dbName?new l(s.dbName,p.s.topology,p.s.options):p,f=p.collection(h.SYSTEM_USER_COLLECTION);d(f,{},e,(n,r)=>{if(null!=n)return c(a,n,null);const o=Object.assign({projection:{dbName:1}},e);f.find({user:t},o).toArray(n=>{if(null!=n)return c(a,n,null);e.upsert=!0,g(f,{user:t},{$set:{user:t,pwd:u}},e,e=>0===r&&e?c(a,null,[{user:t,pwd:u}]):e?c(a,e,null):void c(a,null,[{user:t,pwd:u}]))})})}else{if(e)return c(a,e);c(a,e,n)}})},collections:function(e,t,r){const o=n(72);t=Object.assign({},t,{nameOnly:!0}),e.listCollections({},t).toArray((t,n)=>{if(null!=t)return c(r,t,null);n=n.filter(e=>-1===e.name.indexOf("$")),c(r,null,n.map(t=>new o(e,e.s.topology,e.s.databaseName,t.name,e.s.pkFactory,e.s.options)))})},createCollection:function(e,t,o,s){const i=n(72),a=r(Object.assign({},o),{db:e},o);if(e.serverConfig&&e.serverConfig.isDestroyed())return s(new u("topology was destroyed"));const l=Object.assign({},a,{nameOnly:!0});e.listCollections({name:t},l).setReadPreference(p.PRIMARY).toArray((n,l)=>{if(null!=n)return c(s,n,null);if(l.length>0&&a.strict)return c(s,u.create({message:`Collection ${t} already exists. Currently in strict mode.`,driver:!0}),null);if(l.length>0)try{return c(s,null,new i(e,e.s.topology,e.s.databaseName,t,e.s.pkFactory,o))}catch(n){return c(s,n)}const f={create:t};r(f,{db:e},o);for(let e in o)null!=o[e]&&"function"!=typeof o[e]&&-1===v.indexOf(e)&&(f[e]=o[e]);a.readPreference=p.PRIMARY,w(e,f,a,n=>{if(n)return c(s,n);c(s,null,new i(e,e.s.topology,e.s.databaseName,t,e.s.pkFactory,o))})})},createListener:function(e,t,n){return function(r){if(n.listeners(t).length>0){n.emit(t,r,e);for(let n=0;n<e.s.children.length;n++)e.s.children[n].emit(t,r,e.s.children[n])}}},createIndex:S,dropCollection:function(e,t,n,r){w(e,t,n,(t,n)=>e.serverConfig&&e.serverConfig.isDestroyed()?r(new u("topology was destroyed")):t?c(r,t):n.ok?c(r,null,!0):void c(r,null,!1))},dropDatabase:function(e,t,n,r){w(e,t,n,(t,n)=>e.serverConfig&&e.serverConfig.isDestroyed()?r(new u("topology was destroyed")):null!=r?t?c(r,t,null):void c(r,null,!!n.ok):void 0)},ensureIndex:function(e,t,n,o,s){const i=r({},{db:e},o),a=_(e,t,n,o).name;if(e.serverConfig&&e.serverConfig.isDestroyed())return s(new u("topology was destroyed"));i.readPreference=p.PRIMARY,O(e,t,i,(r,i)=>{if(null!=r&&26!==r.code)return c(s,r,null);if(null!=i&&i[a]){if("function"==typeof s)return c(s,null,a)}else S(e,t,n,o,s)})},evaluate:function(e,t,n,r,s){let i=t,a=[];if(e.serverConfig&&e.serverConfig.isDestroyed())return s(new u("topology was destroyed"));i&&"Code"===i._bsontype||(i=new o(i)),null==n||Array.isArray(n)||"function"==typeof n?null!=n&&Array.isArray(n)&&"function"!=typeof n&&(a=n):a=[n];let l={$eval:i,args:a};r.nolock&&(l.nolock=r.nolock),r.readPreference=new p(p.PRIMARY),w(e,l,r,(e,t)=>e?c(s,e,null):t&&1===t.ok?c(s,null,t.retval):t?c(s,u.create({message:`eval failed: ${t.errmsg}`,driver:!0}),null):void c(s,e,t))},executeCommand:w,executeDbAdminCommand:function(e,t,n,r){e.s.topology.command("admin.$cmd",t,n,(t,n)=>e.serverConfig&&e.serverConfig.isDestroyed()?r(new u("topology was destroyed")):t?c(r,t):void c(r,null,n.result))},listCollectionsTransforms:function(e){const t=`${e}.`;return{doc:e=>{const n=e.name.indexOf(t);return e.name&&0===n&&(e.name=e.name.substr(n+t.length)),e}}},indexInformation:O,profilingInfo:function(e,t,n){try{e.collection("system.profile").find({},t).toArray(n)}catch(e){return n(e,null)}},profilingLevel:function(e,t,n){w(e,{profile:-1},t,(e,t)=>{if(null==e&&1===t.ok){const e=t.was;return 0===e?n(null,"off"):1===e?n(null,"slow_only"):2===e?n(null,"all"):n(new Error("Error: illegal profiling level value "+e),null)}n(null!=e?e:new Error("Error with profile command"),null)})},removeUser:function(e,t,o,s){const i=n(73);!function(e,t,n,o){if("function"==typeof n&&(o=n,n={}),n=n||{},e.serverConfig&&e.serverConfig.isDestroyed())return o(new u("topology was destroyed"));const s={writeCommand:!0};n.dbName&&(s.dbName=n.dbName);const i="number"==typeof n.maxTimeMS?n.maxTimeMS:null;null!=i&&(s.maxTimeMS=i);let a={dropUser:t};a=r(a,{db:e},n),s.readPreference=p.primary,w(e,a,s,(e,t)=>e&&!e.ok&&void 0===e.code?c(o,{code:-5e3}):e?c(o,e,null):void c(o,null,!!t.ok))}(e,t,o,(e,n)=>{if(e&&-5e3===e.code){const e=r(Object.assign({},o),{db:n},o),n=o.dbName?new i(o.dbName,n.s.topology,n.s.options):n,a=n.collection(h.SYSTEM_USER_COLLECTION);m(a,{user:t},e,(n,r)=>{if(null==r)return c(s,n,!1);y(a,{user:t},e,e=>{c(s,e,!0)})})}else{if(e)return c(s,e);c(s,e,n)}})},setProfilingLevel:function(e,t,n,r){const o={};let s=0;if("off"===t)s=0;else if("slow_only"===t)s=1;else{if("all"!==t)return r(new Error("Error: illegal profiling level value "+t));s=2}o.profile=s,w(e,o,n,(e,n)=>null==e&&1===n.ok?r(null,t):r(null!=e?e:new Error("Error with profile command"),null))},validateDatabaseName:function(e){if("string"!=typeof e)throw u.create({message:"database name must be a string",driver:!0});if(0===e.length)throw u.create({message:"database name cannot be the empty string",driver:!0});if("$external"===e)return;const t=[" ",".","$","/","\\"];for(let n=0;n<t.length;n++)if(-1!==e.indexOf(t[n]))throw u.create({message:"database names cannot contain the character '"+t[n]+"'",driver:!0})}}},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";const r=n(18),o=n(60);const s=function(){throw new Error("The `mongodb-extjson` module was not found. Please install it and try again.")};e.exports={uuidV4:()=>{const e=r.randomBytes(16);return e[6]=15&e[6]|64,e[8]=63&e[8]|128,e},calculateDurationInMs:e=>{const t=process.hrtime(e);return(1e9*t[0]+t[1])/1e6},relayEvents:function(e,t,n){n.forEach(n=>e.on(n,e=>t.emit(n,e)))},collationNotSupported:function(e,t){return t&&t.collation&&e.ismaster&&e.ismaster.maxWireVersion<5},retrieveEJSON:function(){let e=null;try{e=o("mongodb-extjson")}catch(e){}return e||(e={parse:s,deserialize:s,serialize:s,stringify:s,setBSONModule:s,BSON:s}),e},retrieveKerberos:function(){let e;try{e=o("kerberos")}catch(e){if("MODULE_NOT_FOUND"===e.code)throw new Error("The `kerberos` module was not found. Please install it and try again.");throw e}return e}}},function(e,t,n){"use strict";const r=n(15).Transform,o=n(15).PassThrough,s=n(1).inherits,i=n(1).deprecate,a=n(0).handleCallback,c=n(2).ReadPreference,u=n(2).MongoError,l=n(15).Readable,p=n(2).Cursor,f=n(2).BSON.Map,h=n(0).executeOperation,d=n(32).count,m=n(32).each,y=n(32).hasNext,g=n(32).next,b=n(32).toArray,v=["tailable","oplogReplay","noCursorTimeout","awaitData","exhaust","partial"],S=["numberOfRetries","tailableRetryInterval"];function w(e,t,n,r,o,s){p.apply(this,Array.prototype.slice.call(arguments,0));const i=w.INIT,a=r.numberOfRetries||5,c=r.tailableRetryInterval||500,u=a,f=r.promiseLibrary||Promise;l.call(this,{objectMode:!0}),this.s={numberOfRetries:a,tailableRetryInterval:c,currentNumberOfRetries:u,state:i,streamOptions:{},bson:e,ns:t,cmd:n,options:r,topology:o,topologyOptions:s,promiseLibrary:f,currentDoc:null,explicitlyIgnoreSession:r.explicitlyIgnoreSession},!r.explicitlyIgnoreSession&&r.session&&(this.s.session=r.session),!0===this.s.options.noCursorTimeout&&this.addCursorFlag("noCursorTimeout",!0),this.sortValue=this.s.cmd.sort;const h=n.cursor&&n.cursor.batchSize?n.cursor&&n.cursor.batchSize:r.cursor&&r.cursor.batchSize?r.cursor.batchSize:1e3;this.setCursorBatchSize(h)}s(w,l),w.prototype._next=function(){return this._initImplicitSession&&this._initImplicitSession(),p.prototype.next.apply(this,arguments)};for(let e in p.prototype)w.prototype[e]=p.prototype[e];w.prototype._initImplicitSession=function(){this.s.explicitlyIgnoreSession||this.s.session||!this.s.topology.hasSessionSupport()||(this.s.session=this.s.topology.startSession({owner:this}),this.cursorState.session=this.s.session)},w.prototype._endSession=function(){p.prototype._endSession.apply(this,arguments)&&(this.s.session=void 0)},w.prototype.hasNext=function(e){return h(this.s.topology,y,[this,e],{skipSessions:!0})},w.prototype.next=function(e){return h(this.s.topology,g,[this,e],{skipSessions:!0})},w.prototype.filter=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.query=e,this},w.prototype.maxScan=i(function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.maxScan=e,this},"Cursor.maxScan is deprecated, and will be removed in a later version"),w.prototype.hint=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.hint=e,this},w.prototype.min=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.min=e,this},w.prototype.max=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.max=e,this},w.prototype.returnKey=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.returnKey=e,this},w.prototype.showRecordId=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.showDiskLoc=e,this},w.prototype.snapshot=i(function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.snapshot=e,this},"Cursor Snapshot is deprecated, and will be removed in a later version"),w.prototype.setCursorOption=function(e,t){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});if(-1===S.indexOf(e))throw u.create({message:`option ${e} is not a supported option ${S}`,driver:!0});return this.s[e]=t,"numberOfRetries"===e&&(this.s.currentNumberOfRetries=t),this},w.prototype.addCursorFlag=function(e,t){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});if(-1===v.indexOf(e))throw u.create({message:`flag ${e} is not a supported flag ${v}`,driver:!0});if("boolean"!=typeof t)throw u.create({message:`flag ${e} must be a boolean value`,driver:!0});return this.s.cmd[e]=t,this},w.prototype.addQueryModifier=function(e,t){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});if("$"!==e[0])throw u.create({message:`${e} is not a valid query modifier`,driver:!0});const n=e.substr(1);return this.s.cmd[n]=t,"orderby"===n&&(this.s.cmd.sort=this.s.cmd[n]),this},w.prototype.comment=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.comment=e,this},w.prototype.maxAwaitTimeMS=function(e){if("number"!=typeof e)throw u.create({message:"maxAwaitTimeMS must be a number",driver:!0});if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.maxAwaitTimeMS=e,this},w.prototype.maxTimeMS=function(e){if("number"!=typeof e)throw u.create({message:"maxTimeMS must be a number",driver:!0});if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.maxTimeMS=e,this},w.prototype.maxTimeMs=w.prototype.maxTimeMS,w.prototype.project=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.fields=e,this},w.prototype.sort=function(e,t){if(this.s.options.tailable)throw u.create({message:"Tailable cursor doesn't support sorting",driver:!0});if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});let n=e;return Array.isArray(n)&&Array.isArray(n[0])&&(n=new f(n.map(e=>{const t=[e[0],null];if("asc"===e[1])t[1]=1;else if("desc"===e[1])t[1]=-1;else{if(1!==e[1]&&-1!==e[1]&&!e[1].$meta)throw new u("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");t[1]=e[1]}return t}))),null!=t&&(n=[[e,t]]),this.s.cmd.sort=n,this.sortValue=n,this},w.prototype.batchSize=function(e){if(this.s.options.tailable)throw u.create({message:"Tailable cursor doesn't support batchSize",driver:!0});if(this.s.state===w.CLOSED||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw u.create({message:"batchSize requires an integer",driver:!0});return this.s.cmd.batchSize=e,this.setCursorBatchSize(e),this},w.prototype.collation=function(e){return this.s.cmd.collation=e,this},w.prototype.limit=function(e){if(this.s.options.tailable)throw u.create({message:"Tailable cursor doesn't support limit",driver:!0});if(this.s.state===w.OPEN||this.s.state===w.CLOSED||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw u.create({message:"limit requires an integer",driver:!0});return this.s.cmd.limit=e,this.setCursorLimit(e),this},w.prototype.skip=function(e){if(this.s.options.tailable)throw u.create({message:"Tailable cursor doesn't support skip",driver:!0});if(this.s.state===w.OPEN||this.s.state===w.CLOSED||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw u.create({message:"skip requires an integer",driver:!0});return this.s.cmd.skip=e,this.setCursorSkip(e),this},w.prototype.each=i(function(e){this.rewind(),this.s.state=w.INIT,m(this,e)},"Cursor.each is deprecated. Use Cursor.forEach instead."),w.prototype.forEach=function(e,t){if(this.rewind(),this.s.state=w.INIT,"function"!=typeof t)return new this.s.promiseLibrary((t,n)=>{m(this,(r,o)=>r?(n(r),!1):null==o?(t(null),!1):(e(o),!0))});m(this,(n,r)=>{if(n)return t(n),!1;if(null!=r)return e(r),!0;if(null==r&&t){const e=t;return t=null,e(null),!1}})},w.prototype.setReadPreference=function(e){if(this.s.state!==w.INIT)throw u.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(e instanceof c)this.s.options.readPreference=e;else{if("string"!=typeof e)throw new TypeError("Invalid read preference: "+e);this.s.options.readPreference=new c(e)}return this},w.prototype.toArray=function(e){if(this.s.options.tailable)throw u.create({message:"Tailable cursor cannot be converted to array",driver:!0});return h(this.s.topology,b,[this,e],{skipSessions:!0})},w.prototype.count=function(e,t,n){if(null==this.s.cmd.query)throw u.create({message:"count can only be used with find command",driver:!0});return"function"==typeof t&&(n=t,t={}),t=t||{},"function"==typeof e&&(n=e,e=!0),this.s.session&&(t=Object.assign({},t,{session:this.s.session})),h(this.s.topology,d,[this,e,t,n],{skipSessions:!!this.s.session})},w.prototype.close=function(e,t){"function"==typeof e&&(t=e,e={}),e=Object.assign({},{skipKillCursors:!1},e),this.s.state=w.CLOSED,e.skipKillCursors||this.kill();const n=()=>(this.emit("close"),"function"==typeof t?a(t,null,this):new this.s.promiseLibrary(e=>{e()}));return this.s.session?"function"==typeof t?this._endSession(()=>n()):new this.s.promiseLibrary(e=>{this._endSession(()=>n().then(e))}):n()},w.prototype.map=function(e){if(this.cursorState.transforms&&this.cursorState.transforms.doc){const t=this.cursorState.transforms.doc;this.cursorState.transforms.doc=(n=>e(t(n)))}else this.cursorState.transforms={doc:e};return this},w.prototype.isClosed=function(){return this.isDead()},w.prototype.destroy=function(e){e&&this.emit("error",e),this.pause(),this.close()},w.prototype.stream=function(e){return this.s.streamOptions=e||{},this},w.prototype.transformStream=function(e){const t=e||{};if("function"==typeof t.transform){const e=new r({objectMode:!0,transform:function(e,n,r){this.push(t.transform(e)),r()}});return this.pipe(e)}return this.pipe(new o({objectMode:!0}))},w.prototype.explain=function(e){return this.s.cmd.explain=!0,this.s.cmd.readConcern&&delete this.s.cmd.readConcern,h(this.s.topology,this._next.bind(this),[e],{skipSessions:!0})},w.prototype._read=function(){if(this.s.state===w.CLOSED||this.isDead())return this.push(null);this.next((e,t)=>e?(this.listeners("error")&&this.listeners("error").length>0&&this.emit("error",e),this.isDead()||this.close(),this.emit("end"),this.emit("finish")):"function"==typeof this.s.streamOptions.transform&&null!=t?this.push(this.s.streamOptions.transform(t)):this.cursorState.transforms&&"function"==typeof this.cursorState.transforms.doc&&null!=t?this.push(this.cursorState.transforms.doc(t)):(this.push(t),void(null===t&&this.isDead()&&this.once("end",()=>{this.close(),this.emit("finish")}))))},w.prototype.getLogger=function(){return this.logger},Object.defineProperty(w.prototype,"readPreference",{enumerable:!0,get:function(){return this&&this.s?this.s.options.readPreference:null}}),Object.defineProperty(w.prototype,"namespace",{enumerable:!0,get:function(){if(!this||!this.s)return null;const e=this.s.ns||"",t=e.indexOf(".");return t<0?{database:this.s.ns,collection:""}:{database:e.substr(0,t),collection:e.substr(t+1)}}}),w.INIT=0,w.OPEN=1,w.CLOSED=2,w.GET_MORE=3,e.exports=w},function(e,t){e.exports=require("crypto")},function(e,t,n){var r=n(59),o=r.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function i(e,t,n){return o(e,t,n)}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=r:(s(r,t),t.Buffer=i),s(o,i),i.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,n)},i.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=o(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";const r=n(63),o=n(1).format,s=n(55),i=n(53).Buffer;function a(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}var c=n(186).version,u=o("Node.js %s, %s",process.version,r.endianness()),l=r.type(),p=process.platform,f=process.arch,h=r.release();function d(e){return JSON.parse(JSON.stringify(e))}var m=function(e,t){e.listeners("serverDescriptionChanged").length>0&&(e.emit("serverDescriptionChanged",{topologyId:-1!==e.s.topologyId?e.s.topologyId:e.id,address:e.name,previousDescription:function(e){return e.s.serverDescription||(e.s.serverDescription={address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),e.s.serverDescription}(e),newDescription:t}),e.s.serverDescription=t)},y=function(e,t){return t||(t=e.ismaster),t?t.ismaster&&"isdbgrid"===t.msg?"Mongos":t.ismaster&&!t.hosts?"Standalone":t.ismaster?"RSPrimary":t.secondary?"RSSecondary":t.arbiterOnly?"RSArbiter":"Unknown":"Unknown"},g=function(e){return function(t){if("destroyed"!==e.s.state){var n=(new Date).getTime();a(e,"serverHeartbeatStarted",{connectionId:e.name}),e.command("admin.$cmd",{ismaster:!0},{monitoring:!0},function(r,o){if(r)a(e,"serverHeartbeatFailed",{durationMS:s,failure:r,connectionId:e.name});else{e.emit("ismaster",o,e);var s=(new Date).getTime()-n;a(e,"serverHeartbeatSucceeded",{durationMS:s,reply:o.result,connectionId:e.name}),function(e,t,n){var r=y(e,t);return y(e,n)!==r}(e,e.s.ismaster,o.result)&&m(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:e.s.inTopology?y(e):"Standalone"}),e.s.ismaster=o.result,e.s.isMasterLatencyMS=s}if("function"==typeof t)return t(r,o);e.s.inquireServerStateTimeout=setTimeout(g(e),e.s.haInterval)})}}};const b={endSessions:function(e,t){Array.isArray(e)||(e=[e]),this.command("admin.$cmd",{endSessions:e},{readPreference:s.primaryPreferred},()=>{"function"==typeof t&&t()})}};e.exports.SessionMixins=b,e.exports.resolveClusterTime=function(e,t){null==e.clusterTime?e.clusterTime=t:t.clusterTime.greaterThan(e.clusterTime.clusterTime)&&(e.clusterTime=t)},e.exports.inquireServerState=g,e.exports.getTopologyType=y,e.exports.emitServerDescriptionChanged=m,e.exports.emitTopologyDescriptionChanged=function(e,t){e.listeners("topologyDescriptionChanged").length>0&&(e.emit("topologyDescriptionChanged",{topologyId:-1!==e.s.topologyId?e.s.topologyId:e.id,address:e.name,previousDescription:function(e){return e.s.topologyDescription||(e.s.topologyDescription={topologyType:"Unknown",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}]}),e.s.topologyDescription}(e),newDescription:t}),e.s.serverDescription=t)},e.exports.cloneOptions=function(e){var t={};for(var n in e)t[n]=e[n];return t},e.exports.createClientInfo=function(e){var t=e.clientInfo?d(e.clientInfo):{driver:{name:"nodejs-core",version:c},os:{type:l,name:p,architecture:f,version:h}};if(t.platform&&-1===t.platform.indexOf("mongodb-core")?t.platform=o("%s, mongodb-core: %s",t.platform,c):t.platform||(t.platform=u),e.appname){var n=i.from(e.appname),r=n.length>128?n.slice(0,128).toString("utf8"):e.appname;t.application={name:r}}return t},e.exports.createCompressionInfo=function(e){return e.compression&&e.compression.compressors?(e.compression.compressors.forEach(function(e){if("snappy"!==e&&"zlib"!==e)throw new Error("compressors must be at least one of snappy or zlib")}),e.compression.compressors):[]},e.exports.clone=d,e.exports.diff=function(e,t){var n={servers:[]};e||(e={servers:[]});for(var r=0;r<e.servers.length;r++){for(var o=!1,s=0;s<t.servers.length;s++)if(t.servers[s].address.toLowerCase()===e.servers[r].address.toLowerCase()){o=!0;break}o||n.servers.push({address:e.servers[r].address,from:e.servers[r].type,to:"Unknown"})}for(s=0;s<t.servers.length;s++){for(o=!1,r=0;r<e.servers.length;r++)if(e.servers[r].address.toLowerCase()===t.servers[s].address.toLowerCase()){o=!0;break}o||n.servers.push({address:t.servers[s].address,from:"Unknown",to:t.servers[s].type})}for(r=0;r<e.servers.length;r++){var i=e.servers[r];for(s=0;s<t.servers.length;s++){var a=t.servers[s];i.address.toLowerCase()===a.address.toLowerCase()&&i.type!==a.type&&n.servers.push({address:i.address,from:i.type,to:a.type})}}return n},e.exports.Interval=function(e,t){var n=!1;this.start=function(){return this.isRunning()||(n=setInterval(e,t)),this},this.stop=function(){return clearInterval(n),n=!1,this},this.isRunning=function(){return!1!==n}},e.exports.Timeout=function(e,t){var n=!1;this.start=function(){return this.isRunning()||(n=setTimeout(e,t)),this},this.stop=function(){return clearTimeout(n),n=!1,this},this.isRunning=function(){return!(n&&n._called||!1===n)}},e.exports.isRetryableWritesSupported=function(e){return!(e.lastIsMaster().maxWireVersion<6||!e.logicalSessionTimeoutMinutes)}},function(e,t,n){"use strict";var r=n(22),o=n(4).MongoError;e.exports={getReadPreference:function(e,t){var n=e.readPreference||new r("primary");if(t.readPreference&&(n=t.readPreference),"string"==typeof n&&(n=new r(n)),!(n instanceof r))throw new o("read preference must be a ReadPreference instance");return n},MESSAGE_HEADER_SIZE:16,opcodes:{OP_REPLY:1,OP_UPDATE:2001,OP_INSERT:2002,OP_QUERY:2004,OP_GETMORE:2005,OP_DELETE:2006,OP_KILL_CURSORS:2007,OP_COMPRESSED:2012},parseHeader:function(e){return{length:e.readInt32LE(0),requestId:e.readInt32LE(4),responseTo:e.readInt32LE(8),opCode:e.readInt32LE(12)}}}},function(e,t,n){"use strict";const r=function(e,t,n){if(t&&!Array.isArray(t)&&(console.warn("ReadPreference tags must be an array, this will change in the next major version"),void 0!==t.maxStalenessSeconds?(n=t,t=void 0):t=[t]),this.mode=e,this.tags=t,null!=(n=n||{}).maxStalenessSeconds){if(n.maxStalenessSeconds<=0)throw new TypeError("maxStalenessSeconds must be a positive integer");this.maxStalenessSeconds=n.maxStalenessSeconds,this.minWireVersion=5}if(this.mode===r.PRIMARY||!0===this.mode){if(this.tags&&Array.isArray(this.tags)&&this.tags.length>0)throw new TypeError("Primary read preference cannot be combined with tags");if(this.maxStalenessSeconds)throw new TypeError("Primary read preference cannot be combined with maxStalenessSeconds")}};Object.defineProperty(r.prototype,"preference",{enumerable:!0,get:function(){return this.mode}}),r.PRIMARY="primary",r.PRIMARY_PREFERRED="primaryPreferred",r.SECONDARY="secondary",r.SECONDARY_PREFERRED="secondaryPreferred",r.NEAREST="nearest";const o=[r.PRIMARY,r.PRIMARY_PREFERRED,r.SECONDARY,r.SECONDARY_PREFERRED,r.NEAREST,!0,!1,null];r.isValid=function(e){return-1!==o.indexOf(e)},r.prototype.isValid=function(e){return r.isValid("string"==typeof e?e:this.mode)};const s=["primaryPreferred","secondary","secondaryPreferred","nearest"];r.prototype.slaveOk=function(){return-1!==s.indexOf(this.mode)},r.prototype.equals=function(e){return e.mode===this.mode},r.prototype.toJSON=function(){const e={mode:this.mode};return Array.isArray(this.tags)&&(e.tags=this.tags),this.maxStalenessSeconds&&(e.maxStalenessSeconds=this.maxStalenessSeconds),e},r.primary=new r("primary"),r.primaryPreferred=new r("primaryPreferred"),r.secondary=new r("secondary"),r.secondaryPreferred=new r("secondaryPreferred"),r.nearest=new r("nearest"),e.exports=r},function(e,t,n){"use strict";var r=n(1).format,o=n(4).MongoError,s={},i={},a=null,c=process.pid,u=null,l=function(e,t){if(!(this instanceof l))return new l(e,t);t=t||{},this.className=e,t.logger?u=t.logger:null==u&&(u=console.log),t.loggerLevel&&(a=t.loggerLevel||"error"),null==i[this.className]&&(s[this.className]=!0)};l.prototype.debug=function(e,t){if(this.isDebug()&&(Object.keys(i).length>0&&i[this.className]||0===Object.keys(i).length&&s[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","DEBUG",this.className,c,n,e),a={type:"debug",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),u(o,a)}},l.prototype.warn=function(e,t){if(this.isWarn()&&(Object.keys(i).length>0&&i[this.className]||0===Object.keys(i).length&&s[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","WARN",this.className,c,n,e),a={type:"warn",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),u(o,a)}},l.prototype.info=function(e,t){if(this.isInfo()&&(Object.keys(i).length>0&&i[this.className]||0===Object.keys(i).length&&s[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","INFO",this.className,c,n,e),a={type:"info",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),u(o,a)}},l.prototype.error=function(e,t){if(this.isError()&&(Object.keys(i).length>0&&i[this.className]||0===Object.keys(i).length&&s[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","ERROR",this.className,c,n,e),a={type:"error",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),u(o,a)}},l.prototype.isInfo=function(){return"info"===a||"debug"===a},l.prototype.isError=function(){return"error"===a||"info"===a||"debug"===a},l.prototype.isWarn=function(){return"error"===a||"warn"===a||"info"===a||"debug"===a},l.prototype.isDebug=function(){return"debug"===a},l.reset=function(){a="error",i={}},l.currentLogger=function(){return u},l.setCurrentLogger=function(e){if("function"!=typeof e)throw new o("current logger must be a function");u=e},l.filter=function(e,t){"class"===e&&Array.isArray(t)&&(i={},t.forEach(function(e){i[e]=!0}))},l.setLevel=function(e){if("info"!==e&&"error"!==e&&"debug"!==e&&"warn"!==e)throw new Error(r("%s is an illegal logging level",e));a=e},e.exports=l},function(e,t,n){"use strict";var r=(0,n(25).retrieveBSON)().Long;const o=n(11).MongoError,s=n(53).Buffer;var i=0,a=n(54).opcodes,c=function(e,t,n,r){if(null==t)throw new Error("ns must be specified for query");if(null==n)throw new Error("query must be specified for query");if(-1!==t.indexOf("\0"))throw new Error("namespace cannot contain a null character");this.bson=e,this.ns=t,this.query=n,this.options=r||{},this.numberToSkip=r.numberToSkip||0,this.numberToReturn=r.numberToReturn||0,this.returnFieldSelector=r.returnFieldSelector||null,this.requestId=c.getRequestId(),this.pre32Limit=r.pre32Limit,this.serializeFunctions="boolean"==typeof r.serializeFunctions&&r.serializeFunctions,this.ignoreUndefined="boolean"==typeof r.ignoreUndefined&&r.ignoreUndefined,this.maxBsonSize=r.maxBsonSize||16777216,this.checkKeys="boolean"!=typeof r.checkKeys||r.checkKeys,this.batchSize=this.numberToReturn,this.tailable=!1,this.slaveOk="boolean"==typeof r.slaveOk&&r.slaveOk,this.oplogReplay=!1,this.noCursorTimeout=!1,this.awaitData=!1,this.exhaust=!1,this.partial=!1};c.prototype.incRequestId=function(){this.requestId=i++},c.nextRequestId=function(){return i+1},c.prototype.toBin=function(){var e=[],t=null,n=0;this.tailable&&(n|=2),this.slaveOk&&(n|=4),this.oplogReplay&&(n|=8),this.noCursorTimeout&&(n|=16),this.awaitData&&(n|=32),this.exhaust&&(n|=64),this.partial&&(n|=128),this.batchSize!==this.numberToReturn&&(this.numberToReturn=this.batchSize);var r=s.alloc(20+s.byteLength(this.ns)+1+4+4);e.push(r);var o=this.bson.serialize(this.query,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});e.push(o),this.returnFieldSelector&&Object.keys(this.returnFieldSelector).length>0&&(t=this.bson.serialize(this.returnFieldSelector,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined}),e.push(t));var i=r.length+o.length+(t?t.length:0),c=4;return r[3]=i>>24&255,r[2]=i>>16&255,r[1]=i>>8&255,r[0]=255&i,r[c+3]=this.requestId>>24&255,r[c+2]=this.requestId>>16&255,r[c+1]=this.requestId>>8&255,r[c]=255&this.requestId,r[(c+=4)+3]=0,r[c+2]=0,r[c+1]=0,r[c]=0,r[(c+=4)+3]=a.OP_QUERY>>24&255,r[c+2]=a.OP_QUERY>>16&255,r[c+1]=a.OP_QUERY>>8&255,r[c]=255&a.OP_QUERY,r[(c+=4)+3]=n>>24&255,r[c+2]=n>>16&255,r[c+1]=n>>8&255,r[c]=255&n,r[(c=(c+=4)+r.write(this.ns,c,"utf8")+1)-1]=0,r[c+3]=this.numberToSkip>>24&255,r[c+2]=this.numberToSkip>>16&255,r[c+1]=this.numberToSkip>>8&255,r[c]=255&this.numberToSkip,r[(c+=4)+3]=this.numberToReturn>>24&255,r[c+2]=this.numberToReturn>>16&255,r[c+1]=this.numberToReturn>>8&255,r[c]=255&this.numberToReturn,c+=4,e},c.getRequestId=function(){return++i};var u=function(e,t,n,r){r=r||{},this.numberToReturn=r.numberToReturn||0,this.requestId=i++,this.bson=e,this.ns=t,this.cursorId=n};u.prototype.toBin=function(){var e=4+s.byteLength(this.ns)+1+4+8+16,t=0,n=s.alloc(e);return n[t+3]=e>>24&255,n[t+2]=e>>16&255,n[t+1]=e>>8&255,n[t]=255&e,n[(t+=4)+3]=this.requestId>>24&255,n[t+2]=this.requestId>>16&255,n[t+1]=this.requestId>>8&255,n[t]=255&this.requestId,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t+=4)+3]=a.OP_GETMORE>>24&255,n[t+2]=a.OP_GETMORE>>16&255,n[t+1]=a.OP_GETMORE>>8&255,n[t]=255&a.OP_GETMORE,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t=(t+=4)+n.write(this.ns,t,"utf8")+1)-1]=0,n[t+3]=this.numberToReturn>>24&255,n[t+2]=this.numberToReturn>>16&255,n[t+1]=this.numberToReturn>>8&255,n[t]=255&this.numberToReturn,n[(t+=4)+3]=this.cursorId.getLowBits()>>24&255,n[t+2]=this.cursorId.getLowBits()>>16&255,n[t+1]=this.cursorId.getLowBits()>>8&255,n[t]=255&this.cursorId.getLowBits(),n[(t+=4)+3]=this.cursorId.getHighBits()>>24&255,n[t+2]=this.cursorId.getHighBits()>>16&255,n[t+1]=this.cursorId.getHighBits()>>8&255,n[t]=255&this.cursorId.getHighBits(),t+=4,n};var l=function(e,t,n){this.ns=t,this.requestId=i++,this.cursorIds=n};l.prototype.toBin=function(){var e=24+8*this.cursorIds.length,t=0,n=s.alloc(e);n[t+3]=e>>24&255,n[t+2]=e>>16&255,n[t+1]=e>>8&255,n[t]=255&e,n[(t+=4)+3]=this.requestId>>24&255,n[t+2]=this.requestId>>16&255,n[t+1]=this.requestId>>8&255,n[t]=255&this.requestId,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t+=4)+3]=a.OP_KILL_CURSORS>>24&255,n[t+2]=a.OP_KILL_CURSORS>>16&255,n[t+1]=a.OP_KILL_CURSORS>>8&255,n[t]=255&a.OP_KILL_CURSORS,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t+=4)+3]=this.cursorIds.length>>24&255,n[t+2]=this.cursorIds.length>>16&255,n[t+1]=this.cursorIds.length>>8&255,n[t]=255&this.cursorIds.length,t+=4;for(var r=0;r<this.cursorIds.length;r++)n[t+3]=this.cursorIds[r].getLowBits()>>24&255,n[t+2]=this.cursorIds[r].getLowBits()>>16&255,n[t+1]=this.cursorIds[r].getLowBits()>>8&255,n[t]=255&this.cursorIds[r].getLowBits(),n[(t+=4)+3]=this.cursorIds[r].getHighBits()>>24&255,n[t+2]=this.cursorIds[r].getHighBits()>>16&255,n[t+1]=this.cursorIds[r].getHighBits()>>8&255,n[t]=255&this.cursorIds[r].getHighBits(),t+=4;return n};var p=function(e,t,n,o,s){s=s||{promoteLongs:!0,promoteValues:!0,promoteBuffers:!1},this.parsed=!1,this.raw=t,this.data=o,this.bson=e,this.opts=s,this.length=n.length,this.requestId=n.requestId,this.responseTo=n.responseTo,this.opCode=n.opCode,this.fromCompressed=n.fromCompressed,this.responseFlags=o.readInt32LE(0),this.cursorId=new r(o.readInt32LE(4),o.readInt32LE(8)),this.startingFrom=o.readInt32LE(12),this.numberReturned=o.readInt32LE(16),this.documents=new Array(this.numberReturned),this.cursorNotFound=0!=(0&this.responseFlags),this.queryFailure=0!=(2&this.responseFlags),this.shardConfigStale=0!=(4&this.responseFlags),this.awaitCapable=0!=(8&this.responseFlags),this.promoteLongs="boolean"!=typeof s.promoteLongs||s.promoteLongs,this.promoteValues="boolean"!=typeof s.promoteValues||s.promoteValues,this.promoteBuffers="boolean"==typeof s.promoteBuffers&&s.promoteBuffers};p.prototype.isParsed=function(){return this.parsed},p.prototype.parse=function(e){if(!this.parsed){var t,n,s=(e=e||{}).raw||!1,i=e.documentsReturnedIn||null;if(n={promoteLongs:"boolean"==typeof e.promoteLongs?e.promoteLongs:this.opts.promoteLongs,promoteValues:"boolean"==typeof e.promoteValues?e.promoteValues:this.opts.promoteValues,promoteBuffers:"boolean"==typeof e.promoteBuffers?e.promoteBuffers:this.opts.promoteBuffers},this.index=20,1===this.numberReturned&&null!=i&&s){t=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24;var a=this.data.slice(this.index,this.index+t),c={};c[i]=!0,n.fieldsAsRaw=c;var u=this.bson.deserialize(a,n);if(u instanceof Error)throw u;if(u.errmsg)throw new o(u.errmsg);if(!u.cursor)throw new o("Cursor not found");return this.documents=u.cursor[i],this.numberReturned=this.documents.length,this.cursorId="number"==typeof u.cursor.id?r.fromNumber(u.cursor.id):u.cursor.id,this.index=this.index+t,void(this.parsed=!0)}for(var l=0;l<this.numberReturned;l++)t=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24,this.documents[l]=s?this.data.slice(this.index,this.index+t):this.bson.deserialize(this.data.slice(this.index,this.index+t),n),this.index=this.index+t;this.parsed=!0}},e.exports={Query:c,GetMore:u,Response:p,KillCursor:l}},function(e,t,n){"use strict";var r=n(1).format,o=n(151),s=function(){throw new Error("Attempted to use Snappy compression, but Snappy is not installed. Install or disable Snappy compression and try again.")};t.setProperty=function(e,t,n,o){Object.defineProperty(e,t.name,{enumerable:!0,set:function(e){if("boolean"!=typeof e)throw new Error(r("%s required a boolean",t.name));!0===e&&(o.flags|=n),!1===e&&(o.flags&n)===n&&(o.flags^=n),t.value=e},get:function(){return t.value}})},t.getProperty=function(e,t,n,r,o){Object.defineProperty(e,t,{enumerable:!0,get:function(){return null==r[n]&&e.isParsed&&!e.isParsed()&&e.parse(),"function"==typeof o?o(r[n]):r[n]}})},t.getSingleProperty=function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},t.copy=function(e,t){for(var n in t=t||{},e)t[n]=e[n];return t},t.debugOptions=function(e,t){var n={};return e.forEach(function(e){n[e]=t[e]}),n},t.retrieveBSON=function(){var e=n(159);e.native=!1;try{var t=o("bson-ext");if(t)return t.native=!0,t}catch(e){}return e},t.retrieveSnappy=function(){var e=null;try{e=o("snappy")}catch(e){}return e||(e={compress:s,uncompress:s,compressSync:s,uncompressSync:s}),e}},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this._bsontype="Long",this.low_=0|e,this.high_=0|t}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var r=n.fromNumber(t),o=this.div(r),s=o.multiply(r).subtract(this);return o.toString(t)+s.toInt().toString(t)}return"-"+this.negate().toString(t)}var i=n.fromNumber(Math.pow(t,6));s=this;for(var a="";!s.isZero();){var c=s.div(i),u=s.subtract(c.multiply(i)).toInt().toString(t);if((s=c).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!==this.high_?this.high_:this.low_,t=31;t>0&&0==(e&1<<t);t--);return 0!==this.high_?t+33:t+1},n.prototype.isZero=function(){return 0===this.high_&&0===this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_},n.prototype.notEquals=function(e){return this.high_!==e.high_||this.low_!==e.low_},n.prototype.lessThan=function(e){return this.compare(e)<0},n.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},n.prototype.greaterThan=function(e){return this.compare(e)>0},n.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},n.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(e){var t=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,s=65535&this.low_,i=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,u=0,l=0,p=0,f=0;return p+=(f+=s+(65535&e.low_))>>>16,f&=65535,l+=(p+=o+c)>>>16,p&=65535,u+=(l+=r+a)>>>16,l&=65535,u+=t+i,u&=65535,n.fromBits(p<<16|f,u<<16|l)},n.prototype.subtract=function(e){return this.add(e.negate())},n.prototype.multiply=function(e){if(this.isZero())return n.ZERO;if(e.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return e.isOdd()?n.MIN_VALUE:n.ZERO;if(e.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&e.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,s=65535&this.low_,i=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,u=65535&e.low_,l=0,p=0,f=0,h=0;return f+=(h+=s*u)>>>16,h&=65535,p+=(f+=o*u)>>>16,f&=65535,p+=(f+=s*c)>>>16,f&=65535,l+=(p+=r*u)>>>16,p&=65535,l+=(p+=o*c)>>>16,p&=65535,l+=(p+=s*a)>>>16,p&=65535,l+=t*u+r*c+o*a+s*i,l&=65535,n.fromBits(f<<16|h,l<<16|p)},n.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(e.equals(n.ONE)||e.equals(n.NEG_ONE))return n.MIN_VALUE;if(e.equals(n.MIN_VALUE))return n.ONE;var t=this.shiftRight(1).div(e).shiftLeft(1);if(t.equals(n.ZERO))return e.isNegative()?n.ONE:n.NEG_ONE;var r=this.subtract(e.multiply(t));return t.add(r.div(e))}if(e.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var o=n.ZERO;for(r=this;r.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(t)/Math.LN2),i=s<=48?1:Math.pow(2,s-48),a=n.fromNumber(t),c=a.multiply(e);c.isNegative()||c.greaterThan(r);)t-=i,c=(a=n.fromNumber(t)).multiply(e);a.isZero()&&(a=n.ONE),o=o.add(a),r=r.subtract(c)}return o},n.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(e){return n.fromBits(this.low_&e.low_,this.high_&e.high_)},n.prototype.or=function(e){return n.fromBits(this.low_|e.low_,this.high_|e.high_)},n.prototype.xor=function(e){return n.fromBits(this.low_^e.low_,this.high_^e.high_)},n.prototype.shiftLeft=function(e){if(0===(e&=63))return this;var t=this.low_;if(e<32){var r=this.high_;return n.fromBits(t<<e,r<<e|t>>>32-e)}return n.fromBits(0,t<<e-32)},n.prototype.shiftRight=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var r=this.low_;return n.fromBits(r>>>e|t<<32-e,t>>e)}return n.fromBits(t>>e-32,t>=0?0:-1)},n.prototype.shiftRightUnsigned=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var r=this.low_;return n.fromBits(r>>>e|t<<32-e,t>>>e)}return 32===e?n.fromBits(t,0):n.fromBits(t>>>e-32,0)},n.fromInt=function(e){if(-128<=e&&e<128){var t=n.INT_CACHE_[e];if(t)return t}var r=new n(0|e,e<0?-1:0);return-128<=e&&e<128&&(n.INT_CACHE_[e]=r),r},n.fromNumber=function(e){return isNaN(e)||!isFinite(e)?n.ZERO:e<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:e+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:e<0?n.fromNumber(-e).negate():new n(e%n.TWO_PWR_32_DBL_|0,e/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(e,t){return new n(e,t)},n.fromString=function(e,t){if(0===e.length)throw Error("number format error: empty string");var r=t||10;if(r<2||36<r)throw Error("radix out of range: "+r);if("-"===e.charAt(0))return n.fromString(e.substring(1),r).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var o=n.fromNumber(Math.pow(r,8)),s=n.ZERO,i=0;i<e.length;i+=8){var a=Math.min(8,e.length-i),c=parseInt(e.substring(i,i+a),r);if(a<8){var u=n.fromNumber(Math.pow(r,a));s=s.multiply(u).add(n.fromNumber(c))}else s=(s=s.multiply(o)).add(n.fromNumber(c))}return s},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),e.exports=n,e.exports.Long=n},function(e,t,n){"use strict";const r=n(1).deprecate,o=n(0).deprecateOptions,s=n(0).checkCollectionName,i=n(2).BSON.ObjectID,a=n(82),c=n(2).MongoError,u=n(0).toError,l=n(0).normalizeHintField,p=n(0).handleCallback,f=n(0).decorateCommand,h=n(0).decorateWithCollation,d=n(0).decorateWithReadConcern,m=n(0).formattedOrderClause,y=n(2).ReadPreference,g=n(68),b=n(140),v=n(141),S=n(67),w=n(0).executeOperation,O=n(0).applyWriteConcern,_=n(0).resolveReadPreference,T=n(3).bulkWrite,C=n(3).checkForAtomicOperators,E=n(3).count,N=n(3).countDocuments,I=n(3).createIndex,x=n(3).createIndexes,A=n(3).deleteMany,k=n(3).deleteOne,B=n(3).distinct,M=n(3).dropIndex,D=n(3).dropIndexes,R=n(3).ensureIndex,P=n(3).findAndModify,L=n(3).findAndRemove,j=n(3).findOne,U=n(3).findOneAndDelete,z=n(3).findOneAndReplace,q=n(3).findOneAndUpdate,$=n(3).geoHaystackSearch,F=n(3).group,W=n(3).indexes,H=n(3).indexExists,V=n(3).indexInformation,Y=n(3).insertOne,K=n(3).isCapped,G=n(3).mapReduce,J=n(3).optionsOp,Z=n(3).parallelCollectionScan,X=n(3).prepareDocs,Q=n(3).reIndex,ee=n(3).removeDocuments,te=n(3).rename,ne=n(3).replaceOne,re=n(3).save,oe=n(3).stats,se=n(3).updateDocuments,ie=n(3).updateMany,ae=n(3).updateOne,ce=["ignoreUndefined"];function ue(e,t,n,r,o,a){s(r);const c=null==a||null==a.slaveOk?e.slaveOk:a.slaveOk,u=null==a||null==a.serializeFunctions?e.s.options.serializeFunctions:a.serializeFunctions,l=null==a||null==a.raw?e.s.options.raw:a.raw,p=null==a||null==a.promoteLongs?e.s.options.promoteLongs:a.promoteLongs,f=null==a||null==a.promoteValues?e.s.options.promoteValues:a.promoteValues,h=null==a||null==a.promoteBuffers?e.s.options.promoteBuffers:a.promoteBuffers;let d=null;const m=`${n}.${r}`,y=a.promiseLibrary||Promise;a&&a.readPreference?d=a.readPreference:e.options.readPreference&&(d=e.options.readPreference),o=null==o?i:o,this.s={pkFactory:o,db:e,topology:t,dbName:n,options:a,namespace:m,readPreference:d,slaveOk:c,serializeFunctions:u,raw:l,promoteLongs:p,promoteValues:f,promoteBuffers:h,internalHint:null,collectionHint:null,name:r,promiseLibrary:y,readConcern:a.readConcern,writeConcern:a.writeConcern}}Object.defineProperty(ue.prototype,"dbName",{enumerable:!0,get:function(){return this.s.dbName}}),Object.defineProperty(ue.prototype,"collectionName",{enumerable:!0,get:function(){return this.s.name}}),Object.defineProperty(ue.prototype,"namespace",{enumerable:!0,get:function(){return this.s.namespace}}),Object.defineProperty(ue.prototype,"readConcern",{enumerable:!0,get:function(){return this.s.readConcern||{level:"local"}}}),Object.defineProperty(ue.prototype,"writeConcern",{enumerable:!0,get:function(){let e={};return this.s.writeConcern?this.s.writeConcern:(null!=this.s.options.w&&(e.w=this.s.options.w),null!=this.s.options.j&&(e.j=this.s.options.j),null!=this.s.options.fsync&&(e.fsync=this.s.options.fsync),null!=this.s.options.wtimeout&&(e.wtimeout=this.s.options.wtimeout),e)}}),Object.defineProperty(ue.prototype,"hint",{enumerable:!0,get:function(){return this.s.collectionHint},set:function(e){this.s.collectionHint=l(e)}});const le=["maxScan","fields","snapshot"];ue.prototype.find=o({name:"collection.find",deprecatedOptions:le,optionsIndex:1},function(e,t,n){"object"==typeof n&&console.warn("Third parameter to `find()` must be a callback or undefined");let r=e;"function"!=typeof n&&("function"==typeof t?(n=t,t=void 0):null==t&&(n="function"==typeof r?r:void 0,r="object"==typeof r?r:void 0));const o=r=null==r?{}:r;if(Buffer.isBuffer(o)){const e=o[0]|o[1]<<8|o[2]<<16|o[3]<<24;if(e!==o.length){const t=new Error("query selector raw message size does not match message header size ["+o.length+"] != ["+e+"]");throw t.name="MongoError",t}}null!=r&&"ObjectID"===r._bsontype&&(r={_id:r}),t||(t={});let s=t.projection||t.fields;s&&!Buffer.isBuffer(s)&&Array.isArray(s)&&(s=s.length?s.reduce((e,t)=>(e[t]=1,e),{}):{_id:1});let i=Object.assign({},t);for(let e in this.s.options)-1!==ce.indexOf(e)&&(i[e]=this.s.options[e]);if(i.skip=t.skip?t.skip:0,i.limit=t.limit?t.limit:0,i.raw="boolean"==typeof t.raw?t.raw:this.s.raw,i.hint=null!=t.hint?l(t.hint):this.s.collectionHint,i.timeout=void 0===t.timeout?void 0:t.timeout,i.slaveOk=null!=t.slaveOk?t.slaveOk:this.s.db.slaveOk,i.readPreference=_(i,{db:this.s.db,collection:this}),null==i.readPreference||"primary"===i.readPreference&&"primary"===i.readPreference.mode||(i.slaveOk=!0),null!=r&&"object"!=typeof r)throw c.create({message:"query selector must be an object",driver:!0});const a={find:this.s.namespace,limit:i.limit,skip:i.skip,query:r};"boolean"==typeof i.awaitdata&&(i.awaitData=i.awaitdata),"boolean"==typeof i.timeout&&(i.noCursorTimeout=i.timeout),f(a,i,["session","collation"]),s&&(a.fields=s),i.db=this.s.db,i.promiseLibrary=this.s.promiseLibrary,null==i.raw&&"boolean"==typeof this.s.raw&&(i.raw=this.s.raw),null==i.promoteLongs&&"boolean"==typeof this.s.promoteLongs&&(i.promoteLongs=this.s.promoteLongs),null==i.promoteValues&&"boolean"==typeof this.s.promoteValues&&(i.promoteValues=this.s.promoteValues),null==i.promoteBuffers&&"boolean"==typeof this.s.promoteBuffers&&(i.promoteBuffers=this.s.promoteBuffers),a.sort&&(a.sort=m(a.sort)),d(a,this,t);try{h(a,this,t)}catch(e){if("function"==typeof n)return n(e,null);throw e}const u=this.s.topology.cursor(this.s.namespace,a,i);return"function"==typeof n?p(n,null,u):u}),ue.prototype.insertOne=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,Y,[this,e,t,n])},ue.prototype.insertMany=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t?Object.assign({},t):{ordered:!0},!Array.isArray(e)&&"function"==typeof n)return n(c.create({message:"docs parameter must be an array of documents",driver:!0}));if(!Array.isArray(e))return new this.s.promiseLibrary((e,t)=>{t(c.create({message:"docs parameter must be an array of documents",driver:!0}))});t.serializeFunctions=t.serializeFunctions||this.s.serializeFunctions;const r=[{insertMany:e=X(this,e,t)}];return w(this.s.topology,T,[this,r,t,n],{resultMutator:t=>(function(e,t){const n={result:{ok:1,n:t.insertedCount},ops:e,insertedCount:t.insertedCount,insertedIds:t.insertedIds};return t.getLastOp()&&(n.result.opTime=t.getLastOp()),n})(e,t)})},ue.prototype.bulkWrite=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{ordered:!0},!Array.isArray(e))throw c.create({message:"operations must be an array of documents",driver:!0});return w(this.s.topology,T,[this,e,t,n])},ue.prototype.insert=r(function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{ordered:!1},e=Array.isArray(e)?e:[e],!0===t.keepGoing&&(t.ordered=!1),this.insertMany(e,t,n)},"collection.insert is deprecated. Use insertOne, insertMany or bulkWrite instead."),ue.prototype.updateOne=function(e,t,n,r){"function"==typeof n&&(r=n,n={}),n=n||{};const o=C(t);return o?"function"==typeof r?r(o):this.s.promiseLibrary.reject(o):(n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,ae,[this,e,t,n,r]))},ue.prototype.replaceOne=function(e,t,n,r){return"function"==typeof n&&(r=n,n={}),n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,ne,[this,e,t,n,r])},ue.prototype.updateMany=function(e,t,n,r){"function"==typeof n&&(r=n,n={}),n=n||{};const o=C(t);return o?"function"==typeof r?r(o):this.s.promiseLibrary.reject(o):(n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,ie,[this,e,t,n,r]))},ue.prototype.update=r(function(e,t,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,se,[this,e,t,n,r])},"collection.update is deprecated. Use updateOne, updateMany, or bulkWrite instead."),ue.prototype.deleteOne=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=Object.assign({},t),this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,k,[this,e,t,n])},ue.prototype.removeOne=ue.prototype.deleteOne,ue.prototype.deleteMany=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=Object.assign({},t),this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,A,[this,e,t,n])},ue.prototype.removeMany=ue.prototype.deleteMany,ue.prototype.remove=r(function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,ee,[this,e,t,n])},"collection.remove is deprecated. Use deleteOne, deleteMany, or bulkWrite instead."),ue.prototype.save=r(function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,re,[this,e,t,n])},"collection.save is deprecated. Use insertOne, insertMany, updateOne, or updateMany instead."),ue.prototype.findOne=o({name:"collection.find",deprecatedOptions:le,optionsIndex:1},function(e,t,n){return"object"==typeof n&&console.warn("Third parameter to `findOne()` must be a callback or undefined"),"function"==typeof e&&(n=e,e={},t={}),"function"==typeof t&&(n=t,t={}),e=e||{},t=t||{},w(this.s.topology,j,[this,e,t,n])}),ue.prototype.rename=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=Object.assign({},t,{readPreference:y.PRIMARY}),w(this.s.topology,te,[this,e,t,n])},ue.prototype.drop=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},w(this.s.topology,this.s.db.dropCollection.bind(this.s.db),[this.s.name,e,t])},ue.prototype.options=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},w(this.s.topology,J,[this,e,t])},ue.prototype.isCapped=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},w(this.s.topology,K,[this,e,t])},ue.prototype.createIndex=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},w(this.s.topology,I,[this,e,t,n])},ue.prototype.createIndexes=function(e,t,n){return"function"==typeof t&&(n=t,t={}),"number"!=typeof(t=t?Object.assign({},t):{}).maxTimeMS&&delete t.maxTimeMS,w(this.s.topology,x,[this,e,t,n])},ue.prototype.dropIndex=function(e,t,n){const r=Array.prototype.slice.call(arguments,1);return n="function"==typeof r[r.length-1]?r.pop():void 0,(t=r.length&&r.shift()||{}).readPreference=y.PRIMARY,w(this.s.topology,M,[this,e,t,n])},ue.prototype.dropIndexes=function(e,t){return"function"==typeof e&&(t=e,e={}),"number"!=typeof(e=e?Object.assign({},e):{}).maxTimeMS&&delete e.maxTimeMS,w(this.s.topology,D,[this,e,t])},ue.prototype.dropAllIndexes=r(ue.prototype.dropIndexes,"collection.dropAllIndexes is deprecated. Use dropIndexes instead."),ue.prototype.reIndex=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},w(this.s.topology,Q,[this,e,t])},ue.prototype.listIndexes=function(e){if(e=e||{},(e=Object.assign({},e)).readPreference=_(e,{db:this.s.db,collection:this}),e.cursorFactory=g,e.promiseLibrary=this.s.promiseLibrary,!this.s.topology.capabilities())throw new c("cannot connect to server");let t=e.batchSize?{batchSize:e.batchSize}:{};if(this.s.topology.capabilities().hasListIndexesCommand){const n={listIndexes:this.s.name,cursor:t};return t=this.s.topology.cursor(`${this.s.dbName}.$cmd`,n,e),e.readPreference&&t.setReadPreference(e.readPreference),t}const n=`${this.s.dbName}.system.indexes`;return t=this.s.topology.cursor(n,{find:n,query:{ns:this.s.namespace}},e),e.readPreference&&t.setReadPreference(e.readPreference),e.batchSize&&(t=t.batchSize(e.batchSize)),t},ue.prototype.ensureIndex=r(function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},w(this.s.topology,R,[this,e,t,n])},"collection.ensureIndex is deprecated. Use createIndexes instead."),ue.prototype.indexExists=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},w(this.s.topology,H,[this,e,t,n])},ue.prototype.indexInformation=function(e,t){const n=Array.prototype.slice.call(arguments,0);return t="function"==typeof n[n.length-1]?n.pop():void 0,e=n.length&&n.shift()||{},w(this.s.topology,V,[this,e,t])},ue.prototype.count=r(function(e,t,n){const r=Array.prototype.slice.call(arguments,0);return n="function"==typeof r[r.length-1]?r.pop():void 0,e=r.length&&r.shift()||{},t=r.length&&r.shift()||{},w(this.s.topology,E,[this,e,t,n])},"collection.count is deprecated, and will be removed in a future version. Use collection.countDocuments or collection.estimatedDocumentCount instead"),ue.prototype.estimatedDocumentCount=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},w(this.s.topology,E,[this,null,e,t])},ue.prototype.countDocuments=function(e,t,n){const r=Array.prototype.slice.call(arguments,0);return n="function"==typeof r[r.length-1]?r.pop():void 0,e=r.length&&r.shift()||{},t=r.length&&r.shift()||{},w(this.s.topology,N,[this,e,t,n])},ue.prototype.distinct=function(e,t,n,r){const o=Array.prototype.slice.call(arguments,1);r="function"==typeof o[o.length-1]?o.pop():void 0;const s=o.length&&o.shift()||{},i=o.length&&o.shift()||{};return w(this.s.topology,B,[this,e,s,i,r])},ue.prototype.indexes=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},w(this.s.topology,W,[this,e,t])},ue.prototype.stats=function(e,t){const n=Array.prototype.slice.call(arguments,0);return t="function"==typeof n[n.length-1]?n.pop():void 0,e=n.length&&n.shift()||{},w(this.s.topology,oe,[this,e,t])},ue.prototype.findOneAndDelete=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},null==e||"object"!=typeof e)throw u("filter parameter must be an object");return w(this.s.topology,U,[this,e,t,n])},ue.prototype.findOneAndReplace=function(e,t,n,r){if("function"==typeof n&&(r=n,n={}),n=n||{},null==e||"object"!=typeof e)throw u("filter parameter must be an object");if(null==t||"object"!=typeof t)throw u("replacement parameter must be an object");return w(this.s.topology,z,[this,e,t,n,r])},ue.prototype.findOneAndUpdate=function(e,t,n,r){if("function"==typeof n&&(r=n,n={}),n=n||{},null==e||"object"!=typeof e)throw u("filter parameter must be an object");if(null==t||"object"!=typeof t)throw u("update parameter must be an object");const o=C(t);return o?"function"==typeof r?r(o):this.s.promiseLibrary.reject(o):w(this.s.topology,q,[this,e,t,n,r])},ue.prototype.findAndModify=r(function(e,t,n,r,o){const s=Array.prototype.slice.call(arguments,1);return o="function"==typeof s[s.length-1]?s.pop():void 0,t=s.length&&s.shift()||[],n=s.length?s.shift():null,r=s.length&&s.shift()||{},(r=Object.assign({},r)).readPreference=y.PRIMARY,w(this.s.topology,P,[this,e,t,n,r,o])},"collection.findAndModify is deprecated. Use findOneAndUpdate, findOneAndReplace or findOneAndDelete instead."),ue.prototype.findAndRemove=r(function(e,t,n,r){const o=Array.prototype.slice.call(arguments,1);return r="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length&&o.shift()||[],n=o.length&&o.shift()||{},w(this.s.topology,L,[this,e,t,n,r])},"collection.findAndRemove is deprecated. Use findOneAndDelete instead."),ue.prototype.aggregate=function(e,t,n){if(Array.isArray(e))"function"==typeof t&&(n=t,t={}),null==t&&null==n&&(t={});else{const r=Array.prototype.slice.call(arguments,0);n=r.pop();const o=r[r.length-1];t=o&&(o.readPreference||o.explain||o.cursor||o.out||o.maxTimeMS||o.hint||o.allowDiskUse)?r.pop():{},e=r}let r=!1;const o={aggregate:this.s.name,pipeline:e};"string"==typeof t.out?(e.push({$out:t.out}),r=!0):e.length>0&&e[e.length-1].$out&&(r=!0),e.length>0&&e[e.length-1].$out&&this.s.topology.capabilities().commandsTakeWriteConcern&&O(o,{db:this.s.db,collection:this},t);try{h(o,this,t)}catch(e){if("function"==typeof n)return n(e,null);throw e}if(!0===t.bypassDocumentValidation&&(o.bypassDocumentValidation=t.bypassDocumentValidation),r||d(o,this,t),t.allowDiskUse&&(o.allowDiskUse=t.allowDiskUse),"number"==typeof t.maxTimeMS&&(o.maxTimeMS=t.maxTimeMS),t.hint&&(o.hint=t.hint),(t=Object.assign({},t)).readPreference=_(t,{db:this.s.db,collection:this}),t.explain){if(o.readConcern||o.writeConcern)throw u('"explain" cannot be used on an aggregate call with readConcern/writeConcern');o.explain=t.explain}if("string"==typeof t.comment&&(o.comment=t.comment),null!=t.cursor&&"object"!=typeof t.cursor)throw u("cursor options must be an object");if(t.cursor=t.cursor||{},t.batchSize&&(t.cursor.batchSize=t.batchSize),o.cursor=t.cursor,t.promiseLibrary=this.s.promiseLibrary,t.cursorFactory=a,"function"!=typeof n){if(!this.s.topology.capabilities())throw new c("cannot connect to server");return"boolean"==typeof t.allowDiskUse&&(o.allowDiskUse=t.allowDiskUse),"number"==typeof t.maxTimeMS&&(o.maxTimeMS=t.maxTimeMS),this.s.topology.cursor(this.s.namespace,o,t)}return p(n,null,this.s.topology.cursor(this.s.namespace,o,t))},ue.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new S(this,e,t)},ue.prototype.parallelCollectionScan=function(e,t){return"function"==typeof e&&(t=e,e={numCursors:1}),e.numCursors=e.numCursors||1,e.batchSize=e.batchSize||1e3,(e=Object.assign({},e)).readPreference=_(e,{db:this.s.db,collection:this}),e.promiseLibrary=this.s.promiseLibrary,e.session&&(e.session=void 0),w(this.s.topology,Z,[this,e,t],{skipSessions:!0})},ue.prototype.geoHaystackSearch=function(e,t,n,r){const o=Array.prototype.slice.call(arguments,2);return r="function"==typeof o[o.length-1]?o.pop():void 0,n=o.length&&o.shift()||{},w(this.s.topology,$,[this,e,t,n,r])},ue.prototype.group=r(function(e,t,n,r,o,s,i,a){const c=Array.prototype.slice.call(arguments,3);return a="function"==typeof c[c.length-1]?c.pop():void 0,r=c.length?c.shift():null,o=c.length?c.shift():null,s=c.length?c.shift():null,i=c.length&&c.shift()||{},"function"!=typeof o&&(s=o,o=null),!Array.isArray(e)&&e instanceof Object&&"function"!=typeof e&&"Code"!==e._bsontype&&(e=Object.keys(e)),"function"==typeof r&&(r=r.toString()),"function"==typeof o&&(o=o.toString()),s=null==s||s,w(this.s.topology,F,[this,e,t,n,r,o,s,i,a])},"MongoDB 3.6 or higher no longer supports the group command. We recommend rewriting using the aggregation framework."),ue.prototype.mapReduce=function(e,t,n,r){if("function"==typeof n&&(r=n,n={}),null==n.out)throw new Error("the out option parameter must be defined, see mongodb docs for possible values");return"function"==typeof e&&(e=e.toString()),"function"==typeof t&&(t=t.toString()),"function"==typeof n.finalize&&(n.finalize=n.finalize.toString()),w(this.s.topology,G,[this,e,t,n,r])},ue.prototype.initializeUnorderedBulkOp=function(e){return(e=e||{}).promiseLibrary=this.s.promiseLibrary,b(this.s.topology,this,e)},ue.prototype.initializeOrderedBulkOp=function(e){return(e=e||{}).promiseLibrary=this.s.promiseLibrary,v(this.s.topology,this,e)},ue.prototype.getLogger=function(){return this.s.db.s.logger},e.exports=ue},function(e,t,n){"use strict";const r=n(9).EventEmitter,o=n(1).inherits,s=n(0).getSingleProperty,i=n(68),a=n(0).handleCallback,c=n(0).filterOptions,u=n(0).toError,l=n(2).ReadPreference,p=n(2).MongoError,f=n(2).ObjectID,h=n(2).Logger,d=n(27),m=n(0).mergeOptionsAndWriteConcern,y=n(0).executeOperation,g=n(0).applyWriteConcern,b=n(0).resolveReadPreference,v=n(67),S=n(1).deprecate,w=n(0).deprecateOptions,O=n(83),_=n(7).addUser,T=n(7).collections,C=n(7).createCollection,E=n(7).createIndex,N=n(7).createListener,I=n(7).dropCollection,x=n(7).dropDatabase,A=n(7).ensureIndex,k=n(7).evaluate,B=n(7).executeCommand,M=n(7).executeDbAdminCommand,D=n(7).indexInformation,R=n(7).listCollectionsTransforms,P=n(7).profilingInfo,L=n(7).profilingLevel,j=n(7).removeUser,U=n(7).setProfilingLevel,z=n(7).validateDatabaseName,q=["w","wtimeout","fsync","j","readPreference","readPreferenceTags","native_parser","forceServerObjectId","pkFactory","serializeFunctions","raw","bufferMaxEntries","authSource","ignoreUndefined","promoteLongs","promiseLibrary","readConcern","retryMiliSeconds","numberOfRetries","parentDb","noListener","loggerLevel","logger","promoteBuffers","promoteLongs","promoteValues","compression","retryWrites"];function $(e,t,n){if(n=n||{},!(this instanceof $))return new $(e,t,n);r.call(this);const o=n.promiseLibrary||Promise;(n=c(n,q)).promiseLibrary=o,this.s={databaseName:e,dbCache:{},children:[],topology:t,options:n,logger:h("Db",n),bson:t?t.bson:null,readPreference:n.readPreference,bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:-1,parentDb:n.parentDb||null,pkFactory:n.pkFactory||f,nativeParser:n.nativeParser||n.native_parser,promiseLibrary:o,noListener:"boolean"==typeof n.noListener&&n.noListener,readConcern:n.readConcern},z(this.s.databaseName),s(this,"serverConfig",this.s.topology),s(this,"bufferMaxEntries",this.s.bufferMaxEntries),s(this,"databaseName",this.s.databaseName),n.parentDb||this.s.noListener||(t.on("error",N(this,"error",this)),t.on("timeout",N(this,"timeout",this)),t.on("close",N(this,"close",this)),t.on("parseError",N(this,"parseError",this)),t.once("open",N(this,"open",this)),t.once("fullsetup",N(this,"fullsetup",this)),t.once("all",N(this,"all",this)),t.on("reconnect",N(this,"reconnect",this)))}o($,r),Object.defineProperty($.prototype,"topology",{enumerable:!0,get:function(){return this.s.topology}}),Object.defineProperty($.prototype,"options",{enumerable:!0,get:function(){return this.s.options}}),Object.defineProperty($.prototype,"slaveOk",{enumerable:!0,get:function(){return null!=this.s.options.readPreference&&("primary"!==this.s.options.readPreference||"primary"!==this.s.options.readPreference.mode)}}),Object.defineProperty($.prototype,"writeConcern",{enumerable:!0,get:function(){const e={};return null!=this.s.options.w&&(e.w=this.s.options.w),null!=this.s.options.j&&(e.j=this.s.options.j),null!=this.s.options.fsync&&(e.fsync=this.s.options.fsync),null!=this.s.options.wtimeout&&(e.wtimeout=this.s.options.wtimeout),e}}),$.prototype.command=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=Object.assign({},t),y(this.s.topology,B,[this,e,t,n])},$.prototype.admin=function(){return new(n(84))(this,this.s.topology,this.s.promiseLibrary)};const F=["pkFactory","readPreference","serializeFunctions","strict","readConcern","ignoreUndefined","promoteValues","promoteBuffers","promoteLongs"];$.prototype.collection=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},(t=Object.assign({},t)).promiseLibrary=this.s.promiseLibrary,t.readConcern=t.readConcern||this.s.readConcern,this.s.options.ignoreUndefined&&(t.ignoreUndefined=this.s.options.ignoreUndefined),null==(t=m(t,this.s.options,F,!0))||!t.strict)try{const r=new d(this,this.s.topology,this.s.databaseName,e,this.s.pkFactory,t);return n&&n(null,r),r}catch(e){if(e instanceof p&&n)return n(e);throw e}if("function"!=typeof n)throw u(`A callback is required in strict mode. While getting collection ${e}`);if(this.serverConfig&&this.serverConfig.isDestroyed())return n(new p("topology was destroyed"));const r=Object.assign({},t,{nameOnly:!0});this.listCollections({name:e},r).toArray((r,o)=>{if(null!=r)return a(n,r,null);if(0===o.length)return a(n,u(`Collection ${e} does not exist. Currently in strict mode.`),null);try{return a(n,null,new d(this,this.s.topology,this.s.databaseName,e,this.s.pkFactory,t))}catch(r){return a(n,r,null)}})},$.prototype.createCollection=w({name:"Db.createCollection",deprecatedOptions:["autoIndexId"],optionsIndex:1},function(e,t,n){return"function"==typeof t&&(n=t,t={}),(t=t||{}).promiseLibrary=t.promiseLibrary||this.s.promiseLibrary,y(this.s.topology,C,[this,e,t,n])}),$.prototype.stats=function(e,t){"function"==typeof e&&(t=e,e={});const n={dbStats:!0};return null!=(e=e||{}).scale&&(n.scale=e.scale),null==e.readPreference&&this.s.readPreference&&(e.readPreference=this.s.readPreference),this.command(n,e,t)},$.prototype.listCollections=function(e,t){e=e||{},t=t||{},(t=Object.assign({},t)).promiseLibrary=this.s.promiseLibrary,t.readPreference=b(t,{db:this,default:l.primary});let n=t.batchSize?{batchSize:t.batchSize}:{};if(this.serverConfig.capabilities().hasListCollectionsCommand){const r={listCollections:!0,filter:e,cursor:n,nameOnly:"boolean"==typeof t.nameOnly&&t.nameOnly};return t.cursorFactory=i,n=this.s.topology.cursor(`${this.s.databaseName}.$cmd`,r,t),t.readPreference&&n.setReadPreference(t.readPreference),n}this.serverConfig.capabilities().hasListCollectionsCommand||"string"!=typeof e.name||new RegExp("^"+this.databaseName+"\\.").test(e.name)||((e=Object.assign({},e)).name=`${this.s.databaseName}.${e.name}`),null==e&&(e.name=`/${this.s.databaseName}/`),e=e.name?{$and:[{name:e.name},{name:/^((?!\$).)*$/}]}:{name:/^((?!\$).)*$/};const r={transforms:R(this.s.databaseName)};return n=this.collection(O.SYSTEM_NAMESPACE_COLLECTION).find(e,r),t.readPreference&&n.setReadPreference(t.readPreference),t.batchSize&&(n=n.batchSize(t.batchSize)),n},$.prototype.eval=S(function(e,t,n,r){const o=Array.prototype.slice.call(arguments,1);return r="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():t,n=o.length&&o.shift()||{},y(this.s.topology,k,[this,e,t,n,r])},"Db.eval is deprecated as of MongoDB version 3.2"),$.prototype.renameCollection=function(e,t,n,r){"function"==typeof n&&(r=n,n={}),(n=n||{}).new_collection=!0;const o=this.collection(e);return y(this.s.topology,o.rename.bind(o),[t,n,r])},$.prototype.dropCollection=function(e,t,n){"function"==typeof t&&(n=t,t={});const r={drop:e};g(r,{db:this},t=t||{});const o=Object.assign({},this.s.options,{readPreference:l.PRIMARY});return t.session&&(o.session=t.session),y(this.s.topology,I,[this,r,o,n])},$.prototype.dropDatabase=function(e,t){"function"==typeof e&&(t=e,e={});const n={dropDatabase:1};g(n,{db:this},e=e||{});const r=Object.assign({},this.s.options,{readPreference:l.PRIMARY});return e.session&&(r.session=e.session),y(this.s.topology,x,[this,n,r,t])},$.prototype.collections=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},y(this.s.topology,T,[this,e,t])},$.prototype.executeDbAdminCommand=function(e,t,n){return"function"==typeof t&&(n=t,t={}),(t=t||{}).readPreference=b(t),y(this.s.topology,M,[this,e,t,n])},$.prototype.createIndex=function(e,t,n,r){return"function"==typeof n&&(r=n,n={}),n=n?Object.assign({},n):{},y(this.s.topology,E,[this,e,t,n,r])},$.prototype.ensureIndex=S(function(e,t,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},y(this.s.topology,A,[this,e,t,n,r])},"Db.ensureIndex is deprecated as of MongoDB version 3.0 / driver version 2.0"),$.prototype.addChild=function(e){if(this.s.parentDb)return this.s.parentDb.addChild(e);this.s.children.push(e)},$.prototype.addUser=function(e,t,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},y(this.s.topology,_,[this,e,t,n,r])},$.prototype.removeUser=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},y(this.s.topology,j,[this,e,t,n])},$.prototype.setProfilingLevel=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},y(this.s.topology,U,[this,e,t,n])},$.prototype.profilingInfo=S(function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},y(this.s.topology,P,[this,e,t])},"Db.profilingInfo is deprecated. Query the system.profile collection directly."),$.prototype.profilingLevel=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},y(this.s.topology,L,[this,e,t])},$.prototype.indexInformation=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},y(this.s.topology,D,[this,e,t,n])},$.prototype.unref=function(){this.s.topology.unref()},$.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new v(this,e,t)},$.prototype.getLogger=function(){return this.s.logger},$.SYSTEM_NAMESPACE_COLLECTION=O.SYSTEM_NAMESPACE_COLLECTION,$.SYSTEM_INDEX_COLLECTION=O.SYSTEM_INDEX_COLLECTION,$.SYSTEM_PROFILE_COLLECTION=O.SYSTEM_PROFILE_COLLECTION,$.SYSTEM_USER_COLLECTION=O.SYSTEM_USER_COLLECTION,$.SYSTEM_COMMAND_COLLECTION=O.SYSTEM_COMMAND_COLLECTION,$.SYSTEM_JS_COLLECTION=O.SYSTEM_JS_COLLECTION,e.exports=$},function(e,t,n){"use strict";const r=n(9),o=n(2).MongoError,s=n(1).format,i=n(63),a=n(0).translateReadPreference,c=n(2).Sessions.ClientSession;var u=function(e,t){var n=this;t=t||{force:!1,bufferMaxEntries:-1},this.s={storedOps:[],storeOptions:t,topology:e},Object.defineProperty(this,"length",{enumerable:!0,get:function(){return n.s.storedOps.length}})};u.prototype.add=function(e,t,n,r,i){if(this.s.storeOptions.force)return i(o.create({message:"db closed by application",driver:!0}));if(0===this.s.storeOptions.bufferMaxEntries)return i(o.create({message:s("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){this.s.storedOps.shift().c(o.create({message:s("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,n:t,o:n,op:r,c:i})},u.prototype.addObjectAndMethod=function(e,t,n,r,i){if(this.s.storeOptions.force)return i(o.create({message:"db closed by application",driver:!0}));if(0===this.s.storeOptions.bufferMaxEntries)return i(o.create({message:s("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){this.s.storedOps.shift().c(o.create({message:s("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,m:n,o:t,p:r,c:i})},u.prototype.flush=function(e){for(;this.s.storedOps.length>0;)this.s.storedOps.shift().c(e||o.create({message:s("no connection available for operation"),driver:!0}))};var l=["primary","primaryPreferred","nearest","secondaryPreferred"],p=["secondary","secondaryPreferred"];u.prototype.execute=function(e){e=e||{};var t=this.s.storedOps;this.s.storedOps=[];for(var n="boolean"!=typeof e.executePrimary||e.executePrimary,r="boolean"!=typeof e.executeSecondary||e.executeSecondary;t.length>0;){var o=t.shift();"cursor"===o.t?n&&r?o.o[o.m].apply(o.o,o.p):n&&o.o.options&&o.o.options.readPreference&&-1!==l.indexOf(o.o.options.readPreference.mode)?o.o[o.m].apply(o.o,o.p):!n&&r&&o.o.options&&o.o.options.readPreference&&-1!==p.indexOf(o.o.options.readPreference.mode)&&o.o[o.m].apply(o.o,o.p):"auth"===o.t?this.s.topology[o.t].apply(this.s.topology,o.o):n&&r?this.s.topology[o.t](o.n,o.o,o.op,o.c):n&&o.op&&o.op.readPreference&&-1!==l.indexOf(o.op.readPreference.mode)?this.s.topology[o.t](o.n,o.o,o.op,o.c):!n&&r&&o.op&&o.op.readPreference&&-1!==p.indexOf(o.op.readPreference.mode)&&this.s.topology[o.t](o.n,o.o,o.op,o.c)}},u.prototype.all=function(){return this.s.storedOps};var f=function(e){var t=function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},n=!1,r=!1,o=!1,s=!1,i=!1,a=!1,c=e.maxWriteBatchSize||1e3,u=!1,l=!1;e.minWireVersion>=0&&(o=!0),e.maxWireVersion>=1&&(n=!0,s=!0),e.maxWireVersion>=2&&(r=!0),e.maxWireVersion>=3&&(i=!0,a=!0),e.maxWireVersion>=5&&(u=!0,l=!0),null==e.minWireVersion&&(e.minWireVersion=0),null==e.maxWireVersion&&(e.maxWireVersion=0),t(this,"hasAggregationCursor",n),t(this,"hasWriteCommands",r),t(this,"hasTextSearch",o),t(this,"hasAuthCommands",s),t(this,"hasListCollectionsCommand",i),t(this,"hasListIndexesCommand",a),t(this,"minWireVersion",e.minWireVersion),t(this,"maxWireVersion",e.maxWireVersion),t(this,"maxNumberOfDocsInBatch",c),t(this,"commandsTakeWriteConcern",u),t(this,"commandsTakeCollation",l)};const h=n(143).version,d=s("Node.js %s, %s",process.version,i.endianness()),m=i.type(),y=process.platform,g=process.arch,b=i.release();class v extends r{constructor(){super(),this.clientInfo={driver:{name:"nodejs",version:h},os:{type:m,name:y,architecture:g,version:b},platform:d},this.setMaxListeners(1/0)}hasSessionSupport(){return null!=this.logicalSessionTimeoutMinutes}startSession(e,t){const n=new c(this,this.s.sessionPool,e,t);return n.once("ended",()=>{this.s.sessions=this.s.sessions.filter(e=>!e.equals(n))}),this.s.sessions.push(n),n}endSessions(e,t){return this.s.coreTopology.endSessions(e,t)}capabilities(){return this.s.sCapabilities?this.s.sCapabilities:null==this.s.coreTopology.lastIsMaster()?null:(this.s.sCapabilities=new f(this.s.coreTopology.lastIsMaster()),this.s.sCapabilities)}command(e,t,n,r){this.s.coreTopology.command(e,t,a(n),r)}insert(e,t,n,r){this.s.coreTopology.insert(e,t,n,r)}update(e,t,n,r){this.s.coreTopology.update(e,t,n,r)}remove(e,t,n,r){this.s.coreTopology.remove(e,t,n,r)}isConnected(e){return e=a(e=e||{}),this.s.coreTopology.isConnected(e)}isDestroyed(){return this.s.coreTopology.isDestroyed()}cursor(e,t,n){return(n=a(n=n||{})).disconnectHandler=this.s.store,n.topology=this,this.s.coreTopology.cursor(e,t,n)}lastIsMaster(){return this.s.coreTopology.lastIsMaster()}selectServer(e,t,n){return this.s.coreTopology.selectServer(e,t,n)}unref(){return this.s.coreTopology.unref()}auth(){var e=Array.prototype.slice.call(arguments,0);this.s.coreTopology.auth.apply(this.s.coreTopology,e)}logout(){var e=Array.prototype.slice.call(arguments,0);this.s.coreTopology.logout.apply(this.s.coreTopology,e)}connections(){return this.s.coreTopology.connections()}close(e){this.s.sessions.length&&this.s.sessions.forEach(e=>e.endSession()),this.s.sessionPool&&this.s.sessionPool.endAllPooledSessions(),this.s.coreTopology.destroy({force:"boolean"==typeof e&&e}),!0===e&&(this.s.storeOptions.force=e,this.s.store.flush())}}Object.defineProperty(v.prototype,"bson",{enumerable:!0,get:function(){return this.s.coreTopology.s.bson}}),Object.defineProperty(v.prototype,"parserType",{enumerable:!0,get:function(){return this.s.coreTopology.parserType}}),Object.defineProperty(v.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.coreTopology.logicalSessionTimeoutMinutes}}),Object.defineProperty(v.prototype,"type",{enumerable:!0,get:function(){return this.s.coreTopology.type}}),t.Store=u,t.ServerCapabilities=f,t.TopologyBase=v},function(e,t){function n(){if(!(this instanceof n))return new n;this._bsontype="MinKey"}e.exports=n,e.exports.MinKey=n},function(e,t,n){if("undefined"!=typeof global)var r=n(59).Buffer;function o(e,t){if(!(this instanceof o))return new o(e,t);if(!(null==e||"string"==typeof e||r.isBuffer(e)||e instanceof Uint8Array||Array.isArray(e)))throw new Error("only String, Buffer, Uint8Array or Array accepted");if(this._bsontype="Binary",e instanceof Number?(this.sub_type=e,this.position=0):(this.sub_type=null==t?s:t,this.position=0),null==e||e instanceof Number)void 0!==r?this.buffer=new r(o.BUFFER_SIZE):"undefined"!=typeof Uint8Array?this.buffer=new Uint8Array(new ArrayBuffer(o.BUFFER_SIZE)):this.buffer=new Array(o.BUFFER_SIZE),this.position=0;else{if("string"==typeof e)if(void 0!==r)this.buffer=new r(e);else{if("undefined"==typeof Uint8Array&&"[object Array]"!==Object.prototype.toString.call(e))throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=i(e)}else this.buffer=e;this.position=e.length}}o.prototype.put=function(e){if(null!=e.length&&"number"!=typeof e&&1!==e.length)throw new Error("only accepts single character String, Uint8Array or Array");if("number"!=typeof e&&e<0||e>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var t=null;if(t="string"==typeof e?e.charCodeAt(0):null!=e.length?e[0]:e,this.buffer.length>this.position)this.buffer[this.position++]=t;else if(void 0!==r&&r.isBuffer(this.buffer)){var n=new r(o.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=t}else{n=null,n="[object Uint8Array]"===Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(o.BUFFER_SIZE+this.buffer.length)):new Array(o.BUFFER_SIZE+this.buffer.length);for(var s=0;s<this.buffer.length;s++)n[s]=this.buffer[s];this.buffer=n,this.buffer[this.position++]=t}},o.prototype.write=function(e,t){if(t="number"==typeof t?t:this.position,this.buffer.length<t+e.length){var n=null;if(void 0!==r&&r.isBuffer(this.buffer))n=new r(this.buffer.length+e.length),this.buffer.copy(n,0,0,this.buffer.length);else if("[object Uint8Array]"===Object.prototype.toString.call(this.buffer)){n=new Uint8Array(new ArrayBuffer(this.buffer.length+e.length));for(var o=0;o<this.position;o++)n[o]=this.buffer[o]}this.buffer=n}if(void 0!==r&&r.isBuffer(e)&&r.isBuffer(this.buffer))e.copy(this.buffer,t,0,e.length),this.position=t+e.length>this.position?t+e.length:this.position;else if(void 0!==r&&"string"==typeof e&&r.isBuffer(this.buffer))this.buffer.write(e,t,"binary"),this.position=t+e.length>this.position?t+e.length:this.position;else if("[object Uint8Array]"===Object.prototype.toString.call(e)||"[object Array]"===Object.prototype.toString.call(e)&&"string"!=typeof e){for(o=0;o<e.length;o++)this.buffer[t++]=e[o];this.position=t>this.position?t:this.position}else if("string"==typeof e){for(o=0;o<e.length;o++)this.buffer[t++]=e.charCodeAt(o);this.position=t>this.position?t:this.position}},o.prototype.read=function(e,t){if(t=t&&t>0?t:this.position,this.buffer.slice)return this.buffer.slice(e,e+t);for(var n="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t)):new Array(t),r=0;r<t;r++)n[r]=this.buffer[e++];return n},o.prototype.value=function(e){if((e=null!=e&&e)&&void 0!==r&&r.isBuffer(this.buffer)&&this.buffer.length===this.position)return this.buffer;if(void 0!==r&&r.isBuffer(this.buffer))return e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(e){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var t="[object Uint8Array]"===Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),n=0;n<this.position;n++)t[n]=this.buffer[n];return t}return a(this.buffer,0,this.position)},o.prototype.length=function(){return this.position},o.prototype.toJSON=function(){return null!=this.buffer?this.buffer.toString("base64"):""},o.prototype.toString=function(e){return null!=this.buffer?this.buffer.slice(0,this.position).toString(e):""};var s=0,i=function(e){for(var t="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t},a=function(e,t,n){for(var r="",o=t;o<n;o++)r+=String.fromCharCode(e[o]);return r};o.BUFFER_SIZE=256,o.SUBTYPE_DEFAULT=0,o.SUBTYPE_FUNCTION=1,o.SUBTYPE_BYTE_ARRAY=2,o.SUBTYPE_UUID_OLD=3,o.SUBTYPE_UUID=4,o.SUBTYPE_MD5=5,o.SUBTYPE_USER_DEFINED=128,e.exports=o,e.exports.Binary=o},function(e,t,n){"use strict";const r=n(3).buildCountCommand,o=n(0).formattedOrderClause,s=n(0).handleCallback,i=n(2).MongoError,a=Array.prototype.push;function c(e,t){if(0!==e.bufferedCount())return e._next(t),c}function u(e,t){const r=n(17);if(e.s.state===r.CLOSED||e.isDead&&e.isDead())return s(t,i.create({message:"Cursor is closed",driver:!0}));if(e.s.state===r.INIT&&e.s.cmd.sort)try{e.s.cmd.sort=o(e.s.cmd.sort)}catch(e){return s(t,e)}e._next((n,o)=>{if(e.s.state=r.OPEN,n)return s(t,n);s(t,null,o)})}e.exports={count:function(e,t,n,o){t&&("number"==typeof e.cursorSkip()&&(n.skip=e.cursorSkip()),"number"==typeof e.cursorLimit()&&(n.limit=e.cursorLimit())),n.readPreference&&e.setReadPreference(n.readPreference),"number"!=typeof n.maxTimeMS&&e.s.cmd&&"number"==typeof e.s.cmd.maxTimeMS&&(n.maxTimeMS=e.s.cmd.maxTimeMS);let s={};s.skip=n.skip,s.limit=n.limit,s.hint=n.hint,s.maxTimeMS=n.maxTimeMS;const i=e.s.ns.indexOf(".");let a;s.collectionName=e.s.ns.substr(i+1);try{a=r(e,e.s.cmd.query,s)}catch(e){return o(e)}e.server=e.topology.s.coreTopology,e.s.topology.command(`${e.s.ns.substr(0,i)}.$cmd`,a,e.s.options,(e,t)=>{o(e,t?t.result.n:null)})},each:function e(t,r){const o=n(17);if(!r)throw i.create({message:"callback is mandatory",driver:!0});if(t.isNotified())return;if(t.s.state===o.CLOSED||t.isDead())return s(r,i.create({message:"Cursor is closed",driver:!0}));t.s.state===o.INIT&&(t.s.state=o.OPEN);let a=null;if(t.bufferedCount()>0){for(;a=c(t,r);)a(t,r);e(t,r)}else t.next((n,o)=>n?s(r,n):null==o?t.close({skipKillCursors:!0},()=>s(r,null,null)):void(!1!==s(r,null,o)&&e(t,r)))},hasNext:function(e,t){const r=n(17);return e.s.currentDoc?t(null,!0):e.isNotified()?t(null,!1):void u(e,(n,o)=>n?t(n,null):e.s.state===r.CLOSED||e.isDead()?t(null,!1):o?(e.s.currentDoc=o,void t(null,!0)):t(null,!1))},next:function(e,t){if(e.s.currentDoc){const n=e.s.currentDoc;return e.s.currentDoc=null,t(null,n)}u(e,t)},toArray:function(e,t){const r=n(17),o=[];e.rewind(),e.s.state=r.INIT;const i=()=>{e._next((n,r)=>{if(n)return e._endSession?e._endSession(()=>s(t,n)):s(t,n);if(null==r)return e.close({skipKillCursors:!0},()=>s(t,null,o));if(o.push(r),e.bufferedCount()>0){let t=e.readBufferedDocuments(e.bufferedCount());e.s.transforms&&"function"==typeof e.s.transforms.doc&&(t=t.map(e.s.transforms.doc)),a.apply(o,t)}i()})};i()}}},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";const r=n(18),o=n(151);const s=function(){throw new Error("The `mongodb-extjson` module was not found. Please install it and try again.")};e.exports={uuidV4:()=>{const e=r.randomBytes(16);return e[6]=15&e[6]|64,e[8]=63&e[8]|128,e},calculateDurationInMs:e=>{const t=process.hrtime(e);return(1e9*t[0]+t[1])/1e6},relayEvents:function(e,t,n){n.forEach(n=>e.on(n,e=>t.emit(n,e)))},collationNotSupported:function(e,t){return t&&t.collation&&e.ismaster&&e.ismaster.maxWireVersion<5},retrieveEJSON:function(){let e=null;try{e=o("mongodb-extjson")}catch(e){}return e||(e={parse:s,deserialize:s,serialize:s,stringify:s,setBSONModule:s,BSON:s}),e},retrieveKerberos:function(){let e;try{e=o("kerberos")}catch(e){if("MODULE_NOT_FOUND"===e.code)throw new Error("The `kerberos` module was not found. Please install it and try again.");throw e}return e}}},function(e,t,n){"use strict";const r=n(15).Transform,o=n(15).PassThrough,s=n(1).inherits,i=n(1).deprecate,a=n(5).handleCallback,c=n(6).ReadPreference,u=n(6).MongoError,l=n(15).Readable,p=n(6).Cursor,f=n(6).BSON.Map,h=n(5).executeOperation,d=n(90).count,m=n(90).each,y=n(90).hasNext,g=n(90).next,b=n(90).toArray,v=["tailable","oplogReplay","noCursorTimeout","awaitData","exhaust","partial"],S=["numberOfRetries","tailableRetryInterval"];function w(e,t,n,r,o,s){p.apply(this,Array.prototype.slice.call(arguments,0));const i=w.INIT,a=r.numberOfRetries||5,c=r.tailableRetryInterval||500,u=a,f=r.promiseLibrary||Promise;l.call(this,{objectMode:!0}),this.s={numberOfRetries:a,tailableRetryInterval:c,currentNumberOfRetries:u,state:i,streamOptions:{},bson:e,ns:t,cmd:n,options:r,topology:o,topologyOptions:s,promiseLibrary:f,currentDoc:null,explicitlyIgnoreSession:r.explicitlyIgnoreSession},!r.explicitlyIgnoreSession&&r.session&&(this.s.session=r.session),!0===this.s.options.noCursorTimeout&&this.addCursorFlag("noCursorTimeout",!0),this.sortValue=this.s.cmd.sort;const h=n.cursor&&n.cursor.batchSize?n.cursor&&n.cursor.batchSize:r.cursor&&r.cursor.batchSize?r.cursor.batchSize:1e3;this.setCursorBatchSize(h)}s(w,l),w.prototype._next=function(){return this._initImplicitSession&&this._initImplicitSession(),p.prototype.next.apply(this,arguments)};for(let e in p.prototype)w.prototype[e]=p.prototype[e];w.prototype._initImplicitSession=function(){this.s.explicitlyIgnoreSession||this.s.session||!this.s.topology.hasSessionSupport()||(this.s.session=this.s.topology.startSession({owner:this}),this.cursorState.session=this.s.session)},w.prototype._endSession=function(){p.prototype._endSession.apply(this,arguments)&&(this.s.session=void 0)},w.prototype.hasNext=function(e){return h(this.s.topology,y,[this,e],{skipSessions:!0})},w.prototype.next=function(e){return h(this.s.topology,g,[this,e],{skipSessions:!0})},w.prototype.filter=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.query=e,this},w.prototype.maxScan=i(function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.maxScan=e,this},"Cursor.maxScan is deprecated, and will be removed in a later version"),w.prototype.hint=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.hint=e,this},w.prototype.min=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.min=e,this},w.prototype.max=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.max=e,this},w.prototype.returnKey=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.returnKey=e,this},w.prototype.showRecordId=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.showDiskLoc=e,this},w.prototype.snapshot=i(function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.snapshot=e,this},"Cursor Snapshot is deprecated, and will be removed in a later version"),w.prototype.setCursorOption=function(e,t){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});if(-1===S.indexOf(e))throw u.create({message:`option ${e} is not a supported option ${S}`,driver:!0});return this.s[e]=t,"numberOfRetries"===e&&(this.s.currentNumberOfRetries=t),this},w.prototype.addCursorFlag=function(e,t){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});if(-1===v.indexOf(e))throw u.create({message:`flag ${e} is not a supported flag ${v}`,driver:!0});if("boolean"!=typeof t)throw u.create({message:`flag ${e} must be a boolean value`,driver:!0});return this.s.cmd[e]=t,this},w.prototype.addQueryModifier=function(e,t){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});if("$"!==e[0])throw u.create({message:`${e} is not a valid query modifier`,driver:!0});const n=e.substr(1);return this.s.cmd[n]=t,"orderby"===n&&(this.s.cmd.sort=this.s.cmd[n]),this},w.prototype.comment=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.comment=e,this},w.prototype.maxAwaitTimeMS=function(e){if("number"!=typeof e)throw u.create({message:"maxAwaitTimeMS must be a number",driver:!0});if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.maxAwaitTimeMS=e,this},w.prototype.maxTimeMS=function(e){if("number"!=typeof e)throw u.create({message:"maxTimeMS must be a number",driver:!0});if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.maxTimeMS=e,this},w.prototype.maxTimeMs=w.prototype.maxTimeMS,w.prototype.project=function(e){if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});return this.s.cmd.fields=e,this},w.prototype.sort=function(e,t){if(this.s.options.tailable)throw u.create({message:"Tailable cursor doesn't support sorting",driver:!0});if(this.s.state===w.CLOSED||this.s.state===w.OPEN||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});let n=e;return Array.isArray(n)&&Array.isArray(n[0])&&(n=new f(n.map(e=>{const t=[e[0],null];if("asc"===e[1])t[1]=1;else if("desc"===e[1])t[1]=-1;else{if(1!==e[1]&&-1!==e[1]&&!e[1].$meta)throw new u("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");t[1]=e[1]}return t}))),null!=t&&(n=[[e,t]]),this.s.cmd.sort=n,this.sortValue=n,this},w.prototype.batchSize=function(e){if(this.s.options.tailable)throw u.create({message:"Tailable cursor doesn't support batchSize",driver:!0});if(this.s.state===w.CLOSED||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw u.create({message:"batchSize requires an integer",driver:!0});return this.s.cmd.batchSize=e,this.setCursorBatchSize(e),this},w.prototype.collation=function(e){return this.s.cmd.collation=e,this},w.prototype.limit=function(e){if(this.s.options.tailable)throw u.create({message:"Tailable cursor doesn't support limit",driver:!0});if(this.s.state===w.OPEN||this.s.state===w.CLOSED||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw u.create({message:"limit requires an integer",driver:!0});return this.s.cmd.limit=e,this.setCursorLimit(e),this},w.prototype.skip=function(e){if(this.s.options.tailable)throw u.create({message:"Tailable cursor doesn't support skip",driver:!0});if(this.s.state===w.OPEN||this.s.state===w.CLOSED||this.isDead())throw u.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw u.create({message:"skip requires an integer",driver:!0});return this.s.cmd.skip=e,this.setCursorSkip(e),this},w.prototype.each=i(function(e){this.rewind(),this.s.state=w.INIT,m(this,e)},"Cursor.each is deprecated. Use Cursor.forEach instead."),w.prototype.forEach=function(e,t){if(this.rewind(),this.s.state=w.INIT,"function"!=typeof t)return new this.s.promiseLibrary((t,n)=>{m(this,(r,o)=>r?(n(r),!1):null==o?(t(null),!1):(e(o),!0))});m(this,(n,r)=>{if(n)return t(n),!1;if(null!=r)return e(r),!0;if(null==r&&t){const e=t;return t=null,e(null),!1}})},w.prototype.setReadPreference=function(e){if(this.s.state!==w.INIT)throw u.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(e instanceof c)this.s.options.readPreference=e;else{if("string"!=typeof e)throw new TypeError("Invalid read preference: "+e);this.s.options.readPreference=new c(e)}return this},w.prototype.toArray=function(e){if(this.s.options.tailable)throw u.create({message:"Tailable cursor cannot be converted to array",driver:!0});return h(this.s.topology,b,[this,e],{skipSessions:!0})},w.prototype.count=function(e,t,n){if(null==this.s.cmd.query)throw u.create({message:"count can only be used with find command",driver:!0});return"function"==typeof t&&(n=t,t={}),t=t||{},"function"==typeof e&&(n=e,e=!0),this.s.session&&(t=Object.assign({},t,{session:this.s.session})),h(this.s.topology,d,[this,e,t,n],{skipSessions:!!this.s.session})},w.prototype.close=function(e,t){"function"==typeof e&&(t=e,e={}),e=Object.assign({},{skipKillCursors:!1},e),this.s.state=w.CLOSED,e.skipKillCursors||this.kill();const n=()=>(this.emit("close"),"function"==typeof t?a(t,null,this):new this.s.promiseLibrary(e=>{e()}));return this.s.session?"function"==typeof t?this._endSession(()=>n()):new this.s.promiseLibrary(e=>{this._endSession(()=>n().then(e))}):n()},w.prototype.map=function(e){if(this.cursorState.transforms&&this.cursorState.transforms.doc){const t=this.cursorState.transforms.doc;this.cursorState.transforms.doc=(n=>e(t(n)))}else this.cursorState.transforms={doc:e};return this},w.prototype.isClosed=function(){return this.isDead()},w.prototype.destroy=function(e){e&&this.emit("error",e),this.pause(),this.close()},w.prototype.stream=function(e){return this.s.streamOptions=e||{},this},w.prototype.transformStream=function(e){const t=e||{};if("function"==typeof t.transform){const e=new r({objectMode:!0,transform:function(e,n,r){this.push(t.transform(e)),r()}});return this.pipe(e)}return this.pipe(new o({objectMode:!0}))},w.prototype.explain=function(e){return this.s.cmd.explain=!0,this.s.cmd.readConcern&&delete this.s.cmd.readConcern,h(this.s.topology,this._next.bind(this),[e],{skipSessions:!0})},w.prototype._read=function(){if(this.s.state===w.CLOSED||this.isDead())return this.push(null);this.next((e,t)=>e?(this.listeners("error")&&this.listeners("error").length>0&&this.emit("error",e),this.isDead()||this.close(),this.emit("end"),this.emit("finish")):"function"==typeof this.s.streamOptions.transform&&null!=t?this.push(this.s.streamOptions.transform(t)):this.cursorState.transforms&&"function"==typeof this.cursorState.transforms.doc&&null!=t?this.push(this.cursorState.transforms.doc(t)):(this.push(t),void(null===t&&this.isDead()&&this.once("end",()=>{this.close(),this.emit("finish")}))))},w.prototype.getLogger=function(){return this.logger},Object.defineProperty(w.prototype,"readPreference",{enumerable:!0,get:function(){return this&&this.s?this.s.options.readPreference:null}}),Object.defineProperty(w.prototype,"namespace",{enumerable:!0,get:function(){if(!this||!this.s)return null;const e=this.s.ns||"",t=e.indexOf(".");return t<0?{database:this.s.ns,collection:""}:{database:e.substr(0,t),collection:e.substr(t+1)}}}),w.INIT=0,w.OPEN=1,w.CLOSED=2,w.GET_MORE=3,e.exports=w},function(e,t){function n(e){if(!(this instanceof n))return new n(e);this._bsontype="Double",this.value=e}n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},e.exports=n,e.exports.Double=n},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this._bsontype="Timestamp",this.low_=0|e,this.high_=0|t}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var r=n.fromNumber(t),o=this.div(r),s=o.multiply(r).subtract(this);return o.toString(t)+s.toInt().toString(t)}return"-"+this.negate().toString(t)}var i=n.fromNumber(Math.pow(t,6));s=this;for(var a="";!s.isZero();){var c=s.div(i),u=s.subtract(c.multiply(i)).toInt().toString(t);if((s=c).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!==this.high_?this.high_:this.low_,t=31;t>0&&0==(e&1<<t);t--);return 0!==this.high_?t+33:t+1},n.prototype.isZero=function(){return 0===this.high_&&0===this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_},n.prototype.notEquals=function(e){return this.high_!==e.high_||this.low_!==e.low_},n.prototype.lessThan=function(e){return this.compare(e)<0},n.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},n.prototype.greaterThan=function(e){return this.compare(e)>0},n.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},n.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(e){var t=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,s=65535&this.low_,i=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,u=0,l=0,p=0,f=0;return p+=(f+=s+(65535&e.low_))>>>16,f&=65535,l+=(p+=o+c)>>>16,p&=65535,u+=(l+=r+a)>>>16,l&=65535,u+=t+i,u&=65535,n.fromBits(p<<16|f,u<<16|l)},n.prototype.subtract=function(e){return this.add(e.negate())},n.prototype.multiply=function(e){if(this.isZero())return n.ZERO;if(e.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return e.isOdd()?n.MIN_VALUE:n.ZERO;if(e.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&e.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,s=65535&this.low_,i=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,u=65535&e.low_,l=0,p=0,f=0,h=0;return f+=(h+=s*u)>>>16,h&=65535,p+=(f+=o*u)>>>16,f&=65535,p+=(f+=s*c)>>>16,f&=65535,l+=(p+=r*u)>>>16,p&=65535,l+=(p+=o*c)>>>16,p&=65535,l+=(p+=s*a)>>>16,p&=65535,l+=t*u+r*c+o*a+s*i,l&=65535,n.fromBits(f<<16|h,l<<16|p)},n.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(e.equals(n.ONE)||e.equals(n.NEG_ONE))return n.MIN_VALUE;if(e.equals(n.MIN_VALUE))return n.ONE;var t=this.shiftRight(1).div(e).shiftLeft(1);if(t.equals(n.ZERO))return e.isNegative()?n.ONE:n.NEG_ONE;var r=this.subtract(e.multiply(t));return t.add(r.div(e))}if(e.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var o=n.ZERO;for(r=this;r.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(t)/Math.LN2),i=s<=48?1:Math.pow(2,s-48),a=n.fromNumber(t),c=a.multiply(e);c.isNegative()||c.greaterThan(r);)t-=i,c=(a=n.fromNumber(t)).multiply(e);a.isZero()&&(a=n.ONE),o=o.add(a),r=r.subtract(c)}return o},n.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(e){return n.fromBits(this.low_&e.low_,this.high_&e.high_)},n.prototype.or=function(e){return n.fromBits(this.low_|e.low_,this.high_|e.high_)},n.prototype.xor=function(e){return n.fromBits(this.low_^e.low_,this.high_^e.high_)},n.prototype.shiftLeft=function(e){if(0===(e&=63))return this;var t=this.low_;if(e<32){var r=this.high_;return n.fromBits(t<<e,r<<e|t>>>32-e)}return n.fromBits(0,t<<e-32)},n.prototype.shiftRight=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var r=this.low_;return n.fromBits(r>>>e|t<<32-e,t>>e)}return n.fromBits(t>>e-32,t>=0?0:-1)},n.prototype.shiftRightUnsigned=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var r=this.low_;return n.fromBits(r>>>e|t<<32-e,t>>>e)}return 32===e?n.fromBits(t,0):n.fromBits(t>>>e-32,0)},n.fromInt=function(e){if(-128<=e&&e<128){var t=n.INT_CACHE_[e];if(t)return t}var r=new n(0|e,e<0?-1:0);return-128<=e&&e<128&&(n.INT_CACHE_[e]=r),r},n.fromNumber=function(e){return isNaN(e)||!isFinite(e)?n.ZERO:e<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:e+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:e<0?n.fromNumber(-e).negate():new n(e%n.TWO_PWR_32_DBL_|0,e/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(e,t){return new n(e,t)},n.fromString=function(e,t){if(0===e.length)throw Error("number format error: empty string");var r=t||10;if(r<2||36<r)throw Error("radix out of range: "+r);if("-"===e.charAt(0))return n.fromString(e.substring(1),r).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var o=n.fromNumber(Math.pow(r,8)),s=n.ZERO,i=0;i<e.length;i+=8){var a=Math.min(8,e.length-i),c=parseInt(e.substring(i,i+a),r);if(a<8){var u=n.fromNumber(Math.pow(r,a));s=s.multiply(u).add(n.fromNumber(c))}else s=(s=s.multiply(o)).add(n.fromNumber(c))}return s},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),e.exports=n,e.exports.Timestamp=n},function(e,t,n){var r="inspect",o=parseInt(16777215*Math.random(),10),s=new RegExp("^[0-9a-fA-F]{24}$");try{if(Buffer&&Buffer.from){var i=!0;r=n(1).inspect.custom||"inspect"}}catch(e){i=!1}for(var a=function e(t){if(t instanceof e)return t;if(!(this instanceof e))return new e(t);if(this._bsontype="ObjectID",null==t||"number"==typeof t)return this.id=this.generate(t),void(e.cacheHexString&&(this.__id=this.toString("hex")));var n=e.isValid(t);if(!n&&null!=t)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(n&&"string"==typeof t&&24===t.length&&i)return new e(new Buffer(t,"hex"));if(n&&"string"==typeof t&&24===t.length)return e.createFromHexString(t);if(null==t||12!==t.length){if(null!=t&&t.toHexString)return t;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=t,e.cacheHexString&&(this.__id=this.toString("hex"))},c=[],u=0;u<256;u++)c[u]=(u<=15?"0":"")+u.toString(16);a.prototype.toHexString=function(){if(a.cacheHexString&&this.__id)return this.__id;var e="";if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id instanceof p)return e=f(this.id),a.cacheHexString&&(this.__id=e),e;for(var t=0;t<this.id.length;t++)e+=c[this.id.charCodeAt(t)];return a.cacheHexString&&(this.__id=e),e},a.prototype.get_inc=function(){return a.index=(a.index+1)%16777215},a.prototype.getInc=function(){return this.get_inc()},a.prototype.generate=function(e){"number"!=typeof e&&(e=~~(Date.now()/1e3));var t=("undefined"==typeof process||1===process.pid?Math.floor(1e5*Math.random()):process.pid)%65535,n=this.get_inc(),r=new Buffer(12);return r[3]=255&e,r[2]=e>>8&255,r[1]=e>>16&255,r[0]=e>>24&255,r[6]=255&o,r[5]=o>>8&255,r[4]=o>>16&255,r[8]=255&t,r[7]=t>>8&255,r[11]=255&n,r[10]=n>>8&255,r[9]=n>>16&255,r},a.prototype.toString=function(e){return this.id&&this.id.copy?this.id.toString("string"==typeof e?e:"hex"):this.toHexString()},a.prototype[r]=a.prototype.toString,a.prototype.toJSON=function(){return this.toHexString()},a.prototype.equals=function(e){return e instanceof a?this.toString()===e.toString():"string"==typeof e&&a.isValid(e)&&12===e.length&&this.id instanceof p?e===this.id.toString("binary"):"string"==typeof e&&a.isValid(e)&&24===e.length?e.toLowerCase()===this.toHexString():"string"==typeof e&&a.isValid(e)&&12===e.length?e===this.id:!(null==e||!(e instanceof a||e.toHexString))&&e.toHexString()===this.toHexString()},a.prototype.getTimestamp=function(){var e=new Date,t=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24;return e.setTime(1e3*Math.floor(t)),e},a.index=~~(16777215*Math.random()),a.createPk=function(){return new a},a.createFromTime=function(e){var t=new Buffer([0,0,0,0,0,0,0,0,0,0,0,0]);return t[3]=255&e,t[2]=e>>8&255,t[1]=e>>16&255,t[0]=e>>24&255,new a(t)};var l=[];for(u=0;u<10;)l[48+u]=u++;for(;u<16;)l[55+u]=l[87+u]=u++;var p=Buffer,f=function(e){return e.toString("hex")};a.createFromHexString=function(e){if(void 0===e||null!=e&&24!==e.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(i)return new a(new Buffer(e,"hex"));for(var t=new p(12),n=0,r=0;r<24;)t[n++]=l[e.charCodeAt(r++)]<<4|l[e.charCodeAt(r++)];return new a(t)},a.isValid=function(e){return null!=e&&("number"==typeof e||("string"==typeof e?12===e.length||24===e.length&&s.test(e):e instanceof a||(e instanceof p||!!e.toHexString&&(12===e.id.length||24===e.id.length&&s.test(e.id)))))},Object.defineProperty(a.prototype,"generationTime",{enumerable:!0,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(e){this.id[3]=255&e,this.id[2]=e>>8&255,this.id[1]=e>>16&255,this.id[0]=e>>24&255}}),e.exports=a,e.exports.ObjectID=a,e.exports.ObjectId=a},function(e,t){function n(e,t){if(!(this instanceof n))return new n;this._bsontype="BSONRegExp",this.pattern=e||"",this.options=t||"";for(var r=0;r<this.options.length;r++)if("i"!==this.options[r]&&"m"!==this.options[r]&&"x"!==this.options[r]&&"l"!==this.options[r]&&"s"!==this.options[r]&&"u"!==this.options[r])throw new Error("the regular expression options ["+this.options[r]+"] is not supported")}e.exports=n,e.exports.BSONRegExp=n},function(e,t,n){var r=Buffer&&n(1).inspect.custom||"inspect";function o(e){if(!(this instanceof o))return new o(e);this._bsontype="Symbol",this.value=e}o.prototype.valueOf=function(){return this.value},o.prototype.toString=function(){return this.value},o.prototype[r]=function(){return this.value},o.prototype.toJSON=function(){return this.value},e.exports=o,e.exports.Symbol=o},function(e,t){var n=function e(t,n){if(!(this instanceof e))return new e(t,n);this._bsontype="Code",this.code=t,this.scope=n};n.prototype.toJSON=function(){return{scope:this.scope,code:this.code}},e.exports=n,e.exports.Code=n},function(e,t,n){"use strict";var r=n(26),o=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,s=/^(\+|-)?(Infinity|inf)$/i,i=/^(\+|-)?NaN$/i,a=6176,c=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),u=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),l=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),p=/^([-+])?(\d+)?$/,f=function(e){return!isNaN(parseInt(e,10))},h=function(e){var t=r.fromNumber(1e9),n=r.fromNumber(0),o=0;if(!(e.parts[0]||e.parts[1]||e.parts[2]||e.parts[3]))return{quotient:e,rem:n};for(o=0;o<=3;o++)n=(n=n.shiftLeft(32)).add(new r(e.parts[o],0)),e.parts[o]=n.div(t).low_,n=n.modulo(t);return{quotient:e,rem:n}},d=function(e){this._bsontype="Decimal128",this.bytes=e};d.fromString=function(e){var t,n=!1,h=!1,m=!1,y=0,g=0,b=0,v=0,S=0,w=[0],O=0,_=0,T=0,C=0,E=0,N=0,I=[0,0],x=[0,0],A=0;if((e=e.trim()).length>=7e3)throw new Error(e+" not a valid Decimal128 string");var k=e.match(o),B=e.match(s),M=e.match(i);if(!k&&!B&&!M||0===e.length)throw new Error(e+" not a valid Decimal128 string");if(k&&k[4]&&void 0===k[2])throw new Error(e+" not a valid Decimal128 string");if("+"!==e[A]&&"-"!==e[A]||(n="-"===e[A++]),!f(e[A])&&"."!==e[A]){if("i"===e[A]||"I"===e[A])return new d(new Buffer(n?u:l));if("N"===e[A])return new d(new Buffer(c))}for(;f(e[A])||"."===e[A];)if("."!==e[A])O<34&&("0"!==e[A]||m)&&(m||(S=g),m=!0,w[_++]=parseInt(e[A],10),O+=1),m&&(b+=1),h&&(v+=1),g+=1,A+=1;else{if(h)return new d(new Buffer(c));h=!0,A+=1}if(h&&!g)throw new Error(e+" not a valid Decimal128 string");if("e"===e[A]||"E"===e[A]){var D=e.substr(++A).match(p);if(!D||!D[2])return new d(new Buffer(c));E=parseInt(D[0],10),A+=D[0].length}if(e[A])return new d(new Buffer(c));if(T=0,O){if(C=O-1,y=b,0!==E&&1!==y)for(;"0"===e[S+y-1];)y-=1}else T=0,C=0,w[0]=0,b=1,O=1,y=0;for(E<=v&&v-E>16384?E=-6176:E-=v;E>6111;){if((C+=1)-T>34){var R=w.join("");if(R.match(/^0+$/)){E=6111;break}return new d(new Buffer(n?u:l))}E-=1}for(;E<-6176||O<b;){if(0===C){E=-6176,y=0;break}if(O<b?b-=1:C-=1,!(E<6111)){if((R=w.join("")).match(/^0+$/)){E=6111;break}return new d(new Buffer(n?u:l))}E+=1}if(C-T+1<y&&"0"!==e[y]){var P=g;h&&-6176===E&&(S+=1,P+=1);var L=parseInt(e[S+C+1],10),j=0;if(L>=5&&(j=1,5===L))for(j=w[C]%2==1,N=S+C+2;N<P;N++)if(parseInt(e[N],10)){j=1;break}if(j)for(var U=C;U>=0&&++w[U]>9;U--)if(w[U]=0,0===U){if(!(E<6111))return new d(new Buffer(n?u:l));E+=1,w[U]=1}}if(I=r.fromNumber(0),x=r.fromNumber(0),0===y)I=r.fromNumber(0),x=r.fromNumber(0);else if(C-T<17)for(U=T,x=r.fromNumber(w[U++]),I=new r(0,0);U<=C;U++)x=(x=x.multiply(r.fromNumber(10))).add(r.fromNumber(w[U]));else{for(U=T,I=r.fromNumber(w[U++]);U<=C-17;U++)I=(I=I.multiply(r.fromNumber(10))).add(r.fromNumber(w[U]));for(x=r.fromNumber(w[U++]);U<=C;U++)x=(x=x.multiply(r.fromNumber(10))).add(r.fromNumber(w[U]))}var z=function(e,t){if(!e&&!t)return{high:r.fromNumber(0),low:r.fromNumber(0)};var n=e.shiftRightUnsigned(32),o=new r(e.getLowBits(),0),s=t.shiftRightUnsigned(32),i=new r(t.getLowBits(),0),a=n.multiply(s),c=n.multiply(i),u=o.multiply(s),l=o.multiply(i);return a=a.add(c.shiftRightUnsigned(32)),c=new r(c.getLowBits(),0).add(u).add(l.shiftRightUnsigned(32)),{high:a=a.add(c.shiftRightUnsigned(32)),low:l=c.shiftLeft(32).add(new r(l.getLowBits(),0))}}(I,r.fromString("100000000000000000"));z.low=z.low.add(x),function(e,t){var n=e.high_>>>0,r=t.high_>>>0;return n<r||n===r&&e.low_>>>0<t.low_>>>0}(z.low,x)&&(z.high=z.high.add(r.fromNumber(1))),t=E+a;var q={low:r.fromNumber(0),high:r.fromNumber(0)};z.high.shiftRightUnsigned(49).and(r.fromNumber(1)).equals(r.fromNumber)?(q.high=q.high.or(r.fromNumber(3).shiftLeft(61)),q.high=q.high.or(r.fromNumber(t).and(r.fromNumber(16383).shiftLeft(47))),q.high=q.high.or(z.high.and(r.fromNumber(0x7fffffffffff)))):(q.high=q.high.or(r.fromNumber(16383&t).shiftLeft(49)),q.high=q.high.or(z.high.and(r.fromNumber(562949953421311)))),q.low=z.low,n&&(q.high=q.high.or(r.fromString("9223372036854775808")));var $=new Buffer(16);return A=0,$[A++]=255&q.low.low_,$[A++]=q.low.low_>>8&255,$[A++]=q.low.low_>>16&255,$[A++]=q.low.low_>>24&255,$[A++]=255&q.low.high_,$[A++]=q.low.high_>>8&255,$[A++]=q.low.high_>>16&255,$[A++]=q.low.high_>>24&255,$[A++]=255&q.high.low_,$[A++]=q.high.low_>>8&255,$[A++]=q.high.low_>>16&255,$[A++]=q.high.low_>>24&255,$[A++]=255&q.high.high_,$[A++]=q.high.high_>>8&255,$[A++]=q.high.high_>>16&255,$[A++]=q.high.high_>>24&255,new d($)};a=6176,d.prototype.toString=function(){for(var e,t,n,o,s,i,c=0,u=new Array(36),l=0;l<u.length;l++)u[l]=0;var p,f,d,m,y,g=0,b=!1,v={parts:new Array(4)},S=[];g=0;var w=this.bytes;if(o=w[g++]|w[g++]<<8|w[g++]<<16|w[g++]<<24,n=w[g++]|w[g++]<<8|w[g++]<<16|w[g++]<<24,t=w[g++]|w[g++]<<8|w[g++]<<16|w[g++]<<24,e=w[g++]|w[g++]<<8|w[g++]<<16|w[g++]<<24,g=0,{low:new r(o,n),high:new r(t,e)}.high.lessThan(r.ZERO)&&S.push("-"),(s=e>>26&31)>>3==3){if(30===s)return S.join("")+"Infinity";if(31===s)return"NaN";i=e>>15&16383,d=8+(e>>14&1)}else d=e>>14&7,i=e>>17&16383;if(p=i-a,v.parts[0]=(16383&e)+((15&d)<<14),v.parts[1]=t,v.parts[2]=n,v.parts[3]=o,0===v.parts[0]&&0===v.parts[1]&&0===v.parts[2]&&0===v.parts[3])b=!0;else for(y=3;y>=0;y--){var O=0,_=h(v);if(v=_.quotient,O=_.rem.low_)for(m=8;m>=0;m--)u[9*y+m]=O%10,O=Math.floor(O/10)}if(b)c=1,u[g]=0;else for(c=36,l=0;!u[g];)l++,c-=1,g+=1;if((f=c-1+p)>=34||f<=-7||p>0){for(S.push(u[g++]),(c-=1)&&S.push("."),l=0;l<c;l++)S.push(u[g++]);S.push("E"),f>0?S.push("+"+f):S.push(f)}else if(p>=0)for(l=0;l<c;l++)S.push(u[g++]);else{var T=c+p;if(T>0)for(l=0;l<T;l++)S.push(u[g++]);else S.push("0");for(S.push(".");T++<0;)S.push("0");for(l=0;l<c-Math.max(T-1,0);l++)S.push(u[g++])}return S.join("")},d.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.exports=d,e.exports.Decimal128=d},function(e,t){function n(){if(!(this instanceof n))return new n;this._bsontype="MaxKey"}e.exports=n,e.exports.MaxKey=n},function(e,t){function n(e,t,r){if(!(this instanceof n))return new n(e,t,r);this._bsontype="DBRef",this.namespace=e,this.oid=t,this.db=r}n.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:null==this.db?"":this.db}},e.exports=n,e.exports.DBRef=n},function(e,t,n){"use strict";var r=n(13).retrieveSnappy(),o=n(95),s={snappy:1,zlib:2};e.exports={compressorIDs:s,uncompressibleCommands:["ismaster","saslStart","saslContinue","getnonce","authenticate","createUser","updateUser","copydbSaslStart","copydbgetnonce","copydb"],compress:function(e,t,n){switch(e.options.agreedCompressor){case"snappy":r.compress(t,n);break;case"zlib":var s={};e.options.zlibCompressionLevel&&(s.level=e.options.zlibCompressionLevel),o.deflate(t,s,n);break;default:throw new Error('Attempt to compress message using unknown compressor "'+e.options.agreedCompressor+'".')}},decompress:function(e,t,n){if(e<0||e>s.length)throw new Error("Server sent message compressed using an unsupported compressor. (Received compressor ID "+e+")");switch(e){case s.snappy:r.uncompress(t,n);break;case s.zlib:o.inflate(t,n);break;default:n(null,t)}}}},function(e,t,n){"use strict";const r=n(78),o=n(79),s=n(80),i=n(81),a=n(126),c=n(48).ScramSHA1,u=n(48).ScramSHA256;e.exports={defaultAuthProviders:function(e){return{mongocr:new r(e),x509:new o(e),plain:new s(e),gssapi:new i(e),sspi:new a(e),"scram-sha-1":new c(e),"scram-sha-256":new u(e)}}}},function(e,t,n){"use strict";var r=n(1).format,o=n(18),s=n(13).retrieveBSON,i=n(12).Query,a=n(4).MongoError,c=n(19).Buffer;let u;try{u=n(127)}catch(e){}var l=s().Binary,p=function(e,t,n){this.db=e,this.username=t,this.password=n};p.prototype.equal=function(e){return e.db===this.db&&e.username===this.username&&e.password===this.password};var f=0,h=function(e,t){this.bson=e,this.authStore=[],this.id=f++,this.cryptoMethod=t||"sha1"};function d(e,t,n){return o.createHmac(e,t).update(n).digest()}var m={},y=0,g=function(){m={},y=0};const b={sha256:32,sha1:20};h.prototype.auth=function(e,t,n,s,f,h){var S=this,w=t.length;if(0===w)return h(null,null);var O=0,_=null;const T=this.cryptoMethod;let C,E="SCRAM-SHA-1";if("sha256"===T){E="SCRAM-SHA-256";let t=e.s&&e.s.saslprep||u;t?C=t(f):(console.warn("Warning: no saslprep library specified. Passwords will not be sanitized"),C=f)}else C=function(e,t){if("string"!=typeof e)throw new a("username must be a string");if("string"!=typeof t)throw new a("password must be a string");if(0===t.length)throw new a("password cannot be empty");var n=o.createHash("md5");return n.update(e+":mongo:"+t,"utf8"),n.digest("hex")}(s,f);for(var N=function(t){s=s.replace("=","=3D").replace(",","=2C");var u=o.randomBytes(24).toString("base64");const N=c.concat([c.from("n=","utf8"),c.from(s,"utf8"),c.from(",r=","utf8"),c.from(u,"utf8")]);var I={saslStart:1,mechanism:E,payload:new l(c.concat([c.from("n,,","utf8"),N])),autoAuthorize:1},x=function(e,t){return e?(O-=1,_=e,!1):t.result.$err?(_=t.result,!1):t.result.errmsg?(_=t.result,!1):(O+=1,!0)},A=function(e,t){x(e,t),function(e,t){0===e&&t>0?(v(S.authStore,new p(n,s,f)),h(null,!0)):0===e&&(null==_&&(_=new a(r("failed to authenticate using scram"))),h(_,!1))}(w-=1,O)};e(t,new i(S.bson,r("%s.$cmd",n),I,{numberToSkip:0,numberToReturn:1}),function(u,E){if(!1===x(u,E))return 0===(w-=1)&&O>0?(v(S.authStore,new p(n,s,f)),h(null,!0)):0===w?(null==_&&(_=new a(r("failed to authenticate using scram"))),h(_,!1)):void 0;var I=function(e){for(var t={},n=e.split(","),r=0;r<n.length;r++){var o=n[r].split("=");t[o[0]]=o[1]}return t}(E.result.payload.value()),k=parseInt(I.i,10),B=I.s,M=I.r,D=r("c=biws,r=%s",M),R=function(e,t,n,r){const s=[e,t.toString("base64"),n].join("_");if(void 0!==m[s])return m[s];const i=o.pbkdf2Sync(e,t,n,b[r],r);return y>=200&&g(),m[s]=i,y+=1,i}(C,c.from(B,"base64"),k,T);if(k&&k<4096){const e=new a(`Server returned an invalid iteration count ${k}`);return h(e,!1)}const P=d(T,R,"Client Key"),L=function(e,t){return o.createHash(e).update(t).digest()}(T,P),j=[N,E.result.payload.value().toString("base64"),D].join(","),U=d(T,L,j),z=[D,r("p=%s",function(e,t){c.isBuffer(e)||(e=c.from(e)),c.isBuffer(t)||(t=c.from(t));const n=Math.max(e.length,t.length),r=[];for(let o=0;o<n;o+=1)r.push(e[o]^t[o]);return c.from(r).toString("base64")}(P,U))].join(","),q={saslContinue:1,conversationId:E.result.conversationId,payload:new l(c.from(z))};e(t,new i(S.bson,r("%s.$cmd",n),q,{numberToSkip:0,numberToReturn:1}),function(o,s){if(s&&!1===s.result.done){var a={saslContinue:1,conversationId:s.result.conversationId,payload:c.alloc(0)};e(t,new i(S.bson,r("%s.$cmd",n),a,{numberToSkip:0,numberToReturn:1}),function(e,t){A(e,t)})}else A(o,s)})})},I=function(e){process.nextTick(function(){N(e)})};t.length>0;)I(t.shift())};var v=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};h.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!==e})},h.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var s=0;s<r.length;s++)this.auth(e,t,r[s].db,r[s].username,r[s].password,function(e){0===(o-=1)&&n(e,null)})};e.exports={ScramSHA1:class extends h{constructor(e){super(e,"sha1")}},ScramSHA256:class extends h{constructor(e){super(e,"sha256")}}}},function(e,t,n){"use strict";const r=n(23),o=n(13).retrieveBSON,s=n(4).MongoError,i=n(4).MongoNetworkError,a=n(4).mongoErrorContextSymbol,c=n(1).format,u=n(16).collationNotSupported;var l=o().Long,p=function(e,t,n,o,s,i){o=o||{},this.pool=null,this.server=null,this.disconnectHandler=o.disconnectHandler,this.bson=e,this.ns=t,this.cmd=n,this.options=o,this.topology=s,this.cursorState={cursorId:null,cmd:n,documents:o.documents||[],cursorIndex:0,dead:!1,killed:!1,init:!1,notified:!1,limit:o.limit||n.limit||0,skip:o.skip||n.skip||0,batchSize:o.batchSize||n.batchSize||1e3,currentLimit:0,transforms:o.transforms},"object"==typeof o.session&&(this.cursorState.session=o.session),"boolean"==typeof i.promoteLongs?this.cursorState.promoteLongs=i.promoteLongs:"boolean"==typeof o.promoteLongs&&(this.cursorState.promoteLongs=o.promoteLongs),"boolean"==typeof i.promoteValues?this.cursorState.promoteValues=i.promoteValues:"boolean"==typeof o.promoteValues&&(this.cursorState.promoteValues=o.promoteValues),"boolean"==typeof i.promoteBuffers?this.cursorState.promoteBuffers=i.promoteBuffers:"boolean"==typeof o.promoteBuffers&&(this.cursorState.promoteBuffers=o.promoteBuffers),i.reconnect&&(this.cursorState.reconnect=i.reconnect),this.logger=r("Cursor",i),"number"==typeof n?(this.cursorState.cursorId=l.fromNumber(n),this.cursorState.lastCursorId=this.cursorState.cursorId):n instanceof l&&(this.cursorState.cursorId=n,this.cursorState.lastCursorId=n)};p.prototype.setCursorBatchSize=function(e){this.cursorState.batchSize=e},p.prototype.cursorBatchSize=function(){return this.cursorState.batchSize},p.prototype.setCursorLimit=function(e){this.cursorState.limit=e},p.prototype.cursorLimit=function(){return this.cursorState.limit},p.prototype.setCursorSkip=function(e){this.cursorState.skip=e},p.prototype.cursorSkip=function(){return this.cursorState.skip},p.prototype._endSession=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=this.cursorState.session;return n&&(e.force||n.owner===this)?(this.cursorState.session=void 0,n.endSession(t),!0):(t&&t(),!1)};var f=function(e,t,n){try{e(t,n)}catch(t){process.nextTick(function(){throw t})}};p.prototype._find=function(e){var t=this;t.logger.isDebug()&&t.logger.debug(c("issue initial query [%s] with flags [%s]",JSON.stringify(t.cmd),JSON.stringify(t.query)));var n={};(t.options.raw||t.cmd.raw)&&(n.raw=t.options.raw||t.cmd.raw),"string"==typeof t.query.documentsReturnedIn&&(n.documentsReturnedIn=t.query.documentsReturnedIn),"boolean"==typeof t.cursorState.promoteLongs&&(n.promoteLongs=t.cursorState.promoteLongs),"boolean"==typeof t.cursorState.promoteValues&&(n.promoteValues=t.cursorState.promoteValues),"boolean"==typeof t.cursorState.promoteBuffers&&(n.promoteBuffers=t.cursorState.promoteBuffers),"object"==typeof t.cursorState.session&&(n.session=t.cursorState.session),t.server.s.pool.write(t.query,n,function(n,r){if(n)return e(n);var o=r.message;if(o.queryFailure)return e(new s(o.documents[0]),null);if(Array.isArray(o.documents)&&1===o.documents.length&&(!t.cmd.find||t.cmd.find&&!1===t.cmd.virtual)&&("string"!=typeof o.documents[0].cursor||o.documents[0].$err||o.documents[0].errmsg||Array.isArray(o.documents[0].result))){if(o.documents[0].$err||o.documents[0].errmsg)return e(new s(o.documents[0]),null);if(null!=o.documents[0].cursor&&"string"!=typeof o.documents[0].cursor){var i=o.documents[0].cursor.id;return o.documents[0].cursor.ns&&(t.ns=o.documents[0].cursor.ns),t.cursorState.cursorId="number"==typeof i?l.fromNumber(i):i,t.cursorState.lastCursorId=t.cursorState.cursorId,t.cursorState.operationTime=o.documents[0].operationTime,Array.isArray(o.documents[0].cursor.firstBatch)&&(t.cursorState.documents=o.documents[0].cursor.firstBatch),e(null,o)}if(Array.isArray(o.documents[0].result))return t.cursorState.documents=o.documents[0].result,t.cursorState.cursorId=l.ZERO,e(null,o)}t.cursorState.cursorId=o.cursorId,t.cursorState.documents=o.documents,t.cursorState.lastCursorId=o.cursorId,t.cursorState.transforms&&"function"==typeof t.cursorState.transforms.query&&(t.cursorState.documents=t.cursorState.transforms.query(o)),e(null,o)})},p.prototype._getmore=function(e){this.logger.isDebug()&&this.logger.debug(c("schedule getMore call for query [%s]",JSON.stringify(this.query)));var t=this.options.raw||this.cmd.raw,n=this.cursorState.batchSize;this.cursorState.limit>0&&this.cursorState.currentLimit+n>this.cursorState.limit&&(n=this.cursorState.limit-this.cursorState.currentLimit);var r=this.server.s.pool;this.server.wireProtocolHandler.getMore(this.bson,this.ns,this.cursorState,n,t,r,this.options,e)},p.prototype.clone=function(){return this.topology.cursor(this.ns,this.cmd,this.options)},p.prototype.isDead=function(){return!0===this.cursorState.dead},p.prototype.isKilled=function(){return!0===this.cursorState.killed},p.prototype.isNotified=function(){return!0===this.cursorState.notified},p.prototype.bufferedCount=function(){return this.cursorState.documents.length-this.cursorState.cursorIndex},p.prototype.readBufferedDocuments=function(e){var t=this.cursorState.documents.length-this.cursorState.cursorIndex,n=e<t?e:t,r=this.cursorState.documents.slice(this.cursorState.cursorIndex,this.cursorState.cursorIndex+n);if(this.cursorState.transforms&&"function"==typeof this.cursorState.transforms.doc)for(var o=0;o<r.length;o++)r[o]=this.cursorState.transforms.doc(r[o]);return this.cursorState.limit>0&&this.cursorState.currentLimit+r.length>this.cursorState.limit&&(r=r.slice(0,this.cursorState.limit-this.cursorState.currentLimit),this.kill()),this.cursorState.currentLimit=this.cursorState.currentLimit+r.length,this.cursorState.cursorIndex=this.cursorState.cursorIndex+r.length,r},p.prototype.kill=function(e){if(this.cursorState.dead=!0,this.cursorState.killed=!0,this.cursorState.documents=[],null==this.cursorState.cursorId||this.cursorState.cursorId.isZero()||!1===this.cursorState.init)e&&e(null,null);else{var t=this.server.s.pool;this.server.wireProtocolHandler.killCursor(this.bson,this.ns,this.cursorState,t,e)}},p.prototype.rewind=function(){this.cursorState.init&&(this.cursorState.dead||this.kill(),this.cursorState.currentLimit=0,this.cursorState.init=!1,this.cursorState.dead=!1,this.cursorState.killed=!1,this.cursorState.notified=!1,this.cursorState.documents=[],this.cursorState.cursorId=null,this.cursorState.cursorIndex=0)};var h=function(e,t){if(e.pool&&e.pool.isDestroyed()){e.cursorState.killed=!0;const n=new i(c("connection to host %s:%s was destroyed",e.pool.host,e.pool.port));return y(e,()=>t(n)),!0}return!1},d=function(e,t){e.cursorState.dead=!0,m(e,t)},m=function(e,t){y(e,()=>f(t,null,null))},y=function(e,t){return e.cursorState.notified=!0,e.cursorState.documents=[],e.cursorState.cursorIndex=0,e._endSession?e._endSession(void 0,()=>t()):t()},g=function(e,t){if(e.cursorState.notified)return t(new Error("cursor is exhausted"));if(!function(e,t){return!!e.cursorState.killed&&(m(e,t),!0)}(e,t)&&!function(e,t){return!(!e.cursorState.dead||e.cursorState.killed||(e.cursorState.killed=!0,m(e,t),0))}(e,t)&&!function(e,t){return!(!e.cursorState.dead||!e.cursorState.killed||(f(t,new s("cursor is dead")),0))}(e,t)){if(!e.cursorState.init)return function(e,t){if(!e.topology.isConnected(e.options)){if("server"===e.topology._type&&!e.topology.s.options.reconnect)return t(new s("no connection available"));if(null!=e.disconnectHandler)return e.topology.isDestroyed()?t(new s("Topology was destroyed")):e.disconnectHandler.addObjectAndMethod("cursor",e,"next",[t],t)}return e.topology.selectServer(e.options,(n,r)=>{if(n)return null!=e.disconnectHandler?e.disconnectHandler.addObjectAndMethod("cursor",e,"next",[t],t):t(n);if(e.server=r,e.cursorState.init=!0,u(e.server,e.cmd))return t(new s(`server ${e.server.name} does not support collation`));try{if(e.query=e.server.wireProtocolHandler.command(e.bson,e.ns,e.cmd,e.cursorState,e.topology,e.options),e.query instanceof s)return t(e.query);g(e,t)}catch(n){return t(n)}})}(e,t);if(null==e.cursorState.cursorId){if(h(e,t))return;if(e.topology.isDestroyed())return t(new i("connection destroyed, not possible to instantiate cursor"));e._find(function(n){return n?f(t,n,null):(e.cursorState.cursorId&&e.cursorState.cursorId.isZero()&&e._endSession&&e._endSession(),0===e.cursorState.documents.length&&e.cursorState.cursorId&&e.cursorState.cursorId.isZero()&&!e.cmd.tailable&&!e.cmd.awaitData?m(e,t):void g(e,t))})}else{if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit)return e.kill(),d(e,t);if(e.cursorState.cursorIndex!==e.cursorState.documents.length||l.ZERO.equals(e.cursorState.cursorId)){if(e.cursorState.documents.length===e.cursorState.cursorIndex&&e.cmd.tailable&&l.ZERO.equals(e.cursorState.cursorId))return f(t,new s({message:"No more documents in tailed cursor",tailable:e.cmd.tailable,awaitData:e.cmd.awaitData}));if(e.cursorState.documents.length===e.cursorState.cursorIndex&&l.ZERO.equals(e.cursorState.cursorId))d(e,t);else{if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit)return e.kill(),d(e,t);e.cursorState.currentLimit+=1;var n=e.cursorState.documents[e.cursorState.cursorIndex++];if(!n||n.$err)return e.kill(),d(e,function(){f(t,new s(n?n.$err:void 0))});e.cursorState.transforms&&"function"==typeof e.cursorState.transforms.doc&&(n=e.cursorState.transforms.doc(n)),f(t,null,n)}}else{if(e.cursorState.documents=[],e.cursorState.cursorIndex=0,e.topology.isDestroyed())return t(new i("connection destroyed, not possible to instantiate cursor"));if(h(e,t))return;e._getmore(function(n,r,o){return n?(n instanceof s&&(n[a].isGetMore=!0),f(t,n)):(e.cursorState.cursorId&&e.cursorState.cursorId.isZero()&&e._endSession&&e._endSession(),e.connection=o,0===e.cursorState.documents.length&&e.cmd.tailable&&l.ZERO.equals(e.cursorState.cursorId)?f(t,new s({message:"No more documents in tailed cursor",tailable:e.cmd.tailable,awaitData:e.cmd.awaitData})):0===e.cursorState.documents.length&&e.cmd.tailable&&!l.ZERO.equals(e.cursorState.cursorId)?g(e,t):e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit?d(e,t):void g(e,t))})}}}};p.prototype.next=function(e){g(this,e)},e.exports=p},function(e,t,n){"use strict";const r=n(67),o=n(28),s=n(9).EventEmitter,i=n(0).executeOperation,a=n(0).handleCallback,c=n(1).inherits,u=n(2).MongoError,l=n(70).connectOp,p=n(70).logout,f=n(70).validOptions;function h(e,t){if(!(this instanceof h))return new h(e,t);s.call(this),this.s={url:e,options:t||{},promiseLibrary:null,dbCache:{},sessions:[]};const n=this.s.options.promiseLibrary||Promise;this.s.promiseLibrary=n}c(h,s),h.prototype.connect=function(e){const t=f(this.s.options);if("string"==typeof e)throw new TypeError("`connect` only accepts a callback");return i(this,l,[this,t,e],{skipSessions:!0})},h.prototype.logout=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=this.s.options.authSource?this.s.options.authSource:this.s.options.dbName;return i(this,p,[this,n,t],{skipSessions:!0})},h.prototype.close=function(e,t){"function"==typeof e&&(t=e,e=!1),this.topology&&this.topology.close(e),this.emit("close",this);for(const e in this.s.dbCache)this.s.dbCache[e].emit("close");return this.removeAllListeners("close"),"function"==typeof t?process.nextTick(()=>{a(t,null)}):new this.s.promiseLibrary(e=>{e()})},h.prototype.db=function(e,t){t=t||{},e||(e=this.s.options.dbName);const n=Object.assign({},this.s.options,t);if(this.s.dbCache[e]&&!0!==n.returnNonCachedInstance)return this.s.dbCache[e];if(n.promiseLibrary=this.s.promiseLibrary,!this.topology)throw new u("MongoClient must be connected before calling MongoClient.prototype.db");const r=new o(e,this.topology,n);return this.s.dbCache[e]=r,r},h.prototype.isConnected=function(e){return e=e||{},!!this.topology&&this.topology.isConnected(e)},h.connect=function(e,t,n){const r=Array.prototype.slice.call(arguments,1);return n="function"==typeof r[r.length-1]?r.pop():void 0,new h(e,(r.length?r.shift():null)||{}).connect(n)},h.prototype.startSession=function(e){if(e=Object.assign({explicit:!0},e),!this.topology)throw new u("Must connect to a server before calling this method");if(!this.topology.hasSessionSupport())throw new u("Current topology does not support sessions");return this.topology.startSession(e,this.s.options)},h.prototype.withSession=function(e,t){"function"==typeof e&&(t=e,e=void 0);const n=this.startSession(e);let r=(e,t,o)=>{if(r=(()=>{throw new ReferenceError("cleanupHandler was called too many times")}),o=Object.assign({throw:!0},o),n.endSession(),e){if(o.throw)throw e;return Promise.reject(e)}};try{const e=t(n);return Promise.resolve(e).then(e=>r(null,e)).catch(e=>r(e,null,{throw:!0}))}catch(e){return r(e,null,{throw:!1})}},h.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new r(this,e,t)},h.prototype.getLogger=function(){return this.s.options.logger},e.exports=h},function(e,t,n){"use strict";const r=n(2).BSON.Long,o=n(2).MongoError,s=n(0).toError,i=n(0).handleCallback,a=n(0).applyRetryableWrites,c=n(0).applyWriteConcern,u=n(2).BSON.ObjectID,l=n(2).BSON,p=64,f=1,h=2,d=3,m=new l([l.Binary,l.Code,l.DBRef,l.Decimal128,l.Double,l.Int32,l.Long,l.Map,l.MaxKey,l.MinKey,l.ObjectId,l.BSONRegExp,l.Symbol,l.Timestamp]);class y{constructor(e){this.result=e}get ok(){return this.result.ok}get nInserted(){return this.result.nInserted}get nUpserted(){return this.result.nUpserted}get nMatched(){return this.result.nMatched}get nModified(){return this.result.nModified}get nRemoved(){return this.result.nRemoved}getInsertedIds(){return this.result.insertedIds}getUpsertedIds(){return this.result.upserted}getUpsertedIdAt(e){return this.result.upserted[e]}getRawResponse(){return this.result}hasWriteErrors(){return this.result.writeErrors.length>0}getWriteErrorCount(){return this.result.writeErrors.length}getWriteErrorAt(e){return e<this.result.writeErrors.length?this.result.writeErrors[e]:null}getWriteErrors(){return this.result.writeErrors}getLastOp(){return this.result.lastOp}getWriteConcernError(){if(0===this.result.writeConcernErrors.length)return null;if(1===this.result.writeConcernErrors.length)return this.result.writeConcernErrors[0];{let e="";for(let t=0;t<this.result.writeConcernErrors.length;t++){e+=this.result.writeConcernErrors[t].errmsg,0===t&&(e+=" and ")}return new g({errmsg:e,code:p})}}toJSON(){return this.result}toString(){return`BulkWriteResult(${this.toJSON(this.result)})`}isOk(){return 1===this.result.ok}}class g{constructor(e){this.err=e}get code(){return this.err.code}get errmsg(){return this.err.errmsg}toJSON(){return{code:this.err.code,errmsg:this.err.errmsg}}toString(){return`WriteConcernError(${this.err.errmsg})`}}class b{constructor(e){this.err=e}get code(){return this.err.code}get index(){return this.err.index}get errmsg(){return this.err.errmsg}getOperation(){return this.err.op}toJSON(){return{code:this.err.code,index:this.err.index,errmsg:this.err.errmsg,op:this.err.op}}toString(){return`WriteError(${JSON.stringify(this.toJSON())})`}}function v(e,t,n,o,s){if(o)s=o;else if(s&&s.result)s=s.result;else if(null==s)return;if(0===s.ok&&1===n.ok){n.ok=0;const e={index:0,code:s.code||0,errmsg:s.message,op:t.operations[0]};return void n.writeErrors.push(new b(e))}if(0===s.ok&&0===n.ok)return;if(s.opTime||s.lastOp){const e=s.lastOp||s.opTime;let t=null,o=null;if(e&&"Timestamp"===e._bsontype)null==n.lastOp?n.lastOp=e:e.greaterThan(n.lastOp)&&(n.lastOp=e);else{n.lastOp&&(t="number"==typeof n.lastOp.ts?r.fromNumber(n.lastOp.ts):n.lastOp.ts,o="number"==typeof n.lastOp.t?r.fromNumber(n.lastOp.t):n.lastOp.t);const s="number"==typeof e.ts?r.fromNumber(e.ts):e.ts,i="number"==typeof e.t?r.fromNumber(e.t):e.t;null==n.lastOp?n.lastOp=e:s.greaterThan(t)?n.lastOp=e:s.equals(t)&&i.greaterThan(o)&&(n.lastOp=e)}}t.batchType===f&&s.n&&(n.nInserted=n.nInserted+s.n),t.batchType===d&&s.n&&(n.nRemoved=n.nRemoved+s.n);let i=0;if(Array.isArray(s.upserted)){i=s.upserted.length;for(let e=0;e<s.upserted.length;e++)n.upserted.push({index:s.upserted[e].index+t.originalZeroIndex,_id:s.upserted[e]._id})}else s.upserted&&(i=1,n.upserted.push({index:t.originalZeroIndex,_id:s.upserted}));if(t.batchType===h&&s.n){const e=s.nModified;n.nUpserted=n.nUpserted+i,n.nMatched=n.nMatched+(s.n-i),n.nModified="number"==typeof e?n.nModified+e:null}if(Array.isArray(s.writeErrors))for(let e=0;e<s.writeErrors.length;e++){const r={index:t.originalZeroIndex+s.writeErrors[e].index,code:s.writeErrors[e].code,errmsg:s.writeErrors[e].errmsg,op:t.operations[s.writeErrors[e].index]};n.writeErrors.push(new b(r))}s.writeConcernError&&n.writeConcernErrors.push(new g(s.writeConcernError))}class S extends o{constructor(e,t){super(e.err||e.errmsg||e.errMessage||e),Object.assign(this,e),this.name="BulkWriteError",this.result=t}}class w{constructor(e){this.s=e.s}update(e){const t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!0,upsert:t};return this.s.currentOp=null,this.s.options.addToOperationsList(this,h,n)}updateOne(e){const t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!1,upsert:t};return this.s.currentOp=null,this.s.options.addToOperationsList(this,h,n)}replaceOne(e){this.updateOne(e)}upsert(){return this.s.currentOp.upsert=!0,this}deleteOne(){const e={q:this.s.currentOp.selector,limit:1};return this.s.currentOp=null,this.s.options.addToOperationsList(this,d,e)}delete(){const e={q:this.s.currentOp.selector,limit:0};return this.s.currentOp=null,this.s.options.addToOperationsList(this,d,e)}removeOne(){return this.deleteOne()}remove(){return this.delete()}}class O{constructor(e,t,n,r){this.isOrdered=r,n=null==n?{}:n;const o=t.collectionName,s=e.bson,i=e.lastIsMaster(),u=i&&i.maxBsonObjectSize?i.maxBsonObjectSize:16777216,l=i&&i.maxWriteBatchSize?i.maxWriteBatchSize:1e3;let p=Object.assign({},n);p=a(p,t.s.db);const f=(p=c(p,{collection:t},n)).writeConcern,h=n.promiseLibrary||Promise;this.s={bulkResult:{ok:1,writeErrors:[],writeConcernErrors:[],insertedIds:[],nInserted:0,nUpserted:0,nMatched:0,nModified:0,nRemoved:0,upserted:[]},currentBatch:null,currentIndex:0,currentBatchSize:0,currentBatchSizeBytes:0,currentInsertBatch:null,currentUpdateBatch:null,currentRemoveBatch:null,batches:[],writeConcern:f,maxBatchSizeBytes:u,maxWriteBatchSize:l,namespace:o,bson:s,topology:e,options:p,currentOp:null,executed:!1,collection:t,promiseLibrary:h,err:null,checkKeys:"boolean"!=typeof n.checkKeys||n.checkKeys},!0===n.bypassDocumentValidation&&(this.s.bypassDocumentValidation=!0)}insert(e){return!0!==this.s.collection.s.db.options.forceServerObjectId&&null==e._id&&(e._id=new u),this.s.options.addToOperationsList(this,f,e)}find(e){if(!e)throw s("Bulk find operation must specify a selector");return this.s.currentOp={selector:e},new w(this)}raw(e){const t=Object.keys(e)[0],n="boolean"==typeof this.s.options.forceServerObjectId?this.s.options.forceServerObjectId:this.s.collection.s.db.options.forceServerObjectId;if(e.updateOne&&e.updateOne.q||e.updateMany&&e.updateMany.q||e.replaceOne&&e.replaceOne.q)return e[t].multi=!e.updateOne&&!e.replaceOne,this.s.options.addToOperationsList(this,h,e[t]);if(e.updateOne||e.updateMany||e.replaceOne){const n=!e.updateOne&&!e.replaceOne,r={q:e[t].filter,u:e[t].update||e[t].replacement,multi:n};return this.isOrdered?(r.upsert=!!e[t].upsert,e.collation&&(r.collation=e.collation)):e[t].upsert&&(r.upsert=!0),e[t].arrayFilters&&(r.arrayFilters=e[t].arrayFilters),this.s.options.addToOperationsList(this,h,r)}if(e.removeOne||e.removeMany||e.deleteOne&&e.deleteOne.q||e.deleteMany&&e.deleteMany.q)return e[t].limit=e.removeOne?1:0,this.s.options.addToOperationsList(this,d,e[t]);if(e.deleteOne||e.deleteMany){const n=e.deleteOne?1:0,r={q:e[t].filter,limit:n};return this.isOrdered&&e.collation&&(r.collation=e.collation),this.s.options.addToOperationsList(this,d,r)}if(e.insertOne&&null==e.insertOne.document)return!0!==n&&null==e.insertOne._id&&(e.insertOne._id=new u),this.s.options.addToOperationsList(this,f,e.insertOne);if(e.insertOne&&e.insertOne.document)return!0!==n&&null==e.insertOne.document._id&&(e.insertOne.document._id=new u),this.s.options.addToOperationsList(this,f,e.insertOne.document);if(!e.insertMany)throw s("bulkWrite only supports insertOne, insertMany, updateOne, updateMany, removeOne, removeMany, deleteOne, deleteMany");for(let t=0;t<e.insertMany.length;t++)!0!==n&&null==e.insertMany[t]._id&&(e.insertMany[t]._id=new u),this.s.options.addToOperationsList(this,f,e.insertMany[t])}bulkExecute(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},this.s.executed){const e=s("batch cannot be re-executed");return"function"==typeof n?n(e,null):this.s.promiseLibrary.reject(e)}if("function"==typeof e?n=e:e&&"object"==typeof e&&(this.s.writeConcern=e),this.isOrdered?this.s.currentBatch&&this.s.batches.push(this.s.currentBatch):(this.s.currentInsertBatch&&this.s.batches.push(this.s.currentInsertBatch),this.s.currentUpdateBatch&&this.s.batches.push(this.s.currentUpdateBatch),this.s.currentRemoveBatch&&this.s.batches.push(this.s.currentRemoveBatch)),0===this.s.batches.length){const e=s("Invalid Operation, no operations specified");return"function"==typeof n?n(e,null):this.s.promiseLibrary.reject(e)}return{options:t,callback:n}}finalOptionsHandler(e,t){const n=Object.assign({ordered:this.isOrdered},e.options);null!=this.s.writeConcern&&(n.writeConcern=this.s.writeConcern),!0!==n.bypassDocumentValidation&&delete n.bypassDocumentValidation,this.operationId&&(e.resultHandler.operationId=this.operationId),this.s.options.serializeFunctions&&(n.serializeFunctions=!0),this.s.options.ignoreUndefined&&(n.ignoreUndefined=!0),!0===this.s.bypassDocumentValidation&&(n.bypassDocumentValidation=!0),!1===this.s.checkKeys&&(n.checkKeys=!1),n.retryWrites&&(e.batch.batchType===h&&(n.retryWrites=n.retryWrites&&!e.batch.operations.some(e=>e.multi)),e.batch.batchType===d&&(n.retryWrites=n.retryWrites&&!e.batch.operations.some(e=>0===e.limit)));try{e.batch.batchType===f?this.s.topology.insert(this.s.collection.namespace,e.batch.operations,n,e.resultHandler):e.batch.batchType===h?this.s.topology.update(this.s.collection.namespace,e.batch.operations,n,e.resultHandler):e.batch.batchType===d&&this.s.topology.remove(this.s.collection.namespace,e.batch.operations,n,e.resultHandler)}catch(n){n.ok=0,i(t,null,v(0,e.batch,this.s.bulkResult,n,null))}}handleWriteError(e,t){return this.s.bulkResult.writeErrors.length>0?1===this.s.bulkResult.writeErrors.length?(i(e,new S(s(this.s.bulkResult.writeErrors[0]),t),null),!0):(i(e,new S(s({message:"write operation failed",code:this.s.bulkResult.writeErrors[0].code,writeErrors:this.s.bulkResult.writeErrors}),t),null),!0):t.getWriteConcernError()?(i(e,new S(s(t.getWriteConcernError()),t),null),!0):void 0}}Object.defineProperty(O.prototype,"length",{enumerable:!0,get:function(){return this.s.currentIndex}}),e.exports={Batch:class{constructor(e,t){this.originalZeroIndex=t,this.currentIndex=0,this.originalIndexes=[],this.batchType=e,this.operations=[],this.size=0,this.sizeBytes=0}},BulkOperationBase:O,BulkWriteError:S,BulkWriteResult:y,bson:m,FindOperators:w,handleMongoWriteConcernError:function(e,t,n,r,o){v(0,e,t,null,r.result);const a=new g({errmsg:r.result.writeConcernError.errmsg,code:r.result.writeConcernError.result});return i(o,new S(s(a),new y(t)),null)},LegacyOp:class{constructor(e,t,n){this.batchType=e,this.index=n,this.operation=t}},mergeBatchResults:v,INVALID_BSON_ERROR:22,MULTIPLE_ERROR:65,UNKNOWN_ERROR:8,WRITE_CONCERN_ERROR:p,INSERT:f,UPDATE:h,REMOVE:d,WriteError:b,WriteConcernError:g}},function(e,t,n){"use strict";const r=n(2).Server,o=n(17),s=n(29).TopologyBase,i=n(29).Store,a=n(2).MongoError,c=n(0).MAX_JS_INT,u=n(0).translateOptions,l=n(0).filterOptions,p=n(0).mergeOptions;var f=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","family","loggerLevel","logger","reconnectTries","reconnectInterval","monitoring","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","compression","promiseLibrary","monitorCommands"];class h extends s{constructor(e,t,n){super();const s=(n=l(n,f)).promiseLibrary;var h={force:!1,bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:c},d=n.store||new i(this,h);if(-1!==e.indexOf("/"))null!=t&&"object"==typeof t&&(n=t,t=null);else if(null==t)throw a.create({message:"port must be specified",driver:!0});var m="boolean"!=typeof n.auto_reconnect||n.auto_reconnect;m="boolean"==typeof n.autoReconnect?n.autoReconnect:m;var y=p({},{host:e,port:t,disconnectHandler:d,cursorFactory:o,reconnect:m,emitError:"boolean"!=typeof n.emitError||n.emitError,size:"number"==typeof n.poolSize?n.poolSize:5,monitorCommands:"boolean"==typeof n.monitorCommands&&n.monitorCommands});y=u(y,n);var g=n.socketOptions&&Object.keys(n.socketOptions).length>0?n.socketOptions:n;(y=u(y,g)).clientInfo=this.clientInfo,n.appname&&(y.clientInfo.application={name:n.appname}),this.s={coreTopology:new r(y),sCapabilities:null,clonedOptions:y,reconnect:y.reconnect,emitError:y.emitError,poolSize:y.size,storeOptions:h,store:d,host:e,port:t,options:n,sessionPool:null,sessions:[],promiseLibrary:s||Promise}}connect(e,t){var n=this;"function"==typeof e&&(t=e,e={}),null==e&&(e=this.s.clonedOptions),"function"!=typeof t&&(t=null),e=Object.assign({},this.s.clonedOptions,e),n.s.options=e,n.s.storeOptions.bufferMaxEntries="number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:-1;var r=function(){return function(e){["timeout","error","close"].forEach(function(e){n.s.coreTopology.removeListener(e,a[e])}),n.s.coreTopology.removeListener("connect",r);try{t(e)}catch(e){process.nextTick(function(){throw e})}}},o=function(e){return function(t){"error"!==e&&n.emit(e,t)}},s=function(){n.s.store.flush()},i=function(e){return function(t,r){n.emit(e,t,r)}},a={timeout:r("timeout"),error:r("error"),close:r("close")};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach(function(e){n.s.coreTopology.removeAllListeners(e)}),n.s.coreTopology.once("timeout",a.timeout),n.s.coreTopology.once("error",a.error),n.s.coreTopology.once("close",a.close),n.s.coreTopology.once("connect",function(){["timeout","error","close","destroy"].forEach(function(e){n.s.coreTopology.removeAllListeners(e)}),n.s.coreTopology.on("timeout",o("timeout")),n.s.coreTopology.once("error",o("error")),n.s.coreTopology.on("close",o("close")),n.s.coreTopology.on("destroy",s),n.emit("open",null,n);try{t(null,n)}catch(e){process.nextTick(function(){throw e})}}),n.s.coreTopology.on("reconnect",function(){n.emit("reconnect",n),n.s.store.execute()}),n.s.coreTopology.on("reconnectFailed",function(e){n.emit("reconnectFailed",e),n.s.store.flush(e)}),n.s.coreTopology.on("serverDescriptionChanged",i("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",i("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",i("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",i("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",i("serverOpening")),n.s.coreTopology.on("serverClosed",i("serverClosed")),n.s.coreTopology.on("topologyOpening",i("topologyOpening")),n.s.coreTopology.on("topologyClosed",i("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",i("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",i("commandStarted")),n.s.coreTopology.on("commandSucceeded",i("commandSucceeded")),n.s.coreTopology.on("commandFailed",i("commandFailed")),n.s.coreTopology.on("attemptReconnect",i("attemptReconnect")),n.s.coreTopology.on("monitoring",i("monitoring")),n.s.coreTopology.connect(e)}}Object.defineProperty(h.prototype,"poolSize",{enumerable:!0,get:function(){return this.s.coreTopology.connections().length}}),Object.defineProperty(h.prototype,"autoReconnect",{enumerable:!0,get:function(){return this.s.reconnect}}),Object.defineProperty(h.prototype,"host",{enumerable:!0,get:function(){return this.s.host}}),Object.defineProperty(h.prototype,"port",{enumerable:!0,get:function(){return this.s.port}}),e.exports=h},function(e,t,n){var r=n(59),o=r.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function i(e,t,n){return o(e,t,n)}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=r:(s(r,t),t.Buffer=i),s(o,i),i.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,n)},i.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=o(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";var r=n(55),o=n(11).MongoError;e.exports={getReadPreference:function(e,t){var n=e.readPreference||new r("primary");if(t.readPreference&&(n=t.readPreference),"string"==typeof n&&(n=new r(n)),!(n instanceof r))throw new o("read preference must be a ReadPreference instance");return n},MESSAGE_HEADER_SIZE:16,opcodes:{OP_REPLY:1,OP_UPDATE:2001,OP_INSERT:2002,OP_QUERY:2004,OP_GETMORE:2005,OP_DELETE:2006,OP_KILL_CURSORS:2007,OP_COMPRESSED:2012},parseHeader:function(e){return{length:e.readInt32LE(0),requestId:e.readInt32LE(4),responseTo:e.readInt32LE(8),opCode:e.readInt32LE(12)}}}},function(e,t,n){"use strict";const r=function(e,t,n){if(t&&!Array.isArray(t)&&(console.warn("ReadPreference tags must be an array, this will change in the next major version"),void 0!==t.maxStalenessSeconds?(n=t,t=void 0):t=[t]),this.mode=e,this.tags=t,null!=(n=n||{}).maxStalenessSeconds){if(n.maxStalenessSeconds<=0)throw new TypeError("maxStalenessSeconds must be a positive integer");this.maxStalenessSeconds=n.maxStalenessSeconds,this.minWireVersion=5}if(this.mode===r.PRIMARY||!0===this.mode){if(this.tags&&Array.isArray(this.tags)&&this.tags.length>0)throw new TypeError("Primary read preference cannot be combined with tags");if(this.maxStalenessSeconds)throw new TypeError("Primary read preference cannot be combined with maxStalenessSeconds")}};Object.defineProperty(r.prototype,"preference",{enumerable:!0,get:function(){return this.mode}}),r.PRIMARY="primary",r.PRIMARY_PREFERRED="primaryPreferred",r.SECONDARY="secondary",r.SECONDARY_PREFERRED="secondaryPreferred",r.NEAREST="nearest";const o=[r.PRIMARY,r.PRIMARY_PREFERRED,r.SECONDARY,r.SECONDARY_PREFERRED,r.NEAREST,!0,!1,null];r.isValid=function(e){return-1!==o.indexOf(e)},r.prototype.isValid=function(e){return r.isValid("string"==typeof e?e:this.mode)};const s=["primaryPreferred","secondary","secondaryPreferred","nearest"];r.prototype.slaveOk=function(){return-1!==s.indexOf(this.mode)},r.prototype.equals=function(e){return e.mode===this.mode},r.prototype.toJSON=function(){const e={mode:this.mode};return Array.isArray(this.tags)&&(e.tags=this.tags),this.maxStalenessSeconds&&(e.maxStalenessSeconds=this.maxStalenessSeconds),e},r.primary=new r("primary"),r.primaryPreferred=new r("primaryPreferred"),r.secondary=new r("secondary"),r.secondaryPreferred=new r("secondaryPreferred"),r.nearest=new r("nearest"),e.exports=r},function(e,t,n){"use strict";var r=n(1).format,o=n(11).MongoError,s={},i={},a=null,c=process.pid,u=null,l=function(e,t){if(!(this instanceof l))return new l(e,t);t=t||{},this.className=e,t.logger?u=t.logger:null==u&&(u=console.log),t.loggerLevel&&(a=t.loggerLevel||"error"),null==i[this.className]&&(s[this.className]=!0)};l.prototype.debug=function(e,t){if(this.isDebug()&&(Object.keys(i).length>0&&i[this.className]||0===Object.keys(i).length&&s[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","DEBUG",this.className,c,n,e),a={type:"debug",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),u(o,a)}},l.prototype.warn=function(e,t){if(this.isWarn()&&(Object.keys(i).length>0&&i[this.className]||0===Object.keys(i).length&&s[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","WARN",this.className,c,n,e),a={type:"warn",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),u(o,a)}},l.prototype.info=function(e,t){if(this.isInfo()&&(Object.keys(i).length>0&&i[this.className]||0===Object.keys(i).length&&s[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","INFO",this.className,c,n,e),a={type:"info",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),u(o,a)}},l.prototype.error=function(e,t){if(this.isError()&&(Object.keys(i).length>0&&i[this.className]||0===Object.keys(i).length&&s[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","ERROR",this.className,c,n,e),a={type:"error",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),u(o,a)}},l.prototype.isInfo=function(){return"info"===a||"debug"===a},l.prototype.isError=function(){return"error"===a||"info"===a||"debug"===a},l.prototype.isWarn=function(){return"error"===a||"warn"===a||"info"===a||"debug"===a},l.prototype.isDebug=function(){return"debug"===a},l.reset=function(){a="error",i={}},l.currentLogger=function(){return u},l.setCurrentLogger=function(e){if("function"!=typeof e)throw new o("current logger must be a function");u=e},l.filter=function(e,t){"class"===e&&Array.isArray(t)&&(i={},t.forEach(function(e){i[e]=!0}))},l.setLevel=function(e){if("info"!==e&&"error"!==e&&"debug"!==e&&"warn"!==e)throw new Error(r("%s is an illegal logging level",e));a=e},e.exports=l},function(e,t,n){"use strict";if(void 0!==global.Map)e.exports=global.Map,e.exports.Map=global.Map;else{var r=function(e){this._keys=[],this._values={};for(var t=0;t<e.length;t++)if(null!=e[t]){var n=e[t],r=n[0],o=n[1];this._keys.push(r),this._values[r]={v:o,i:this._keys.length-1}}};r.prototype.clear=function(){this._keys=[],this._values={}},r.prototype.delete=function(e){var t=this._values[e];return null!=t&&(delete this._values[e],this._keys.splice(t.i,1),!0)},r.prototype.entries=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?[n,e._values[n].v]:void 0,done:void 0===n}}}},r.prototype.forEach=function(e,t){t=t||this;for(var n=0;n<this._keys.length;n++){var r=this._keys[n];e.call(t,this._values[r].v,r,t)}},r.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},r.prototype.has=function(e){return null!=this._values[e]},r.prototype.keys=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?n:void 0,done:void 0===n}}}},r.prototype.set=function(e,t){return this._values[e]?(this._values[e].v=t,this):(this._keys.push(e),this._values[e]={v:t,i:this._keys.length-1},this)},r.prototype.values=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?e._values[n].v:void 0,done:void 0===n}}}},Object.defineProperty(r.prototype,"size",{enumerable:!0,get:function(){return this._keys.length}}),e.exports=r,e.exports.Map=r}},function(e,t){var n=function(e){if(!(this instanceof n))return new n(e);this._bsontype="Int32",this.value=e};n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},e.exports=n,e.exports.Int32=n},function(e,t){e.exports=require("buffer")},function(e,t,n){(function(e){var t=n(33),r=n(34),o=n(1).format,s=n(120),i=n(121),a=r.existsSync||t.existsSync,c=function(e){for(var n=!1;!n;)if(a(e+"/package.json"))n=e;else{if("/"===e)return!1;e=t.dirname(e)}return e},u=function(t,a){(a=a||{}).strict="boolean"!=typeof a.strict||a.strict;var u=function(t){for(var n=e,s=!1;n;){i=n.filename;var i=c(i);if(i){var a=JSON.parse(r.readFileSync(o("%s/package.json",i))),u=t.split(/\//);if(a.peerOptionalDependencies&&(!a.peerOptionalDependencies||a.peerOptionalDependencies[u[0]])){s=!0;break}n=n.parent}else n=n.parent}if(!s)throw new Error(o("no optional dependency [%s] defined in peerOptionalDependencies in any package.json",u[0]));return{object:a,parts:u}}(t),l=u.object,p=u.parts,f=l.peerOptionalDependencies[p[0]],h=void 0,d=t;try{h=n(61)(d)}catch(e){try{if(null==(d=s(process.cwd(),t)))return;h=n(61)(d)}catch(e){if("MODULE_NOT_FOUND"===e.code)return}}var m=c(n(61).resolve(d));if(!m)throw new Error("package.json can not be located");var y=JSON.parse(r.readFileSync(o("%s/package.json",m))).version;if(0==i.satisfies(y,f)&&a.strict){var g=new Error(o("optional dependency [%s] found but version [%s] did not satisfy constraint [%s]",p[0],y,f));throw g.code="OPTIONAL_MODULE_NOT_FOUND",g}return h};u.exists=function(e){try{return void 0!==u(e)}catch(e){return!1}},e.exports=u}).call(this,n(91)(e))},function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=61},function(e,t,n){"use strict";var r=n(1).inherits,o=n(1).format,s=n(9).EventEmitter,i=n(22),a=n(23),c=n(13).debugOptions,u=n(13).retrieveBSON,l=n(122),p=n(12).Query,f=n(4).MongoError,h=n(4).MongoNetworkError,d=n(131),m=n(132),y=n(49),g=n(10),b=n(10).createClientInfo,v=n(10).createCompressionInfo,S=n(10).resolveClusterTime,w=n(10).SessionMixins,O=n(16).relayEvents;const _=n(16).collationNotSupported;var T=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","singleBufferSerializtion","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","servername"],C=0,E=!1,N={},I=u(),x=function(e){e=e||{},s.call(this),this.id=C++,this.s={options:e,logger:a("Server",e),Cursor:e.cursorFactory||y,bson:e.bson||new I([I.Binary,I.Code,I.DBRef,I.Decimal128,I.Double,I.Int32,I.Long,I.Map,I.MaxKey,I.MinKey,I.ObjectId,I.BSONRegExp,I.Symbol,I.Timestamp]),pool:null,disconnectHandler:e.disconnectHandler,monitoring:"boolean"!=typeof e.monitoring||e.monitoring,inTopology:!!e.parent,monitoringInterval:"number"==typeof e.monitoringInterval?e.monitoringInterval:5e3,topologyId:-1,compression:{compressors:v(e)},parent:e.parent},this.s.parent||(this.s.clusterTime=null),this.ismaster=null,this.lastIsMasterMS=-1,this.monitoringProcessId=null,this.initialConnect=!0,this.wireProtocolHandler=new d,this._type="server",this.clientInfo=b(e),this.lastUpdateTime=0,this.lastWriteDate=0,this.staleness=0};function A(e,t,n,r,s,i){return e.s.pool.isConnected()||!e.s.options.reconnect||null==e.s.disconnectHandler||s.monitoring?e.s.pool.isConnected()?void 0:(i(new f(o("no connection available to server %s",e.name))),!0):(e.s.disconnectHandler.add(t,n,r,s,i),!0)}r(x,s),Object.assign(x.prototype,w),Object.defineProperty(x.prototype,"type",{enumerable:!0,get:function(){return this._type}}),Object.defineProperty(x.prototype,"parserType",{enumerable:!0,get:function(){return I.native?"c++":"js"}}),Object.defineProperty(x.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}}),Object.defineProperty(x.prototype,"clusterTime",{enumerable:!0,set:function(e){const t=this.s.parent?this.s.parent:this.s;S(t,e)},get:function(){return(this.s.parent?this.s.parent:this.s).clusterTime||null}}),x.enableServerAccounting=function(){E=!0,N={}},x.disableServerAccounting=function(){E=!1},x.servers=function(){return N},Object.defineProperty(x.prototype,"name",{enumerable:!0,get:function(){return this.s.options.host+":"+this.s.options.port}});var k=function(e,t){return function(n){if(e.s.logger.isInfo()){var r=n instanceof f?JSON.stringify(n):{};e.s.logger.info(o("server %s fired event %s out with message %s",e.name,t,r))}if("connect"===t){var s=e.s.compression&&e.s.compression.compressors?e.s.compression.compressors:[],i=new p(e.s.bson,"admin.$cmd",Object.assign({ismaster:!0,client:e.clientInfo,compression:s},function(e){if(!e)return{};const t=e.auth||[],n=t[0]||e.authMechanism,r=t[1]||e.authSource||e.dbName||"admin",o=t[2]||e.user;return"string"==typeof n&&"DEFAULT"!==n.toUpperCase()?{}:o?{saslSupportedMechs:`${r}.${o}`}:{}}(e.s.options)),{numberToSkip:0,numberToReturn:-1,checkKeys:!1,slaveOk:!0}),a=(new Date).getTime();e.s.pool.write(i,{socketTimeout:e.s.options.connectionTimeout||2e3},function(t,n){e.lastIsMasterMS=(new Date).getTime()-a;const r=function(e,t){return e||(t&&t.result&&0===t.result.ok?new f(t.result):void 0)}(t,n);if(r)return e.destroy(),e.emit("error",r);if(!function(e){return e&&"number"==typeof e.maxWireVersion&&e.maxWireVersion>=2}(n.result)){e.destroy();const t="2.6",r="Server at "+e.s.options.host+":"+e.s.options.port+" reports wire version "+(n.result.maxWireVersion||0)+", but this version of Node.js Driver requires at least 2 (MongoDB"+t+").";return e.emit("error",new f(r),e)}if(n.result&&n.result.compression){for(var s=0;s<e.s.compression.compressors.length;s++)if(n.result.compression.indexOf(e.s.compression.compressors[s])>-1){e.s.pool.options.agreedCompressor=e.s.compression.compressors[s];break}e.s.compression.zlibCompressionLevel&&(e.s.pool.options.zlibCompressionLevel=e.s.compression.zlibCompressionLevel)}e.initialConnect=!1,e.ismaster=n.result,"isdbgrid"===e.ismaster.msg&&(e._type="mongos"),e.wireProtocolHandler=function(e,t){return t.maxWireVersion>=4?new m:new d}(0,e.ismaster),e.s.monitoring&&(e.monitoringProcessId=setTimeout(function e(t){return function(){if(!t.s.pool.isDestroyed()){t.emit("monitoring",t);var n=new p(t.s.bson,"admin.$cmd",{ismaster:!0},{numberToSkip:0,numberToReturn:-1,checkKeys:!1,slaveOk:!0}),r=(new Date).getTime();t.s.pool.write(n,{socketTimeout:"number"!=typeof t.s.options.connectionTimeout?2e3:t.s.options.connectionTimeout,monitoring:!0},function(n,o){t.lastIsMasterMS=(new Date).getTime()-r,t.s.pool.isDestroyed()||(o&&(t.ismaster=o.result),t.monitoringProcessId=setTimeout(e(t),t.s.monitoringInterval))})}}}(e),e.s.monitoringInterval)),g.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:g.getTopologyType(e)}),e.s.inTopology||g.emitTopologyDescriptionChanged(e,{topologyType:"Single",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:g.getTopologyType(e)}]}),e.s.logger.isInfo()&&e.s.logger.info(o("server %s connected with ismaster [%s]",e.name,JSON.stringify(e.ismaster))),e.emit("connect",e)})}else{if(E&&-1!==["close","timeout","error","parseError","reconnectFailed"].indexOf(t)&&(e.s.inTopology||e.emit("topologyOpening",{topologyId:e.id}),delete N[e.id]),"close"===t&&g.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),"reconnectFailed"===t)return e.emit("reconnectFailed",n),void(e.listeners("error").length>0&&e.emit("error",n));if("disconnected"===e.s.pool.state&&e.initialConnect&&-1!==["close","timeout","error","parseError"].indexOf(t))return e.initialConnect=!1,e.emit("error",new h(o("failed to connect to server [%s] on first connect [%s]",e.name,n)));if("reconnect"===t)return g.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:g.getTopologyType(e)}),e.emit(t,e);e.emit(t,n)}}};function B(e){return e.s.pool?e.s.pool.isDestroyed()?new f("server instance pool was destroyed"):void 0:new f("server instance is not connected")}x.prototype.connect=function(e){if(e=e||{},E&&(N[this.id]=this),this.s.pool&&!this.s.pool.isDisconnected()&&!this.s.pool.isDestroyed())throw new f(o("server instance in invalid state %s",this.s.pool.state));this.s.pool=new l(this,Object.assign(this.s.options,e,{bson:this.s.bson})),this.s.pool.on("close",k(this,"close")),this.s.pool.on("error",k(this,"error")),this.s.pool.on("timeout",k(this,"timeout")),this.s.pool.on("parseError",k(this,"parseError")),this.s.pool.on("connect",k(this,"connect")),this.s.pool.on("reconnect",k(this,"reconnect")),this.s.pool.on("reconnectFailed",k(this,"reconnectFailed")),O(this.s.pool,this,["commandStarted","commandSucceeded","commandFailed"]),this.s.inTopology||this.emit("topologyOpening",{topologyId:this.id}),this.emit("serverOpening",{topologyId:-1!==this.s.topologyId?this.s.topologyId:this.id,address:this.name}),e.auth?this.s.pool.connect.apply(this.s.pool,e.auth):this.s.pool.connect()},x.prototype.getDescription=function(){var e=this.ismaster||{},t={type:g.getTopologyType(this),address:this.name};return e.hosts&&(t.hosts=e.hosts),e.arbiters&&(t.arbiters=e.arbiters),e.passives&&(t.passives=e.passives),e.setName&&(t.setName=e.setName),t},x.prototype.lastIsMaster=function(){return this.ismaster},x.prototype.unref=function(){this.s.pool.unref()},x.prototype.isConnected=function(){return!!this.s.pool&&this.s.pool.isConnected()},x.prototype.isDestroyed=function(){return!!this.s.pool&&this.s.pool.isDestroyed()},x.prototype.command=function(e,t,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var s=function(e,t){if(B(e),t.readPreference&&!(t.readPreference instanceof i))throw new Error("readPreference must be an instance of ReadPreference")}(this,n);if(s)return r(s);if(n=Object.assign({},n,{wireProtocolCommand:!1}),this.s.logger.isDebug()&&this.s.logger.debug(o("executing command [%s] against %s",JSON.stringify({ns:e,cmd:t,options:c(T,n)}),this.name)),!A(this,"command",e,t,n,r)){if(_(this,t))return r(new f(`server ${this.name} does not support collation`));var a=n.topology||{},u=this.wireProtocolHandler.command(this.s.bson,e,t,{},a,n);if(u instanceof f)return r(u,null);u.slaveOk=!!n.readPreference&&n.readPreference.slaveOk();var l={raw:"boolean"==typeof n.raw&&n.raw,promoteLongs:"boolean"!=typeof n.promoteLongs||n.promoteLongs,promoteValues:"boolean"!=typeof n.promoteValues||n.promoteValues,promoteBuffers:"boolean"==typeof n.promoteBuffers&&n.promoteBuffers,command:!0,monitoring:"boolean"==typeof n.monitoring&&n.monitoring,fullResult:"boolean"==typeof n.fullResult&&n.fullResult,requestId:u.requestId,socketTimeout:"number"==typeof n.socketTimeout?n.socketTimeout:null,session:n.session||null};this.s.pool.write(u,l,r)}},x.prototype.insert=function(e,t,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var o=B(this);return o?r(o):A(this,"insert",e,t,n,r)?void 0:(t=Array.isArray(t)?t:[t],this.wireProtocolHandler.insert(this.s.pool,e,this.s.bson,t,n,r))},x.prototype.update=function(e,t,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var o=B(this);return o?r(o):A(this,"update",e,t,n,r)?void 0:_(this,n)?r(new f(`server ${this.name} does not support collation`)):(t=Array.isArray(t)?t:[t],this.wireProtocolHandler.update(this.s.pool,e,this.s.bson,t,n,r))},x.prototype.remove=function(e,t,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var o=B(this);return o?r(o):A(this,"remove",e,t,n,r)?void 0:_(this,n)?r(new f(`server ${this.name} does not support collation`)):(t=Array.isArray(t)?t:[t],this.wireProtocolHandler.remove(this.s.pool,e,this.s.bson,t,n,r))},x.prototype.cursor=function(e,t,n){const r=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(this.s.bson,e,t,n,r,this.s.options)},x.prototype.logout=function(e,t){this.s.pool.logout(e,t)},x.prototype.auth=function(e,t){"default"===e&&(e=function(e){if(e){if(Array.isArray(e.saslSupportedMechs))return e.saslSupportedMechs.indexOf("SCRAM-SHA-256")>=0?"scram-sha-256":"scram-sha-1";if(e.maxWireVersion>=3)return"scram-sha-1"}return"mongocr"}(this.ismaster));var n=Array.prototype.slice.call(arguments,0);n[0]=e;var r=n[n.length-1];if(!A(this,"auth",t,n,{},r))return this.lastIsMaster()&&this.lastIsMaster().arbiterOnly?r(null,!0):void this.s.pool.auth.apply(this.s.pool,n)},x.prototype.equals=function(e){return"string"==typeof e?this.name.toLowerCase()===e.toLowerCase():!!e.name&&this.name.toLowerCase()===e.name.toLowerCase()},x.prototype.connections=function(){return this.s.pool.allConnections()},x.prototype.selectServer=function(e,t,n){"function"==typeof e&&void 0===n&&(n=e,e=void 0,t={}),"function"==typeof t&&(n=t,t=e,e=void 0),n(null,this)};var M=["close","error","timeout","parseError","connect"];x.prototype.destroy=function(e){if(!this._destroyed){e=e||{};var t=this;E&&delete N[this.id],this.monitoringProcessId&&clearTimeout(this.monitoringProcessId),t.s.pool?(e.emitClose&&t.emit("close",t),e.emitDestroy&&t.emit("destroy",t),M.forEach(function(e){t.s.pool.removeAllListeners(e)}),t.listeners("serverClosed").length>0&&t.emit("serverClosed",{topologyId:-1!==t.s.topologyId?t.s.topologyId:t.id,address:t.name}),t.listeners("topologyClosed").length>0&&!t.s.inTopology&&t.emit("topologyClosed",{topologyId:t.id}),t.s.logger.isDebug()&&t.s.logger.debug(o("destroy called on server %s",t.name)),this.s.pool.destroy(e.force),this._destroyed=!0):this._destroyed=!0}},e.exports=x},function(e,t){e.exports=require("os")},function(e,t,n){"use strict";const r=n(4).MongoError;let o,s;o={NO_TRANSACTION:"NO_TRANSACTION",STARTING_TRANSACTION:"STARTING_TRANSACTION",TRANSACTION_IN_PROGRESS:"TRANSACTION_IN_PROGRESS",TRANSACTION_COMMITTED:"TRANSACTION_COMMITTED",TRANSACTION_COMMITTED_EMPTY:"TRANSACTION_COMMITTED_EMPTY",TRANSACTION_ABORTED:"TRANSACTION_ABORTED"},s={NO_TRANSACTION:["NO_TRANSACTION","STARTING_TRANSACTION"],STARTING_TRANSACTION:["TRANSACTION_IN_PROGRESS","TRANSACTION_COMMITTED","TRANSACTION_COMMITTED_EMPTY","TRANSACTION_ABORTED"],TRANSACTION_IN_PROGRESS:["TRANSACTION_IN_PROGRESS","TRANSACTION_COMMITTED","TRANSACTION_ABORTED"],TRANSACTION_COMMITTED:["TRANSACTION_COMMITTED","TRANSACTION_COMMITTED_EMPTY","STARTING_TRANSACTION","NO_TRANSACTION"],TRANSACTION_ABORTED:["STARTING_TRANSACTION","NO_TRANSACTION"],TRANSACTION_COMMITTED_EMPTY:["TRANSACTION_COMMITTED_EMPTY","NO_TRANSACTION"]};e.exports={TxnState:o,Transaction:class{constructor(e){if(e=e||{},this.state=o.NO_TRANSACTION,this.options={},e.writeConcern||void 0!==e.w){if((e.writeConcern?e.writeConcern.w:e.w)<=0)throw new r("Transactions do not support unacknowledged write concern");this.options.writeConcern=e.writeConcern?e.writeConcern:{w:e.w}}e.readConcern&&(this.options.readConcern=e.readConcern),e.readPreference&&(this.options.readPreference=e.readPreference)}get isActive(){return-1!==[o.STARTING_TRANSACTION,o.TRANSACTION_IN_PROGRESS].indexOf(this.state)}transition(e){const t=s[this.state];if(!t||-1===t.indexOf(e))throw new r(`Attempted illegal state transition from [${this.state}] to [${e}]`);this.state=e}}}},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("dns")},function(e,t,n){"use strict";const r=n(9),o=n(139).isResumableError,s=n(2).MongoError;var i=["maxAwaitTimeMS","collation","readPreference"];const a={COLLECTION:Symbol("Collection"),DATABASE:Symbol("Database"),CLUSTER:Symbol("Cluster")};var c=function(e){e.resumeToken&&(e.options.resumeAfter=e.resumeToken);var t=p(e);if(e.listenerCount("change")>0&&t.on("data",function(t){d({changeStream:e,change:t,eventEmitter:!0})}),t.on("close",function(){e.emit("close")}),t.on("end",function(){e.emit("end")}),t.on("error",function(t){d({changeStream:e,error:t,eventEmitter:!0})}),e.pipeDestinations){const n=t.stream(e.streamOptions);for(let t in e.pipeDestinations)n.pipe(t)}return t};function u(e){return e.resumeToken||e.options.resumeAfter}function l(e){const t=e.topology.lastIsMaster()||{};return t.maxWireVersion&&t.maxWireVersion>=7&&e.options.startAtOperationTime}var p=function(e){const t=e.topology,n=e.namespace,r=e.pipeline,o=e.options,s=e.cursorNamespace;var c={fullDocument:o.fullDocument||"default"};const p=u(e),f=l(e);p&&(c.resumeAfter=p),f&&(c.startAtOperationTime=f);var h={};i.forEach(function(e){o[e]&&(h[e]=o[e])}),e.type===a.CLUSTER&&(c.allChangesForCluster=!0);var d=[{$changeStream:c}];d=d.concat(r);var m={aggregate:e.type===a.COLLECTION?n.collection:1,pipeline:d,readConcern:{level:"majority"},cursor:{batchSize:o.batchSize||1}};return t.cursor(s,m,h)};const f=3e4;function h(e,t,n){setTimeout(()=>{t&&null==t.start&&(t.start=process.hrtime());const r=t.start||process.hrtime(),o=t.timeout||f,i=t.readPreference;if(e.isConnected({readPreference:i}))return n(null,null);const a=process.hrtime(r);if((1e9*a[0]+a[1])/1e6>o)return n(new s("Timed out waiting for connection"));h(e,t,n)},3e3)}function d(e){const t=e.changeStream,n=e.error,r=e.change,s=e.callback,i=e.eventEmitter||!1,a=t.topology,p=t.cursor.options;if(n){if(o(n)&&!t.attemptingResume){if(t.attemptingResume=!0,!u(t)&&!l(t)){const e=t.cursor.cursorState.operationTime;t.options=Object.assign({startAtOperationTime:e},t.options)}return["data","close","end","error"].forEach(e=>t.cursor.removeAllListeners(e)),t.cursor.close(),i?void h(a,{readPreference:p.readPreference},e=>{if(e)return t.emit("error",e);t.cursor=c(t)}):s?void h(a,{readPreference:p.readPreference},e=>{if(e)return s(e,null);t.cursor=c(t),t.next(s)}):new Promise((e,t)=>{h(a,{readPreference:p.readPreference},n=>{if(n)return t(n);e()})}).then(()=>t.cursor=c(t)).then(()=>t.next())}return i?t.emit("error",n):"function"==typeof s?s(n,null):t.promiseLibrary.reject(n)}if(t.attemptingResume=!1,!r||!r._id){var f=new Error("A change stream document has been received that lacks a resume token (_id).");return i?t.emit("error",f):"function"==typeof s?s(f,null):t.promiseLibrary.reject(f)}return t.resumeToken=r._id,i?t.emit("change",r):"function"==typeof s?s(n,r):t.promiseLibrary.resolve(r)}e.exports=class extends r{constructor(e,t,r){super();const o=n(27),i=n(28),u=n(50);if(this.pipeline=t||[],this.options=r||{},this.cursorNamespace=void 0,this.namespace={},e instanceof o)this.type=a.COLLECTION,this.topology=e.s.db.serverConfig,this.namespace={collection:e.collectionName,database:e.s.db.databaseName},this.cursorNamespace=`${this.namespace.database}.${this.namespace.collection}`;else if(e instanceof i)this.type=a.DATABASE,this.namespace={collection:"",database:e.databaseName},this.cursorNamespace=this.namespace.database,this.topology=e.serverConfig;else{if(!(e instanceof u))throw new TypeError("changeDomain provided to ChangeStream constructor is not an instance of Collection, Db, or MongoClient");this.type=a.CLUSTER,this.namespace={collection:"",database:"admin"},this.cursorNamespace=this.namespace.database,this.topology=e.topology}this.promiseLibrary=e.s.promiseLibrary,!this.options.readPreference&&e.s.readPreference&&(this.options.readPreference=e.s.readPreference);const l=this.topology.lastIsMaster();if(!l)throw new s("Topology does not have an ismaster yet.");this.operationTime=l.operationTime,this.cursor=c(this),this.on("newListener",e=>{"change"===e&&this.cursor&&0===this.listenerCount("change")&&this.cursor.on("data",e=>d({changeStream:this,change:e,eventEmitter:!0}))}),this.on("removeListener",e=>{"change"===e&&0===this.listenerCount("change")&&this.cursor&&this.cursor.removeAllListeners("data")})}hasNext(e){return this.cursor.hasNext(e)}next(e){var t=this;return this.isClosed()?e?e(new Error("Change Stream is not open."),null):t.promiseLibrary.reject(new Error("Change Stream is not open.")):this.cursor.next().then(n=>d({changeStream:t,change:n,callback:e})).catch(n=>d({changeStream:t,error:n,callback:e}))}isClosed(){return!this.cursor||this.cursor.isClosed()}close(e){if(!this.cursor)return e?e():this.promiseLibrary.resolve();var t=this.cursor;return delete this.cursor,t.close(e)}pipe(e,t){return this.pipeDestinations||(this.pipeDestinations=[]),this.pipeDestinations.push(e),this.cursor.pipe(e,t)}unpipe(e){return this.pipeDestinations&&this.pipeDestinations.indexOf(e)>-1&&this.pipeDestinations.splice(this.pipeDestinations.indexOf(e),1),this.cursor.unpipe(e)}stream(e){return this.streamOptions=e,this.cursor.stream(e)}pause(){return this.cursor.pause()}resume(){return this.cursor.resume()}}},function(e,t,n){"use strict";const r=n(1).inherits,o=n(2).ReadPreference,s=n(2).MongoError,i=n(15).Readable,a=n(17);var c=function(e,t,n,r,o,s){a.apply(this,Array.prototype.slice.call(arguments,0));var u=c.INIT,l=r.promiseLibrary||Promise;i.call(this,{objectMode:!0}),this.s={maxTimeMS:null,state:u,streamOptions:{},bson:e,ns:t,cmd:n,options:r,topology:o,topologyOptions:s,promiseLibrary:l,session:r.session}};r(c,i);for(var u=["_next","next","hasNext","each","forEach","toArray","rewind","bufferedCount","readBufferedDocuments","close","isClosed","kill","setCursorBatchSize","_find","_getmore","_killcursor","isDead","explain","isNotified","isKilled","_endSession","_initImplicitSession"],l=0;l<u.length;l++)c.prototype[u[l]]=a.prototype[u[l]];c.prototype.setReadPreference=function(e){if(this.s.state===c.CLOSED||this.isDead())throw s.create({message:"Cursor is closed",driver:!0});if(this.s.state!==c.INIT)throw s.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(e instanceof o)this.s.options.readPreference=e;else{if("string"!=typeof e)throw new TypeError("Invalid read preference: "+e);this.s.options.readPreference=new o(e)}return this},c.prototype.batchSize=function(e){if(this.s.state===c.CLOSED||this.isDead())throw s.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw s.create({message:"batchSize requires an integer",driver:!0});return this.s.cmd.cursor&&(this.s.cmd.cursor.batchSize=e),this.setCursorBatchSize(e),this},c.prototype.maxTimeMS=function(e){return this.s.topology.lastIsMaster().minWireVersion>2&&(this.s.cmd.maxTimeMS=e),this},c.prototype.getLogger=function(){return this.logger},c.prototype.get=c.prototype.toArray,c.INIT=0,c.OPEN=1,c.CLOSED=2,e.exports=c},function(e,t,n){"use strict";const r=n(7).executeCommand,o=n(7).executeDbAdminCommand;e.exports={replSetGetStatus:function(e,t,n){o(e.s.db,{replSetGetStatus:1},t,n)},serverStatus:function(e,t,n){o(e.s.db,{serverStatus:1},t,n)},validateCollection:function(e,t,n,o){const s={validate:t},i=Object.keys(n);for(let e=0;e<i.length;e++)n.hasOwnProperty(i[e])&&"session"!==i[e]&&(s[i[e]]=n[i[e]]);r(e.s.db,s,n,(e,n)=>null!=e?o(e,null):0===n.ok?o(new Error("Error with validate command"),null):null!=n.result&&n.result.constructor!==String?o(new Error("Error with validation data"),null):null!=n.result&&null!=n.result.match(/exception|corrupt/)?o(new Error("Error: invalid collection "+t),null):null==n.valid||n.valid?o(null,n):o(new Error("Error: invalid collection "+t),null))}}},function(e,t,n){"use strict";const r=n(142),o=n(1).deprecate,s=n(2).Logger,i=n(2).MongoError,a=n(85),c=n(2).parseConnectionString,u=n(2).ReadPreference,l=n(86),p=n(52),f=n(2).Sessions.ServerSessionPool,h=["timeout","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha","all","fullsetup","open"],d=["native_parser"],m=["server","replset","replSet","mongos","db"],y=o(n(144),"current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option { useNewUrlParser: true } to MongoClient.connect."),g=["poolSize","ssl","sslValidate","sslCA","sslCert","sslKey","sslPass","sslCRL","autoReconnect","noDelay","keepAlive","keepAliveInitialDelay","connectTimeoutMS","family","socketTimeoutMS","reconnectTries","reconnectInterval","ha","haInterval","replicaSet","secondaryAcceptableLatencyMS","acceptableLatencyMS","connectWithNoPrimary","authSource","w","wtimeout","j","forceServerObjectId","serializeFunctions","ignoreUndefined","raw","bufferMaxEntries","readPreference","pkFactory","promiseLibrary","readConcern","maxStalenessSeconds","loggerLevel","logger","promoteValues","promoteBuffers","promoteLongs","domainsEnabled","checkServerIdentity","validateOptions","appname","auth","user","password","authMechanism","compression","fsync","readPreferenceTags","numberOfRetries","auto_reconnect","minSize","monitorCommands","retryWrites","useNewUrlParser"];function b(e,t){t.on("authenticated",O(e,"authenticated")),t.on("error",O(e,"error")),t.on("timeout",O(e,"timeout")),t.on("close",O(e,"close")),t.on("parseError",O(e,"parseError")),t.once("open",O(e,"open")),t.once("fullsetup",O(e,"fullsetup")),t.once("all",O(e,"all")),t.on("reconnect",O(e,"reconnect"))}function v(e,t){e.topology=t,t.s.sessionPool=new f(t.s.coreTopology)}function S(e,t,o,f){if(o=Object.assign({},o),null==f)throw new Error("no callback function provided");const d=s("MongoClient",o);if(t instanceof p||t instanceof l||t instanceof a)return function(e,t,n,o){v(e,t),b(e,t),I(e,t);let s=Object.assign({},n);"string"!=typeof n.readPreference&&"string"!=typeof n.read_preference||(s.readPreference=new u(n.readPreference||n.read_preference));return t.connect(s,w(e,s,(t,n)=>t?o(t,n):s.user||s.password||s.authMechanism?r(e,s.user,s.password,s,e=>{if(e)return o(e,n);o(e,n)}):void o(t,n)))}(e,t,o,S);const m=o.useNewUrlParser?c:y,g=o.useNewUrlParser?A:E;function S(e,t){const n="seed list contains no mongos proxies, replicaset connections requires the parameter replicaSet to be supplied in the URI or options object, mongodb://server:port/db?replicaSet=name";if(e&&"no mongos proxies found in seed list"===e.message)return d.isWarn()&&d.warn(n),f(new i(n));f(e,t)}m(t,o,(t,r)=>{if(t)return f(t);const s=g(r),i=T(s,o);return null==i.socketTimeoutMS&&(i.socketTimeoutMS=36e4),null==i.connectTimeoutMS&&(i.connectTimeoutMS=3e4),i.db_options&&i.db_options.auth&&delete i.db_options.auth,e.s.options=i,0===s.servers.length?f(new Error("connection string must contain at least one seed host")):i.replicaSet||i.rs_name?_(e,"replicaset",i,w(e,i,S)):s.servers.length>1?_(e,"mongos",i,w(e,i,S)):function(e,t,r){t.promiseLibrary=e.s.promiseLibrary;const o=k(t)[0],s=function(e,t){const r=n(50),o=[];return e instanceof r&&h.forEach(n=>{t.on(n,(t,r)=>{"open"===n?o.push({event:n,object1:e}):o.push({event:n,object1:t,object2:r})})}),o}(e,o);o.connect(t,(n,i)=>{if(n)return o.close(!0),r(n);!function(e){h.forEach(t=>e.removeAllListeners(t))}(o),I(e,o),b(e,o);const a=i.lastIsMaster();if(v(e,i),a&&"isdbgrid"===a.msg)return i.close(),_(e,"mongos",t,r);!function(e,t){for(let n=0;n<t.length;n++)e.emit(t[n].event,t[n].object1,t[n].object2)}(e,s),r(n,i)})}(e,i,w(e,i,S))})}function w(e,t,n){return(o,s)=>o?C(o,s,n):t.auth?void r(e,t.user,t.password,t,(e,r)=>{if(r)C(null,s,n);else{s&&s.close(),C(e||new Error("Could not authenticate user "+t.auth[0]),s,n)}}):C(o,s,n)}function O(e,t){const n=new Set(["all","fullsetup","open","reconnect"]);return(r,o)=>{if(n.has(t))return e.emit(t,e);e.emit(t,r,o)}}function _(e,t,n,r){n.promiseLibrary=e.s.promiseLibrary;const o={};"unified"===t&&(o.createServers=!1);const s=k(n,o);let i;"mongos"===t?i=new a(s,n):"replicaset"===t&&(i=new l(s,n)),b(e,i),I(e,i),i.connect(n,(t,n)=>{if(t)return i.close(!0),r(t);v(e,n),r(null,n)})}function T(e,t){const n=["mongos","server","db","replset","db_options","server_options","rs_options","mongos_options"],r=["readconcern","compression"];for(const o in t)-1!==r.indexOf(o.toLowerCase())?e[o]=t[o]:-1!==n.indexOf(o.toLowerCase())?e=N(e,t[o],!1):!t[o]||"object"!=typeof t[o]||Buffer.isBuffer(t[o])||Array.isArray(t[o])?e[o]=t[o]:e=N(e,t[o],!0);return e}function C(e,t,n){return process.nextTick(()=>{try{n(e,t)}catch(e){throw t&&t.close(),e}})}function E(e){return N(T({},e),e,!1)}function N(e,t,n){for(const r in t)t[r]&&"object"==typeof t[r]&&n?e=N(e,t[r],n):e[r]=t[r];return e}function I(e,t){["serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha"].forEach(n=>{t.on(n,(t,r)=>{e.emit(n,t,r)})})}const x=g.reduce((e,t)=>(e[t.toLowerCase()]=t,e),{});function A(e){let t=Object.assign({servers:e.hosts},e.options);for(let e in t){const n=x[e];n&&(t[n]=t[e])}if(e.auth){const n=e.auth;for(let e in n)n[e]&&(t[e]=n[e]);n.username&&(t.auth=n,t.user=n.username),n.db&&(t.authSource=t.authSource||n.db)}return e.defaultDatabase&&(t.dbName=e.defaultDatabase),t.maxpoolsize&&(t.poolSize=t.maxpoolsize),t.readconcernlevel&&(t.readConcern={level:t.readconcernlevel}),t.wtimeoutms&&(t.wtimeout=t.wtimeoutms),t}function k(e,t){if(t=Object.assign({},{createServers:!0},t),"string"!=typeof e.readPreference&&"string"!=typeof e.read_preference||(e.readPreference=new u(e.readPreference||e.read_preference)),e.readPreference&&(e.readPreferenceTags||e.read_preference_tags)&&(e.readPreference.tags=e.readPreferenceTags||e.read_preference_tags),e.maxStalenessSeconds&&(e.readPreference.maxStalenessSeconds=e.maxStalenessSeconds),null==e.socketTimeoutMS&&(e.socketTimeoutMS=36e4),null==e.connectTimeoutMS&&(e.connectTimeoutMS=3e4),t.createServers)return e.servers.map(t=>t.domain_socket?new p(t.domain_socket,27017,e):new p(t.host,t.port,e))}e.exports={connectOp:function(e,t,n){if(t)return n(t);S(e,e.s.url,e.s.options,t=>{if(t)return n(t);n(null,e)})},logout:function(e,t,n){e.topology.logout(t,e=>{if(e)return n(e);n(null,!0)})},validOptions:function(e){const t=g.concat(m);for(const n in e)if(-1===d.indexOf(n)){if(-1===t.indexOf(n)&&e.validateOptions)return new i(`option ${n} is not supported`);-1===t.indexOf(n)&&console.warn(`the options [${n}] is not supported`),-1!==m.indexOf(n)&&console.warn("the server/replset/mongos/db options are deprecated, "+`all their options are supported at the top level of the options object [${g}]`)}}}},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this._bsontype="Long",this.low_=0|e,this.high_=0|t}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var r=n.fromNumber(t),o=this.div(r),s=o.multiply(r).subtract(this);return o.toString(t)+s.toInt().toString(t)}return"-"+this.negate().toString(t)}var i=n.fromNumber(Math.pow(t,6));s=this;for(var a="";!s.isZero();){var c=s.div(i),u=s.subtract(c.multiply(i)).toInt().toString(t);if((s=c).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!==this.high_?this.high_:this.low_,t=31;t>0&&0==(e&1<<t);t--);return 0!==this.high_?t+33:t+1},n.prototype.isZero=function(){return 0===this.high_&&0===this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_},n.prototype.notEquals=function(e){return this.high_!==e.high_||this.low_!==e.low_},n.prototype.lessThan=function(e){return this.compare(e)<0},n.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},n.prototype.greaterThan=function(e){return this.compare(e)>0},n.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},n.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(e){var t=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,s=65535&this.low_,i=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,u=0,l=0,p=0,f=0;return p+=(f+=s+(65535&e.low_))>>>16,f&=65535,l+=(p+=o+c)>>>16,p&=65535,u+=(l+=r+a)>>>16,l&=65535,u+=t+i,u&=65535,n.fromBits(p<<16|f,u<<16|l)},n.prototype.subtract=function(e){return this.add(e.negate())},n.prototype.multiply=function(e){if(this.isZero())return n.ZERO;if(e.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return e.isOdd()?n.MIN_VALUE:n.ZERO;if(e.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&e.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,s=65535&this.low_,i=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,u=65535&e.low_,l=0,p=0,f=0,h=0;return f+=(h+=s*u)>>>16,h&=65535,p+=(f+=o*u)>>>16,f&=65535,p+=(f+=s*c)>>>16,f&=65535,l+=(p+=r*u)>>>16,p&=65535,l+=(p+=o*c)>>>16,p&=65535,l+=(p+=s*a)>>>16,p&=65535,l+=t*u+r*c+o*a+s*i,l&=65535,n.fromBits(f<<16|h,l<<16|p)},n.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(e.equals(n.ONE)||e.equals(n.NEG_ONE))return n.MIN_VALUE;if(e.equals(n.MIN_VALUE))return n.ONE;var t=this.shiftRight(1).div(e).shiftLeft(1);if(t.equals(n.ZERO))return e.isNegative()?n.ONE:n.NEG_ONE;var r=this.subtract(e.multiply(t));return t.add(r.div(e))}if(e.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var o=n.ZERO;for(r=this;r.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(t)/Math.LN2),i=s<=48?1:Math.pow(2,s-48),a=n.fromNumber(t),c=a.multiply(e);c.isNegative()||c.greaterThan(r);)t-=i,c=(a=n.fromNumber(t)).multiply(e);a.isZero()&&(a=n.ONE),o=o.add(a),r=r.subtract(c)}return o},n.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(e){return n.fromBits(this.low_&e.low_,this.high_&e.high_)},n.prototype.or=function(e){return n.fromBits(this.low_|e.low_,this.high_|e.high_)},n.prototype.xor=function(e){return n.fromBits(this.low_^e.low_,this.high_^e.high_)},n.prototype.shiftLeft=function(e){if(0===(e&=63))return this;var t=this.low_;if(e<32){var r=this.high_;return n.fromBits(t<<e,r<<e|t>>>32-e)}return n.fromBits(0,t<<e-32)},n.prototype.shiftRight=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var r=this.low_;return n.fromBits(r>>>e|t<<32-e,t>>e)}return n.fromBits(t>>e-32,t>=0?0:-1)},n.prototype.shiftRightUnsigned=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var r=this.low_;return n.fromBits(r>>>e|t<<32-e,t>>>e)}return 32===e?n.fromBits(t,0):n.fromBits(t>>>e-32,0)},n.fromInt=function(e){if(-128<=e&&e<128){var t=n.INT_CACHE_[e];if(t)return t}var r=new n(0|e,e<0?-1:0);return-128<=e&&e<128&&(n.INT_CACHE_[e]=r),r},n.fromNumber=function(e){return isNaN(e)||!isFinite(e)?n.ZERO:e<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:e+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:e<0?n.fromNumber(-e).negate():new n(e%n.TWO_PWR_32_DBL_|0,e/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(e,t){return new n(e,t)},n.fromString=function(e,t){if(0===e.length)throw Error("number format error: empty string");var r=t||10;if(r<2||36<r)throw Error("radix out of range: "+r);if("-"===e.charAt(0))return n.fromString(e.substring(1),r).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var o=n.fromNumber(Math.pow(r,8)),s=n.ZERO,i=0;i<e.length;i+=8){var a=Math.min(8,e.length-i),c=parseInt(e.substring(i,i+a),r);if(a<8){var u=n.fromNumber(Math.pow(r,a));s=s.multiply(u).add(n.fromNumber(c))}else s=(s=s.multiply(o)).add(n.fromNumber(c))}return s},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),e.exports=n,e.exports.Long=n},function(e,t,n){"use strict";const r=n(1).deprecate,o=n(5).deprecateOptions,s=n(5).checkCollectionName,i=n(6).BSON.ObjectID,a=n(166),c=n(6).MongoError,u=n(5).toError,l=n(5).normalizeHintField,p=n(5).handleCallback,f=n(5).decorateCommand,h=n(5).decorateWithCollation,d=n(5).decorateWithReadConcern,m=n(5).formattedOrderClause,y=n(6).ReadPreference,g=n(156),b=n(202),v=n(203),S=n(155),w=n(5).executeOperation,O=n(5).applyWriteConcern,_=n(5).resolveReadPreference,T=n(8).bulkWrite,C=n(8).checkForAtomicOperators,E=n(8).count,N=n(8).countDocuments,I=n(8).createIndex,x=n(8).createIndexes,A=n(8).deleteMany,k=n(8).deleteOne,B=n(8).distinct,M=n(8).dropIndex,D=n(8).dropIndexes,R=n(8).ensureIndex,P=n(8).findAndModify,L=n(8).findAndRemove,j=n(8).findOne,U=n(8).findOneAndDelete,z=n(8).findOneAndReplace,q=n(8).findOneAndUpdate,$=n(8).geoHaystackSearch,F=n(8).group,W=n(8).indexes,H=n(8).indexExists,V=n(8).indexInformation,Y=n(8).insertOne,K=n(8).isCapped,G=n(8).mapReduce,J=n(8).optionsOp,Z=n(8).parallelCollectionScan,X=n(8).prepareDocs,Q=n(8).reIndex,ee=n(8).removeDocuments,te=n(8).rename,ne=n(8).replaceOne,re=n(8).save,oe=n(8).stats,se=n(8).updateDocuments,ie=n(8).updateMany,ae=n(8).updateOne,ce=["ignoreUndefined"];function ue(e,t,n,r,o,a){s(r);const c=null==a||null==a.slaveOk?e.slaveOk:a.slaveOk,u=null==a||null==a.serializeFunctions?e.s.options.serializeFunctions:a.serializeFunctions,l=null==a||null==a.raw?e.s.options.raw:a.raw,p=null==a||null==a.promoteLongs?e.s.options.promoteLongs:a.promoteLongs,f=null==a||null==a.promoteValues?e.s.options.promoteValues:a.promoteValues,h=null==a||null==a.promoteBuffers?e.s.options.promoteBuffers:a.promoteBuffers;let d=null;const m=`${n}.${r}`,y=a.promiseLibrary||Promise;a&&a.readPreference?d=a.readPreference:e.options.readPreference&&(d=e.options.readPreference),o=null==o?i:o,this.s={pkFactory:o,db:e,topology:t,dbName:n,options:a,namespace:m,readPreference:d,slaveOk:c,serializeFunctions:u,raw:l,promoteLongs:p,promoteValues:f,promoteBuffers:h,internalHint:null,collectionHint:null,name:r,promiseLibrary:y,readConcern:a.readConcern,writeConcern:a.writeConcern}}Object.defineProperty(ue.prototype,"dbName",{enumerable:!0,get:function(){return this.s.dbName}}),Object.defineProperty(ue.prototype,"collectionName",{enumerable:!0,get:function(){return this.s.name}}),Object.defineProperty(ue.prototype,"namespace",{enumerable:!0,get:function(){return this.s.namespace}}),Object.defineProperty(ue.prototype,"readConcern",{enumerable:!0,get:function(){return this.s.readConcern||{level:"local"}}}),Object.defineProperty(ue.prototype,"writeConcern",{enumerable:!0,get:function(){let e={};return this.s.writeConcern?this.s.writeConcern:(null!=this.s.options.w&&(e.w=this.s.options.w),null!=this.s.options.j&&(e.j=this.s.options.j),null!=this.s.options.fsync&&(e.fsync=this.s.options.fsync),null!=this.s.options.wtimeout&&(e.wtimeout=this.s.options.wtimeout),e)}}),Object.defineProperty(ue.prototype,"hint",{enumerable:!0,get:function(){return this.s.collectionHint},set:function(e){this.s.collectionHint=l(e)}});const le=["maxScan","fields","snapshot"];ue.prototype.find=o({name:"collection.find",deprecatedOptions:le,optionsIndex:1},function(e,t,n){"object"==typeof n&&console.warn("Third parameter to `find()` must be a callback or undefined");let r=e;"function"!=typeof n&&("function"==typeof t?(n=t,t=void 0):null==t&&(n="function"==typeof r?r:void 0,r="object"==typeof r?r:void 0));const o=r=null==r?{}:r;if(Buffer.isBuffer(o)){const e=o[0]|o[1]<<8|o[2]<<16|o[3]<<24;if(e!==o.length){const t=new Error("query selector raw message size does not match message header size ["+o.length+"] != ["+e+"]");throw t.name="MongoError",t}}null!=r&&"ObjectID"===r._bsontype&&(r={_id:r}),t||(t={});let s=t.projection||t.fields;s&&!Buffer.isBuffer(s)&&Array.isArray(s)&&(s=s.length?s.reduce((e,t)=>(e[t]=1,e),{}):{_id:1});let i=Object.assign({},t);for(let e in this.s.options)-1!==ce.indexOf(e)&&(i[e]=this.s.options[e]);if(i.skip=t.skip?t.skip:0,i.limit=t.limit?t.limit:0,i.raw="boolean"==typeof t.raw?t.raw:this.s.raw,i.hint=null!=t.hint?l(t.hint):this.s.collectionHint,i.timeout=void 0===t.timeout?void 0:t.timeout,i.slaveOk=null!=t.slaveOk?t.slaveOk:this.s.db.slaveOk,i.readPreference=_(i,{db:this.s.db,collection:this}),null==i.readPreference||"primary"===i.readPreference&&"primary"===i.readPreference.mode||(i.slaveOk=!0),null!=r&&"object"!=typeof r)throw c.create({message:"query selector must be an object",driver:!0});const a={find:this.s.namespace,limit:i.limit,skip:i.skip,query:r};"boolean"==typeof i.awaitdata&&(i.awaitData=i.awaitdata),"boolean"==typeof i.timeout&&(i.noCursorTimeout=i.timeout),f(a,i,["session","collation"]),s&&(a.fields=s),i.db=this.s.db,i.promiseLibrary=this.s.promiseLibrary,null==i.raw&&"boolean"==typeof this.s.raw&&(i.raw=this.s.raw),null==i.promoteLongs&&"boolean"==typeof this.s.promoteLongs&&(i.promoteLongs=this.s.promoteLongs),null==i.promoteValues&&"boolean"==typeof this.s.promoteValues&&(i.promoteValues=this.s.promoteValues),null==i.promoteBuffers&&"boolean"==typeof this.s.promoteBuffers&&(i.promoteBuffers=this.s.promoteBuffers),a.sort&&(a.sort=m(a.sort)),d(a,this,t);try{h(a,this,t)}catch(e){if("function"==typeof n)return n(e,null);throw e}const u=this.s.topology.cursor(this.s.namespace,a,i);return"function"==typeof n?p(n,null,u):u}),ue.prototype.insertOne=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,Y,[this,e,t,n])},ue.prototype.insertMany=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t?Object.assign({},t):{ordered:!0},!Array.isArray(e)&&"function"==typeof n)return n(c.create({message:"docs parameter must be an array of documents",driver:!0}));if(!Array.isArray(e))return new this.s.promiseLibrary((e,t)=>{t(c.create({message:"docs parameter must be an array of documents",driver:!0}))});t.serializeFunctions=t.serializeFunctions||this.s.serializeFunctions;const r=[{insertMany:e=X(this,e,t)}];return w(this.s.topology,T,[this,r,t,n],{resultMutator:t=>(function(e,t){const n={result:{ok:1,n:t.insertedCount},ops:e,insertedCount:t.insertedCount,insertedIds:t.insertedIds};return t.getLastOp()&&(n.result.opTime=t.getLastOp()),n})(e,t)})},ue.prototype.bulkWrite=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{ordered:!0},!Array.isArray(e))throw c.create({message:"operations must be an array of documents",driver:!0});return w(this.s.topology,T,[this,e,t,n])},ue.prototype.insert=r(function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{ordered:!1},e=Array.isArray(e)?e:[e],!0===t.keepGoing&&(t.ordered=!1),this.insertMany(e,t,n)},"collection.insert is deprecated. Use insertOne, insertMany or bulkWrite instead."),ue.prototype.updateOne=function(e,t,n,r){"function"==typeof n&&(r=n,n={}),n=n||{};const o=C(t);return o?"function"==typeof r?r(o):this.s.promiseLibrary.reject(o):(n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,ae,[this,e,t,n,r]))},ue.prototype.replaceOne=function(e,t,n,r){return"function"==typeof n&&(r=n,n={}),n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,ne,[this,e,t,n,r])},ue.prototype.updateMany=function(e,t,n,r){"function"==typeof n&&(r=n,n={}),n=n||{};const o=C(t);return o?"function"==typeof r?r(o):this.s.promiseLibrary.reject(o):(n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,ie,[this,e,t,n,r]))},ue.prototype.update=r(function(e,t,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,se,[this,e,t,n,r])},"collection.update is deprecated. Use updateOne, updateMany, or bulkWrite instead."),ue.prototype.deleteOne=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=Object.assign({},t),this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,k,[this,e,t,n])},ue.prototype.removeOne=ue.prototype.deleteOne,ue.prototype.deleteMany=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=Object.assign({},t),this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,A,[this,e,t,n])},ue.prototype.removeMany=ue.prototype.deleteMany,ue.prototype.remove=r(function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,ee,[this,e,t,n])},"collection.remove is deprecated. Use deleteOne, deleteMany, or bulkWrite instead."),ue.prototype.save=r(function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),w(this.s.topology,re,[this,e,t,n])},"collection.save is deprecated. Use insertOne, insertMany, updateOne, or updateMany instead."),ue.prototype.findOne=o({name:"collection.find",deprecatedOptions:le,optionsIndex:1},function(e,t,n){return"object"==typeof n&&console.warn("Third parameter to `findOne()` must be a callback or undefined"),"function"==typeof e&&(n=e,e={},t={}),"function"==typeof t&&(n=t,t={}),e=e||{},t=t||{},w(this.s.topology,j,[this,e,t,n])}),ue.prototype.rename=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=Object.assign({},t,{readPreference:y.PRIMARY}),w(this.s.topology,te,[this,e,t,n])},ue.prototype.drop=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},w(this.s.topology,this.s.db.dropCollection.bind(this.s.db),[this.s.name,e,t])},ue.prototype.options=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},w(this.s.topology,J,[this,e,t])},ue.prototype.isCapped=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},w(this.s.topology,K,[this,e,t])},ue.prototype.createIndex=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},w(this.s.topology,I,[this,e,t,n])},ue.prototype.createIndexes=function(e,t,n){return"function"==typeof t&&(n=t,t={}),"number"!=typeof(t=t?Object.assign({},t):{}).maxTimeMS&&delete t.maxTimeMS,w(this.s.topology,x,[this,e,t,n])},ue.prototype.dropIndex=function(e,t,n){const r=Array.prototype.slice.call(arguments,1);return n="function"==typeof r[r.length-1]?r.pop():void 0,(t=r.length&&r.shift()||{}).readPreference=y.PRIMARY,w(this.s.topology,M,[this,e,t,n])},ue.prototype.dropIndexes=function(e,t){return"function"==typeof e&&(t=e,e={}),"number"!=typeof(e=e?Object.assign({},e):{}).maxTimeMS&&delete e.maxTimeMS,w(this.s.topology,D,[this,e,t])},ue.prototype.dropAllIndexes=r(ue.prototype.dropIndexes,"collection.dropAllIndexes is deprecated. Use dropIndexes instead."),ue.prototype.reIndex=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},w(this.s.topology,Q,[this,e,t])},ue.prototype.listIndexes=function(e){if(e=e||{},(e=Object.assign({},e)).readPreference=_(e,{db:this.s.db,collection:this}),e.cursorFactory=g,e.promiseLibrary=this.s.promiseLibrary,!this.s.topology.capabilities())throw new c("cannot connect to server");let t=e.batchSize?{batchSize:e.batchSize}:{};if(this.s.topology.capabilities().hasListIndexesCommand){const n={listIndexes:this.s.name,cursor:t};return t=this.s.topology.cursor(`${this.s.dbName}.$cmd`,n,e),e.readPreference&&t.setReadPreference(e.readPreference),t}const n=`${this.s.dbName}.system.indexes`;return t=this.s.topology.cursor(n,{find:n,query:{ns:this.s.namespace}},e),e.readPreference&&t.setReadPreference(e.readPreference),e.batchSize&&(t=t.batchSize(e.batchSize)),t},ue.prototype.ensureIndex=r(function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},w(this.s.topology,R,[this,e,t,n])},"collection.ensureIndex is deprecated. Use createIndexes instead."),ue.prototype.indexExists=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},w(this.s.topology,H,[this,e,t,n])},ue.prototype.indexInformation=function(e,t){const n=Array.prototype.slice.call(arguments,0);return t="function"==typeof n[n.length-1]?n.pop():void 0,e=n.length&&n.shift()||{},w(this.s.topology,V,[this,e,t])},ue.prototype.count=r(function(e,t,n){const r=Array.prototype.slice.call(arguments,0);return n="function"==typeof r[r.length-1]?r.pop():void 0,e=r.length&&r.shift()||{},t=r.length&&r.shift()||{},w(this.s.topology,E,[this,e,t,n])},"collection.count is deprecated, and will be removed in a future version. Use collection.countDocuments or collection.estimatedDocumentCount instead"),ue.prototype.estimatedDocumentCount=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},w(this.s.topology,E,[this,null,e,t])},ue.prototype.countDocuments=function(e,t,n){const r=Array.prototype.slice.call(arguments,0);return n="function"==typeof r[r.length-1]?r.pop():void 0,e=r.length&&r.shift()||{},t=r.length&&r.shift()||{},w(this.s.topology,N,[this,e,t,n])},ue.prototype.distinct=function(e,t,n,r){const o=Array.prototype.slice.call(arguments,1);r="function"==typeof o[o.length-1]?o.pop():void 0;const s=o.length&&o.shift()||{},i=o.length&&o.shift()||{};return w(this.s.topology,B,[this,e,s,i,r])},ue.prototype.indexes=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},w(this.s.topology,W,[this,e,t])},ue.prototype.stats=function(e,t){const n=Array.prototype.slice.call(arguments,0);return t="function"==typeof n[n.length-1]?n.pop():void 0,e=n.length&&n.shift()||{},w(this.s.topology,oe,[this,e,t])},ue.prototype.findOneAndDelete=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},null==e||"object"!=typeof e)throw u("filter parameter must be an object");return w(this.s.topology,U,[this,e,t,n])},ue.prototype.findOneAndReplace=function(e,t,n,r){if("function"==typeof n&&(r=n,n={}),n=n||{},null==e||"object"!=typeof e)throw u("filter parameter must be an object");if(null==t||"object"!=typeof t)throw u("replacement parameter must be an object");return w(this.s.topology,z,[this,e,t,n,r])},ue.prototype.findOneAndUpdate=function(e,t,n,r){if("function"==typeof n&&(r=n,n={}),n=n||{},null==e||"object"!=typeof e)throw u("filter parameter must be an object");if(null==t||"object"!=typeof t)throw u("update parameter must be an object");const o=C(t);return o?"function"==typeof r?r(o):this.s.promiseLibrary.reject(o):w(this.s.topology,q,[this,e,t,n,r])},ue.prototype.findAndModify=r(function(e,t,n,r,o){const s=Array.prototype.slice.call(arguments,1);return o="function"==typeof s[s.length-1]?s.pop():void 0,t=s.length&&s.shift()||[],n=s.length?s.shift():null,r=s.length&&s.shift()||{},(r=Object.assign({},r)).readPreference=y.PRIMARY,w(this.s.topology,P,[this,e,t,n,r,o])},"collection.findAndModify is deprecated. Use findOneAndUpdate, findOneAndReplace or findOneAndDelete instead."),ue.prototype.findAndRemove=r(function(e,t,n,r){const o=Array.prototype.slice.call(arguments,1);return r="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length&&o.shift()||[],n=o.length&&o.shift()||{},w(this.s.topology,L,[this,e,t,n,r])},"collection.findAndRemove is deprecated. Use findOneAndDelete instead."),ue.prototype.aggregate=function(e,t,n){if(Array.isArray(e))"function"==typeof t&&(n=t,t={}),null==t&&null==n&&(t={});else{const r=Array.prototype.slice.call(arguments,0);n=r.pop();const o=r[r.length-1];t=o&&(o.readPreference||o.explain||o.cursor||o.out||o.maxTimeMS||o.hint||o.allowDiskUse)?r.pop():{},e=r}let r=!1;const o={aggregate:this.s.name,pipeline:e};"string"==typeof t.out?(e.push({$out:t.out}),r=!0):e.length>0&&e[e.length-1].$out&&(r=!0),e.length>0&&e[e.length-1].$out&&this.s.topology.capabilities().commandsTakeWriteConcern&&O(o,{db:this.s.db,collection:this},t);try{h(o,this,t)}catch(e){if("function"==typeof n)return n(e,null);throw e}if(!0===t.bypassDocumentValidation&&(o.bypassDocumentValidation=t.bypassDocumentValidation),r||d(o,this,t),t.allowDiskUse&&(o.allowDiskUse=t.allowDiskUse),"number"==typeof t.maxTimeMS&&(o.maxTimeMS=t.maxTimeMS),t.hint&&(o.hint=t.hint),(t=Object.assign({},t)).readPreference=_(t,{db:this.s.db,collection:this}),t.explain){if(o.readConcern||o.writeConcern)throw u('"explain" cannot be used on an aggregate call with readConcern/writeConcern');o.explain=t.explain}if("string"==typeof t.comment&&(o.comment=t.comment),null!=t.cursor&&"object"!=typeof t.cursor)throw u("cursor options must be an object");if(t.cursor=t.cursor||{},t.batchSize&&(t.cursor.batchSize=t.batchSize),o.cursor=t.cursor,t.promiseLibrary=this.s.promiseLibrary,t.cursorFactory=a,"function"!=typeof n){if(!this.s.topology.capabilities())throw new c("cannot connect to server");return"boolean"==typeof t.allowDiskUse&&(o.allowDiskUse=t.allowDiskUse),"number"==typeof t.maxTimeMS&&(o.maxTimeMS=t.maxTimeMS),this.s.topology.cursor(this.s.namespace,o,t)}return p(n,null,this.s.topology.cursor(this.s.namespace,o,t))},ue.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new S(this,e,t)},ue.prototype.parallelCollectionScan=function(e,t){return"function"==typeof e&&(t=e,e={numCursors:1}),e.numCursors=e.numCursors||1,e.batchSize=e.batchSize||1e3,(e=Object.assign({},e)).readPreference=_(e,{db:this.s.db,collection:this}),e.promiseLibrary=this.s.promiseLibrary,e.session&&(e.session=void 0),w(this.s.topology,Z,[this,e,t],{skipSessions:!0})},ue.prototype.geoHaystackSearch=function(e,t,n,r){const o=Array.prototype.slice.call(arguments,2);return r="function"==typeof o[o.length-1]?o.pop():void 0,n=o.length&&o.shift()||{},w(this.s.topology,$,[this,e,t,n,r])},ue.prototype.group=r(function(e,t,n,r,o,s,i,a){const c=Array.prototype.slice.call(arguments,3);return a="function"==typeof c[c.length-1]?c.pop():void 0,r=c.length?c.shift():null,o=c.length?c.shift():null,s=c.length?c.shift():null,i=c.length&&c.shift()||{},"function"!=typeof o&&(s=o,o=null),!Array.isArray(e)&&e instanceof Object&&"function"!=typeof e&&"Code"!==e._bsontype&&(e=Object.keys(e)),"function"==typeof r&&(r=r.toString()),"function"==typeof o&&(o=o.toString()),s=null==s||s,w(this.s.topology,F,[this,e,t,n,r,o,s,i,a])},"MongoDB 3.6 or higher no longer supports the group command. We recommend rewriting using the aggregation framework."),ue.prototype.mapReduce=function(e,t,n,r){if("function"==typeof n&&(r=n,n={}),null==n.out)throw new Error("the out option parameter must be defined, see mongodb docs for possible values");return"function"==typeof e&&(e=e.toString()),"function"==typeof t&&(t=t.toString()),"function"==typeof n.finalize&&(n.finalize=n.finalize.toString()),w(this.s.topology,G,[this,e,t,n,r])},ue.prototype.initializeUnorderedBulkOp=function(e){return(e=e||{}).promiseLibrary=this.s.promiseLibrary,b(this.s.topology,this,e)},ue.prototype.initializeOrderedBulkOp=function(e){return(e=e||{}).promiseLibrary=this.s.promiseLibrary,v(this.s.topology,this,e)},ue.prototype.getLogger=function(){return this.s.db.s.logger},e.exports=ue},function(e,t,n){"use strict";const r=n(9).EventEmitter,o=n(1).inherits,s=n(5).getSingleProperty,i=n(156),a=n(5).handleCallback,c=n(5).filterOptions,u=n(5).toError,l=n(6).ReadPreference,p=n(6).MongoError,f=n(6).ObjectID,h=n(6).Logger,d=n(72),m=n(5).mergeOptionsAndWriteConcern,y=n(5).executeOperation,g=n(5).applyWriteConcern,b=n(5).resolveReadPreference,v=n(155),S=n(1).deprecate,w=n(5).deprecateOptions,O=n(167),_=n(14).addUser,T=n(14).collections,C=n(14).createCollection,E=n(14).createIndex,N=n(14).createListener,I=n(14).dropCollection,x=n(14).dropDatabase,A=n(14).ensureIndex,k=n(14).evaluate,B=n(14).executeCommand,M=n(14).executeDbAdminCommand,D=n(14).indexInformation,R=n(14).listCollectionsTransforms,P=n(14).profilingInfo,L=n(14).profilingLevel,j=n(14).removeUser,U=n(14).setProfilingLevel,z=n(14).validateDatabaseName,q=["w","wtimeout","fsync","j","readPreference","readPreferenceTags","native_parser","forceServerObjectId","pkFactory","serializeFunctions","raw","bufferMaxEntries","authSource","ignoreUndefined","promoteLongs","promiseLibrary","readConcern","retryMiliSeconds","numberOfRetries","parentDb","noListener","loggerLevel","logger","promoteBuffers","promoteLongs","promoteValues","compression","retryWrites"];function $(e,t,n){if(n=n||{},!(this instanceof $))return new $(e,t,n);r.call(this);const o=n.promiseLibrary||Promise;(n=c(n,q)).promiseLibrary=o,this.s={databaseName:e,dbCache:{},children:[],topology:t,options:n,logger:h("Db",n),bson:t?t.bson:null,readPreference:n.readPreference,bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:-1,parentDb:n.parentDb||null,pkFactory:n.pkFactory||f,nativeParser:n.nativeParser||n.native_parser,promiseLibrary:o,noListener:"boolean"==typeof n.noListener&&n.noListener,readConcern:n.readConcern},z(this.s.databaseName),s(this,"serverConfig",this.s.topology),s(this,"bufferMaxEntries",this.s.bufferMaxEntries),s(this,"databaseName",this.s.databaseName),n.parentDb||this.s.noListener||(t.on("error",N(this,"error",this)),t.on("timeout",N(this,"timeout",this)),t.on("close",N(this,"close",this)),t.on("parseError",N(this,"parseError",this)),t.once("open",N(this,"open",this)),t.once("fullsetup",N(this,"fullsetup",this)),t.once("all",N(this,"all",this)),t.on("reconnect",N(this,"reconnect",this)))}o($,r),Object.defineProperty($.prototype,"topology",{enumerable:!0,get:function(){return this.s.topology}}),Object.defineProperty($.prototype,"options",{enumerable:!0,get:function(){return this.s.options}}),Object.defineProperty($.prototype,"slaveOk",{enumerable:!0,get:function(){return null!=this.s.options.readPreference&&("primary"!==this.s.options.readPreference||"primary"!==this.s.options.readPreference.mode)}}),Object.defineProperty($.prototype,"writeConcern",{enumerable:!0,get:function(){const e={};return null!=this.s.options.w&&(e.w=this.s.options.w),null!=this.s.options.j&&(e.j=this.s.options.j),null!=this.s.options.fsync&&(e.fsync=this.s.options.fsync),null!=this.s.options.wtimeout&&(e.wtimeout=this.s.options.wtimeout),e}}),$.prototype.command=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=Object.assign({},t),y(this.s.topology,B,[this,e,t,n])},$.prototype.admin=function(){return new(n(168))(this,this.s.topology,this.s.promiseLibrary)};const F=["pkFactory","readPreference","serializeFunctions","strict","readConcern","ignoreUndefined","promoteValues","promoteBuffers","promoteLongs"];$.prototype.collection=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},(t=Object.assign({},t)).promiseLibrary=this.s.promiseLibrary,t.readConcern=t.readConcern||this.s.readConcern,this.s.options.ignoreUndefined&&(t.ignoreUndefined=this.s.options.ignoreUndefined),null==(t=m(t,this.s.options,F,!0))||!t.strict)try{const r=new d(this,this.s.topology,this.s.databaseName,e,this.s.pkFactory,t);return n&&n(null,r),r}catch(e){if(e instanceof p&&n)return n(e);throw e}if("function"!=typeof n)throw u(`A callback is required in strict mode. While getting collection ${e}`);if(this.serverConfig&&this.serverConfig.isDestroyed())return n(new p("topology was destroyed"));const r=Object.assign({},t,{nameOnly:!0});this.listCollections({name:e},r).toArray((r,o)=>{if(null!=r)return a(n,r,null);if(0===o.length)return a(n,u(`Collection ${e} does not exist. Currently in strict mode.`),null);try{return a(n,null,new d(this,this.s.topology,this.s.databaseName,e,this.s.pkFactory,t))}catch(r){return a(n,r,null)}})},$.prototype.createCollection=w({name:"Db.createCollection",deprecatedOptions:["autoIndexId"],optionsIndex:1},function(e,t,n){return"function"==typeof t&&(n=t,t={}),(t=t||{}).promiseLibrary=t.promiseLibrary||this.s.promiseLibrary,y(this.s.topology,C,[this,e,t,n])}),$.prototype.stats=function(e,t){"function"==typeof e&&(t=e,e={});const n={dbStats:!0};return null!=(e=e||{}).scale&&(n.scale=e.scale),null==e.readPreference&&this.s.readPreference&&(e.readPreference=this.s.readPreference),this.command(n,e,t)},$.prototype.listCollections=function(e,t){e=e||{},t=t||{},(t=Object.assign({},t)).promiseLibrary=this.s.promiseLibrary,t.readPreference=b(t,{db:this,default:l.primary});let n=t.batchSize?{batchSize:t.batchSize}:{};if(this.serverConfig.capabilities().hasListCollectionsCommand){const r={listCollections:!0,filter:e,cursor:n,nameOnly:"boolean"==typeof t.nameOnly&&t.nameOnly};return t.cursorFactory=i,n=this.s.topology.cursor(`${this.s.databaseName}.$cmd`,r,t),t.readPreference&&n.setReadPreference(t.readPreference),n}this.serverConfig.capabilities().hasListCollectionsCommand||"string"!=typeof e.name||new RegExp("^"+this.databaseName+"\\.").test(e.name)||((e=Object.assign({},e)).name=`${this.s.databaseName}.${e.name}`),null==e&&(e.name=`/${this.s.databaseName}/`),e=e.name?{$and:[{name:e.name},{name:/^((?!\$).)*$/}]}:{name:/^((?!\$).)*$/};const r={transforms:R(this.s.databaseName)};return n=this.collection(O.SYSTEM_NAMESPACE_COLLECTION).find(e,r),t.readPreference&&n.setReadPreference(t.readPreference),t.batchSize&&(n=n.batchSize(t.batchSize)),n},$.prototype.eval=S(function(e,t,n,r){const o=Array.prototype.slice.call(arguments,1);return r="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():t,n=o.length&&o.shift()||{},y(this.s.topology,k,[this,e,t,n,r])},"Db.eval is deprecated as of MongoDB version 3.2"),$.prototype.renameCollection=function(e,t,n,r){"function"==typeof n&&(r=n,n={}),(n=n||{}).new_collection=!0;const o=this.collection(e);return y(this.s.topology,o.rename.bind(o),[t,n,r])},$.prototype.dropCollection=function(e,t,n){"function"==typeof t&&(n=t,t={});const r={drop:e};g(r,{db:this},t=t||{});const o=Object.assign({},this.s.options,{readPreference:l.PRIMARY});return t.session&&(o.session=t.session),y(this.s.topology,I,[this,r,o,n])},$.prototype.dropDatabase=function(e,t){"function"==typeof e&&(t=e,e={});const n={dropDatabase:1};g(n,{db:this},e=e||{});const r=Object.assign({},this.s.options,{readPreference:l.PRIMARY});return e.session&&(r.session=e.session),y(this.s.topology,x,[this,n,r,t])},$.prototype.collections=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},y(this.s.topology,T,[this,e,t])},$.prototype.executeDbAdminCommand=function(e,t,n){return"function"==typeof t&&(n=t,t={}),(t=t||{}).readPreference=b(t),y(this.s.topology,M,[this,e,t,n])},$.prototype.createIndex=function(e,t,n,r){return"function"==typeof n&&(r=n,n={}),n=n?Object.assign({},n):{},y(this.s.topology,E,[this,e,t,n,r])},$.prototype.ensureIndex=S(function(e,t,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},y(this.s.topology,A,[this,e,t,n,r])},"Db.ensureIndex is deprecated as of MongoDB version 3.0 / driver version 2.0"),$.prototype.addChild=function(e){if(this.s.parentDb)return this.s.parentDb.addChild(e);this.s.children.push(e)},$.prototype.addUser=function(e,t,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},y(this.s.topology,_,[this,e,t,n,r])},$.prototype.removeUser=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},y(this.s.topology,j,[this,e,t,n])},$.prototype.setProfilingLevel=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},y(this.s.topology,U,[this,e,t,n])},$.prototype.profilingInfo=S(function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},y(this.s.topology,P,[this,e,t])},"Db.profilingInfo is deprecated. Query the system.profile collection directly."),$.prototype.profilingLevel=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},y(this.s.topology,L,[this,e,t])},$.prototype.indexInformation=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},y(this.s.topology,D,[this,e,t,n])},$.prototype.unref=function(){this.s.topology.unref()},$.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new v(this,e,t)},$.prototype.getLogger=function(){return this.s.logger},$.SYSTEM_NAMESPACE_COLLECTION=O.SYSTEM_NAMESPACE_COLLECTION,$.SYSTEM_INDEX_COLLECTION=O.SYSTEM_INDEX_COLLECTION,$.SYSTEM_PROFILE_COLLECTION=O.SYSTEM_PROFILE_COLLECTION,$.SYSTEM_USER_COLLECTION=O.SYSTEM_USER_COLLECTION,$.SYSTEM_COMMAND_COLLECTION=O.SYSTEM_COMMAND_COLLECTION,$.SYSTEM_JS_COLLECTION=O.SYSTEM_JS_COLLECTION,e.exports=$},function(e,t,n){"use strict";const r=n(9),o=n(6).MongoError,s=n(1).format,i=n(63),a=n(5).translateReadPreference,c=n(6).Sessions.ClientSession;var u=function(e,t){var n=this;t=t||{force:!1,bufferMaxEntries:-1},this.s={storedOps:[],storeOptions:t,topology:e},Object.defineProperty(this,"length",{enumerable:!0,get:function(){return n.s.storedOps.length}})};u.prototype.add=function(e,t,n,r,i){if(this.s.storeOptions.force)return i(o.create({message:"db closed by application",driver:!0}));if(0===this.s.storeOptions.bufferMaxEntries)return i(o.create({message:s("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){this.s.storedOps.shift().c(o.create({message:s("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,n:t,o:n,op:r,c:i})},u.prototype.addObjectAndMethod=function(e,t,n,r,i){if(this.s.storeOptions.force)return i(o.create({message:"db closed by application",driver:!0}));if(0===this.s.storeOptions.bufferMaxEntries)return i(o.create({message:s("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){this.s.storedOps.shift().c(o.create({message:s("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,m:n,o:t,p:r,c:i})},u.prototype.flush=function(e){for(;this.s.storedOps.length>0;)this.s.storedOps.shift().c(e||o.create({message:s("no connection available for operation"),driver:!0}))};var l=["primary","primaryPreferred","nearest","secondaryPreferred"],p=["secondary","secondaryPreferred"];u.prototype.execute=function(e){e=e||{};var t=this.s.storedOps;this.s.storedOps=[];for(var n="boolean"!=typeof e.executePrimary||e.executePrimary,r="boolean"!=typeof e.executeSecondary||e.executeSecondary;t.length>0;){var o=t.shift();"cursor"===o.t?n&&r?o.o[o.m].apply(o.o,o.p):n&&o.o.options&&o.o.options.readPreference&&-1!==l.indexOf(o.o.options.readPreference.mode)?o.o[o.m].apply(o.o,o.p):!n&&r&&o.o.options&&o.o.options.readPreference&&-1!==p.indexOf(o.o.options.readPreference.mode)&&o.o[o.m].apply(o.o,o.p):"auth"===o.t?this.s.topology[o.t].apply(this.s.topology,o.o):n&&r?this.s.topology[o.t](o.n,o.o,o.op,o.c):n&&o.op&&o.op.readPreference&&-1!==l.indexOf(o.op.readPreference.mode)?this.s.topology[o.t](o.n,o.o,o.op,o.c):!n&&r&&o.op&&o.op.readPreference&&-1!==p.indexOf(o.op.readPreference.mode)&&this.s.topology[o.t](o.n,o.o,o.op,o.c)}},u.prototype.all=function(){return this.s.storedOps};var f=function(e){var t=function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},n=!1,r=!1,o=!1,s=!1,i=!1,a=!1,c=e.maxWriteBatchSize||1e3,u=!1,l=!1;e.minWireVersion>=0&&(o=!0),e.maxWireVersion>=1&&(n=!0,s=!0),e.maxWireVersion>=2&&(r=!0),e.maxWireVersion>=3&&(i=!0,a=!0),e.maxWireVersion>=5&&(u=!0,l=!0),null==e.minWireVersion&&(e.minWireVersion=0),null==e.maxWireVersion&&(e.maxWireVersion=0),t(this,"hasAggregationCursor",n),t(this,"hasWriteCommands",r),t(this,"hasTextSearch",o),t(this,"hasAuthCommands",s),t(this,"hasListCollectionsCommand",i),t(this,"hasListIndexesCommand",a),t(this,"minWireVersion",e.minWireVersion),t(this,"maxWireVersion",e.maxWireVersion),t(this,"maxNumberOfDocsInBatch",c),t(this,"commandsTakeWriteConcern",u),t(this,"commandsTakeCollation",l)};const h=n(205).version,d=s("Node.js %s, %s",process.version,i.endianness()),m=i.type(),y=process.platform,g=process.arch,b=i.release();class v extends r{constructor(){super(),this.clientInfo={driver:{name:"nodejs",version:h},os:{type:m,name:y,architecture:g,version:b},platform:d},this.setMaxListeners(1/0)}hasSessionSupport(){return null!=this.logicalSessionTimeoutMinutes}startSession(e,t){const n=new c(this,this.s.sessionPool,e,t);return n.once("ended",()=>{this.s.sessions=this.s.sessions.filter(e=>!e.equals(n))}),this.s.sessions.push(n),n}endSessions(e,t){return this.s.coreTopology.endSessions(e,t)}capabilities(){return this.s.sCapabilities?this.s.sCapabilities:null==this.s.coreTopology.lastIsMaster()?null:(this.s.sCapabilities=new f(this.s.coreTopology.lastIsMaster()),this.s.sCapabilities)}command(e,t,n,r){this.s.coreTopology.command(e,t,a(n),r)}insert(e,t,n,r){this.s.coreTopology.insert(e,t,n,r)}update(e,t,n,r){this.s.coreTopology.update(e,t,n,r)}remove(e,t,n,r){this.s.coreTopology.remove(e,t,n,r)}isConnected(e){return e=a(e=e||{}),this.s.coreTopology.isConnected(e)}isDestroyed(){return this.s.coreTopology.isDestroyed()}cursor(e,t,n){return(n=a(n=n||{})).disconnectHandler=this.s.store,n.topology=this,this.s.coreTopology.cursor(e,t,n)}lastIsMaster(){return this.s.coreTopology.lastIsMaster()}selectServer(e,t,n){return this.s.coreTopology.selectServer(e,t,n)}unref(){return this.s.coreTopology.unref()}auth(){var e=Array.prototype.slice.call(arguments,0);this.s.coreTopology.auth.apply(this.s.coreTopology,e)}logout(){var e=Array.prototype.slice.call(arguments,0);this.s.coreTopology.logout.apply(this.s.coreTopology,e)}connections(){return this.s.coreTopology.connections()}close(e){this.s.sessions.length&&this.s.sessions.forEach(e=>e.endSession()),this.s.sessionPool&&this.s.sessionPool.endAllPooledSessions(),this.s.coreTopology.destroy({force:"boolean"==typeof e&&e}),!0===e&&(this.s.storeOptions.force=e,this.s.store.flush())}}Object.defineProperty(v.prototype,"bson",{enumerable:!0,get:function(){return this.s.coreTopology.s.bson}}),Object.defineProperty(v.prototype,"parserType",{enumerable:!0,get:function(){return this.s.coreTopology.parserType}}),Object.defineProperty(v.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.coreTopology.logicalSessionTimeoutMinutes}}),Object.defineProperty(v.prototype,"type",{enumerable:!0,get:function(){return this.s.coreTopology.type}}),t.Store=u,t.ServerCapabilities=f,t.TopologyBase=v},function(e,t,n){var r=n(115),o=n(31),s=n(42),i=n(45),a=n(43),c=n(37),u=n(58),l=n(26),p=n(57),f=n(44),h=n(30),d=n(39),m=n(40),y=n(41),g=n(38);r.BSON_INT32_MAX=2147483647,r.BSON_INT32_MIN=-2147483648,r.BSON_INT64_MAX=Math.pow(2,63)-1,r.BSON_INT64_MIN=-Math.pow(2,63),r.JS_INT_MAX=9007199254740992,r.JS_INT_MIN=-9007199254740992,r.Binary=o,r.Code=s,r.DBRef=i,r.Decimal128=a,r.Double=c,r.Int32=u,r.Long=l,r.Map=p,r.MaxKey=f,r.MinKey=h,r.ObjectId=d,r.ObjectID=d,r.BSONRegExp=m,r.Symbol=y,r.Timestamp=g,e.exports=r},function(e,t,n){"use strict";e.exports={normalizedFunctionString:function(e){return e.toString().replace(/function *\(/,"function (")}}},function(e,t,n){"use strict";var r=n(1).inherits,o=n(9).EventEmitter,s=n(93),i=n(94),a=n(18),c=n(1).format,u=n(13).debugOptions,l=n(21).parseHeader,p=n(46).decompress,f=n(12).Response,h=n(4).MongoNetworkError,d=n(23),m=n(21).opcodes.OP_COMPRESSED,y=n(21).MESSAGE_HEADER_SIZE,g=n(19).Buffer,b=0,v=["host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","socketTimeout","singleBufferSerializtion","ssl","ca","crl","cert","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","checkServerIdentity"],S=void 0,w=!1,O={},_=function(e,t){if(o.call(this),this.options=t||{},this.id=b++,this.logger=d("Connection",t),!t.bson)throw new Error("must pass in valid bson parser");this.bson=t.bson,this.tag=t.tag,this.messageHandler=e,this.maxBsonMessageSize=t.maxBsonMessageSize||67108864,this.logger.isDebug()&&this.logger.debug(c("creating connection %s with options [%s]",this.id,JSON.stringify(u(v,t)))),this.port=t.port||27017,this.host=t.host||"localhost",this.family="number"==typeof t.family?t.family:void 0,this.keepAlive="boolean"!=typeof t.keepAlive||t.keepAlive,this.keepAliveInitialDelay="number"==typeof t.keepAliveInitialDelay?t.keepAliveInitialDelay:3e5,this.noDelay="boolean"!=typeof t.noDelay||t.noDelay,this.connectionTimeout="number"==typeof t.connectionTimeout?t.connectionTimeout:3e4,this.socketTimeout="number"==typeof t.socketTimeout?t.socketTimeout:36e4,this.keepAliveInitialDelay>this.socketTimeout&&(this.keepAliveInitialDelay=Math.round(this.socketTimeout/2)),this.destroyed=!1,this.domainSocket=-1!==this.host.indexOf("/"),this.singleBufferSerializtion="boolean"!=typeof t.singleBufferSerializtion||t.singleBufferSerializtion,this.serializationFunction=this.singleBufferSerializtion?"toBinUnified":"toBin",this.ca=t.ca||null,this.crl=t.crl||null,this.cert=t.cert||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.ciphers=t.ciphers||null,this.ecdhCurve=t.ecdhCurve||null,this.ssl="boolean"==typeof t.ssl&&t.ssl,this.rejectUnauthorized="boolean"!=typeof t.rejectUnauthorized||t.rejectUnauthorized,this.checkServerIdentity="boolean"!=typeof t.checkServerIdentity&&"function"!=typeof t.checkServerIdentity||t.checkServerIdentity,this.ssl||(this.rejectUnauthorized=!1),this.responseOptions={promoteLongs:"boolean"!=typeof t.promoteLongs||t.promoteLongs,promoteValues:"boolean"!=typeof t.promoteValues||t.promoteValues,promoteBuffers:"boolean"==typeof t.promoteBuffers&&t.promoteBuffers},this.flushing=!1,this.queue=[],this.connection=null,this.writeStream=null;var n=a.createHash("sha1");n.update(c("%s:%s",this.host,this.port)),this.hashedName=n.digest("hex"),this.workItems=[]};function T(e){delete O[e],S&&S.deleteConnection(e)}r(_,o),_.prototype.setSocketTimeout=function(e){this.connection&&this.connection.setTimeout(e)},_.prototype.resetSocketTimeout=function(){this.connection&&this.connection.setTimeout(this.socketTimeout)},_.enableConnectionAccounting=function(e){e&&(S=e),w=!0,O={}},_.disableConnectionAccounting=function(){w=!1,S=void 0},_.connections=function(){return O};var C=function(e){return function(){w&&T(e.id),e.logger.isDebug()&&e.logger.debug(c("connection %s for [%s:%s] timed out",e.id,e.host,e.port)),e.emit("timeout",new h(c("connection %s to %s:%s timed out",e.id,e.host,e.port)),e)}},E=function(e){return function(t){w&&T(e.id),e.logger.isDebug()&&e.logger.debug(c("connection %s with for [%s:%s] closed",e.id,e.host,e.port)),t||e.emit("close",new h(c("connection %s to %s:%s closed",e.id,e.host,e.port)),e)}},N=function(e,t){var n=l(t);if(n.opCode===m){n.fromCompressed=!0;var r=y;n.opCode=t.readInt32LE(r),r+=4,n.length=t.readInt32LE(r);var o=t[r+=4];r++,p(o,t.slice(r),function(r,o){if(r)throw r;if(o.length!==n.length)throw new Error("Decompressing a compressed message from the server failed. The message is corrupt.");e.messageHandler(new f(e.bson,t,n,o,e.responseOptions),e)})}else e.messageHandler(new f(e.bson,t,n,t.slice(y),e.responseOptions),e)},I=function(e){return function(t){for(;t.length>0;)if(e.bytesRead>0&&e.sizeOfMessage>0){var n=e.sizeOfMessage-e.bytesRead;if(n>t.length)t.copy(e.buffer,e.bytesRead),e.bytesRead=e.bytesRead+t.length,t=g.alloc(0);else{t.copy(e.buffer,e.bytesRead,0,n),t=t.slice(n);try{var r=e.buffer;e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,N(e,r)}catch(t){var o={err:"socketHandler",trace:t,bin:e.buffer,parseState:{sizeOfMessage:e.sizeOfMessage,bytesRead:e.bytesRead,stubBuffer:e.stubBuffer}};e.emit("parseError",o,e)}}}else if(null!=e.stubBuffer&&e.stubBuffer.length>0)if(e.stubBuffer.length+t.length>4){var s=g.alloc(e.stubBuffer.length+t.length);e.stubBuffer.copy(s,0),t.copy(s,e.stubBuffer.length),t=s,e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null}else{var i=g.alloc(e.stubBuffer.length+t.length);e.stubBuffer.copy(i,0),t.copy(i,e.stubBuffer.length),t=g.alloc(0)}else if(t.length>4){var a=t[0]|t[1]<<8|t[2]<<16|t[3]<<24;if(a<0||a>e.maxBsonMessageSize)return o={err:"socketHandler",trace:"",bin:e.buffer,parseState:{sizeOfMessage:a,bytesRead:e.bytesRead,stubBuffer:e.stubBuffer}},void e.emit("parseError",o,e);if(a>4&&a<e.maxBsonMessageSize&&a>t.length)e.buffer=g.alloc(a),t.copy(e.buffer,0),e.bytesRead=t.length,e.sizeOfMessage=a,e.stubBuffer=null,t=g.alloc(0);else if(a>4&&a<e.maxBsonMessageSize&&a===t.length)try{r=t,e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=g.alloc(0),N(e,r)}catch(t){e.emit("parseError",t,e)}else a<=4||a>e.maxBsonMessageSize?(o={err:"socketHandler",trace:null,bin:t,parseState:{sizeOfMessage:a,bytesRead:0,buffer:null,stubBuffer:null}},e.emit("parseError",o,e),e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=g.alloc(0)):(r=t.slice(0,a),e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=t.slice(a),N(e,r))}else e.stubBuffer=g.alloc(t.length),t.copy(e.stubBuffer,0),t=g.alloc(0)}},x=["pfx","key","passphrase","cert","ca","ciphers","NPNProtocols","ALPNProtocols","servername","ecdhCurve","secureProtocol","secureContext","session","minDHSize"];function A(e,t){for(var n in t)null!=t[n]&&-1!==x.indexOf(n)&&(e[n]=t[n])}function k(e,t,n,r){e.connection=e.ssl?function(e,t){let n={socket:e.connection,rejectUnauthorized:e.rejectUnauthorized};A(n,e.options),A(n,t),e.ca&&(n.ca=e.ca),e.crl&&(n.crl=e.crl),e.cert&&(n.cert=e.cert),e.key&&(n.key=e.key),e.passphrase&&(n.passphrase=e.passphrase),!1===e.checkServerIdentity?n.checkServerIdentity=function(){}:"function"==typeof e.checkServerIdentity&&(n.checkServerIdentity=e.checkServerIdentity),null==n.servername&&(n.servername=e.host);const r=i.connect(e.port,e.host,n,function(){if(r.authorizationError&&e.rejectUnauthorized)return e.emit("error",r.authorizationError,e,{ssl:!0});r.setTimeout(e.socketTimeout),e.emit("connect",e)});return r.setKeepAlive(e.keepAlive,e.keepAliveInitialDelay),r.setTimeout(e.connectionTimeout),r.setNoDelay(e.noDelay),r}(e,n):function(e,t){let n;e.domainSocket?n={path:e.host}:(n={port:e.port,host:e.host}).family=t;const r=s.createConnection(n);return r.setKeepAlive(e.keepAlive,e.keepAliveInitialDelay),r.setTimeout(e.connectionTimeout),r.setNoDelay(e.noDelay),r.once("connect",function(){r.setTimeout(e.socketTimeout),e.emit("connect",e)}),r}(e,t),e.connection.once("error",r),e.connection.once("timeout",C(e)),e.connection.once("close",E(e)),e.connection.on("data",I(e))}_.prototype.connect=function(e){e=e||{},w&&function(e,t){O[e]=t,S&&S.addConnection(e,t)}(this.id,this),"boolean"==typeof e.promoteLongs&&(this.responseOptions.promoteLongs=e.promoteLongs,this.responseOptions.promoteValues=e.promoteValues,this.responseOptions.promoteBuffers=e.promoteBuffers);const t=function(e){return function(t){w&&T(e.id),e.logger.isDebug()&&e.logger.debug(c("connection %s for [%s:%s] errored out with [%s]",e.id,e.host,e.port,JSON.stringify(t))),e.listeners("error").length>0&&e.emit("error",new h(t),e)}}(this);return void 0!==this.family?k(this,this.family,e,t):k(this,6,e,n=>(this.logger.isDebug()&&this.logger.debug(c("connection %s for [%s:%s] errored out with [%s]",this.id,this.host,this.port,JSON.stringify(n))),this.connection.removeAllListeners("error"),this.connection.removeAllListeners("timeout"),this.connection.removeAllListeners("close"),this.connection.removeAllListeners("data"),this.connection=void 0,k(this,4,e,t)))},_.prototype.unref=function(){if(this.connection)this.connection.unref();else{var e=this;this.once("connect",function(){e.connection.unref()})}},_.prototype.destroy=function(){if(w&&T(this.id),this.connection){try{this.connection.end()}catch(e){}this.connection.destroy()}this.destroyed=!0},_.prototype.write=function(e){var t;if(this.logger.isDebug())if(Array.isArray(e))for(t=0;t<e.length;t++)this.logger.debug(c("writing buffer [%s] to %s:%s",e[t].toString("hex"),this.host,this.port));else this.logger.debug(c("writing buffer [%s] to %s:%s",e.toString("hex"),this.host,this.port));if(!1===this.connection.destroyed){if(!Array.isArray(e))return this.connection.write(e,"binary"),!0;for(t=0;t<e.length;t++)this.connection.write(e[t],"binary");return!0}return!1},_.prototype.toString=function(){return""+this.id},_.prototype.toJSON=function(){return{id:this.id,host:this.host,port:this.port}},_.prototype.isConnected=function(){return!this.destroyed&&(!this.connection.destroyed&&this.connection.writable)},e.exports=_},function(e,t,n){"use strict";var r=n(1).format,o=n(18),s=n(12).Query,i=n(4).MongoError,a=function(e,t,n){this.db=e,this.username=t,this.password=n};a.prototype.equal=function(e){return e.db===this.db&&e.username===this.username&&e.password===this.password};var c=function(e){this.bson=e,this.authStore=[]},u=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};c.prototype.auth=function(e,t,n,c,l,p){var f=this,h=t.length;if(0===h)return p(null,null);for(var d=0,m=null;t.length>0;){!function(t){process.nextTick(function(){!function(t){e(t,new s(f.bson,r("%s.$cmd",n),{getnonce:1},{numberToSkip:0,numberToReturn:1}),function(y,g){var b=null,v=null;if(null==y){b=g.result.nonce;var S=o.createHash("md5");S.update(c+":mongo:"+l,"utf8");var w=S.digest("hex");(S=o.createHash("md5")).update(b+c+w,"utf8"),v=S.digest("hex")}e(t,new s(f.bson,r("%s.$cmd",n),{authenticate:1,user:c,nonce:b,key:v},{numberToSkip:0,numberToReturn:1}),function(e,t){h-=1,e?m=e:t.result.$err?m=t.result:t.result.errmsg?m=t.result:d+=1,0===h&&d>0?(u(f.authStore,new a(n,c,l)),p(null,!0)):0===h&&(null==m&&(m=new i(r("failed to authenticate using mongocr"))),p(m,!1))})})}(t)})}(t.shift())}},c.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!==e})},c.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var s=0;s<r.length;s++)this.auth(e,t,r[s].db,r[s].username,r[s].password,function(e){0===(o-=1)&&n(e,null)})},e.exports=c},function(e,t,n){"use strict";var r=n(1).format,o=n(12).Query,s=n(4).MongoError,i=function(e,t,n){this.db=e,this.username=t,this.password=n};i.prototype.equal=function(e){return e.db===this.db&&e.username===this.username&&e.password===this.password};var a=function(e){this.bson=e,this.authStore=[]};a.prototype.auth=function(e,t,n,a,u,l){var p=this,f=t.length;if(0===f)return l(null,null);for(var h=0,d=null;t.length>0;){!function(t){process.nextTick(function(){!function(t){var m={authenticate:1,mechanism:"MONGODB-X509"};a&&(m.user=a),e(t,new o(p.bson,"$external.$cmd",m,{numberToSkip:0,numberToReturn:1}),function(e,t){f-=1,e?d=e:t.result.$err?d=t.result:t.result.errmsg?d=t.result:h+=1,0===f&&h>0?(c(p.authStore,new i(n,a,u)),l(null,!0)):0===f&&(null==d&&(d=new s(r("failed to authenticate using mongocr"))),l(d,!1))})}(t)})}(t.shift())}};var c=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};a.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!==e})},a.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var s=0;s<r.length;s++)this.auth(e,t,r[s].db,r[s].username,r[s].password,function(e){0===(o-=1)&&n(e,null)})},e.exports=a},function(e,t,n){"use strict";var r=n(1).format,o=n(13).retrieveBSON,s=n(12).Query,i=n(4).MongoError,a=o().Binary,c=function(e,t,n){this.db=e,this.username=t,this.password=n};c.prototype.equal=function(e){return e.db===this.db&&e.username===this.username&&e.password===this.password};var u=function(e){this.bson=e,this.authStore=[]};u.prototype.auth=function(e,t,n,o,u,p){var f=this,h=t.length;if(0===h)return p(null,null);for(var d=0,m=null;t.length>0;){!function(t){process.nextTick(function(){!function(t){var y={saslStart:1,mechanism:"PLAIN",payload:new a(r("\0%s\0%s",o,u)),autoAuthorize:1};e(t,new s(f.bson,"$external.$cmd",y,{numberToSkip:0,numberToReturn:1}),function(e,t){h-=1,e?m=e:t.result.$err?m=t.result:t.result.errmsg?m=t.result:d+=1,0===h&&d>0?(l(f.authStore,new c(n,o,u)),p(null,!0)):0===h&&(null==m&&(m=new i(r("failed to authenticate using mongocr"))),p(m,!1))})}(t)})}(t.shift())}};var l=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};u.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!==e})},u.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var s=0;s<r.length;s++)this.auth(e,t,r[s].db,r[s].username,r[s].password,function(e){0===(o-=1)&&n(e,null)})},e.exports=u},function(e,t,n){"use strict";const r=n(1).format,o=n(12).Query,s=n(4).MongoError,i=n(16).retrieveKerberos;var a=function(e,t,n,r){this.db=e,this.username=t,this.password=n,this.options=r};a.prototype.equal=function(e){return e.db===this.db&&e.username===this.username&&e.password===this.password};var c=function(e){this.bson=e,this.authStore=[]};c.prototype.auth=function(e,t,n,o,c,l,p){var f=this;let d;try{d=i()}catch(e){return p(e,null)}var m=l.gssapiservicename||l.gssapiServiceName||"mongodb",y=t.length;if(0===y)return p(null,null);for(var g=0,b=null;t.length>0;){!function(t){process.nextTick(function(){!function(t){u(f,d.processes.MongoAuthProcess,n,o,c,n,m,e,t,l,function(e,t){y-=1,e?b=e:t.result.$err?b=t.result:t.result.errmsg?b=t.result:g+=1,0===y&&g>0?(h(f.authStore,new a(n,o,c,l)),p(null,!0)):0===y&&(null==b&&(b=new s(r("failed to authenticate using mongocr"))),p(b,!1))})}(t)})}(t.shift())}};var u=function(e,t,n,r,o,s,i,a,c,u,p){var f=new t(c.host,c.port,i,u);f.init(r,o,function(t){if(t)return p(t,!1);f.transition("",function(t,i){if(t)return p(t,!1);l(e,f,i,n,r,o,s,a,c,p)})})},l=function(e,t,n,r,s,i,a,c,u,l){var f={saslStart:1,mechanism:"GSSAPI",payload:n,autoAuthorize:1};c(u,new o(e.bson,"$external.$cmd",f,{numberToSkip:0,numberToReturn:1}),function(n,o){if(n)return l(n,!1);var f=o.result;t.transition(o.result.payload,function(n,o){if(n)return l(n,!1);p(e,t,o,f,r,s,i,a,c,u,l)})})},p=function(e,t,n,r,s,i,a,c,u,l,p){var h={saslContinue:1,conversationId:r.conversationId,payload:n};u(l,new o(e.bson,"$external.$cmd",h,{numberToSkip:0,numberToReturn:1}),function(n,r){if(n)return p(n,!1);var o=r.result;t.transition(o.payload,function(n,r){if(n)return p(n,!1);f(e,t,r,o,s,i,a,c,u,l,p)})})},f=function(e,t,n,r,s,i,a,c,u,l,p){var f={saslContinue:1,conversationId:r.conversationId,payload:n};u(l,new o(e.bson,"$external.$cmd",f,{numberToSkip:0,numberToReturn:1}),function(e,n){if(e)return p(e,!1);t.transition(null,function(e){if(e)return p(e,null);p(null,n)})})},h=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};c.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!==e})},c.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var s=0;s<r.length;s++)this.auth(e,t,r[s].db,r[s].username,r[s].password,r[s].options,function(e){0===(o-=1)&&n(e,null)})},e.exports=c},function(e,t,n){"use strict";const r=n(1).inherits,o=n(2).MongoError,s=n(15).Readable,i=n(17);var a=function(e,t,n,r,o,c){i.apply(this,Array.prototype.slice.call(arguments,0));var u=a.INIT,l=r.promiseLibrary||Promise;s.call(this,{objectMode:!0}),this.s={maxTimeMS:null,state:u,streamOptions:{},bson:e,ns:t,cmd:n,options:r,topology:o,topologyOptions:c,promiseLibrary:l,session:r.session}};for(var c in r(a,s),i.prototype)a.prototype[c]=i.prototype[c];a.prototype.batchSize=function(e){if(this.s.state===a.CLOSED||this.isDead())throw o.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw o.create({message:"batchSize requires an integer",drvier:!0});return this.s.cmd.cursor&&(this.s.cmd.cursor.batchSize=e),this.setCursorBatchSize(e),this},a.prototype.geoNear=function(e){return this.s.cmd.pipeline.push({$geoNear:e}),this},a.prototype.group=function(e){return this.s.cmd.pipeline.push({$group:e}),this},a.prototype.limit=function(e){return this.s.cmd.pipeline.push({$limit:e}),this},a.prototype.match=function(e){return this.s.cmd.pipeline.push({$match:e}),this},a.prototype.maxTimeMS=function(e){return this.s.topology.lastIsMaster().minWireVersion>2&&(this.s.cmd.maxTimeMS=e),this},a.prototype.out=function(e){return this.s.cmd.pipeline.push({$out:e}),this},a.prototype.project=function(e){return this.s.cmd.pipeline.push({$project:e}),this},a.prototype.lookup=function(e){return this.s.cmd.pipeline.push({$lookup:e}),this},a.prototype.redact=function(e){return this.s.cmd.pipeline.push({$redact:e}),this},a.prototype.skip=function(e){return this.s.cmd.pipeline.push({$skip:e}),this},a.prototype.sort=function(e){return this.s.cmd.pipeline.push({$sort:e}),this},a.prototype.unwind=function(e){return this.s.cmd.pipeline.push({$unwind:e}),this},a.prototype.getLogger=function(){return this.logger},a.prototype.get=a.prototype.toArray,a.INIT=0,a.OPEN=1,a.CLOSED=2,e.exports=a},function(e,t,n){"use strict";e.exports={SYSTEM_NAMESPACE_COLLECTION:"system.namespaces",SYSTEM_INDEX_COLLECTION:"system.indexes",SYSTEM_PROFILE_COLLECTION:"system.profile",SYSTEM_USER_COLLECTION:"system.users",SYSTEM_COMMAND_COLLECTION:"$cmd",SYSTEM_JS_COLLECTION:"system.js"}},function(e,t,n){"use strict";const r=n(0).executeOperation,o=n(0).applyWriteConcern,s=n(7).addUser,i=n(7).executeDbAdminCommand,a=n(7).removeUser,c=n(69).replSetGetStatus,u=n(69).serverStatus,l=n(69).validateCollection;function p(e,t,n){if(!(this instanceof p))return new p(e,t);this.s={db:e,topology:t,promiseLibrary:n}}p.prototype.command=function(e,t,n){const o=Array.prototype.slice.call(arguments,1);return n="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():{},r(this.s.db.s.topology,i.bind(this.s.db),[this.s.db,e,t,n])},p.prototype.buildInfo=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};return r(this.s.db.s.topology,i.bind(this.s.db),[this.s.db,{buildinfo:1},e,t])},p.prototype.serverInfo=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};return r(this.s.db.s.topology,i.bind(this.s.db),[this.s.db,{buildinfo:1},e,t])},p.prototype.serverStatus=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},r(this.s.db.s.topology,u,[this,e,t])},p.prototype.ping=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};return r(this.s.db.s.topology,i.bind(this.s.db),[this.s.db,{ping:1},e,t])},p.prototype.addUser=function(e,t,n,i){const a=Array.prototype.slice.call(arguments,2);return i="function"==typeof a[a.length-1]?a.pop():void 0,n=a.length?a.shift():{},n=Object.assign({},n),(n=o(n,{db:this.s.db})).dbName="admin",r(this.s.db.s.topology,s,[this.s.db,e,t,n,i])},p.prototype.removeUser=function(e,t,n){const s=Array.prototype.slice.call(arguments,1);return n="function"==typeof s[s.length-1]?s.pop():void 0,t=s.length?s.shift():{},t=Object.assign({},t),(t=o(t,{db:this.s.db})).dbName="admin",r(this.s.db.s.topology,a,[this.s.db,e,t,n])},p.prototype.validateCollection=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},r(this.s.db.s.topology,l,[this,e,t,n])},p.prototype.listDatabases=function(e,t){"function"==typeof e&&(t=e,e={});const n={listDatabases:1};return(e=e||{}).nameOnly&&(n.nameOnly=Number(n.nameOnly)),r(this.s.db.s.topology,i.bind(this.s.db),[this.s.db,n,e,t])},p.prototype.replSetGetStatus=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},r(this.s.db.s.topology,c,[this,e,t])},e.exports=p},function(e,t,n){"use strict";const r=n(29).TopologyBase,o=n(2).MongoError,s=n(2).Mongos,i=n(17),a=n(52),c=n(29).Store,u=n(0).MAX_JS_INT,l=n(0).translateOptions,p=n(0).filterOptions,f=n(0).mergeOptions;var h=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","promiseLibrary","monitorCommands"];class d extends r{constructor(e,t){super();t=p(t=t||{},h);for(var n=0;n<e.length;n++)if(!(e[n]instanceof a))throw o.create({message:"all seed list instances must be of the Server type",driver:!0});var r={force:!1,bufferMaxEntries:"number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:u},d=t.store||new c(this,r),m=e.map(function(e){return{host:e.host,port:e.port}}),y="boolean"!=typeof t.auto_reconnect||t.auto_reconnect;y="boolean"==typeof t.autoReconnect?t.autoReconnect:y;var g=f({},{disconnectHandler:d,cursorFactory:i,reconnect:y,emitError:"boolean"!=typeof t.emitError||t.emitError,size:"number"==typeof t.poolSize?t.poolSize:5,monitorCommands:"boolean"==typeof t.monitorCommands&&t.monitorCommands});g=l(g,t);var b=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;(g=l(g,b)).clientInfo=this.clientInfo,t.appname&&(g.clientInfo.application={name:t.appname}),this.s={coreTopology:new s(m,g),sCapabilities:null,debug:g.debug,storeOptions:r,clonedOptions:g,store:d,options:t,sessionPool:null,sessions:[],promiseLibrary:t.promiseLibrary||Promise}}connect(e,t){var n=this;"function"==typeof e&&(t=e,e={}),null==e&&(e={}),"function"!=typeof t&&(t=null),e=Object.assign({},this.s.clonedOptions,e),n.s.options=e,n.s.storeOptions.bufferMaxEntries="number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:-1;var r=function(){return function(e){["timeout","error","close"].forEach(function(e){n.removeListener(e,r)}),n.s.coreTopology.removeListener("connect",r),n.close(!0);try{t(e)}catch(e){process.nextTick(function(){throw e})}}},o=function(e){return function(t){"error"!==e&&n.emit(e,t)}},s=function(e){return function(t,r){n.emit(e,t,r)}};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach(function(e){n.s.coreTopology.removeAllListeners(e)}),n.s.coreTopology.on("serverDescriptionChanged",s("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",s("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",s("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",s("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",s("serverOpening")),n.s.coreTopology.on("serverClosed",s("serverClosed")),n.s.coreTopology.on("topologyOpening",s("topologyOpening")),n.s.coreTopology.on("topologyClosed",s("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",s("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",s("commandStarted")),n.s.coreTopology.on("commandSucceeded",s("commandSucceeded")),n.s.coreTopology.on("commandFailed",s("commandFailed")),n.s.coreTopology.once("timeout",r("timeout")),n.s.coreTopology.once("error",r("error")),n.s.coreTopology.once("close",r("close")),n.s.coreTopology.once("connect",function(){["timeout","error","close","fullsetup"].forEach(function(e){n.s.coreTopology.removeAllListeners(e)}),n.s.coreTopology.on("timeout",o("timeout")),n.s.coreTopology.on("error",o("error")),n.s.coreTopology.on("close",o("close")),n.s.coreTopology.on("fullsetup",function(){n.emit("fullsetup",n)}),n.emit("open",null,n);try{t(null,n)}catch(e){process.nextTick(function(){throw e})}}),n.s.coreTopology.on("joined",s("joined")),n.s.coreTopology.on("left",s("left")),n.s.coreTopology.on("reconnect",function(){n.emit("reconnect"),n.s.store.execute()}),n.s.coreTopology.connect(e)}}Object.defineProperty(d.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}}),e.exports=d},function(e,t,n){"use strict";const r=n(52),o=n(17),s=n(2).MongoError,i=n(29).TopologyBase,a=n(29).Store,c=n(2).ReplSet,u=n(0).MAX_JS_INT,l=n(0).translateOptions,p=n(0).filterOptions,f=n(0).mergeOptions;var h=["ha","haInterval","replicaSet","rs_name","secondaryAcceptableLatencyMS","connectWithNoPrimary","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCert","ciphers","ecdhCurve","sslCRL","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","strategy","debug","family","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","maxStalenessSeconds","promiseLibrary","minSize","monitorCommands"];class d extends i{constructor(e,t){super();var n=this;t=p(t=t||{},h);for(var i=0;i<e.length;i++)if(!(e[i]instanceof r))throw s.create({message:"all seed list instances must be of the Server type",driver:!0});var d={force:!1,bufferMaxEntries:"number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:u},m=t.store||new a(n,d),y=e.map(function(e){return{host:e.host,port:e.port}}),g=f({},{disconnectHandler:m,cursorFactory:o,reconnect:!1,emitError:"boolean"!=typeof t.emitError||t.emitError,size:"number"==typeof t.poolSize?t.poolSize:5,monitorCommands:"boolean"==typeof t.monitorCommands&&t.monitorCommands});g=l(g,t);var b=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;(g=l(g,b)).clientInfo=this.clientInfo,t.appname&&(g.clientInfo.application={name:t.appname});var v=new c(y,g);v.on("reconnect",function(){n.emit("reconnect"),m.execute()}),this.s={coreTopology:v,sCapabilities:null,tag:t.tag,storeOptions:d,clonedOptions:g,store:m,options:t,sessionPool:null,sessions:[],promiseLibrary:t.promiseLibrary||Promise},g.debug&&Object.defineProperty(this,"replset",{enumerable:!0,get:function(){return v}})}connect(e,t){var n=this;"function"==typeof e&&(t=e,e={}),null==e&&(e={}),"function"!=typeof t&&(t=null),e=Object.assign({},this.s.clonedOptions,e),n.s.options=e,n.s.storeOptions.bufferMaxEntries="number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:-1;var r=function(e){return function(t){"error"!==e&&n.emit(e,t)}};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha"].forEach(function(e){n.s.coreTopology.removeAllListeners(e)});var o=function(e){return function(t,r){n.emit(e,t,r)}};n.s.coreTopology.on("joined",function(e){return function(t,r){n.emit(e,t,r.lastIsMaster(),r)}}("joined")),n.s.coreTopology.on("left",o("left")),n.s.coreTopology.on("ping",o("ping")),n.s.coreTopology.on("ha",function(e,t){n.emit("ha",e,t),"start"===e?n.emit("ha_connect",e,t):"end"===e&&n.emit("ha_ismaster",e,t)}),n.s.coreTopology.on("serverDescriptionChanged",o("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",o("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",o("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",o("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",o("serverOpening")),n.s.coreTopology.on("serverClosed",o("serverClosed")),n.s.coreTopology.on("topologyOpening",o("topologyOpening")),n.s.coreTopology.on("topologyClosed",o("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",o("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",o("commandStarted")),n.s.coreTopology.on("commandSucceeded",o("commandSucceeded")),n.s.coreTopology.on("commandFailed",o("commandFailed")),n.s.coreTopology.on("fullsetup",function(){n.emit("fullsetup",n,n)}),n.s.coreTopology.on("all",function(){n.emit("all",null,n)});var s=function(){return function(e){["timeout","error","close"].forEach(function(e){n.s.coreTopology.removeListener(e,s)}),n.s.coreTopology.removeListener("connect",s),n.s.coreTopology.destroy();try{t(e)}catch(e){n.s.coreTopology.isConnected()||process.nextTick(function(){throw e})}}};n.s.coreTopology.once("timeout",s("timeout")),n.s.coreTopology.once("error",s("error")),n.s.coreTopology.once("close",s("close")),n.s.coreTopology.once("connect",function(){n.s.coreTopology.once("timeout",r("timeout")),n.s.coreTopology.once("error",r("error")),n.s.coreTopology.once("close",r("close")),n.emit("open",null,n);try{t(null,n)}catch(e){process.nextTick(function(){throw e})}}),n.s.coreTopology.connect(e)}close(e){super.close(e),["timeout","error","close","joined","left"].forEach(e=>this.removeAllListeners(e))}}Object.defineProperty(d.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}}),e.exports=d},function(e,t,n){"use strict";var r=n(2).BSON.Binary,o=n(2).BSON.ObjectID,s=n(19).Buffer,i=function(e,t,n){if(!(this instanceof i))return new i(e,t);this.file=e;var a=null==t?{}:t;if(this.writeConcern=n||{w:1},this.objectId=null==a._id?new o:a._id,this.chunkNumber=null==a.n?0:a.n,this.data=new r,"string"==typeof a.data){var c=s.alloc(a.data.length);c.write(a.data,0,a.data.length,"binary"),this.data=new r(c)}else if(Array.isArray(a.data)){c=s.alloc(a.data.length);var u=a.data.join("");c.write(u,0,u.length,"binary"),this.data=new r(c)}else if(a.data&&"Binary"===a.data._bsontype)this.data=a.data;else if(!s.isBuffer(a.data)&&null!=a.data)throw Error("Illegal chunk format");this.internalPosition=0};i.prototype.write=function(e,t){return this.data.write(e,this.internalPosition,e.length,"binary"),this.internalPosition=this.data.length(),null!=t?t(null,this):this},i.prototype.read=function(e){if(e=null==e||0===e?this.length():e,this.length()-this.internalPosition+1>=e){var t=this.data.read(this.internalPosition,e);return this.internalPosition=this.internalPosition+e,t}return""},i.prototype.readSlice=function(e){if(this.length()-this.internalPosition>=e){var t=null;return null!=this.data.buffer?t=this.data.buffer.slice(this.internalPosition,this.internalPosition+e):(t=s.alloc(e),e=this.data.readInto(t,this.internalPosition)),this.internalPosition=this.internalPosition+e,t}return null},i.prototype.eof=function(){return this.internalPosition===this.length()},i.prototype.getc=function(){return this.read(1)},i.prototype.rewind=function(){this.internalPosition=0,this.data=new r},i.prototype.save=function(e,t){var n=this;"function"==typeof e&&(t=e,e={}),n.file.chunkCollection(function(r,o){if(r)return t(r);var s={upsert:!0};for(var i in e)s[i]=e[i];for(i in n.writeConcern)s[i]=n.writeConcern[i];n.data.length()>0?n.buildMongoObject(function(e){var r={forceServerObjectId:!0};for(var i in n.writeConcern)r[i]=n.writeConcern[i];o.replaceOne({_id:n.objectId},e,s,function(e){t(e,n)})}):t(null,n)})},i.prototype.buildMongoObject=function(e){var t={files_id:this.file.fileId,n:this.chunkNumber,data:this.data};null!=this.objectId&&(t._id=this.objectId),e(t)},i.prototype.length=function(){return this.data.length()},Object.defineProperty(i.prototype,"position",{enumerable:!0,get:function(){return this.internalPosition},set:function(e){this.internalPosition=e}}),i.DEFAULT_CHUNK_SIZE=261120,e.exports=i},function(e,t){function n(){if(!(this instanceof n))return new n;this._bsontype="MinKey"}e.exports=n,e.exports.MinKey=n},function(e,t,n){if("undefined"!=typeof global)var r=n(59).Buffer;function o(e,t){if(!(this instanceof o))return new o(e,t);if(!(null==e||"string"==typeof e||r.isBuffer(e)||e instanceof Uint8Array||Array.isArray(e)))throw new Error("only String, Buffer, Uint8Array or Array accepted");if(this._bsontype="Binary",e instanceof Number?(this.sub_type=e,this.position=0):(this.sub_type=null==t?s:t,this.position=0),null==e||e instanceof Number)void 0!==r?this.buffer=new r(o.BUFFER_SIZE):"undefined"!=typeof Uint8Array?this.buffer=new Uint8Array(new ArrayBuffer(o.BUFFER_SIZE)):this.buffer=new Array(o.BUFFER_SIZE),this.position=0;else{if("string"==typeof e)if(void 0!==r)this.buffer=new r(e);else{if("undefined"==typeof Uint8Array&&"[object Array]"!==Object.prototype.toString.call(e))throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=i(e)}else this.buffer=e;this.position=e.length}}o.prototype.put=function(e){if(null!=e.length&&"number"!=typeof e&&1!==e.length)throw new Error("only accepts single character String, Uint8Array or Array");if("number"!=typeof e&&e<0||e>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var t=null;if(t="string"==typeof e?e.charCodeAt(0):null!=e.length?e[0]:e,this.buffer.length>this.position)this.buffer[this.position++]=t;else if(void 0!==r&&r.isBuffer(this.buffer)){var n=new r(o.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=t}else{n=null,n="[object Uint8Array]"===Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(o.BUFFER_SIZE+this.buffer.length)):new Array(o.BUFFER_SIZE+this.buffer.length);for(var s=0;s<this.buffer.length;s++)n[s]=this.buffer[s];this.buffer=n,this.buffer[this.position++]=t}},o.prototype.write=function(e,t){if(t="number"==typeof t?t:this.position,this.buffer.length<t+e.length){var n=null;if(void 0!==r&&r.isBuffer(this.buffer))n=new r(this.buffer.length+e.length),this.buffer.copy(n,0,0,this.buffer.length);else if("[object Uint8Array]"===Object.prototype.toString.call(this.buffer)){n=new Uint8Array(new ArrayBuffer(this.buffer.length+e.length));for(var o=0;o<this.position;o++)n[o]=this.buffer[o]}this.buffer=n}if(void 0!==r&&r.isBuffer(e)&&r.isBuffer(this.buffer))e.copy(this.buffer,t,0,e.length),this.position=t+e.length>this.position?t+e.length:this.position;else if(void 0!==r&&"string"==typeof e&&r.isBuffer(this.buffer))this.buffer.write(e,t,"binary"),this.position=t+e.length>this.position?t+e.length:this.position;else if("[object Uint8Array]"===Object.prototype.toString.call(e)||"[object Array]"===Object.prototype.toString.call(e)&&"string"!=typeof e){for(o=0;o<e.length;o++)this.buffer[t++]=e[o];this.position=t>this.position?t:this.position}else if("string"==typeof e){for(o=0;o<e.length;o++)this.buffer[t++]=e.charCodeAt(o);this.position=t>this.position?t:this.position}},o.prototype.read=function(e,t){if(t=t&&t>0?t:this.position,this.buffer.slice)return this.buffer.slice(e,e+t);for(var n="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t)):new Array(t),r=0;r<t;r++)n[r]=this.buffer[e++];return n},o.prototype.value=function(e){if((e=null!=e&&e)&&void 0!==r&&r.isBuffer(this.buffer)&&this.buffer.length===this.position)return this.buffer;if(void 0!==r&&r.isBuffer(this.buffer))return e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(e){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var t="[object Uint8Array]"===Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),n=0;n<this.position;n++)t[n]=this.buffer[n];return t}return a(this.buffer,0,this.position)},o.prototype.length=function(){return this.position},o.prototype.toJSON=function(){return null!=this.buffer?this.buffer.toString("base64"):""},o.prototype.toString=function(e){return null!=this.buffer?this.buffer.slice(0,this.position).toString(e):""};var s=0,i=function(e){for(var t="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t},a=function(e,t,n){for(var r="",o=t;o<n;o++)r+=String.fromCharCode(e[o]);return r};o.BUFFER_SIZE=256,o.SUBTYPE_DEFAULT=0,o.SUBTYPE_FUNCTION=1,o.SUBTYPE_BYTE_ARRAY=2,o.SUBTYPE_UUID_OLD=3,o.SUBTYPE_UUID=4,o.SUBTYPE_MD5=5,o.SUBTYPE_USER_DEFINED=128,e.exports=o,e.exports.Binary=o},function(e,t,n){"use strict";const r=n(8).buildCountCommand,o=n(5).formattedOrderClause,s=n(5).handleCallback,i=n(6).MongoError,a=Array.prototype.push;function c(e,t){if(0!==e.bufferedCount())return e._next(t),c}function u(e,t){const r=n(36);if(e.s.state===r.CLOSED||e.isDead&&e.isDead())return s(t,i.create({message:"Cursor is closed",driver:!0}));if(e.s.state===r.INIT&&e.s.cmd.sort)try{e.s.cmd.sort=o(e.s.cmd.sort)}catch(e){return s(t,e)}e._next((n,o)=>{if(e.s.state=r.OPEN,n)return s(t,n);s(t,null,o)})}e.exports={count:function(e,t,n,o){t&&("number"==typeof e.cursorSkip()&&(n.skip=e.cursorSkip()),"number"==typeof e.cursorLimit()&&(n.limit=e.cursorLimit())),n.readPreference&&e.setReadPreference(n.readPreference),"number"!=typeof n.maxTimeMS&&e.s.cmd&&"number"==typeof e.s.cmd.maxTimeMS&&(n.maxTimeMS=e.s.cmd.maxTimeMS);let s={};s.skip=n.skip,s.limit=n.limit,s.hint=n.hint,s.maxTimeMS=n.maxTimeMS;const i=e.s.ns.indexOf(".");let a;s.collectionName=e.s.ns.substr(i+1);try{a=r(e,e.s.cmd.query,s)}catch(e){return o(e)}e.server=e.topology.s.coreTopology,e.s.topology.command(`${e.s.ns.substr(0,i)}.$cmd`,a,e.s.options,(e,t)=>{o(e,t?t.result.n:null)})},each:function e(t,r){const o=n(36);if(!r)throw i.create({message:"callback is mandatory",driver:!0});if(t.isNotified())return;if(t.s.state===o.CLOSED||t.isDead())return s(r,i.create({message:"Cursor is closed",driver:!0}));t.s.state===o.INIT&&(t.s.state=o.OPEN);let a=null;if(t.bufferedCount()>0){for(;a=c(t,r);)a(t,r);e(t,r)}else t.next((n,o)=>n?s(r,n):null==o?t.close({skipKillCursors:!0},()=>s(r,null,null)):void(!1!==s(r,null,o)&&e(t,r)))},hasNext:function(e,t){const r=n(36);return e.s.currentDoc?t(null,!0):e.isNotified()?t(null,!1):void u(e,(n,o)=>n?t(n,null):e.s.state===r.CLOSED||e.isDead()?t(null,!1):o?(e.s.currentDoc=o,void t(null,!0)):t(null,!1))},next:function(e,t){if(e.s.currentDoc){const n=e.s.currentDoc;return e.s.currentDoc=null,t(null,n)}u(e,t)},toArray:function(e,t){const r=n(36),o=[];e.rewind(),e.s.state=r.INIT;const i=()=>{e._next((n,r)=>{if(n)return e._endSession?e._endSession(()=>s(t,n)):s(t,n);if(null==r)return e.close({skipKillCursors:!0},()=>s(t,null,o));if(o.push(r),e.bufferedCount()>0){let t=e.readBufferedDocuments(e.bufferedCount());e.s.transforms&&"function"==typeof e.s.transforms.doc&&(t=t.map(e.s.transforms.doc)),a.apply(o,t)}i()})};i()}}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=require("module")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("tls")},function(e,t){e.exports=require("zlib")},function(e,t){e.exports=require("querystring")},function(e,t,n){"use strict";e.exports={uri:"mongodb+srv://zeuslawyer:!!Zubster2000@visijam-db-jfc5t.mongodb.net/visiJAM-DB?retryWrites=true",URI:"mongodb+srv://teamAccess:getMeTheDb007@visijam-db-jfc5t.mongodb.net/visiJAM-DB?retryWrites=true"}},function(e,t){function n(e){if(!(this instanceof n))return new n(e);this._bsontype="Double",this.value=e}n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},e.exports=n,e.exports.Double=n},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this._bsontype="Timestamp",this.low_=0|e,this.high_=0|t}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var r=n.fromNumber(t),o=this.div(r),s=o.multiply(r).subtract(this);return o.toString(t)+s.toInt().toString(t)}return"-"+this.negate().toString(t)}var i=n.fromNumber(Math.pow(t,6));s=this;for(var a="";!s.isZero();){var c=s.div(i),u=s.subtract(c.multiply(i)).toInt().toString(t);if((s=c).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!==this.high_?this.high_:this.low_,t=31;t>0&&0==(e&1<<t);t--);return 0!==this.high_?t+33:t+1},n.prototype.isZero=function(){return 0===this.high_&&0===this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_},n.prototype.notEquals=function(e){return this.high_!==e.high_||this.low_!==e.low_},n.prototype.lessThan=function(e){return this.compare(e)<0},n.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},n.prototype.greaterThan=function(e){return this.compare(e)>0},n.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},n.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(e){var t=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,s=65535&this.low_,i=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,u=0,l=0,p=0,f=0;return p+=(f+=s+(65535&e.low_))>>>16,f&=65535,l+=(p+=o+c)>>>16,p&=65535,u+=(l+=r+a)>>>16,l&=65535,u+=t+i,u&=65535,n.fromBits(p<<16|f,u<<16|l)},n.prototype.subtract=function(e){return this.add(e.negate())},n.prototype.multiply=function(e){if(this.isZero())return n.ZERO;if(e.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return e.isOdd()?n.MIN_VALUE:n.ZERO;if(e.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&e.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,s=65535&this.low_,i=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,u=65535&e.low_,l=0,p=0,f=0,h=0;return f+=(h+=s*u)>>>16,h&=65535,p+=(f+=o*u)>>>16,f&=65535,p+=(f+=s*c)>>>16,f&=65535,l+=(p+=r*u)>>>16,p&=65535,l+=(p+=o*c)>>>16,p&=65535,l+=(p+=s*a)>>>16,p&=65535,l+=t*u+r*c+o*a+s*i,l&=65535,n.fromBits(f<<16|h,l<<16|p)},n.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(e.equals(n.ONE)||e.equals(n.NEG_ONE))return n.MIN_VALUE;if(e.equals(n.MIN_VALUE))return n.ONE;var t=this.shiftRight(1).div(e).shiftLeft(1);if(t.equals(n.ZERO))return e.isNegative()?n.ONE:n.NEG_ONE;var r=this.subtract(e.multiply(t));return t.add(r.div(e))}if(e.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var o=n.ZERO;for(r=this;r.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(t)/Math.LN2),i=s<=48?1:Math.pow(2,s-48),a=n.fromNumber(t),c=a.multiply(e);c.isNegative()||c.greaterThan(r);)t-=i,c=(a=n.fromNumber(t)).multiply(e);a.isZero()&&(a=n.ONE),o=o.add(a),r=r.subtract(c)}return o},n.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(e){return n.fromBits(this.low_&e.low_,this.high_&e.high_)},n.prototype.or=function(e){return n.fromBits(this.low_|e.low_,this.high_|e.high_)},n.prototype.xor=function(e){return n.fromBits(this.low_^e.low_,this.high_^e.high_)},n.prototype.shiftLeft=function(e){if(0===(e&=63))return this;var t=this.low_;if(e<32){var r=this.high_;return n.fromBits(t<<e,r<<e|t>>>32-e)}return n.fromBits(0,t<<e-32)},n.prototype.shiftRight=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var r=this.low_;return n.fromBits(r>>>e|t<<32-e,t>>e)}return n.fromBits(t>>e-32,t>=0?0:-1)},n.prototype.shiftRightUnsigned=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var r=this.low_;return n.fromBits(r>>>e|t<<32-e,t>>>e)}return 32===e?n.fromBits(t,0):n.fromBits(t>>>e-32,0)},n.fromInt=function(e){if(-128<=e&&e<128){var t=n.INT_CACHE_[e];if(t)return t}var r=new n(0|e,e<0?-1:0);return-128<=e&&e<128&&(n.INT_CACHE_[e]=r),r},n.fromNumber=function(e){return isNaN(e)||!isFinite(e)?n.ZERO:e<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:e+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:e<0?n.fromNumber(-e).negate():new n(e%n.TWO_PWR_32_DBL_|0,e/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(e,t){return new n(e,t)},n.fromString=function(e,t){if(0===e.length)throw Error("number format error: empty string");var r=t||10;if(r<2||36<r)throw Error("radix out of range: "+r);if("-"===e.charAt(0))return n.fromString(e.substring(1),r).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var o=n.fromNumber(Math.pow(r,8)),s=n.ZERO,i=0;i<e.length;i+=8){var a=Math.min(8,e.length-i),c=parseInt(e.substring(i,i+a),r);if(a<8){var u=n.fromNumber(Math.pow(r,a));s=s.multiply(u).add(n.fromNumber(c))}else s=(s=s.multiply(o)).add(n.fromNumber(c))}return s},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),e.exports=n,e.exports.Timestamp=n},function(e,t,n){var r="inspect",o=parseInt(16777215*Math.random(),10),s=new RegExp("^[0-9a-fA-F]{24}$");try{if(Buffer&&Buffer.from){var i=!0;r=n(1).inspect.custom||"inspect"}}catch(e){i=!1}for(var a=function e(t){if(t instanceof e)return t;if(!(this instanceof e))return new e(t);if(this._bsontype="ObjectID",null==t||"number"==typeof t)return this.id=this.generate(t),void(e.cacheHexString&&(this.__id=this.toString("hex")));var n=e.isValid(t);if(!n&&null!=t)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(n&&"string"==typeof t&&24===t.length&&i)return new e(new Buffer(t,"hex"));if(n&&"string"==typeof t&&24===t.length)return e.createFromHexString(t);if(null==t||12!==t.length){if(null!=t&&t.toHexString)return t;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=t,e.cacheHexString&&(this.__id=this.toString("hex"))},c=[],u=0;u<256;u++)c[u]=(u<=15?"0":"")+u.toString(16);a.prototype.toHexString=function(){if(a.cacheHexString&&this.__id)return this.__id;var e="";if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id instanceof p)return e=f(this.id),a.cacheHexString&&(this.__id=e),e;for(var t=0;t<this.id.length;t++)e+=c[this.id.charCodeAt(t)];return a.cacheHexString&&(this.__id=e),e},a.prototype.get_inc=function(){return a.index=(a.index+1)%16777215},a.prototype.getInc=function(){return this.get_inc()},a.prototype.generate=function(e){"number"!=typeof e&&(e=~~(Date.now()/1e3));var t=("undefined"==typeof process||1===process.pid?Math.floor(1e5*Math.random()):process.pid)%65535,n=this.get_inc(),r=new Buffer(12);return r[3]=255&e,r[2]=e>>8&255,r[1]=e>>16&255,r[0]=e>>24&255,r[6]=255&o,r[5]=o>>8&255,r[4]=o>>16&255,r[8]=255&t,r[7]=t>>8&255,r[11]=255&n,r[10]=n>>8&255,r[9]=n>>16&255,r},a.prototype.toString=function(e){return this.id&&this.id.copy?this.id.toString("string"==typeof e?e:"hex"):this.toHexString()},a.prototype[r]=a.prototype.toString,a.prototype.toJSON=function(){return this.toHexString()},a.prototype.equals=function(e){return e instanceof a?this.toString()===e.toString():"string"==typeof e&&a.isValid(e)&&12===e.length&&this.id instanceof p?e===this.id.toString("binary"):"string"==typeof e&&a.isValid(e)&&24===e.length?e.toLowerCase()===this.toHexString():"string"==typeof e&&a.isValid(e)&&12===e.length?e===this.id:!(null==e||!(e instanceof a||e.toHexString))&&e.toHexString()===this.toHexString()},a.prototype.getTimestamp=function(){var e=new Date,t=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24;return e.setTime(1e3*Math.floor(t)),e},a.index=~~(16777215*Math.random()),a.createPk=function(){return new a},a.createFromTime=function(e){var t=new Buffer([0,0,0,0,0,0,0,0,0,0,0,0]);return t[3]=255&e,t[2]=e>>8&255,t[1]=e>>16&255,t[0]=e>>24&255,new a(t)};var l=[];for(u=0;u<10;)l[48+u]=u++;for(;u<16;)l[55+u]=l[87+u]=u++;var p=Buffer,f=function(e){return e.toString("hex")};a.createFromHexString=function(e){if(void 0===e||null!=e&&24!==e.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(i)return new a(new Buffer(e,"hex"));for(var t=new p(12),n=0,r=0;r<24;)t[n++]=l[e.charCodeAt(r++)]<<4|l[e.charCodeAt(r++)];return new a(t)},a.isValid=function(e){return null!=e&&("number"==typeof e||("string"==typeof e?12===e.length||24===e.length&&s.test(e):e instanceof a||(e instanceof p||!!e.toHexString&&(12===e.id.length||24===e.id.length&&s.test(e.id)))))},Object.defineProperty(a.prototype,"generationTime",{enumerable:!0,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(e){this.id[3]=255&e,this.id[2]=e>>8&255,this.id[1]=e>>16&255,this.id[0]=e>>24&255}}),e.exports=a,e.exports.ObjectID=a,e.exports.ObjectId=a},function(e,t){function n(e,t){if(!(this instanceof n))return new n;this._bsontype="BSONRegExp",this.pattern=e||"",this.options=t||"";for(var r=0;r<this.options.length;r++)if("i"!==this.options[r]&&"m"!==this.options[r]&&"x"!==this.options[r]&&"l"!==this.options[r]&&"s"!==this.options[r]&&"u"!==this.options[r])throw new Error("the regular expression options ["+this.options[r]+"] is not supported")}e.exports=n,e.exports.BSONRegExp=n},function(e,t,n){var r=Buffer&&n(1).inspect.custom||"inspect";function o(e){if(!(this instanceof o))return new o(e);this._bsontype="Symbol",this.value=e}o.prototype.valueOf=function(){return this.value},o.prototype.toString=function(){return this.value},o.prototype[r]=function(){return this.value},o.prototype.toJSON=function(){return this.value},e.exports=o,e.exports.Symbol=o},function(e,t){var n=function e(t,n){if(!(this instanceof e))return new e(t,n);this._bsontype="Code",this.code=t,this.scope=n};n.prototype.toJSON=function(){return{scope:this.scope,code:this.code}},e.exports=n,e.exports.Code=n},function(e,t,n){"use strict";var r=n(71),o=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,s=/^(\+|-)?(Infinity|inf)$/i,i=/^(\+|-)?NaN$/i,a=6176,c=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),u=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),l=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),p=/^([-+])?(\d+)?$/,f=function(e){return!isNaN(parseInt(e,10))},h=function(e){var t=r.fromNumber(1e9),n=r.fromNumber(0),o=0;if(!(e.parts[0]||e.parts[1]||e.parts[2]||e.parts[3]))return{quotient:e,rem:n};for(o=0;o<=3;o++)n=(n=n.shiftLeft(32)).add(new r(e.parts[o],0)),e.parts[o]=n.div(t).low_,n=n.modulo(t);return{quotient:e,rem:n}},d=function(e){this._bsontype="Decimal128",this.bytes=e};d.fromString=function(e){var t,n=!1,h=!1,m=!1,y=0,g=0,b=0,v=0,S=0,w=[0],O=0,_=0,T=0,C=0,E=0,N=0,I=[0,0],x=[0,0],A=0;if((e=e.trim()).length>=7e3)throw new Error(e+" not a valid Decimal128 string");var k=e.match(o),B=e.match(s),M=e.match(i);if(!k&&!B&&!M||0===e.length)throw new Error(e+" not a valid Decimal128 string");if(k&&k[4]&&void 0===k[2])throw new Error(e+" not a valid Decimal128 string");if("+"!==e[A]&&"-"!==e[A]||(n="-"===e[A++]),!f(e[A])&&"."!==e[A]){if("i"===e[A]||"I"===e[A])return new d(new Buffer(n?u:l));if("N"===e[A])return new d(new Buffer(c))}for(;f(e[A])||"."===e[A];)if("."!==e[A])O<34&&("0"!==e[A]||m)&&(m||(S=g),m=!0,w[_++]=parseInt(e[A],10),O+=1),m&&(b+=1),h&&(v+=1),g+=1,A+=1;else{if(h)return new d(new Buffer(c));h=!0,A+=1}if(h&&!g)throw new Error(e+" not a valid Decimal128 string");if("e"===e[A]||"E"===e[A]){var D=e.substr(++A).match(p);if(!D||!D[2])return new d(new Buffer(c));E=parseInt(D[0],10),A+=D[0].length}if(e[A])return new d(new Buffer(c));if(T=0,O){if(C=O-1,y=b,0!==E&&1!==y)for(;"0"===e[S+y-1];)y-=1}else T=0,C=0,w[0]=0,b=1,O=1,y=0;for(E<=v&&v-E>16384?E=-6176:E-=v;E>6111;){if((C+=1)-T>34){var R=w.join("");if(R.match(/^0+$/)){E=6111;break}return new d(new Buffer(n?u:l))}E-=1}for(;E<-6176||O<b;){if(0===C){E=-6176,y=0;break}if(O<b?b-=1:C-=1,!(E<6111)){if((R=w.join("")).match(/^0+$/)){E=6111;break}return new d(new Buffer(n?u:l))}E+=1}if(C-T+1<y&&"0"!==e[y]){var P=g;h&&-6176===E&&(S+=1,P+=1);var L=parseInt(e[S+C+1],10),j=0;if(L>=5&&(j=1,5===L))for(j=w[C]%2==1,N=S+C+2;N<P;N++)if(parseInt(e[N],10)){j=1;break}if(j)for(var U=C;U>=0&&++w[U]>9;U--)if(w[U]=0,0===U){if(!(E<6111))return new d(new Buffer(n?u:l));E+=1,w[U]=1}}if(I=r.fromNumber(0),x=r.fromNumber(0),0===y)I=r.fromNumber(0),x=r.fromNumber(0);else if(C-T<17)for(U=T,x=r.fromNumber(w[U++]),I=new r(0,0);U<=C;U++)x=(x=x.multiply(r.fromNumber(10))).add(r.fromNumber(w[U]));else{for(U=T,I=r.fromNumber(w[U++]);U<=C-17;U++)I=(I=I.multiply(r.fromNumber(10))).add(r.fromNumber(w[U]));for(x=r.fromNumber(w[U++]);U<=C;U++)x=(x=x.multiply(r.fromNumber(10))).add(r.fromNumber(w[U]))}var z=function(e,t){if(!e&&!t)return{high:r.fromNumber(0),low:r.fromNumber(0)};var n=e.shiftRightUnsigned(32),o=new r(e.getLowBits(),0),s=t.shiftRightUnsigned(32),i=new r(t.getLowBits(),0),a=n.multiply(s),c=n.multiply(i),u=o.multiply(s),l=o.multiply(i);return a=a.add(c.shiftRightUnsigned(32)),c=new r(c.getLowBits(),0).add(u).add(l.shiftRightUnsigned(32)),{high:a=a.add(c.shiftRightUnsigned(32)),low:l=c.shiftLeft(32).add(new r(l.getLowBits(),0))}}(I,r.fromString("100000000000000000"));z.low=z.low.add(x),function(e,t){var n=e.high_>>>0,r=t.high_>>>0;return n<r||n===r&&e.low_>>>0<t.low_>>>0}(z.low,x)&&(z.high=z.high.add(r.fromNumber(1))),t=E+a;var q={low:r.fromNumber(0),high:r.fromNumber(0)};z.high.shiftRightUnsigned(49).and(r.fromNumber(1)).equals(r.fromNumber)?(q.high=q.high.or(r.fromNumber(3).shiftLeft(61)),q.high=q.high.or(r.fromNumber(t).and(r.fromNumber(16383).shiftLeft(47))),q.high=q.high.or(z.high.and(r.fromNumber(0x7fffffffffff)))):(q.high=q.high.or(r.fromNumber(16383&t).shiftLeft(49)),q.high=q.high.or(z.high.and(r.fromNumber(562949953421311)))),q.low=z.low,n&&(q.high=q.high.or(r.fromString("9223372036854775808")));var $=new Buffer(16);return A=0,$[A++]=255&q.low.low_,$[A++]=q.low.low_>>8&255,$[A++]=q.low.low_>>16&255,$[A++]=q.low.low_>>24&255,$[A++]=255&q.low.high_,$[A++]=q.low.high_>>8&255,$[A++]=q.low.high_>>16&255,$[A++]=q.low.high_>>24&255,$[A++]=255&q.high.low_,$[A++]=q.high.low_>>8&255,$[A++]=q.high.low_>>16&255,$[A++]=q.high.low_>>24&255,$[A++]=255&q.high.high_,$[A++]=q.high.high_>>8&255,$[A++]=q.high.high_>>16&255,$[A++]=q.high.high_>>24&255,new d($)};a=6176,d.prototype.toString=function(){for(var e,t,n,o,s,i,c=0,u=new Array(36),l=0;l<u.length;l++)u[l]=0;var p,f,d,m,y,g=0,b=!1,v={parts:new Array(4)},S=[];g=0;var w=this.bytes;if(o=w[g++]|w[g++]<<8|w[g++]<<16|w[g++]<<24,n=w[g++]|w[g++]<<8|w[g++]<<16|w[g++]<<24,t=w[g++]|w[g++]<<8|w[g++]<<16|w[g++]<<24,e=w[g++]|w[g++]<<8|w[g++]<<16|w[g++]<<24,g=0,{low:new r(o,n),high:new r(t,e)}.high.lessThan(r.ZERO)&&S.push("-"),(s=e>>26&31)>>3==3){if(30===s)return S.join("")+"Infinity";if(31===s)return"NaN";i=e>>15&16383,d=8+(e>>14&1)}else d=e>>14&7,i=e>>17&16383;if(p=i-a,v.parts[0]=(16383&e)+((15&d)<<14),v.parts[1]=t,v.parts[2]=n,v.parts[3]=o,0===v.parts[0]&&0===v.parts[1]&&0===v.parts[2]&&0===v.parts[3])b=!0;else for(y=3;y>=0;y--){var O=0,_=h(v);if(v=_.quotient,O=_.rem.low_)for(m=8;m>=0;m--)u[9*y+m]=O%10,O=Math.floor(O/10)}if(b)c=1,u[g]=0;else for(c=36,l=0;!u[g];)l++,c-=1,g+=1;if((f=c-1+p)>=34||f<=-7||p>0){for(S.push(u[g++]),(c-=1)&&S.push("."),l=0;l<c;l++)S.push(u[g++]);S.push("E"),f>0?S.push("+"+f):S.push(f)}else if(p>=0)for(l=0;l<c;l++)S.push(u[g++]);else{var T=c+p;if(T>0)for(l=0;l<T;l++)S.push(u[g++]);else S.push("0");for(S.push(".");T++<0;)S.push("0");for(l=0;l<c-Math.max(T-1,0);l++)S.push(u[g++])}return S.join("")},d.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.exports=d,e.exports.Decimal128=d},function(e,t){function n(){if(!(this instanceof n))return new n;this._bsontype="MaxKey"}e.exports=n,e.exports.MaxKey=n},function(e,t){function n(e,t,r){if(!(this instanceof n))return new n(e,t,r);this._bsontype="DBRef",this.namespace=e,this.oid=t,this.db=r}n.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:null==this.db?"":this.db}},e.exports=n,e.exports.DBRef=n},function(e,t,n){"use strict";var r=n(25).retrieveSnappy(),o=n(95),s={snappy:1,zlib:2};e.exports={compressorIDs:s,uncompressibleCommands:["ismaster","saslStart","saslContinue","getnonce","authenticate","createUser","updateUser","copydbSaslStart","copydbgetnonce","copydb"],compress:function(e,t,n){switch(e.options.agreedCompressor){case"snappy":r.compress(t,n);break;case"zlib":var s={};e.options.zlibCompressionLevel&&(s.level=e.options.zlibCompressionLevel),o.deflate(t,s,n);break;default:throw new Error('Attempt to compress message using unknown compressor "'+e.options.agreedCompressor+'".')}},decompress:function(e,t,n){if(e<0||e>s.length)throw new Error("Server sent message compressed using an unsupported compressor. (Received compressor ID "+e+")");switch(e){case s.snappy:r.uncompress(t,n);break;case s.zlib:o.inflate(t,n);break;default:n(null,t)}}}},function(e,t,n){"use strict";const r=n(162),o=n(163),s=n(164),i=n(165),a=n(188),c=n(109).ScramSHA1,u=n(109).ScramSHA256;e.exports={defaultAuthProviders:function(e){return{mongocr:new r(e),x509:new o(e),plain:new s(e),gssapi:new i(e),sspi:new a(e),"scram-sha-1":new c(e),"scram-sha-256":new u(e)}}}},function(e,t,n){"use strict";var r=n(1).format,o=n(18),s=n(25).retrieveBSON,i=n(24).Query,a=n(11).MongoError,c=n(53).Buffer;let u;try{u=n(189)}catch(e){}var l=s().Binary,p=function(e,t,n){this.db=e,this.username=t,this.password=n};p.prototype.equal=function(e){return e.db===this.db&&e.username===this.username&&e.password===this.password};var f=0,h=function(e,t){this.bson=e,this.authStore=[],this.id=f++,this.cryptoMethod=t||"sha1"};function d(e,t,n){return o.createHmac(e,t).update(n).digest()}var m={},y=0,g=function(){m={},y=0};const b={sha256:32,sha1:20};h.prototype.auth=function(e,t,n,s,f,h){var S=this,w=t.length;if(0===w)return h(null,null);var O=0,_=null;const T=this.cryptoMethod;let C,E="SCRAM-SHA-1";if("sha256"===T){E="SCRAM-SHA-256";let t=e.s&&e.s.saslprep||u;t?C=t(f):(console.warn("Warning: no saslprep library specified. Passwords will not be sanitized"),C=f)}else C=function(e,t){if("string"!=typeof e)throw new a("username must be a string");if("string"!=typeof t)throw new a("password must be a string");if(0===t.length)throw new a("password cannot be empty");var n=o.createHash("md5");return n.update(e+":mongo:"+t,"utf8"),n.digest("hex")}(s,f);for(var N=function(t){s=s.replace("=","=3D").replace(",","=2C");var u=o.randomBytes(24).toString("base64");const N=c.concat([c.from("n=","utf8"),c.from(s,"utf8"),c.from(",r=","utf8"),c.from(u,"utf8")]);var I={saslStart:1,mechanism:E,payload:new l(c.concat([c.from("n,,","utf8"),N])),autoAuthorize:1},x=function(e,t){return e?(O-=1,_=e,!1):t.result.$err?(_=t.result,!1):t.result.errmsg?(_=t.result,!1):(O+=1,!0)},A=function(e,t){x(e,t),function(e,t){0===e&&t>0?(v(S.authStore,new p(n,s,f)),h(null,!0)):0===e&&(null==_&&(_=new a(r("failed to authenticate using scram"))),h(_,!1))}(w-=1,O)};e(t,new i(S.bson,r("%s.$cmd",n),I,{numberToSkip:0,numberToReturn:1}),function(u,E){if(!1===x(u,E))return 0===(w-=1)&&O>0?(v(S.authStore,new p(n,s,f)),h(null,!0)):0===w?(null==_&&(_=new a(r("failed to authenticate using scram"))),h(_,!1)):void 0;var I=function(e){for(var t={},n=e.split(","),r=0;r<n.length;r++){var o=n[r].split("=");t[o[0]]=o[1]}return t}(E.result.payload.value()),k=parseInt(I.i,10),B=I.s,M=I.r,D=r("c=biws,r=%s",M),R=function(e,t,n,r){const s=[e,t.toString("base64"),n].join("_");if(void 0!==m[s])return m[s];const i=o.pbkdf2Sync(e,t,n,b[r],r);return y>=200&&g(),m[s]=i,y+=1,i}(C,c.from(B,"base64"),k,T);if(k&&k<4096){const e=new a(`Server returned an invalid iteration count ${k}`);return h(e,!1)}const P=d(T,R,"Client Key"),L=function(e,t){return o.createHash(e).update(t).digest()}(T,P),j=[N,E.result.payload.value().toString("base64"),D].join(","),U=d(T,L,j),z=[D,r("p=%s",function(e,t){c.isBuffer(e)||(e=c.from(e)),c.isBuffer(t)||(t=c.from(t));const n=Math.max(e.length,t.length),r=[];for(let o=0;o<n;o+=1)r.push(e[o]^t[o]);return c.from(r).toString("base64")}(P,U))].join(","),q={saslContinue:1,conversationId:E.result.conversationId,payload:new l(c.from(z))};e(t,new i(S.bson,r("%s.$cmd",n),q,{numberToSkip:0,numberToReturn:1}),function(o,s){if(s&&!1===s.result.done){var a={saslContinue:1,conversationId:s.result.conversationId,payload:c.alloc(0)};e(t,new i(S.bson,r("%s.$cmd",n),a,{numberToSkip:0,numberToReturn:1}),function(e,t){A(e,t)})}else A(o,s)})})},I=function(e){process.nextTick(function(){N(e)})};t.length>0;)I(t.shift())};var v=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};h.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!==e})},h.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var s=0;s<r.length;s++)this.auth(e,t,r[s].db,r[s].username,r[s].password,function(e){0===(o-=1)&&n(e,null)})};e.exports={ScramSHA1:class extends h{constructor(e){super(e,"sha1")}},ScramSHA256:class extends h{constructor(e){super(e,"sha256")}}}},function(e,t,n){"use strict";const r=n(56),o=n(25).retrieveBSON,s=n(11).MongoError,i=n(11).MongoNetworkError,a=n(11).mongoErrorContextSymbol,c=n(1).format,u=n(35).collationNotSupported;var l=o().Long,p=function(e,t,n,o,s,i){o=o||{},this.pool=null,this.server=null,this.disconnectHandler=o.disconnectHandler,this.bson=e,this.ns=t,this.cmd=n,this.options=o,this.topology=s,this.cursorState={cursorId:null,cmd:n,documents:o.documents||[],cursorIndex:0,dead:!1,killed:!1,init:!1,notified:!1,limit:o.limit||n.limit||0,skip:o.skip||n.skip||0,batchSize:o.batchSize||n.batchSize||1e3,currentLimit:0,transforms:o.transforms},"object"==typeof o.session&&(this.cursorState.session=o.session),"boolean"==typeof i.promoteLongs?this.cursorState.promoteLongs=i.promoteLongs:"boolean"==typeof o.promoteLongs&&(this.cursorState.promoteLongs=o.promoteLongs),"boolean"==typeof i.promoteValues?this.cursorState.promoteValues=i.promoteValues:"boolean"==typeof o.promoteValues&&(this.cursorState.promoteValues=o.promoteValues),"boolean"==typeof i.promoteBuffers?this.cursorState.promoteBuffers=i.promoteBuffers:"boolean"==typeof o.promoteBuffers&&(this.cursorState.promoteBuffers=o.promoteBuffers),i.reconnect&&(this.cursorState.reconnect=i.reconnect),this.logger=r("Cursor",i),"number"==typeof n?(this.cursorState.cursorId=l.fromNumber(n),this.cursorState.lastCursorId=this.cursorState.cursorId):n instanceof l&&(this.cursorState.cursorId=n,this.cursorState.lastCursorId=n)};p.prototype.setCursorBatchSize=function(e){this.cursorState.batchSize=e},p.prototype.cursorBatchSize=function(){return this.cursorState.batchSize},p.prototype.setCursorLimit=function(e){this.cursorState.limit=e},p.prototype.cursorLimit=function(){return this.cursorState.limit},p.prototype.setCursorSkip=function(e){this.cursorState.skip=e},p.prototype.cursorSkip=function(){return this.cursorState.skip},p.prototype._endSession=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=this.cursorState.session;return n&&(e.force||n.owner===this)?(this.cursorState.session=void 0,n.endSession(t),!0):(t&&t(),!1)};var f=function(e,t,n){try{e(t,n)}catch(t){process.nextTick(function(){throw t})}};p.prototype._find=function(e){var t=this;t.logger.isDebug()&&t.logger.debug(c("issue initial query [%s] with flags [%s]",JSON.stringify(t.cmd),JSON.stringify(t.query)));var n={};(t.options.raw||t.cmd.raw)&&(n.raw=t.options.raw||t.cmd.raw),"string"==typeof t.query.documentsReturnedIn&&(n.documentsReturnedIn=t.query.documentsReturnedIn),"boolean"==typeof t.cursorState.promoteLongs&&(n.promoteLongs=t.cursorState.promoteLongs),"boolean"==typeof t.cursorState.promoteValues&&(n.promoteValues=t.cursorState.promoteValues),"boolean"==typeof t.cursorState.promoteBuffers&&(n.promoteBuffers=t.cursorState.promoteBuffers),"object"==typeof t.cursorState.session&&(n.session=t.cursorState.session),t.server.s.pool.write(t.query,n,function(n,r){if(n)return e(n);var o=r.message;if(o.queryFailure)return e(new s(o.documents[0]),null);if(Array.isArray(o.documents)&&1===o.documents.length&&(!t.cmd.find||t.cmd.find&&!1===t.cmd.virtual)&&("string"!=typeof o.documents[0].cursor||o.documents[0].$err||o.documents[0].errmsg||Array.isArray(o.documents[0].result))){if(o.documents[0].$err||o.documents[0].errmsg)return e(new s(o.documents[0]),null);if(null!=o.documents[0].cursor&&"string"!=typeof o.documents[0].cursor){var i=o.documents[0].cursor.id;return o.documents[0].cursor.ns&&(t.ns=o.documents[0].cursor.ns),t.cursorState.cursorId="number"==typeof i?l.fromNumber(i):i,t.cursorState.lastCursorId=t.cursorState.cursorId,t.cursorState.operationTime=o.documents[0].operationTime,Array.isArray(o.documents[0].cursor.firstBatch)&&(t.cursorState.documents=o.documents[0].cursor.firstBatch),e(null,o)}if(Array.isArray(o.documents[0].result))return t.cursorState.documents=o.documents[0].result,t.cursorState.cursorId=l.ZERO,e(null,o)}t.cursorState.cursorId=o.cursorId,t.cursorState.documents=o.documents,t.cursorState.lastCursorId=o.cursorId,t.cursorState.transforms&&"function"==typeof t.cursorState.transforms.query&&(t.cursorState.documents=t.cursorState.transforms.query(o)),e(null,o)})},p.prototype._getmore=function(e){this.logger.isDebug()&&this.logger.debug(c("schedule getMore call for query [%s]",JSON.stringify(this.query)));var t=this.options.raw||this.cmd.raw,n=this.cursorState.batchSize;this.cursorState.limit>0&&this.cursorState.currentLimit+n>this.cursorState.limit&&(n=this.cursorState.limit-this.cursorState.currentLimit);var r=this.server.s.pool;this.server.wireProtocolHandler.getMore(this.bson,this.ns,this.cursorState,n,t,r,this.options,e)},p.prototype.clone=function(){return this.topology.cursor(this.ns,this.cmd,this.options)},p.prototype.isDead=function(){return!0===this.cursorState.dead},p.prototype.isKilled=function(){return!0===this.cursorState.killed},p.prototype.isNotified=function(){return!0===this.cursorState.notified},p.prototype.bufferedCount=function(){return this.cursorState.documents.length-this.cursorState.cursorIndex},p.prototype.readBufferedDocuments=function(e){var t=this.cursorState.documents.length-this.cursorState.cursorIndex,n=e<t?e:t,r=this.cursorState.documents.slice(this.cursorState.cursorIndex,this.cursorState.cursorIndex+n);if(this.cursorState.transforms&&"function"==typeof this.cursorState.transforms.doc)for(var o=0;o<r.length;o++)r[o]=this.cursorState.transforms.doc(r[o]);return this.cursorState.limit>0&&this.cursorState.currentLimit+r.length>this.cursorState.limit&&(r=r.slice(0,this.cursorState.limit-this.cursorState.currentLimit),this.kill()),this.cursorState.currentLimit=this.cursorState.currentLimit+r.length,this.cursorState.cursorIndex=this.cursorState.cursorIndex+r.length,r},p.prototype.kill=function(e){if(this.cursorState.dead=!0,this.cursorState.killed=!0,this.cursorState.documents=[],null==this.cursorState.cursorId||this.cursorState.cursorId.isZero()||!1===this.cursorState.init)e&&e(null,null);else{var t=this.server.s.pool;this.server.wireProtocolHandler.killCursor(this.bson,this.ns,this.cursorState,t,e)}},p.prototype.rewind=function(){this.cursorState.init&&(this.cursorState.dead||this.kill(),this.cursorState.currentLimit=0,this.cursorState.init=!1,this.cursorState.dead=!1,this.cursorState.killed=!1,this.cursorState.notified=!1,this.cursorState.documents=[],this.cursorState.cursorId=null,this.cursorState.cursorIndex=0)};var h=function(e,t){if(e.pool&&e.pool.isDestroyed()){e.cursorState.killed=!0;const n=new i(c("connection to host %s:%s was destroyed",e.pool.host,e.pool.port));return y(e,()=>t(n)),!0}return!1},d=function(e,t){e.cursorState.dead=!0,m(e,t)},m=function(e,t){y(e,()=>f(t,null,null))},y=function(e,t){return e.cursorState.notified=!0,e.cursorState.documents=[],e.cursorState.cursorIndex=0,e._endSession?e._endSession(void 0,()=>t()):t()},g=function(e,t){if(e.cursorState.notified)return t(new Error("cursor is exhausted"));if(!function(e,t){return!!e.cursorState.killed&&(m(e,t),!0)}(e,t)&&!function(e,t){return!(!e.cursorState.dead||e.cursorState.killed||(e.cursorState.killed=!0,m(e,t),0))}(e,t)&&!function(e,t){return!(!e.cursorState.dead||!e.cursorState.killed||(f(t,new s("cursor is dead")),0))}(e,t)){if(!e.cursorState.init)return function(e,t){if(!e.topology.isConnected(e.options)){if("server"===e.topology._type&&!e.topology.s.options.reconnect)return t(new s("no connection available"));if(null!=e.disconnectHandler)return e.topology.isDestroyed()?t(new s("Topology was destroyed")):e.disconnectHandler.addObjectAndMethod("cursor",e,"next",[t],t)}return e.topology.selectServer(e.options,(n,r)=>{if(n)return null!=e.disconnectHandler?e.disconnectHandler.addObjectAndMethod("cursor",e,"next",[t],t):t(n);if(e.server=r,e.cursorState.init=!0,u(e.server,e.cmd))return t(new s(`server ${e.server.name} does not support collation`));try{if(e.query=e.server.wireProtocolHandler.command(e.bson,e.ns,e.cmd,e.cursorState,e.topology,e.options),e.query instanceof s)return t(e.query);g(e,t)}catch(n){return t(n)}})}(e,t);if(null==e.cursorState.cursorId){if(h(e,t))return;if(e.topology.isDestroyed())return t(new i("connection destroyed, not possible to instantiate cursor"));e._find(function(n){return n?f(t,n,null):(e.cursorState.cursorId&&e.cursorState.cursorId.isZero()&&e._endSession&&e._endSession(),0===e.cursorState.documents.length&&e.cursorState.cursorId&&e.cursorState.cursorId.isZero()&&!e.cmd.tailable&&!e.cmd.awaitData?m(e,t):void g(e,t))})}else{if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit)return e.kill(),d(e,t);if(e.cursorState.cursorIndex!==e.cursorState.documents.length||l.ZERO.equals(e.cursorState.cursorId)){if(e.cursorState.documents.length===e.cursorState.cursorIndex&&e.cmd.tailable&&l.ZERO.equals(e.cursorState.cursorId))return f(t,new s({message:"No more documents in tailed cursor",tailable:e.cmd.tailable,awaitData:e.cmd.awaitData}));if(e.cursorState.documents.length===e.cursorState.cursorIndex&&l.ZERO.equals(e.cursorState.cursorId))d(e,t);else{if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit)return e.kill(),d(e,t);e.cursorState.currentLimit+=1;var n=e.cursorState.documents[e.cursorState.cursorIndex++];if(!n||n.$err)return e.kill(),d(e,function(){f(t,new s(n?n.$err:void 0))});e.cursorState.transforms&&"function"==typeof e.cursorState.transforms.doc&&(n=e.cursorState.transforms.doc(n)),f(t,null,n)}}else{if(e.cursorState.documents=[],e.cursorState.cursorIndex=0,e.topology.isDestroyed())return t(new i("connection destroyed, not possible to instantiate cursor"));if(h(e,t))return;e._getmore(function(n,r,o){return n?(n instanceof s&&(n[a].isGetMore=!0),f(t,n)):(e.cursorState.cursorId&&e.cursorState.cursorId.isZero()&&e._endSession&&e._endSession(),e.connection=o,0===e.cursorState.documents.length&&e.cmd.tailable&&l.ZERO.equals(e.cursorState.cursorId)?f(t,new s({message:"No more documents in tailed cursor",tailable:e.cmd.tailable,awaitData:e.cmd.awaitData})):0===e.cursorState.documents.length&&e.cmd.tailable&&!l.ZERO.equals(e.cursorState.cursorId)?g(e,t):e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit?d(e,t):void g(e,t))})}}}};p.prototype.next=function(e){g(this,e)},e.exports=p},function(e,t,n){"use strict";const r=n(155),o=n(73),s=n(9).EventEmitter,i=n(5).executeOperation,a=n(5).handleCallback,c=n(1).inherits,u=n(6).MongoError,l=n(158).connectOp,p=n(158).logout,f=n(158).validOptions;function h(e,t){if(!(this instanceof h))return new h(e,t);s.call(this),this.s={url:e,options:t||{},promiseLibrary:null,dbCache:{},sessions:[]};const n=this.s.options.promiseLibrary||Promise;this.s.promiseLibrary=n}c(h,s),h.prototype.connect=function(e){const t=f(this.s.options);if("string"==typeof e)throw new TypeError("`connect` only accepts a callback");return i(this,l,[this,t,e],{skipSessions:!0})},h.prototype.logout=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=this.s.options.authSource?this.s.options.authSource:this.s.options.dbName;return i(this,p,[this,n,t],{skipSessions:!0})},h.prototype.close=function(e,t){"function"==typeof e&&(t=e,e=!1),this.topology&&this.topology.close(e),this.emit("close",this);for(const e in this.s.dbCache)this.s.dbCache[e].emit("close");return this.removeAllListeners("close"),"function"==typeof t?process.nextTick(()=>{a(t,null)}):new this.s.promiseLibrary(e=>{e()})},h.prototype.db=function(e,t){t=t||{},e||(e=this.s.options.dbName);const n=Object.assign({},this.s.options,t);if(this.s.dbCache[e]&&!0!==n.returnNonCachedInstance)return this.s.dbCache[e];if(n.promiseLibrary=this.s.promiseLibrary,!this.topology)throw new u("MongoClient must be connected before calling MongoClient.prototype.db");const r=new o(e,this.topology,n);return this.s.dbCache[e]=r,r},h.prototype.isConnected=function(e){return e=e||{},!!this.topology&&this.topology.isConnected(e)},h.connect=function(e,t,n){const r=Array.prototype.slice.call(arguments,1);return n="function"==typeof r[r.length-1]?r.pop():void 0,new h(e,(r.length?r.shift():null)||{}).connect(n)},h.prototype.startSession=function(e){if(e=Object.assign({explicit:!0},e),!this.topology)throw new u("Must connect to a server before calling this method");if(!this.topology.hasSessionSupport())throw new u("Current topology does not support sessions");return this.topology.startSession(e,this.s.options)},h.prototype.withSession=function(e,t){"function"==typeof e&&(t=e,e=void 0);const n=this.startSession(e);let r=(e,t,o)=>{if(r=(()=>{throw new ReferenceError("cleanupHandler was called too many times")}),o=Object.assign({throw:!0},o),n.endSession(),e){if(o.throw)throw e;return Promise.reject(e)}};try{const e=t(n);return Promise.resolve(e).then(e=>r(null,e)).catch(e=>r(e,null,{throw:!0}))}catch(e){return r(e,null,{throw:!1})}},h.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new r(this,e,t)},h.prototype.getLogger=function(){return this.s.options.logger},e.exports=h},function(e,t,n){"use strict";const r=n(6).BSON.Long,o=n(6).MongoError,s=n(5).toError,i=n(5).handleCallback,a=n(5).applyRetryableWrites,c=n(5).applyWriteConcern,u=n(6).BSON.ObjectID,l=n(6).BSON,p=64,f=1,h=2,d=3,m=new l([l.Binary,l.Code,l.DBRef,l.Decimal128,l.Double,l.Int32,l.Long,l.Map,l.MaxKey,l.MinKey,l.ObjectId,l.BSONRegExp,l.Symbol,l.Timestamp]);class y{constructor(e){this.result=e}get ok(){return this.result.ok}get nInserted(){return this.result.nInserted}get nUpserted(){return this.result.nUpserted}get nMatched(){return this.result.nMatched}get nModified(){return this.result.nModified}get nRemoved(){return this.result.nRemoved}getInsertedIds(){return this.result.insertedIds}getUpsertedIds(){return this.result.upserted}getUpsertedIdAt(e){return this.result.upserted[e]}getRawResponse(){return this.result}hasWriteErrors(){return this.result.writeErrors.length>0}getWriteErrorCount(){return this.result.writeErrors.length}getWriteErrorAt(e){return e<this.result.writeErrors.length?this.result.writeErrors[e]:null}getWriteErrors(){return this.result.writeErrors}getLastOp(){return this.result.lastOp}getWriteConcernError(){if(0===this.result.writeConcernErrors.length)return null;if(1===this.result.writeConcernErrors.length)return this.result.writeConcernErrors[0];{let e="";for(let t=0;t<this.result.writeConcernErrors.length;t++){e+=this.result.writeConcernErrors[t].errmsg,0===t&&(e+=" and ")}return new g({errmsg:e,code:p})}}toJSON(){return this.result}toString(){return`BulkWriteResult(${this.toJSON(this.result)})`}isOk(){return 1===this.result.ok}}class g{constructor(e){this.err=e}get code(){return this.err.code}get errmsg(){return this.err.errmsg}toJSON(){return{code:this.err.code,errmsg:this.err.errmsg}}toString(){return`WriteConcernError(${this.err.errmsg})`}}class b{constructor(e){this.err=e}get code(){return this.err.code}get index(){return this.err.index}get errmsg(){return this.err.errmsg}getOperation(){return this.err.op}toJSON(){return{code:this.err.code,index:this.err.index,errmsg:this.err.errmsg,op:this.err.op}}toString(){return`WriteError(${JSON.stringify(this.toJSON())})`}}function v(e,t,n,o,s){if(o)s=o;else if(s&&s.result)s=s.result;else if(null==s)return;if(0===s.ok&&1===n.ok){n.ok=0;const e={index:0,code:s.code||0,errmsg:s.message,op:t.operations[0]};return void n.writeErrors.push(new b(e))}if(0===s.ok&&0===n.ok)return;if(s.opTime||s.lastOp){const e=s.lastOp||s.opTime;let t=null,o=null;if(e&&"Timestamp"===e._bsontype)null==n.lastOp?n.lastOp=e:e.greaterThan(n.lastOp)&&(n.lastOp=e);else{n.lastOp&&(t="number"==typeof n.lastOp.ts?r.fromNumber(n.lastOp.ts):n.lastOp.ts,o="number"==typeof n.lastOp.t?r.fromNumber(n.lastOp.t):n.lastOp.t);const s="number"==typeof e.ts?r.fromNumber(e.ts):e.ts,i="number"==typeof e.t?r.fromNumber(e.t):e.t;null==n.lastOp?n.lastOp=e:s.greaterThan(t)?n.lastOp=e:s.equals(t)&&i.greaterThan(o)&&(n.lastOp=e)}}t.batchType===f&&s.n&&(n.nInserted=n.nInserted+s.n),t.batchType===d&&s.n&&(n.nRemoved=n.nRemoved+s.n);let i=0;if(Array.isArray(s.upserted)){i=s.upserted.length;for(let e=0;e<s.upserted.length;e++)n.upserted.push({index:s.upserted[e].index+t.originalZeroIndex,_id:s.upserted[e]._id})}else s.upserted&&(i=1,n.upserted.push({index:t.originalZeroIndex,_id:s.upserted}));if(t.batchType===h&&s.n){const e=s.nModified;n.nUpserted=n.nUpserted+i,n.nMatched=n.nMatched+(s.n-i),n.nModified="number"==typeof e?n.nModified+e:null}if(Array.isArray(s.writeErrors))for(let e=0;e<s.writeErrors.length;e++){const r={index:t.originalZeroIndex+s.writeErrors[e].index,code:s.writeErrors[e].code,errmsg:s.writeErrors[e].errmsg,op:t.operations[s.writeErrors[e].index]};n.writeErrors.push(new b(r))}s.writeConcernError&&n.writeConcernErrors.push(new g(s.writeConcernError))}class S extends o{constructor(e,t){super(e.err||e.errmsg||e.errMessage||e),Object.assign(this,e),this.name="BulkWriteError",this.result=t}}class w{constructor(e){this.s=e.s}update(e){const t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!0,upsert:t};return this.s.currentOp=null,this.s.options.addToOperationsList(this,h,n)}updateOne(e){const t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!1,upsert:t};return this.s.currentOp=null,this.s.options.addToOperationsList(this,h,n)}replaceOne(e){this.updateOne(e)}upsert(){return this.s.currentOp.upsert=!0,this}deleteOne(){const e={q:this.s.currentOp.selector,limit:1};return this.s.currentOp=null,this.s.options.addToOperationsList(this,d,e)}delete(){const e={q:this.s.currentOp.selector,limit:0};return this.s.currentOp=null,this.s.options.addToOperationsList(this,d,e)}removeOne(){return this.deleteOne()}remove(){return this.delete()}}class O{constructor(e,t,n,r){this.isOrdered=r,n=null==n?{}:n;const o=t.collectionName,s=e.bson,i=e.lastIsMaster(),u=i&&i.maxBsonObjectSize?i.maxBsonObjectSize:16777216,l=i&&i.maxWriteBatchSize?i.maxWriteBatchSize:1e3;let p=Object.assign({},n);p=a(p,t.s.db);const f=(p=c(p,{collection:t},n)).writeConcern,h=n.promiseLibrary||Promise;this.s={bulkResult:{ok:1,writeErrors:[],writeConcernErrors:[],insertedIds:[],nInserted:0,nUpserted:0,nMatched:0,nModified:0,nRemoved:0,upserted:[]},currentBatch:null,currentIndex:0,currentBatchSize:0,currentBatchSizeBytes:0,currentInsertBatch:null,currentUpdateBatch:null,currentRemoveBatch:null,batches:[],writeConcern:f,maxBatchSizeBytes:u,maxWriteBatchSize:l,namespace:o,bson:s,topology:e,options:p,currentOp:null,executed:!1,collection:t,promiseLibrary:h,err:null,checkKeys:"boolean"!=typeof n.checkKeys||n.checkKeys},!0===n.bypassDocumentValidation&&(this.s.bypassDocumentValidation=!0)}insert(e){return!0!==this.s.collection.s.db.options.forceServerObjectId&&null==e._id&&(e._id=new u),this.s.options.addToOperationsList(this,f,e)}find(e){if(!e)throw s("Bulk find operation must specify a selector");return this.s.currentOp={selector:e},new w(this)}raw(e){const t=Object.keys(e)[0],n="boolean"==typeof this.s.options.forceServerObjectId?this.s.options.forceServerObjectId:this.s.collection.s.db.options.forceServerObjectId;if(e.updateOne&&e.updateOne.q||e.updateMany&&e.updateMany.q||e.replaceOne&&e.replaceOne.q)return e[t].multi=!e.updateOne&&!e.replaceOne,this.s.options.addToOperationsList(this,h,e[t]);if(e.updateOne||e.updateMany||e.replaceOne){const n=!e.updateOne&&!e.replaceOne,r={q:e[t].filter,u:e[t].update||e[t].replacement,multi:n};return this.isOrdered?(r.upsert=!!e[t].upsert,e.collation&&(r.collation=e.collation)):e[t].upsert&&(r.upsert=!0),e[t].arrayFilters&&(r.arrayFilters=e[t].arrayFilters),this.s.options.addToOperationsList(this,h,r)}if(e.removeOne||e.removeMany||e.deleteOne&&e.deleteOne.q||e.deleteMany&&e.deleteMany.q)return e[t].limit=e.removeOne?1:0,this.s.options.addToOperationsList(this,d,e[t]);if(e.deleteOne||e.deleteMany){const n=e.deleteOne?1:0,r={q:e[t].filter,limit:n};return this.isOrdered&&e.collation&&(r.collation=e.collation),this.s.options.addToOperationsList(this,d,r)}if(e.insertOne&&null==e.insertOne.document)return!0!==n&&null==e.insertOne._id&&(e.insertOne._id=new u),this.s.options.addToOperationsList(this,f,e.insertOne);if(e.insertOne&&e.insertOne.document)return!0!==n&&null==e.insertOne.document._id&&(e.insertOne.document._id=new u),this.s.options.addToOperationsList(this,f,e.insertOne.document);if(!e.insertMany)throw s("bulkWrite only supports insertOne, insertMany, updateOne, updateMany, removeOne, removeMany, deleteOne, deleteMany");for(let t=0;t<e.insertMany.length;t++)!0!==n&&null==e.insertMany[t]._id&&(e.insertMany[t]._id=new u),this.s.options.addToOperationsList(this,f,e.insertMany[t])}bulkExecute(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},this.s.executed){const e=s("batch cannot be re-executed");return"function"==typeof n?n(e,null):this.s.promiseLibrary.reject(e)}if("function"==typeof e?n=e:e&&"object"==typeof e&&(this.s.writeConcern=e),this.isOrdered?this.s.currentBatch&&this.s.batches.push(this.s.currentBatch):(this.s.currentInsertBatch&&this.s.batches.push(this.s.currentInsertBatch),this.s.currentUpdateBatch&&this.s.batches.push(this.s.currentUpdateBatch),this.s.currentRemoveBatch&&this.s.batches.push(this.s.currentRemoveBatch)),0===this.s.batches.length){const e=s("Invalid Operation, no operations specified");return"function"==typeof n?n(e,null):this.s.promiseLibrary.reject(e)}return{options:t,callback:n}}finalOptionsHandler(e,t){const n=Object.assign({ordered:this.isOrdered},e.options);null!=this.s.writeConcern&&(n.writeConcern=this.s.writeConcern),!0!==n.bypassDocumentValidation&&delete n.bypassDocumentValidation,this.operationId&&(e.resultHandler.operationId=this.operationId),this.s.options.serializeFunctions&&(n.serializeFunctions=!0),this.s.options.ignoreUndefined&&(n.ignoreUndefined=!0),!0===this.s.bypassDocumentValidation&&(n.bypassDocumentValidation=!0),!1===this.s.checkKeys&&(n.checkKeys=!1),n.retryWrites&&(e.batch.batchType===h&&(n.retryWrites=n.retryWrites&&!e.batch.operations.some(e=>e.multi)),e.batch.batchType===d&&(n.retryWrites=n.retryWrites&&!e.batch.operations.some(e=>0===e.limit)));try{e.batch.batchType===f?this.s.topology.insert(this.s.collection.namespace,e.batch.operations,n,e.resultHandler):e.batch.batchType===h?this.s.topology.update(this.s.collection.namespace,e.batch.operations,n,e.resultHandler):e.batch.batchType===d&&this.s.topology.remove(this.s.collection.namespace,e.batch.operations,n,e.resultHandler)}catch(n){n.ok=0,i(t,null,v(0,e.batch,this.s.bulkResult,n,null))}}handleWriteError(e,t){return this.s.bulkResult.writeErrors.length>0?1===this.s.bulkResult.writeErrors.length?(i(e,new S(s(this.s.bulkResult.writeErrors[0]),t),null),!0):(i(e,new S(s({message:"write operation failed",code:this.s.bulkResult.writeErrors[0].code,writeErrors:this.s.bulkResult.writeErrors}),t),null),!0):t.getWriteConcernError()?(i(e,new S(s(t.getWriteConcernError()),t),null),!0):void 0}}Object.defineProperty(O.prototype,"length",{enumerable:!0,get:function(){return this.s.currentIndex}}),e.exports={Batch:class{constructor(e,t){this.originalZeroIndex=t,this.currentIndex=0,this.originalIndexes=[],this.batchType=e,this.operations=[],this.size=0,this.sizeBytes=0}},BulkOperationBase:O,BulkWriteError:S,BulkWriteResult:y,bson:m,FindOperators:w,handleMongoWriteConcernError:function(e,t,n,r,o){v(0,e,t,null,r.result);const a=new g({errmsg:r.result.writeConcernError.errmsg,code:r.result.writeConcernError.result});return i(o,new S(s(a),new y(t)),null)},LegacyOp:class{constructor(e,t,n){this.batchType=e,this.index=n,this.operation=t}},mergeBatchResults:v,INVALID_BSON_ERROR:22,MULTIPLE_ERROR:65,UNKNOWN_ERROR:8,WRITE_CONCERN_ERROR:p,INSERT:f,UPDATE:h,REMOVE:d,WriteError:b,WriteConcernError:g}},function(e,t,n){"use strict";const r=n(6).Server,o=n(36),s=n(74).TopologyBase,i=n(74).Store,a=n(6).MongoError,c=n(5).MAX_JS_INT,u=n(5).translateOptions,l=n(5).filterOptions,p=n(5).mergeOptions;var f=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","family","loggerLevel","logger","reconnectTries","reconnectInterval","monitoring","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","compression","promiseLibrary","monitorCommands"];class h extends s{constructor(e,t,n){super();const s=(n=l(n,f)).promiseLibrary;var h={force:!1,bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:c},d=n.store||new i(this,h);if(-1!==e.indexOf("/"))null!=t&&"object"==typeof t&&(n=t,t=null);else if(null==t)throw a.create({message:"port must be specified",driver:!0});var m="boolean"!=typeof n.auto_reconnect||n.auto_reconnect;m="boolean"==typeof n.autoReconnect?n.autoReconnect:m;var y=p({},{host:e,port:t,disconnectHandler:d,cursorFactory:o,reconnect:m,emitError:"boolean"!=typeof n.emitError||n.emitError,size:"number"==typeof n.poolSize?n.poolSize:5,monitorCommands:"boolean"==typeof n.monitorCommands&&n.monitorCommands});y=u(y,n);var g=n.socketOptions&&Object.keys(n.socketOptions).length>0?n.socketOptions:n;(y=u(y,g)).clientInfo=this.clientInfo,n.appname&&(y.clientInfo.application={name:n.appname}),this.s={coreTopology:new r(y),sCapabilities:null,clonedOptions:y,reconnect:y.reconnect,emitError:y.emitError,poolSize:y.size,storeOptions:h,store:d,host:e,port:t,options:n,sessionPool:null,sessions:[],promiseLibrary:s||Promise}}connect(e,t){var n=this;"function"==typeof e&&(t=e,e={}),null==e&&(e=this.s.clonedOptions),"function"!=typeof t&&(t=null),e=Object.assign({},this.s.clonedOptions,e),n.s.options=e,n.s.storeOptions.bufferMaxEntries="number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:-1;var r=function(){return function(e){["timeout","error","close"].forEach(function(e){n.s.coreTopology.removeListener(e,a[e])}),n.s.coreTopology.removeListener("connect",r);try{t(e)}catch(e){process.nextTick(function(){throw e})}}},o=function(e){return function(t){"error"!==e&&n.emit(e,t)}},s=function(){n.s.store.flush()},i=function(e){return function(t,r){n.emit(e,t,r)}},a={timeout:r("timeout"),error:r("error"),close:r("close")};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach(function(e){n.s.coreTopology.removeAllListeners(e)}),n.s.coreTopology.once("timeout",a.timeout),n.s.coreTopology.once("error",a.error),n.s.coreTopology.once("close",a.close),n.s.coreTopology.once("connect",function(){["timeout","error","close","destroy"].forEach(function(e){n.s.coreTopology.removeAllListeners(e)}),n.s.coreTopology.on("timeout",o("timeout")),n.s.coreTopology.once("error",o("error")),n.s.coreTopology.on("close",o("close")),n.s.coreTopology.on("destroy",s),n.emit("open",null,n);try{t(null,n)}catch(e){process.nextTick(function(){throw e})}}),n.s.coreTopology.on("reconnect",function(){n.emit("reconnect",n),n.s.store.execute()}),n.s.coreTopology.on("reconnectFailed",function(e){n.emit("reconnectFailed",e),n.s.store.flush(e)}),n.s.coreTopology.on("serverDescriptionChanged",i("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",i("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",i("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",i("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",i("serverOpening")),n.s.coreTopology.on("serverClosed",i("serverClosed")),n.s.coreTopology.on("topologyOpening",i("topologyOpening")),n.s.coreTopology.on("topologyClosed",i("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",i("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",i("commandStarted")),n.s.coreTopology.on("commandSucceeded",i("commandSucceeded")),n.s.coreTopology.on("commandFailed",i("commandFailed")),n.s.coreTopology.on("attemptReconnect",i("attemptReconnect")),n.s.coreTopology.on("monitoring",i("monitoring")),n.s.coreTopology.connect(e)}}Object.defineProperty(h.prototype,"poolSize",{enumerable:!0,get:function(){return this.s.coreTopology.connections().length}}),Object.defineProperty(h.prototype,"autoReconnect",{enumerable:!0,get:function(){return this.s.reconnect}}),Object.defineProperty(h.prototype,"host",{enumerable:!0,get:function(){return this.s.host}}),Object.defineProperty(h.prototype,"port",{enumerable:!0,get:function(){return this.s.port}}),e.exports=h},function(e,t,n){"use strict";const r=n(2),o=n(138),s=n(50).connect;s.MongoError=r.MongoError,s.MongoNetworkError=r.MongoNetworkError,s.Admin=n(84),s.MongoClient=n(50),s.Db=n(28),s.Collection=n(27),s.Server=n(52),s.ReplSet=n(86),s.Mongos=n(85),s.ReadPreference=n(2).ReadPreference,s.GridStore=n(145),s.Chunk=n(87),s.Logger=r.Logger,s.AggregationCursor=n(82),s.CommandCursor=n(68),s.Cursor=n(17),s.GridFSBucket=n(146),s.CoreServer=n(2).Server,s.CoreConnection=n(2).Connection,s.Binary=r.BSON.Binary,s.Code=r.BSON.Code,s.Map=r.BSON.Map,s.DBRef=r.BSON.DBRef,s.Double=r.BSON.Double,s.Int32=r.BSON.Int32,s.Long=r.BSON.Long,s.MinKey=r.BSON.MinKey,s.MaxKey=r.BSON.MaxKey,s.ObjectID=r.BSON.ObjectID,s.ObjectId=r.BSON.ObjectID,s.Symbol=r.BSON.Symbol,s.Timestamp=r.BSON.Timestamp,s.BSONRegExp=r.BSON.BSONRegExp,s.Decimal128=r.BSON.Decimal128,s.connect=s,s.instrument=function(e,t){"function"==typeof e&&(t=e,e={});const n=new o;return n.instrument(s.MongoClient,t),n},e.exports=s},function(e,t,n){"use strict";var r=n(57),o=n(26),s=n(37),i=n(38),a=n(39),c=n(40),u=n(41),l=n(58),p=n(42),f=n(43),h=n(30),d=n(44),m=n(45),y=n(31),g=n(116),b=n(117),v=n(119),S=new Buffer(17825792),w=function(){};w.prototype.serialize=function(e,t){var n="boolean"==typeof(t=t||{}).checkKeys&&t.checkKeys,r="boolean"==typeof t.serializeFunctions&&t.serializeFunctions,o="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined,s="number"==typeof t.minInternalBufferSize?t.minInternalBufferSize:17825792;S.length<s&&(S=new Buffer(s));var i=b(S,e,n,0,0,r,o,[]),a=new Buffer(i);return S.copy(a,0,0,a.length),a},w.prototype.serializeWithBufferAndIndex=function(e,t,n){var r="boolean"==typeof(n=n||{}).checkKeys&&n.checkKeys,o="boolean"==typeof n.serializeFunctions&&n.serializeFunctions,s="boolean"!=typeof n.ignoreUndefined||n.ignoreUndefined,i="number"==typeof n.index?n.index:0;return b(t,e,r,i||0,0,o,s)-1},w.prototype.deserialize=function(e,t){return g(e,t)},w.prototype.calculateObjectSize=function(e,t){var n="boolean"==typeof(t=t||{}).serializeFunctions&&t.serializeFunctions,r="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined;return v(e,n,r)},w.prototype.deserializeStream=function(e,t,n,r,o,s){s=null!=s?s:{};for(var i=t,a=0;a<n;a++){var c=e[i]|e[i+1]<<8|e[i+2]<<16|e[i+3]<<24;s.index=i,r[o+a]=this.deserialize(e,s),i+=c}return i},w.BSON_INT32_MAX=2147483647,w.BSON_INT32_MIN=-2147483648,w.BSON_INT64_MAX=Math.pow(2,63)-1,w.BSON_INT64_MIN=-Math.pow(2,63),w.JS_INT_MAX=9007199254740992,w.JS_INT_MIN=-9007199254740992,w.BSON_DATA_NUMBER=1,w.BSON_DATA_STRING=2,w.BSON_DATA_OBJECT=3,w.BSON_DATA_ARRAY=4,w.BSON_DATA_BINARY=5,w.BSON_DATA_OID=7,w.BSON_DATA_BOOLEAN=8,w.BSON_DATA_DATE=9,w.BSON_DATA_NULL=10,w.BSON_DATA_REGEXP=11,w.BSON_DATA_CODE=13,w.BSON_DATA_SYMBOL=14,w.BSON_DATA_CODE_W_SCOPE=15,w.BSON_DATA_INT=16,w.BSON_DATA_TIMESTAMP=17,w.BSON_DATA_LONG=18,w.BSON_DATA_MIN_KEY=255,w.BSON_DATA_MAX_KEY=127,w.BSON_BINARY_SUBTYPE_DEFAULT=0,w.BSON_BINARY_SUBTYPE_FUNCTION=1,w.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,w.BSON_BINARY_SUBTYPE_UUID=3,w.BSON_BINARY_SUBTYPE_MD5=4,w.BSON_BINARY_SUBTYPE_USER_DEFINED=128,e.exports=w,e.exports.Code=p,e.exports.Map=r,e.exports.Symbol=u,e.exports.BSON=w,e.exports.DBRef=m,e.exports.Binary=y,e.exports.ObjectID=a,e.exports.Long=o,e.exports.Timestamp=i,e.exports.Double=s,e.exports.Int32=l,e.exports.MinKey=h,e.exports.MaxKey=d,e.exports.BSONRegExp=c,e.exports.Decimal128=f},function(module,exports,__webpack_require__){"use strict";var Long=__webpack_require__(26).Long,Double=__webpack_require__(37).Double,Timestamp=__webpack_require__(38).Timestamp,ObjectID=__webpack_require__(39).ObjectID,Symbol=__webpack_require__(41).Symbol,Code=__webpack_require__(42).Code,MinKey=__webpack_require__(30).MinKey,MaxKey=__webpack_require__(44).MaxKey,Decimal128=__webpack_require__(43),Int32=__webpack_require__(58),DBRef=__webpack_require__(45).DBRef,BSONRegExp=__webpack_require__(40).BSONRegExp,Binary=__webpack_require__(31).Binary,deserialize=function(e,t,n){var r=(t=null==t?{}:t)&&t.index?t.index:0,o=e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24;if(o<5||e.length<o||o+r>e.length)throw new Error("corrupt bson message");if(0!==e[r+o-1])throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return deserializeObject(e,r,t,n)},deserializeObject=function(e,t,n,r){var o=null!=n.evalFunctions&&n.evalFunctions,s=null!=n.cacheFunctions&&n.cacheFunctions,i=null!=n.cacheFunctionsCrc32&&n.cacheFunctionsCrc32;if(!i)var a=null;var c=null==n.fieldsAsRaw?null:n.fieldsAsRaw,u=null!=n.raw&&n.raw,l="boolean"==typeof n.bsonRegExp&&n.bsonRegExp,p=null!=n.promoteBuffers&&n.promoteBuffers,f=null==n.promoteLongs||n.promoteLongs,h=null==n.promoteValues||n.promoteValues,d=t;if(e.length<5)throw new Error("corrupt bson message < 5 bytes long");var m=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(m<5||m>e.length)throw new Error("corrupt bson message");for(var y=r?[]:{},g=0;;){var b=e[t++];if(0===b)break;for(var v=t;0!==e[v]&&v<e.length;)v++;if(v>=e.length)throw new Error("Bad BSON Document: illegal CString");var S=r?g++:e.toString("utf8",t,v);if(t=v+1,b===BSON.BSON_DATA_STRING){var w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(w<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");y[S]=e.toString("utf8",t,t+w-1),t+=w}else if(b===BSON.BSON_DATA_OID){var O=new Buffer(12);e.copy(O,0,t,t+12),y[S]=new ObjectID(O),t+=12}else if(b===BSON.BSON_DATA_INT&&!1===h)y[S]=new Int32(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24);else if(b===BSON.BSON_DATA_INT)y[S]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;else if(b===BSON.BSON_DATA_NUMBER&&!1===h)y[S]=new Double(e.readDoubleLE(t)),t+=8;else if(b===BSON.BSON_DATA_NUMBER)y[S]=e.readDoubleLE(t),t+=8;else if(b===BSON.BSON_DATA_DATE){var _=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;y[S]=new Date(new Long(_,T).toNumber())}else if(b===BSON.BSON_DATA_BOOLEAN){if(0!==e[t]&&1!==e[t])throw new Error("illegal boolean type value");y[S]=1===e[t++]}else if(b===BSON.BSON_DATA_OBJECT){var C=t,E=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;if(E<=0||E>e.length-t)throw new Error("bad embedded document length in bson");y[S]=u?e.slice(t,t+E):deserializeObject(e,C,n,!1),t+=E}else if(b===BSON.BSON_DATA_ARRAY){C=t;var N=n,I=t+(E=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24);if(c&&c[S]){for(var x in N={},n)N[x]=n[x];N.raw=!0}if(y[S]=deserializeObject(e,C,N,!0),0!==e[(t+=E)-1])throw new Error("invalid array terminator byte");if(t!==I)throw new Error("corrupted array bson")}else if(b===BSON.BSON_DATA_UNDEFINED)y[S]=void 0;else if(b===BSON.BSON_DATA_NULL)y[S]=null;else if(b===BSON.BSON_DATA_LONG){_=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var A=new Long(_,T);y[S]=f&&!0===h&&A.lessThanOrEqual(JS_INT_MAX_LONG)&&A.greaterThanOrEqual(JS_INT_MIN_LONG)?A.toNumber():A}else if(b===BSON.BSON_DATA_DECIMAL128){var k=new Buffer(16);e.copy(k,0,t,t+16),t+=16;var B=new Decimal128(k);y[S]=B.toObject?B.toObject():B}else if(b===BSON.BSON_DATA_BINARY){var M=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,D=M,R=e[t++];if(M<0)throw new Error("Negative binary type element size found");if(M>e.length)throw new Error("Binary type size larger than document size");if(null!=e.slice){if(R===Binary.SUBTYPE_BYTE_ARRAY){if((M=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(M>D-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(M<D-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}y[S]=p&&h?e.slice(t,t+M):new Binary(e.slice(t,t+M),R)}else{var P="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(M)):new Array(M);if(R===Binary.SUBTYPE_BYTE_ARRAY){if((M=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(M>D-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(M<D-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}for(v=0;v<M;v++)P[v]=e[t+v];y[S]=p&&h?P:new Binary(P,R)}t+=M}else if(b===BSON.BSON_DATA_REGEXP&&!1===l){for(v=t;0!==e[v]&&v<e.length;)v++;if(v>=e.length)throw new Error("Bad BSON Document: illegal CString");var L=e.toString("utf8",t,v);for(v=t=v+1;0!==e[v]&&v<e.length;)v++;if(v>=e.length)throw new Error("Bad BSON Document: illegal CString");var j=e.toString("utf8",t,v);t=v+1;var U=new Array(j.length);for(v=0;v<j.length;v++)switch(j[v]){case"m":U[v]="m";break;case"s":U[v]="g";break;case"i":U[v]="i"}y[S]=new RegExp(L,U.join(""))}else if(b===BSON.BSON_DATA_REGEXP&&!0===l){for(v=t;0!==e[v]&&v<e.length;)v++;if(v>=e.length)throw new Error("Bad BSON Document: illegal CString");for(L=e.toString("utf8",t,v),v=t=v+1;0!==e[v]&&v<e.length;)v++;if(v>=e.length)throw new Error("Bad BSON Document: illegal CString");j=e.toString("utf8",t,v),t=v+1,y[S]=new BSONRegExp(L,j)}else if(b===BSON.BSON_DATA_SYMBOL){if((w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");y[S]=new Symbol(e.toString("utf8",t,t+w-1)),t+=w}else if(b===BSON.BSON_DATA_TIMESTAMP)_=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,y[S]=new Timestamp(_,T);else if(b===BSON.BSON_DATA_MIN_KEY)y[S]=new MinKey;else if(b===BSON.BSON_DATA_MAX_KEY)y[S]=new MaxKey;else if(b===BSON.BSON_DATA_CODE){if((w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");var z=e.toString("utf8",t,t+w-1);if(o)if(s){var q=i?a(z):z;y[S]=isolateEvalWithHash(functionCache,q,z,y)}else y[S]=isolateEval(z);else y[S]=new Code(z);t+=w}else if(b===BSON.BSON_DATA_CODE_W_SCOPE){var $=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if($<13)throw new Error("code_w_scope total size shorter minimum expected length");if((w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");z=e.toString("utf8",t,t+w-1),C=t+=w,E=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;var F=deserializeObject(e,C,n,!1);if(t+=E,$<8+E+w)throw new Error("code_w_scope total size is to short, truncating scope");if($>8+E+w)throw new Error("code_w_scope total size is to long, clips outer document");o?(s?(q=i?a(z):z,y[S]=isolateEvalWithHash(functionCache,q,z,y)):y[S]=isolateEval(z),y[S].scope=F):y[S]=new Code(z,F)}else{if(b!==BSON.BSON_DATA_DBPOINTER)throw new Error("Detected unknown BSON type "+b.toString(16)+' for fieldname "'+S+'", are you using the latest BSON parser');if((w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");var W=e.toString("utf8",t,t+w-1);t+=w;var H=new Buffer(12);e.copy(H,0,t,t+12),O=new ObjectID(H),t+=12;var V=W.split("."),Y=V.shift(),K=V.join(".");y[S]=new DBRef(K,O,Y)}}if(m!==t-d){if(r)throw new Error("corrupt array bson");throw new Error("corrupt object bson")}return null!=y.$id&&(y=new DBRef(y.$ref,y.$id,y.$db)),y},isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return null==functionCache[hash]&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},BSON={},functionCache=BSON.functionCache={};BSON.BSON_DATA_NUMBER=1,BSON.BSON_DATA_STRING=2,BSON.BSON_DATA_OBJECT=3,BSON.BSON_DATA_ARRAY=4,BSON.BSON_DATA_BINARY=5,BSON.BSON_DATA_UNDEFINED=6,BSON.BSON_DATA_OID=7,BSON.BSON_DATA_BOOLEAN=8,BSON.BSON_DATA_DATE=9,BSON.BSON_DATA_NULL=10,BSON.BSON_DATA_REGEXP=11,BSON.BSON_DATA_DBPOINTER=12,BSON.BSON_DATA_CODE=13,BSON.BSON_DATA_SYMBOL=14,BSON.BSON_DATA_CODE_W_SCOPE=15,BSON.BSON_DATA_INT=16,BSON.BSON_DATA_TIMESTAMP=17,BSON.BSON_DATA_LONG=18,BSON.BSON_DATA_DECIMAL128=19,BSON.BSON_DATA_MIN_KEY=255,BSON.BSON_DATA_MAX_KEY=127,BSON.BSON_BINARY_SUBTYPE_DEFAULT=0,BSON.BSON_BINARY_SUBTYPE_FUNCTION=1,BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON.BSON_BINARY_SUBTYPE_UUID=3,BSON.BSON_BINARY_SUBTYPE_MD5=4,BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128,BSON.BSON_INT32_MAX=2147483647,BSON.BSON_INT32_MIN=-2147483648,BSON.BSON_INT64_MAX=Math.pow(2,63)-1,BSON.BSON_INT64_MIN=-Math.pow(2,63),BSON.JS_INT_MAX=9007199254740992,BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);module.exports=deserialize},function(e,t,n){"use strict";var r=n(118).writeIEEE754,o=n(26).Long,s=n(30).MinKey,i=n(57),a=n(31).Binary,c=n(76).normalizedFunctionString,u=/\x00/,l=["$db","$ref","$id","$clusterTime"],p=function(e){return"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)},f=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},h=function(e,t,n,r,o){e[r++]=D.BSON_DATA_STRING,e[(r=r+(o?e.write(t,r,"ascii"):e.write(t,r,"utf8"))+1)-1]=0;var s=e.write(n,r+4,"utf8");return e[r+3]=s+1>>24&255,e[r+2]=s+1>>16&255,e[r+1]=s+1>>8&255,e[r]=s+1&255,r=r+4+s,e[r++]=0,r},d=function(e,t,n,s,i){if(Math.floor(n)===n&&n>=D.JS_INT_MIN&&n<=D.JS_INT_MAX)if(n>=D.BSON_INT32_MIN&&n<=D.BSON_INT32_MAX){e[s++]=D.BSON_DATA_INT;var a=i?e.write(t,s,"ascii"):e.write(t,s,"utf8");s+=a,e[s++]=0,e[s++]=255&n,e[s++]=n>>8&255,e[s++]=n>>16&255,e[s++]=n>>24&255}else if(n>=D.JS_INT_MIN&&n<=D.JS_INT_MAX)e[s++]=D.BSON_DATA_NUMBER,s+=a=i?e.write(t,s,"ascii"):e.write(t,s,"utf8"),e[s++]=0,r(e,n,s,"little",52,8),s+=8;else{e[s++]=D.BSON_DATA_LONG,s+=a=i?e.write(t,s,"ascii"):e.write(t,s,"utf8"),e[s++]=0;var c=o.fromNumber(n),u=c.getLowBits(),l=c.getHighBits();e[s++]=255&u,e[s++]=u>>8&255,e[s++]=u>>16&255,e[s++]=u>>24&255,e[s++]=255&l,e[s++]=l>>8&255,e[s++]=l>>16&255,e[s++]=l>>24&255}else e[s++]=D.BSON_DATA_NUMBER,s+=a=i?e.write(t,s,"ascii"):e.write(t,s,"utf8"),e[s++]=0,r(e,n,s,"little",52,8),s+=8;return s},m=function(e,t,n,r,o){return e[r++]=D.BSON_DATA_NULL,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,r},y=function(e,t,n,r,o){return e[r++]=D.BSON_DATA_BOOLEAN,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,e[r++]=n?1:0,r},g=function(e,t,n,r,s){e[r++]=D.BSON_DATA_DATE,r+=s?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var i=o.fromNumber(n.getTime()),a=i.getLowBits(),c=i.getHighBits();return e[r++]=255&a,e[r++]=a>>8&255,e[r++]=a>>16&255,e[r++]=a>>24&255,e[r++]=255&c,e[r++]=c>>8&255,e[r++]=c>>16&255,e[r++]=c>>24&255,r},b=function(e,t,n,r,o){if(e[r++]=D.BSON_DATA_REGEXP,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,n.source&&null!=n.source.match(u))throw Error("value "+n.source+" must not contain null bytes");return r+=e.write(n.source,r,"utf8"),e[r++]=0,n.global&&(e[r++]=115),n.ignoreCase&&(e[r++]=105),n.multiline&&(e[r++]=109),e[r++]=0,r},v=function(e,t,n,r,o){if(e[r++]=D.BSON_DATA_REGEXP,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,null!=n.pattern.match(u))throw Error("pattern "+n.pattern+" must not contain null bytes");return r+=e.write(n.pattern,r,"utf8"),e[r++]=0,r+=e.write(n.options.split("").sort().join(""),r,"utf8"),e[r++]=0,r},S=function(e,t,n,r,o){return e[r++]=null===n?D.BSON_DATA_NULL:n instanceof s?D.BSON_DATA_MIN_KEY:D.BSON_DATA_MAX_KEY,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,r},w=function(e,t,n,r,o){if(e[r++]=D.BSON_DATA_OID,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,"string"==typeof n.id)e.write(n.id,r,"binary");else{if(!n.id||!n.id.copy)throw new Error("object ["+JSON.stringify(n)+"] is not a valid ObjectId");n.id.copy(e,r,0,12)}return r+12},O=function(e,t,n,r,o){e[r++]=D.BSON_DATA_BINARY,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var s=n.length;return e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=D.BSON_BINARY_SUBTYPE_DEFAULT,n.copy(e,r,0,s),r+=s},_=function(e,t,n,r,o,s,i,a,c,u){for(var l=0;l<u.length;l++)if(u[l]===n)throw new Error("cyclic dependency detected");u.push(n),e[r++]=Array.isArray(n)?D.BSON_DATA_ARRAY:D.BSON_DATA_OBJECT,r+=c?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var p=M(e,n,o,r,s+1,i,a,u);return u.pop(),p},T=function(e,t,n,r,o){return e[r++]=D.BSON_DATA_DECIMAL128,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,n.bytes.copy(e,r,0,16),r+16},C=function(e,t,n,r,o){e[r++]="Long"===n._bsontype?D.BSON_DATA_LONG:D.BSON_DATA_TIMESTAMP,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var s=n.getLowBits(),i=n.getHighBits();return e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=255&i,e[r++]=i>>8&255,e[r++]=i>>16&255,e[r++]=i>>24&255,r},E=function(e,t,n,r,o){return e[r++]=D.BSON_DATA_INT,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,e[r++]=255&n,e[r++]=n>>8&255,e[r++]=n>>16&255,e[r++]=n>>24&255,r},N=function(e,t,n,o,s){return e[o++]=D.BSON_DATA_NUMBER,o+=s?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0,r(e,n,o,"little",52,8),o+=8},I=function(e,t,n,r,o,s,i){e[r++]=D.BSON_DATA_CODE,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var a=c(n),u=e.write(a,r+4,"utf8")+1;return e[r]=255&u,e[r+1]=u>>8&255,e[r+2]=u>>16&255,e[r+3]=u>>24&255,r=r+4+u-1,e[r++]=0,r},x=function(e,t,n,r,o,s,i,a,c){if(n.scope&&"object"==typeof n.scope){e[r++]=D.BSON_DATA_CODE_W_SCOPE;var u=c?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=u,e[r++]=0;var l=r,p="string"==typeof n.code?n.code:n.code.toString();r+=4;var f=e.write(p,r+4,"utf8")+1;e[r]=255&f,e[r+1]=f>>8&255,e[r+2]=f>>16&255,e[r+3]=f>>24&255,e[r+4+f-1]=0,r=r+f+4;var h=M(e,n.scope,o,r,s+1,i,a);r=h-1;var d=h-l;e[l++]=255&d,e[l++]=d>>8&255,e[l++]=d>>16&255,e[l++]=d>>24&255,e[r++]=0}else{e[r++]=D.BSON_DATA_CODE,r+=u=c?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,p=n.code.toString();var m=e.write(p,r+4,"utf8")+1;e[r]=255&m,e[r+1]=m>>8&255,e[r+2]=m>>16&255,e[r+3]=m>>24&255,r=r+4+m-1,e[r++]=0}return r},A=function(e,t,n,r,o){e[r++]=D.BSON_DATA_BINARY,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var s=n.value(!0),i=n.position;return n.sub_type===a.SUBTYPE_BYTE_ARRAY&&(i+=4),e[r++]=255&i,e[r++]=i>>8&255,e[r++]=i>>16&255,e[r++]=i>>24&255,e[r++]=n.sub_type,n.sub_type===a.SUBTYPE_BYTE_ARRAY&&(i-=4,e[r++]=255&i,e[r++]=i>>8&255,e[r++]=i>>16&255,e[r++]=i>>24&255),s.copy(e,r,0,n.position),r+=n.position},k=function(e,t,n,r,o){e[r++]=D.BSON_DATA_SYMBOL,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var s=e.write(n.value,r+4,"utf8")+1;return e[r]=255&s,e[r+1]=s>>8&255,e[r+2]=s>>16&255,e[r+3]=s>>24&255,r=r+4+s-1,e[r++]=0,r},B=function(e,t,n,r,o,s,i){e[r++]=D.BSON_DATA_OBJECT,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var a,c=r,u=(a=null!=n.db?M(e,{$ref:n.namespace,$id:n.oid,$db:n.db},!1,r,o+1,s):M(e,{$ref:n.namespace,$id:n.oid},!1,r,o+1,s))-c;return e[c++]=255&u,e[c++]=u>>8&255,e[c++]=u>>16&255,e[c++]=u>>24&255,a},M=function(e,t,n,r,o,s,a,c){r=r||0,(c=c||[]).push(t);var M=r+4;if(Array.isArray(t))for(var D=0;D<t.length;D++){var R=""+D,P=t[D];if(P&&P.toBSON){if("function"!=typeof P.toBSON)throw new Error("toBSON is not a function");P=P.toBSON()}var L=typeof P;"string"===L?M=h(e,R,P,M,!0):"number"===L?M=d(e,R,P,M,!0):"boolean"===L?M=y(e,R,P,M,!0):P instanceof Date||p(P)?M=g(e,R,P,M,!0):void 0===P?M=m(e,R,0,M,!0):null===P?M=m(e,R,0,M,!0):"ObjectID"===P._bsontype?M=w(e,R,P,M,!0):Buffer.isBuffer(P)?M=O(e,R,P,M,!0):P instanceof RegExp||f(P)?M=b(e,R,P,M,!0):"object"===L&&null==P._bsontype?M=_(e,R,P,M,n,o,s,a,!0,c):"object"===L&&"Decimal128"===P._bsontype?M=T(e,R,P,M,!0):"Long"===P._bsontype||"Timestamp"===P._bsontype?M=C(e,R,P,M,!0):"Double"===P._bsontype?M=N(e,R,P,M,!0):"function"==typeof P&&s?M=I(e,R,P,M,0,0,s):"Code"===P._bsontype?M=x(e,R,P,M,n,o,s,a,!0):"Binary"===P._bsontype?M=A(e,R,P,M,!0):"Symbol"===P._bsontype?M=k(e,R,P,M,!0):"DBRef"===P._bsontype?M=B(e,R,P,M,o,s,!0):"BSONRegExp"===P._bsontype?M=v(e,R,P,M,!0):"Int32"===P._bsontype?M=E(e,R,P,M,!0):"MinKey"!==P._bsontype&&"MaxKey"!==P._bsontype||(M=S(e,R,P,M,!0))}else if(t instanceof i)for(var j=t.entries(),U=!1;!U;){var z=j.next();if(!(U=z.done)){if(R=z.value[0],L=typeof(P=z.value[1]),"string"==typeof R&&-1===l.indexOf(R)){if(null!=R.match(u))throw Error("key "+R+" must not contain null bytes");if(n){if("$"===R[0])throw Error("key "+R+" must not start with '$'");if(~R.indexOf("."))throw Error("key "+R+" must not contain '.'")}}"string"===L?M=h(e,R,P,M):"number"===L?M=d(e,R,P,M):"boolean"===L?M=y(e,R,P,M):P instanceof Date||p(P)?M=g(e,R,P,M):null===P||void 0===P&&!1===a?M=m(e,R,0,M):"ObjectID"===P._bsontype?M=w(e,R,P,M):Buffer.isBuffer(P)?M=O(e,R,P,M):P instanceof RegExp||f(P)?M=b(e,R,P,M):"object"===L&&null==P._bsontype?M=_(e,R,P,M,n,o,s,a,!1,c):"object"===L&&"Decimal128"===P._bsontype?M=T(e,R,P,M):"Long"===P._bsontype||"Timestamp"===P._bsontype?M=C(e,R,P,M):"Double"===P._bsontype?M=N(e,R,P,M):"Code"===P._bsontype?M=x(e,R,P,M,n,o,s,a):"function"==typeof P&&s?M=I(e,R,P,M,0,0,s):"Binary"===P._bsontype?M=A(e,R,P,M):"Symbol"===P._bsontype?M=k(e,R,P,M):"DBRef"===P._bsontype?M=B(e,R,P,M,o,s):"BSONRegExp"===P._bsontype?M=v(e,R,P,M):"Int32"===P._bsontype?M=E(e,R,P,M):"MinKey"!==P._bsontype&&"MaxKey"!==P._bsontype||(M=S(e,R,P,M))}}else{if(t.toBSON){if("function"!=typeof t.toBSON)throw new Error("toBSON is not a function");if(null!=(t=t.toBSON())&&"object"!=typeof t)throw new Error("toBSON function did not return an object")}for(R in t){if((P=t[R])&&P.toBSON){if("function"!=typeof P.toBSON)throw new Error("toBSON is not a function");P=P.toBSON()}if(L=typeof P,"string"==typeof R&&-1===l.indexOf(R)){if(null!=R.match(u))throw Error("key "+R+" must not contain null bytes");if(n){if("$"===R[0])throw Error("key "+R+" must not start with '$'");if(~R.indexOf("."))throw Error("key "+R+" must not contain '.'")}}"string"===L?M=h(e,R,P,M):"number"===L?M=d(e,R,P,M):"boolean"===L?M=y(e,R,P,M):P instanceof Date||p(P)?M=g(e,R,P,M):void 0===P?!1===a&&(M=m(e,R,0,M)):null===P?M=m(e,R,0,M):"ObjectID"===P._bsontype?M=w(e,R,P,M):Buffer.isBuffer(P)?M=O(e,R,P,M):P instanceof RegExp||f(P)?M=b(e,R,P,M):"object"===L&&null==P._bsontype?M=_(e,R,P,M,n,o,s,a,!1,c):"object"===L&&"Decimal128"===P._bsontype?M=T(e,R,P,M):"Long"===P._bsontype||"Timestamp"===P._bsontype?M=C(e,R,P,M):"Double"===P._bsontype?M=N(e,R,P,M):"Code"===P._bsontype?M=x(e,R,P,M,n,o,s,a):"function"==typeof P&&s?M=I(e,R,P,M,0,0,s):"Binary"===P._bsontype?M=A(e,R,P,M):"Symbol"===P._bsontype?M=k(e,R,P,M):"DBRef"===P._bsontype?M=B(e,R,P,M,o,s):"BSONRegExp"===P._bsontype?M=v(e,R,P,M):"Int32"===P._bsontype?M=E(e,R,P,M):"MinKey"!==P._bsontype&&"MaxKey"!==P._bsontype||(M=S(e,R,P,M))}}c.pop(),e[M++]=0;var q=M-r;return e[r++]=255&q,e[r++]=q>>8&255,e[r++]=q>>16&255,e[r++]=q>>24&255,M},D={BSON_DATA_NUMBER:1,BSON_DATA_STRING:2,BSON_DATA_OBJECT:3,BSON_DATA_ARRAY:4,BSON_DATA_BINARY:5,BSON_DATA_UNDEFINED:6,BSON_DATA_OID:7,BSON_DATA_BOOLEAN:8,BSON_DATA_DATE:9,BSON_DATA_NULL:10,BSON_DATA_REGEXP:11,BSON_DATA_CODE:13,BSON_DATA_SYMBOL:14,BSON_DATA_CODE_W_SCOPE:15,BSON_DATA_INT:16,BSON_DATA_TIMESTAMP:17,BSON_DATA_LONG:18,BSON_DATA_DECIMAL128:19,BSON_DATA_MIN_KEY:255,BSON_DATA_MAX_KEY:127,BSON_BINARY_SUBTYPE_DEFAULT:0,BSON_BINARY_SUBTYPE_FUNCTION:1,BSON_BINARY_SUBTYPE_BYTE_ARRAY:2,BSON_BINARY_SUBTYPE_UUID:3,BSON_BINARY_SUBTYPE_MD5:4,BSON_BINARY_SUBTYPE_USER_DEFINED:128,BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648};D.BSON_INT64_MAX=Math.pow(2,63)-1,D.BSON_INT64_MIN=-Math.pow(2,63),D.JS_INT_MAX=9007199254740992,D.JS_INT_MIN=-9007199254740992,e.exports=M},function(e,t){t.readIEEE754=function(e,t,n,r,o){var s,i,a="big"===n,c=8*o-r-1,u=(1<<c)-1,l=u>>1,p=-7,f=a?0:o-1,h=a?1:-1,d=e[t+f];for(f+=h,s=d&(1<<-p)-1,d>>=-p,p+=c;p>0;s=256*s+e[t+f],f+=h,p-=8);for(i=s&(1<<-p)-1,s>>=-p,p+=r;p>0;i=256*i+e[t+f],f+=h,p-=8);if(0===s)s=1-l;else{if(s===u)return i?NaN:1/0*(d?-1:1);i+=Math.pow(2,r),s-=l}return(d?-1:1)*i*Math.pow(2,s-r)},t.writeIEEE754=function(e,t,n,r,o,s){var i,a,c,u="big"===r,l=8*s-o-1,p=(1<<l)-1,f=p>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,d=u?s-1:0,m=u?-1:1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,i=p):(i=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-i))<1&&(i--,c*=2),(t+=i+f>=1?h/c:h*Math.pow(2,1-f))*c>=2&&(i++,c/=2),i+f>=p?(a=0,i=p):i+f>=1?(a=(t*c-1)*Math.pow(2,o),i+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,o),i=0));o>=8;e[n+d]=255&a,d+=m,a/=256,o-=8);for(i=i<<o|a,l+=o;l>0;e[n+d]=255&i,d+=m,i/=256,l-=8);e[n+d-m]|=128*y}},function(e,t,n){"use strict";var r=n(26).Long,o=n(37).Double,s=n(38).Timestamp,i=n(39).ObjectID,a=n(41).Symbol,c=n(40).BSONRegExp,u=n(42).Code,l=n(43),p=n(30).MinKey,f=n(44).MaxKey,h=n(45).DBRef,d=n(31).Binary,m=n(76).normalizedFunctionString,y=function(e){return"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)},g=function(e,t,n){var r=5;if(Array.isArray(e))for(var o=0;o<e.length;o++)r+=b(o.toString(),e[o],t,!0,n);else for(var s in e.toBSON&&(e=e.toBSON()),e)r+=b(s,e[s],t,!1,n);return r};function b(e,t,n,b,S){switch(t&&t.toBSON&&(t=t.toBSON()),typeof t){case"string":return 1+Buffer.byteLength(e,"utf8")+1+4+Buffer.byteLength(t,"utf8")+1;case"number":return Math.floor(t)===t&&t>=v.JS_INT_MIN&&t<=v.JS_INT_MAX&&t>=v.BSON_INT32_MIN&&t<=v.BSON_INT32_MAX?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+5:(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;case"undefined":return b||!S?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1:0;case"boolean":return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+2;case"object":if(null==t||t instanceof p||t instanceof f||"MinKey"===t._bsontype||"MaxKey"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1;if(t instanceof i||"ObjectID"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+13;if(t instanceof Date||y(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;if("undefined"!=typeof Buffer&&Buffer.isBuffer(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+6+t.length;if(t instanceof r||t instanceof o||t instanceof s||"Long"===t._bsontype||"Double"===t._bsontype||"Timestamp"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;if(t instanceof l||"Decimal128"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+17;if(t instanceof u||"Code"===t._bsontype)return null!=t.scope&&Object.keys(t.scope).length>0?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(t.code.toString(),"utf8")+1+g(t.scope,n,S):(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(t.code.toString(),"utf8")+1;if(t instanceof d||"Binary"===t._bsontype)return t.sub_type===d.SUBTYPE_BYTE_ARRAY?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1+4):(null!=e?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1);if(t instanceof a||"Symbol"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+Buffer.byteLength(t.value,"utf8")+4+1+1;if(t instanceof h||"DBRef"===t._bsontype){var w={$ref:t.namespace,$id:t.oid};return null!=t.db&&(w.$db=t.db),(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+g(w,n,S)}return t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:t instanceof c||"BSONRegExp"===t._bsontype?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.pattern,"utf8")+1+Buffer.byteLength(t.options,"utf8")+1:(null!=e?Buffer.byteLength(e,"utf8")+1:0)+g(t,n,S)+1;case"function":if(t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)||"[object RegExp]"===String.call(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;if(n&&null!=t.scope&&Object.keys(t.scope).length>0)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(m(t),"utf8")+1+g(t.scope,n,S);if(n)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(m(t),"utf8")+1}return 0}var v={BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648,JS_INT_MAX:9007199254740992,JS_INT_MIN:-9007199254740992};e.exports=g},function(e,t,n){"use strict";var r=n(33),o=n(92);e.exports=function(e,t){if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected `fromDir` and `moduleId` to be a string");e=r.resolve(e);var n=r.join(e,"noop.js");try{return o._resolveFilename(t,{id:n,filename:n,paths:o._nodeModulePaths(e)})}catch(e){return null}}},function(e,t){var n;t=e.exports=Y,n="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var r=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,s=t.re=[],i=t.src=[],a=0,c=a++;i[c]="0|[1-9]\\d*";var u=a++;i[u]="[0-9]+";var l=a++;i[l]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var p=a++;i[p]="("+i[c]+")\\.("+i[c]+")\\.("+i[c]+")";var f=a++;i[f]="("+i[u]+")\\.("+i[u]+")\\.("+i[u]+")";var h=a++;i[h]="(?:"+i[c]+"|"+i[l]+")";var d=a++;i[d]="(?:"+i[u]+"|"+i[l]+")";var m=a++;i[m]="(?:-("+i[h]+"(?:\\."+i[h]+")*))";var y=a++;i[y]="(?:-?("+i[d]+"(?:\\."+i[d]+")*))";var g=a++;i[g]="[0-9A-Za-z-]+";var b=a++;i[b]="(?:\\+("+i[g]+"(?:\\."+i[g]+")*))";var v=a++,S="v?"+i[p]+i[m]+"?"+i[b]+"?";i[v]="^"+S+"$";var w="[v=\\s]*"+i[f]+i[y]+"?"+i[b]+"?",O=a++;i[O]="^"+w+"$";var _=a++;i[_]="((?:<|>)?=?)";var T=a++;i[T]=i[u]+"|x|X|\\*";var C=a++;i[C]=i[c]+"|x|X|\\*";var E=a++;i[E]="[v=\\s]*("+i[C]+")(?:\\.("+i[C]+")(?:\\.("+i[C]+")(?:"+i[m]+")?"+i[b]+"?)?)?";var N=a++;i[N]="[v=\\s]*("+i[T]+")(?:\\.("+i[T]+")(?:\\.("+i[T]+")(?:"+i[y]+")?"+i[b]+"?)?)?";var I=a++;i[I]="^"+i[_]+"\\s*"+i[E]+"$";var x=a++;i[x]="^"+i[_]+"\\s*"+i[N]+"$";var A=a++;i[A]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var k=a++;i[k]="(?:~>?)";var B=a++;i[B]="(\\s*)"+i[k]+"\\s+",s[B]=new RegExp(i[B],"g");var M=a++;i[M]="^"+i[k]+i[E]+"$";var D=a++;i[D]="^"+i[k]+i[N]+"$";var R=a++;i[R]="(?:\\^)";var P=a++;i[P]="(\\s*)"+i[R]+"\\s+",s[P]=new RegExp(i[P],"g");var L=a++;i[L]="^"+i[R]+i[E]+"$";var j=a++;i[j]="^"+i[R]+i[N]+"$";var U=a++;i[U]="^"+i[_]+"\\s*("+w+")$|^$";var z=a++;i[z]="^"+i[_]+"\\s*("+S+")$|^$";var q=a++;i[q]="(\\s*)"+i[_]+"\\s*("+w+"|"+i[E]+")",s[q]=new RegExp(i[q],"g");var $=a++;i[$]="^\\s*("+i[E]+")\\s+-\\s+("+i[E]+")\\s*$";var F=a++;i[F]="^\\s*("+i[N]+")\\s+-\\s+("+i[N]+")\\s*$";var W=a++;i[W]="(<|>)?=?\\s*\\*";for(var H=0;H<a;H++)n(H,i[H]),s[H]||(s[H]=new RegExp(i[H]));function V(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof Y)return e;if("string"!=typeof e)return null;if(e.length>r)return null;if(!(t.loose?s[O]:s[v]).test(e))return null;try{return new Y(e,t)}catch(e){return null}}function Y(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof Y){if(e.loose===t.loose)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>r)throw new TypeError("version is longer than "+r+" characters");if(!(this instanceof Y))return new Y(e,t);n("SemVer",e,t),this.options=t,this.loose=!!t.loose;var i=e.trim().match(t.loose?s[O]:s[v]);if(!i)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<o)return t}return e}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}t.parse=V,t.valid=function(e,t){var n=V(e,t);return n?n.version:null},t.clean=function(e,t){var n=V(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null},t.SemVer=Y,Y.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Y.prototype.toString=function(){return this.version},Y.prototype.compare=function(e){return n("SemVer.compare",this.version,this.options,e),e instanceof Y||(e=new Y(e,this.options)),this.compareMain(e)||this.comparePre(e)},Y.prototype.compareMain=function(e){return e instanceof Y||(e=new Y(e,this.options)),G(this.major,e.major)||G(this.minor,e.minor)||G(this.patch,e.patch)},Y.prototype.comparePre=function(e){if(e instanceof Y||(e=new Y(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],o=e.prerelease[t];if(n("prerelease compare",t,r,o),void 0===r&&void 0===o)return 0;if(void 0===o)return 1;if(void 0===r)return-1;if(r!==o)return G(r,o)}while(++t)},Y.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);-1===n&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,n,r){"string"==typeof n&&(r=n,n=void 0);try{return new Y(e,n).inc(t,r).version}catch(e){return null}},t.diff=function(e,t){if(Q(e,t))return null;var n=V(e),r=V(t);if(n.prerelease.length||r.prerelease.length){for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==r[o])return"pre"+o;return"prerelease"}for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==r[o])return o},t.compareIdentifiers=G;var K=/^[0-9]+$/;function G(e,t){var n=K.test(e),r=K.test(t);return n&&r&&(e=+e,t=+t),n&&!r?-1:r&&!n?1:e<t?-1:e>t?1:0}function J(e,t,n){return new Y(e,n).compare(new Y(t,n))}function Z(e,t,n){return J(e,t,n)>0}function X(e,t,n){return J(e,t,n)<0}function Q(e,t,n){return 0===J(e,t,n)}function ee(e,t,n){return 0!==J(e,t,n)}function te(e,t,n){return J(e,t,n)>=0}function ne(e,t,n){return J(e,t,n)<=0}function re(e,t,n,r){var o;switch(t){case"===":"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),o=e===n;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),o=e!==n;break;case"":case"=":case"==":o=Q(e,n,r);break;case"!=":o=ee(e,n,r);break;case">":o=Z(e,n,r);break;case">=":o=te(e,n,r);break;case"<":o=X(e,n,r);break;case"<=":o=ne(e,n,r);break;default:throw new TypeError("Invalid operator: "+t)}return o}function oe(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof oe){if(e.loose===!!t.loose)return e;e=e.value}if(!(this instanceof oe))return new oe(e,t);n("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===se?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}t.rcompareIdentifiers=function(e,t){return G(t,e)},t.major=function(e,t){return new Y(e,t).major},t.minor=function(e,t){return new Y(e,t).minor},t.patch=function(e,t){return new Y(e,t).patch},t.compare=J,t.compareLoose=function(e,t){return J(e,t,!0)},t.rcompare=function(e,t,n){return J(t,e,n)},t.sort=function(e,n){return e.sort(function(e,r){return t.compare(e,r,n)})},t.rsort=function(e,n){return e.sort(function(e,r){return t.rcompare(e,r,n)})},t.gt=Z,t.lt=X,t.eq=Q,t.neq=ee,t.gte=te,t.lte=ne,t.cmp=re,t.Comparator=oe;var se={};function ie(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof ie)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new ie(e.raw,t);if(e instanceof oe)return new ie(e.value,t);if(!(this instanceof ie))return new ie(e,t);if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function ae(e){return!e||"x"===e.toLowerCase()||"*"===e}function ce(e,t,n,r,o,s,i,a,c,u,l,p,f){return((t=ae(n)?"":ae(r)?">="+n+".0.0":ae(o)?">="+n+"."+r+".0":">="+t)+" "+(a=ae(c)?"":ae(u)?"<"+(+c+1)+".0.0":ae(l)?"<"+c+"."+(+u+1)+".0":p?"<="+c+"."+u+"."+l+"-"+p:"<="+a)).trim()}function ue(e,t,r){for(var o=0;o<e.length;o++)if(!e[o].test(t))return!1;if(r||(r={}),t.prerelease.length&&!r.includePrerelease){for(o=0;o<e.length;o++)if(n(e[o].semver),e[o].semver!==se&&e[o].semver.prerelease.length>0){var s=e[o].semver;if(s.major===t.major&&s.minor===t.minor&&s.patch===t.patch)return!0}return!1}return!0}function le(e,t,n){try{t=new ie(t,n)}catch(e){return!1}return t.test(e)}function pe(e,t,n,r){var o,s,i,a,c;switch(e=new Y(e,r),t=new ie(t,r),n){case">":o=Z,s=ne,i=X,a=">",c=">=";break;case"<":o=X,s=te,i=Z,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(le(e,t,r))return!1;for(var u=0;u<t.set.length;++u){var l=null,p=null;if(t.set[u].forEach(function(e){e.semver===se&&(e=new oe(">=0.0.0")),l=l||e,p=p||e,o(e.semver,l.semver,r)?l=e:i(e.semver,p.semver,r)&&(p=e)}),l.operator===a||l.operator===c)return!1;if((!p.operator||p.operator===a)&&s(e,p.semver))return!1;if(p.operator===c&&i(e,p.semver))return!1}return!0}oe.prototype.parse=function(e){var t=this.options.loose?s[U]:s[z],n=e.match(t);if(!n)throw new TypeError("Invalid comparator: "+e);this.operator=n[1],"="===this.operator&&(this.operator=""),n[2]?this.semver=new Y(n[2],this.options.loose):this.semver=se},oe.prototype.toString=function(){return this.value},oe.prototype.test=function(e){return n("Comparator.test",e,this.options.loose),this.semver===se||("string"==typeof e&&(e=new Y(e,this.options)),re(e,this.operator,this.semver,this.options))},oe.prototype.intersects=function(e,t){if(!(e instanceof oe))throw new TypeError("a Comparator is required");var n;if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return n=new ie(e.value,t),le(this.value,n,t);if(""===e.operator)return n=new ie(this.value,t),le(e.semver,n,t);var r=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),o=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),s=this.semver.version===e.semver.version,i=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),a=re(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),c=re(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return r||o||s&&i||a||c},t.Range=ie,ie.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},ie.prototype.toString=function(){return this.range},ie.prototype.parseRange=function(e){var t=this.options.loose;e=e.trim();var r=t?s[F]:s[$];e=e.replace(r,ce),n("hyphen replace",e),e=e.replace(s[q],"$1$2$3"),n("comparator trim",e,s[q]),e=(e=(e=e.replace(s[B],"$1~")).replace(s[P],"$1^")).split(/\s+/).join(" ");var o=t?s[U]:s[z],i=e.split(" ").map(function(e){return function(e,t){return n("comp",e,t),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){n("caret",e,t),t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1});var r=t.loose?s[j]:s[L];return e.replace(r,function(t,r,o,s,i){var a;return n("caret",e,t,r,o,s,i),ae(r)?a="":ae(o)?a=">="+r+".0.0 <"+(+r+1)+".0.0":ae(s)?a="0"===r?">="+r+"."+o+".0 <"+r+"."+(+o+1)+".0":">="+r+"."+o+".0 <"+(+r+1)+".0.0":i?(n("replaceCaret pr",i),"-"!==i.charAt(0)&&(i="-"+i),a="0"===r?"0"===o?">="+r+"."+o+"."+s+i+" <"+r+"."+o+"."+(+s+1):">="+r+"."+o+"."+s+i+" <"+r+"."+(+o+1)+".0":">="+r+"."+o+"."+s+i+" <"+(+r+1)+".0.0"):(n("no pr"),a="0"===r?"0"===o?">="+r+"."+o+"."+s+" <"+r+"."+o+"."+(+s+1):">="+r+"."+o+"."+s+" <"+r+"."+(+o+1)+".0":">="+r+"."+o+"."+s+" <"+(+r+1)+".0.0"),n("caret return",a),a})}(e,t)}).join(" ")}(e,t),n("caret",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1});var r=t.loose?s[D]:s[M];return e.replace(r,function(t,r,o,s,i){var a;return n("tilde",e,t,r,o,s,i),ae(r)?a="":ae(o)?a=">="+r+".0.0 <"+(+r+1)+".0.0":ae(s)?a=">="+r+"."+o+".0 <"+r+"."+(+o+1)+".0":i?(n("replaceTilde pr",i),"-"!==i.charAt(0)&&(i="-"+i),a=">="+r+"."+o+"."+s+i+" <"+r+"."+(+o+1)+".0"):a=">="+r+"."+o+"."+s+" <"+r+"."+(+o+1)+".0",n("tilde return",a),a})}(e,t)}).join(" ")}(e,t),n("tildes",e),e=function(e,t){return n("replaceXRanges",e,t),e.split(/\s+/).map(function(e){return function(e,t){e=e.trim(),t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1});var r=t.loose?s[x]:s[I];return e.replace(r,function(t,r,o,s,i,a){n("xRange",e,t,r,o,s,i,a);var c=ae(o),u=c||ae(s),l=u||ae(i),p=l;return"="===r&&p&&(r=""),c?t=">"===r||"<"===r?"<0.0.0":"*":r&&p?(u&&(s=0),l&&(i=0),">"===r?(r=">=",u?(o=+o+1,s=0,i=0):l&&(s=+s+1,i=0)):"<="===r&&(r="<",u?o=+o+1:s=+s+1),t=r+o+"."+s+"."+i):u?t=">="+o+".0.0 <"+(+o+1)+".0.0":l&&(t=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0"),n("xRange return",t),t})}(e,t)}).join(" ")}(e,t),n("xrange",e),e=function(e,t){return n("replaceStars",e,t),e.trim().replace(s[W],"")}(e,t),n("stars",e),e}(e,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(e){return!!e.match(o)})),i=i.map(function(e){return new oe(e,this.options)},this)},ie.prototype.intersects=function(e,t){if(!(e instanceof ie))throw new TypeError("a Range is required");return this.set.some(function(n){return n.every(function(n){return e.set.some(function(e){return e.every(function(e){return n.intersects(e,t)})})})})},t.toComparators=function(e,t){return new ie(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},ie.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new Y(e,this.options));for(var t=0;t<this.set.length;t++)if(ue(this.set[t],e,this.options))return!0;return!1},t.satisfies=le,t.maxSatisfying=function(e,t,n){var r=null,o=null;try{var s=new ie(t,n)}catch(e){return null}return e.forEach(function(e){s.test(e)&&(r&&-1!==o.compare(e)||(o=new Y(r=e,n)))}),r},t.minSatisfying=function(e,t,n){var r=null,o=null;try{var s=new ie(t,n)}catch(e){return null}return e.forEach(function(e){s.test(e)&&(r&&1!==o.compare(e)||(o=new Y(r=e,n)))}),r},t.validRange=function(e,t){try{return new ie(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,n){return pe(e,t,"<",n)},t.gtr=function(e,t,n){return pe(e,t,">",n)},t.outside=pe,t.prerelease=function(e,t){var n=V(e,t);return n&&n.prerelease.length?n.prerelease:null},t.intersects=function(e,t,n){return e=new ie(e,n),t=new ie(t,n),e.intersects(t)},t.coerce=function(e){if(e instanceof Y)return e;if("string"!=typeof e)return null;var t=e.match(s[A]);return null==t?null:V((t[1]||"0")+"."+(t[2]||"0")+"."+(t[3]||"0"))}},function(e,t,n){"use strict";const r=n(1).inherits,o=n(9).EventEmitter,s=n(77),i=n(4).MongoError,a=n(4).MongoNetworkError,c=n(4).MongoWriteConcernError,u=n(23),l=n(1).format,p=n(12).Query,f=n(123),h=n(21).MESSAGE_HEADER_SIZE,d=n(21).opcodes,m=n(46).compress,y=n(46).compressorIDs,g=n(46).uncompressibleCommands,b=n(10).resolveClusterTime,v=n(125),S=n(47).defaultAuthProviders,w=n(19).Buffer;var O="disconnected",_="connecting",T="connected",C="destroying",E="destroyed",N=0;var I=function(e,t){if(o.call(this),this.topology=e,this.options=Object.assign({host:"localhost",port:27017,size:5,minSize:0,connectionTimeout:3e4,socketTimeout:36e4,keepAlive:!0,keepAliveInitialDelay:3e5,noDelay:!0,ssl:!1,checkServerIdentity:!0,ca:null,crl:null,cert:null,key:null,passPhrase:null,rejectUnauthorized:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,reconnect:!0,reconnectInterval:1e3,reconnectTries:30,domainsEnabled:!1},t),this.id=N++,this.retriesLeft=this.options.reconnectTries,this.reconnectId=null,!t.bson||t.bson&&("function"!=typeof t.bson.serialize||"function"!=typeof t.bson.deserialize))throw new Error("must pass in valid bson parser");this.logger=u("Pool",t),this.state=O,this.availableConnections=[],this.inUseConnections=[],this.connectingConnections=[],this.executing=!1,this.queue=[],this.authProviders=t.authProviders||S(t.bson),this.reconnectConnection=null,this.authenticating=!1,this.loggingout=!1,this.nonAuthenticatedConnections=[],this.authenticatingTimestamp=null,this.numberOfConsecutiveTimeouts=0,this.connectionIndex=0};function x(e,t){var n={disconnected:[_,C,O],connecting:[_,C,T,O],connected:[T,O,C],destroying:[C,E],destroyed:[E]}[e.state];n&&-1!==n.indexOf(t)?(e.emit("stateChanged",e.state,t),e.state=t):e.logger.error(l("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}function A(e,t,n,r){if(void 0===t[0])return r(null);var o=t[0],s=t[1];if(!e.authProviders[o])throw new i(l("authMechanism %s not supported",o));var a=e.authProviders[o];a.auth.apply(a,[k(e),[n],s].concat(t.slice(2)).concat([r]))}function k(e){return function(t,n,r){if(e.state===E||e.state===C)return r(new i("pool destroyed"));t.workItems.push({cb:r,command:!0,requestId:n.requestId}),t.write(n.toBin())}}function B(e,t,n){!function e(t,n,r,o){if(0===r.length)return o();t.authProviders[r.pop()].reauthenticate(k(t),[n],function(s){if(s)return o(s);e(t,n,r,o)})}(e,t,Object.keys(e.authProviders),n)}function M(e,t){return function(n){if(this._connectionFailHandled)return;for(this._connectionFailHandled=!0,this.destroy(),$(e,this);this.workItems.length>0;){var r=this.workItems.shift();r.cb&&r.cb(n)}if("timeout"===t&&(e.numberOfConsecutiveTimeouts=e.numberOfConsecutiveTimeouts+1,e.numberOfConsecutiveTimeouts>e.options.reconnectTries))return e.numberOfConsecutiveTimeouts=0,e.destroy(!0),e.emit("close",e);0===e.socketCount()&&(e.state!==E&&e.state!==C&&x(e,O),t="error"===t?"close":t,e.emit(t,n)),!e.reconnectId&&e.options.reconnect&&(e.reconnectId=setTimeout(D(e),e.options.reconnectInterval)),e.availableConnections.length+e.connectingConnections.length+e.inUseConnections.length<e.minSize&&W(e)}}function D(e){return function(){function t(e){return function(){this._connectionFailHandled||(this._connectionFailHandled=!0,this.destroy(),e.retriesLeft=e.retriesLeft-1,e.retriesLeft<=0?(e.destroy(),e.emit("reconnectFailed",new a(l("failed to reconnect after %s attempts with interval %s ms",e.options.reconnectTries,e.options.reconnectInterval)))):e.reconnectId=setTimeout(D(e),e.options.reconnectInterval))}}e.emit("attemptReconnect",e),e.state!==E&&e.state!==C&&(e.isConnected()?e.reconnectId=null:(e.reconnectConnection=new s(P(e),e.options),e.reconnectConnection.on("close",t(e)),e.reconnectConnection.on("error",t(e)),e.reconnectConnection.on("timeout",t(e)),e.reconnectConnection.on("parseError",t(e)),e.reconnectConnection.on("connect",function(e){return function(){var t=this;if(e.state===E||e.state===C)return t.destroy();F.forEach(function(e){t.removeAllListeners(e)}),e.reconnectId=null,t.on("error",M(e,"error")),t.on("close",M(e,"close")),t.on("timeout",M(e,"timeout")),t.on("parseError",M(e,"parseError")),B(e,this,function(){e.retriesLeft=e.options.reconnectTries,e.availableConnections.push(t),e.reconnectConnection=null,e.emit("reconnect",e),V(e)()})}}(e)),e.reconnectConnection.connect()))}}function R(e,t,n){var r=t.indexOf(e);-1!==r&&(t.splice(r,1),n.push(e))}function P(e){return function(t,n){for(var r=null,o=0;o<n.workItems.length;o++)n.workItems[o].requestId===t.responseTo&&(r=n.workItems[o],n.workItems.splice(o,1));function s(e,t,n,r){if(!e.options.domainsEnabled)return process.nextTick(function(){return t(n,r)});t(n,r)}e.numberOfConsecutiveTimeouts=0,r&&r.socketTimeout&&n.resetSocketTimeout(),e.logger.isDebug()&&e.logger.debug(l("message [%s] received from %s:%s",t.raw.toString("hex"),e.options.host,e.options.port)),function(e,t,n){var r=e.nonAuthenticatedConnections.slice(0),o=e.nonAuthenticatedConnections;if(e.nonAuthenticatedConnections=[],1===t.workItems.length&&(!0===t.workItems[0].authenticating||"number"==typeof t.workItems[0].authenticatingTimestamp&&t.workItems[0].authenticatingTimestamp!==e.authenticatingTimestamp)&&r.push(t),0===r.length)return R(t,e.inUseConnections,e.availableConnections),n();for(var s=r.length,i=0;i<s;i++)B(e,r[i],function(){0==(s-=1)&&(e.availableConnections=e.availableConnections.concat(o),R(t,e.inUseConnections,e.availableConnections),n())})}(e,n,function(){if(e.executing||process.nextTick(function(){V(e)()}),r&&!r.immediateRelease){try{t.parse(r)}catch(t){return s(e,r.cb,new i(t))}if(t.documents[0]){if(t.documents[0].$clusterTime){const n=t.documents[0].$clusterTime;e.topology.clusterTime=n,null!=r.session&&b(r.session,n)}t.documents[0].operationTime&&r.session&&r.session.supports.causalConsistency&&r.session.advanceOperationTime(t.documents[0].operationTime)}if(r.command&&t.documents[0]){const n=t.documents[0];if(0===n.ok||n.$err||n.errmsg||n.code)return s(e,r.cb,new i(n));if(n.writeConcernError){const t=1===n.ok?new c(n.writeConcernError,n):new c(n.writeConcernError);return s(e,r.cb,t)}}t.hashedName=n.hashedName,s(e,r.cb,null,new f(r.fullResult?t:t.documents[0],n,t))}})}}r(I,o),Object.defineProperty(I.prototype,"size",{enumerable:!0,get:function(){return this.options.size}}),Object.defineProperty(I.prototype,"minSize",{enumerable:!0,get:function(){return this.options.minSize}}),Object.defineProperty(I.prototype,"connectionTimeout",{enumerable:!0,get:function(){return this.options.connectionTimeout}}),Object.defineProperty(I.prototype,"socketTimeout",{enumerable:!0,get:function(){return this.options.socketTimeout}}),I.prototype.socketCount=function(){return this.availableConnections.length+this.inUseConnections.length},I.prototype.allConnections=function(){return this.availableConnections.concat(this.inUseConnections).concat(this.connectingConnections)},I.prototype.get=function(){return this.allConnections()[0]},I.prototype.isConnected=function(){if(this.state===E||this.state===C)return!1;for(var e=this.availableConnections.concat(this.inUseConnections),t=0;t<e.length;t++)if(e[t].isConnected())return!0;return!(0!==e.length||!this.authenticating)},I.prototype.isDestroyed=function(){return this.state===E||this.state===C},I.prototype.isDisconnected=function(){return this.state===O},I.prototype.connect=function(){if(this.state!==O)throw new i("connection in unlawful state "+this.state);var e=this;x(this,_);var t=Array.prototype.slice.call(arguments,0),n=new s(P(e),this.options);this.connectingConnections.push(n),n.once("connect",function(n){return e.state===E||e.state===C?e.destroy():e.options.inTopology?(x(e,T),R(n,e.connectingConnections,e.availableConnections),e.emit("connect",e)):void B(e,n,function(r){return e.state===E||e.state===C?e.destroy():r?(e.destroy(),e.emit("error",r)):void A(e,t,n,function(t){if(e.state===E||e.state===C)return e.destroy();if(t)return e.destroy(),e.emit("error",t);if(x(e,T),R(n,e.connectingConnections,e.availableConnections),e.minSize)for(let t=0;t<e.minSize;t++)W(e);e.emit("connect",e)})})}),n.once("error",M(this,"error")),n.once("close",M(this,"close")),n.once("timeout",M(this,"timeout")),n.once("parseError",M(this,"parseError"));try{n.connect()}catch(t){process.nextTick(function(){e.emit("error",t)})}},I.prototype.auth=function(e){var t=this,n=Array.prototype.slice.call(arguments,0),r=n.pop();if(null==t.authProviders[e]&&"default"!==e)throw new i(l("auth provider %s does not exist",e));this.authenticating=!0,this.authenticatingTimestamp=(new Date).getTime(),function e(t,n){if(!t.loggingout)return n();setTimeout(function(){e(t,n)},1)}(t,function(){!function(e,t,n){var o=e.allConnections();e.availableConnections=[],e.inUseConnections=[],e.connectingConnections=[];var s=o.length,i=null;if(0===s)return e.authenticating=!1,r(null);for(var a=0;a<o.length;a++)A(e,t,o[a],function(t,r){if(s-=1,t&&(i=t),0===s){if(e.authenticating=!1,e.availableConnections=e.availableConnections.concat(o),i)return e.logger.isError()&&e.logger.error(l("[%s] failed to authenticate against server %s:%s",e.id,e.options.host,e.options.port)),n(i,r);n(null,r)}})}(t,n,function(e,n){t.authenticating=!1,r(e,n)})})},I.prototype.logout=function(e,t){var n=this;if("string"!=typeof e)throw new i("logout method requires a db name as first argument");if("function"!=typeof t)throw new i("logout method requires a callback");this.loggingout=!0;for(var r=n.availableConnections.concat(n.inUseConnections),o=r.length,s=null,a=0;a<r.length;a++)k(n)(r[a],new p(this.options.bson,l("%s.$cmd",e),{logout:1},{numberToSkip:0,numberToReturn:1}),function(e){o-=1,e&&(s=e),0===o&&(n.loggingout=!1,t(s))})},I.prototype.unref=function(){this.availableConnections.concat(this.inUseConnections).concat(this.connectingConnections).forEach(function(e){e.unref()})};var L=["error","close","timeout","parseError","connect"];function j(e,t){t.forEach(function(e){for(var t=0;t<L.length;t++)e.removeAllListeners(L[t]);e.destroy()}),e.inUseConnections=[],e.availableConnections=[],e.nonAuthenticatedConnections=[],e.connectingConnections=[],x(e,E)}I.prototype.destroy=function(e){var t=this;if(this.state!==E&&t.state!==C){if(x(this,C),e){for(var n=t.availableConnections.concat(t.inUseConnections).concat(t.nonAuthenticatedConnections).concat(t.connectingConnections);t.queue.length>0;){var r=t.queue.shift();"function"==typeof r.cb&&r.cb(new i("Pool was force destroyed"))}return j(t,n)}this.reconnectId&&clearTimeout(this.reconnectId),this.reconnectConnection&&this.reconnectConnection.destroy(),function e(){if(H(t.queue),0===t.queue.length){for(var n=t.availableConnections.concat(t.inUseConnections).concat(t.nonAuthenticatedConnections).concat(t.connectingConnections),r=0;r<n.length;r++)if(n[r].workItems.length>0)return setTimeout(e,1);j(t,n)}else V(t)(),setTimeout(e,1)}()}};var U=function(e,t,n,r){if(0===t.length)return r(null,n);var o=t.shift(),s=o.toBin();if(e.options.agreedCompressor&&!z(o)){var i=w.concat(s),a=i.slice(h),c=i.readInt32LE(12);m(e,a,function(s,i){if(s)return r(s,null);var u=w.alloc(h);u.writeInt32LE(h+9+i.length,0),u.writeInt32LE(o.requestId,4),u.writeInt32LE(0,8),u.writeInt32LE(d.OP_COMPRESSED,12);var l=w.alloc(9);l.writeInt32LE(c,0),l.writeInt32LE(a.length,4),l.writeUInt8(y[e.options.agreedCompressor],8),n.push(w.concat([u,l,i])),U(e,t,n,r)})}else n.push(s),U(e,t,n,r)};I.prototype.write=function(e,t,n){var r=this;if("function"==typeof t&&(n=t),t=t||{},"function"!=typeof n&&!t.noResponse)throw new i("write method must provide a callback");if(this.state!==E&&this.state!==C){if(this.options.domainsEnabled&&process.domain&&"function"==typeof n){var o=n;n=process.domain.bind(function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;t++)e[t]=arguments[t];process.nextTick(function(){o.apply(null,e)})})}var s={cb:n,raw:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,fullResult:!1};if(s.promoteLongs="boolean"!=typeof t.promoteLongs||t.promoteLongs,s.promoteValues="boolean"!=typeof t.promoteValues||t.promoteValues,s.promoteBuffers="boolean"==typeof t.promoteBuffers&&t.promoteBuffers,s.raw="boolean"==typeof t.raw&&t.raw,s.immediateRelease="boolean"==typeof t.immediateRelease&&t.immediateRelease,s.documentsReturnedIn=t.documentsReturnedIn,s.command="boolean"==typeof t.command&&t.command,s.fullResult="boolean"==typeof t.fullResult&&t.fullResult,s.noResponse="boolean"==typeof t.noResponse&&t.noResponse,s.session=t.session||null,s.socketTimeout=t.socketTimeout,s.monitoring=t.monitoring,t.socketTimeout&&(s.socketTimeout=t.socketTimeout),Array.isArray(e)||(e=[e]),s.requestId=e[e.length-1].requestId,function(e){return null!=e&&null!=e.ismaster&&e.ismaster.maxWireVersion>=6}(this.topology)){let t={};if(this.topology.clusterTime&&(t={$clusterTime:this.topology.clusterTime}),s.session){if(s.session.hasEnded)return n(new i("Use of expired sessions is not permitted"));s.session.clusterTime&&s.session.clusterTime.clusterTime.greaterThan(t.$clusterTime.clusterTime)&&(t.$clusterTime=s.session.clusterTime),t.lsid=s.session.id,s.session.serverSession.lastUse=Date.now()}e.forEach(e=>{e instanceof p?e.query.$query?Object.assign(e.query.$query,t):Object.assign(e.query,t):Object.assign(e,t)})}if(r.options.monitorCommands){const t=e[0];this.emit("commandStarted",new v.CommandStartedEvent(this,t)),s.started=process.hrtime(),s.cb=((e,o)=>{e?r.emit("commandFailed",new v.CommandFailedEvent(this,t,e,s.started)):o&&o.result&&(0===o.result.ok||o.result.$err)?r.emit("commandFailed",new v.CommandFailedEvent(this,t,o.result,s.started)):r.emit("commandSucceeded",new v.CommandSucceededEvent(this,t,o,s.started)),"function"==typeof n&&n(e,o)})}U(r,e,[],function(e,n){if(e)throw e;s.buffer=n,t.monitoring?r.queue.unshift(s):r.queue.push(s),r.executing||process.nextTick(function(){V(r)()})})}else if(n)try{n(new i("pool destroyed"))}catch(e){process.nextTick(function(){throw e})}};var z=function(e){return g.some(function(t){return e.query.hasOwnProperty(t)})};function q(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return t.splice(n,1),!0}function $(e,t){q(t,e.availableConnections)||q(t,e.inUseConnections)||q(t,e.connectingConnections)||q(t,e.nonAuthenticatedConnections)}var F=["close","message","error","timeout","parseError","connect"];function W(e){if(e.state!==E&&e.state!==C){var t=new s(P(e),e.options);e.connectingConnections.push(t);var n=function(t){return function(){t.destroy(),$(e,t),!e.reconnectId&&e.options.reconnect&&(e.reconnectId=setTimeout(D(e),e.options.reconnectInterval))}};t.once("close",n(t)),t.once("error",n(t)),t.once("timeout",n(t)),t.once("parseError",n(t)),t.once("connect",function(t){return function(){if(e.state===E||e.state===C)return $(e,t),t.destroy();F.forEach(function(e){t.removeAllListeners(e)}),t.once("close",M(e,"close")),t.once("error",M(e,"error")),t.once("timeout",M(e,"timeout")),t.once("parseError",M(e,"parseError")),B(e,t,function(n){return e.state===E||e.state===C?t.destroy():($(e,t),n?t.destroy():void(e.authenticating?e.nonAuthenticatedConnections.push(t):(e.availableConnections.push(t),V(e)())))})}}(t)),t.connect()}}function H(e){for(var t=0;t<e.length;t++)if(e[t].monitoring){var n=e[t];e.splice(t,1),n.cb(new i({message:"no connection available for monitoring",driver:!0}))}}function V(e){return function(){e.state!==E&&(e.executing||(e.executing=!0,function t(n){if(!e.authenticating)return n();setTimeout(function(){t(n)},1)}(function(){if(!(e.connectingConnections.length>0))for(;;){var t=e.availableConnections.length+e.connectingConnections.length+e.inUseConnections.length;if(0===e.availableConnections.length){H(e.queue);break}if(0===e.queue.length)break;for(var n=null,r=[],o=0;o<e.availableConnections.length;o++)0===e.availableConnections[o].workItems.length&&r.push(e.availableConnections[o]);if((n=0===r.length?e.availableConnections[e.connectionIndex++%e.availableConnections.length]:r[e.connectionIndex++%r.length]).isConnected()){var s=e.queue.shift();if(s.monitoring){var i=!1;for(o=0;o<e.availableConnections.length;o++)if(e.availableConnections[o].isConnected()&&0===e.availableConnections[o].workItems.length){i=!0,n=e.availableConnections[o];break}if(!i){e.queue.unshift(s),t<e.options.size&&e.queue.length>0&&W(e),setTimeout(function(){V(e)()},10);break}}if(t<e.options.size&&n.workItems.length>0){e.queue.unshift(s),W(e);break}var a=s.buffer;s.authenticating=e.authenticating,s.authenticatingTimestamp=e.authenticatingTimestamp,s.monitoring&&R(n,e.availableConnections,e.inUseConnections),s.noResponse||n.workItems.push(s),s.immediateRelease||"number"!=typeof s.socketTimeout||n.setSocketTimeout(s.socketTimeout);var c=!0;if(Array.isArray(a))for(o=0;o<a.length;o++)c=n.write(a[o]);else c=n.write(a);s.noResponse&&"function"==typeof s.cb&&s.cb(null,null),c&&s.immediateRelease&&e.authenticating?($(e,n),e.nonAuthenticatedConnections.push(n)):!1===c&&(e.queue.unshift(s),$(e,n),H(e.queue))}else $(e,n),H(e.queue)}}),e.executing=!1))}}I._execute=V,e.exports=I},function(e,t,n){"use strict";var r=function(e,t,n){this.result=e,this.connection=t,this.message=n};r.prototype.toJSON=function(){return this.result},r.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.exports=r},function(e){e.exports={_from:"mongodb-core@3.1.9",_id:"mongodb-core@3.1.9",_inBundle:!1,_integrity:"sha512-MJpciDABXMchrZphh3vMcqu8hkNf/Mi+Gk6btOimVg1XMxLXh87j6FAvRm+KmwD1A9fpu3qRQYcbQe4egj23og==",_location:"/mongodb-core",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"mongodb-core@3.1.9",name:"mongodb-core",escapedName:"mongodb-core",rawSpec:"3.1.9",saveSpec:null,fetchSpec:"3.1.9"},_requiredBy:["/mongodb","/mongoose"],_resolved:"https://registry.npmjs.org/mongodb-core/-/mongodb-core-3.1.9.tgz",_shasum:"c31ee407bf932b0149eaed775c17ee09974e4ca3",_spec:"mongodb-core@3.1.9",_where:"/Users/zubinpratap/Documents/DevProjects/Practice_Projects/visiJAM/src/functions/node_modules/mongodb",author:{name:"Christian Kvalheim"},bugs:{url:"https://github.com/mongodb-js/mongodb-core/issues"},bundleDependencies:!1,dependencies:{bson:"^1.1.0",require_optional:"^1.0.1","safe-buffer":"^5.1.2",saslprep:"^1.0.0"},deprecated:!1,description:"Core MongoDB driver functionality, no bells and whistles and meant for integration not end applications",devDependencies:{chai:"^4.1.2","chai-subset":"^1.6.0",co:"^4.6.0",eslint:"^4.6.1","eslint-plugin-prettier":"^2.2.0",jsdoc:"3.5.4","mongodb-extjson":"^2.1.2","mongodb-mock-server":"^1.0.0","mongodb-test-runner":"^1.1.18",prettier:"~1.12.0",sinon:"^6.0.0",snappy:"^6.1.1","standard-version":"^4.4.0"},files:["index.js","lib"],homepage:"https://github.com/mongodb-js/mongodb-core",keywords:["mongodb","core"],license:"Apache-2.0",main:"index.js",name:"mongodb-core",optionalDependencies:{saslprep:"^1.0.0"},peerOptionalDependencies:{kerberos:"^1.0.0","mongodb-extjson":"^2.1.2",snappy:"^6.1.1","bson-ext":"^2.0.0"},repository:{type:"git",url:"git://github.com/mongodb-js/mongodb-core.git"},scripts:{atlas:"node ./test/atlas.js",changelog:"conventional-changelog -p angular -i HISTORY.md -s",coverage:"nyc node test/runner.js -t functional -l && node_modules/.bin/nyc report --reporter=text-lcov | node_modules/.bin/coveralls",format:"prettier --print-width 100 --tab-width 2 --single-quote --write index.js 'test/**/*.js' 'lib/**/*.js'",lint:"eslint index.js lib test",release:"standard-version -i HISTORY.md",test:"npm run lint && mongodb-test-runner -t 60000 test/tests"},version:"3.1.9"}},function(e,t,n){"use strict";const r=n(12).KillCursor,o=n(12).GetMore,s=n(16).calculateDurationInMs,i=new Set(["authenticate","saslStart","saslContinue","getnonce","createUser","updateUser","copydbgetnonce","copydbsaslstart","copydb"]),a=e=>Object.keys(e)[0],c=e=>e.ns,u=e=>e.ns.split(".")[0],l=e=>e.ns.split(".")[1],p=e=>`${e.options.host}:${e.options.port}`,f=(e,t)=>i.has(e)?{}:t,h={$query:"filter",$orderby:"sort",$hint:"hint",$comment:"comment",$maxScan:"maxScan",$max:"max",$min:"min",$returnKey:"returnKey",$showDiskLoc:"showRecordId",$maxTimeMS:"maxTimeMS",$snapshot:"snapshot"},d={numberToSkip:"skip",numberToReturn:"batchSize",returnFieldsSelector:"projection"},m=["tailable","oplogReplay","noCursorTimeout","awaitData","partial","exhaust"],y=e=>{if(e instanceof o)return{getMore:e.cursorId,collection:l(e),batchSize:e.numberToReturn};if(e instanceof r)return{killCursors:l(e),cursors:e.cursorIds};if(e.query&&e.query.$query){let t;return"admin.$cmd"===e.ns?t=Object.assign({},e.query.$query):(t={find:l(e)},Object.keys(h).forEach(n=>{void 0!==e.query[n]&&(t[h[n]]=e.query[n])})),Object.keys(d).forEach(n=>{void 0!==e.options[n]&&(t[d[n]]=e.options[n])}),m.forEach(n=>{e[n]&&(t[n]=e[n])}),void 0!==e.pre32Limit&&(t.limit=e.pre32Limit),e.query.$explain?{explain:t}:t}return e.query?e.query:e},g=(e,t)=>e instanceof o?{ok:1,cursor:{id:t.message.cursorId,ns:c(e),nextBatch:t.message.documents}}:e instanceof r?{ok:1,cursorsUnknown:e.cursorIds}:e.query&&void 0!==e.query.$query?{ok:1,cursor:{id:t.message.cursorId,ns:c(e),firstBatch:t.message.documents}}:t.result;e.exports={CommandStartedEvent:class{constructor(e,t){const n=y(t),r=a(n);i.has(r)&&(this.commandObj={},this.commandObj[r]=!0),Object.assign(this,{command:n,databaseName:u(t),commandName:r,requestId:t.requestId,connectionId:p(e)})}},CommandSucceededEvent:class{constructor(e,t,n,r){const o=y(t),i=a(o);Object.assign(this,{duration:s(r),commandName:i,reply:f(i,g(t,n)),requestId:t.requestId,connectionId:p(e)})}},CommandFailedEvent:class{constructor(e,t,n,r){const o=y(t),i=a(o);Object.assign(this,{duration:s(r),commandName:i,failure:f(i,n),requestId:t.requestId,connectionId:p(e)})}}}},function(e,t,n){"use strict";const r=n(1).format,o=n(12).Query,s=n(4).MongoError,i=n(16).retrieveKerberos;var a=function(e,t,n,r){this.db=e,this.username=t,this.password=n,this.options=r};a.prototype.equal=function(e){return e.db===this.db&&e.username===this.username&&e.password===this.password};var c=function(e){this.bson=e,this.authStore=[]};function u(e,t,n,r,s,i,a,c,u){const l=new t(a.host,a.port,s,c);function p(t,n){const r=new o(e.bson,"$external.$cmd",t,{numberToSkip:0,numberToReturn:1});i(a,r,n)}l.init(n,r,e=>{if(e)return u(e,!1);l.transition("",(e,t)=>{if(e)return u(e,!1);p({saslStart:1,mechanism:"GSSAPI",payload:t,autoAuthorize:1},(e,t)=>{if(e)return u(e,!1);const n=t.result;l.transition(n.payload,(e,t)=>{if(e)return u(e,!1);p({saslContinue:1,conversationId:n.conversationId,payload:t},(e,t)=>{if(e)return u(e,!1);const n=t.result;l.transition(n.payload,(e,t)=>{if(e)return u(e,!1);p({saslContinue:1,conversationId:n.conversationId,payload:t},(e,t)=>{if(e)return u(e,!1);l.transition(null,e=>{if(e)return u(e,null);u(null,t)})})})})})})})})}c.prototype.auth=function(e,t,n,o,c,p,f){var h=this;let d;try{d=i()}catch(e){return f(e,null)}var m=p.gssapiServiceName||"mongodb",y=t.length;if(0===y)return f(null,null);for(var g=0,b=null;t.length>0;){!function(t){process.nextTick(function(){!function(t){u(h,d.processes.MongoAuthProcess,o,c,m,e,t,p,function(e,t){y-=1,e?b=e:t&&"object"==typeof t&&t.result.$err?b=t.result:t&&"object"==typeof t&&t.result.errmsg?b=t.result:g+=1,0===y&&g>0?(l(h.authStore,new a(n,o,c,p)),f(null,!0)):0===y&&(null==b&&(b=new s(r("failed to authenticate using mongocr"))),f(b,!1))})}(t)})}(t.shift())}};var l=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};c.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!==e})},c.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var s=0;s<r.length;s++)this.auth(e,t,r[s].db,r[s].username,r[s].password,r[s].options,function(e){0===(o-=1)&&n(e,null)})},e.exports=c},function(e,t,n){"use strict";const{unassigned_code_points:r,commonly_mapped_to_nothing:o,non_ASCII_space_characters:s,prohibited_characters:i,bidirectional_r_al:a,bidirectional_l:c}=n(128);e.exports=function(e,t={}){if("string"!=typeof e)throw new TypeError("Expected string.");if(0===e.length)return"";const n=e.split("").map(p).map(e=>u.get(e)?32:e).filter(e=>!l.get(e)),o=String.fromCodePoint(...n).normalize("NFKC"),s=o.split("").map(p);if(s.some(e=>i.get(e)))throw new Error("Prohibited character, see https://tools.ietf.org/html/rfc4013#section-2.3");if(!0!==t.allowUnassigned){const e=s.some(e=>r.get(e));if(e)throw new Error("Unassigned code point, see https://tools.ietf.org/html/rfc4013#section-2.5")}const d=s.some(e=>a.get(e)),m=s.some(e=>c.get(e));if(d&&m)throw new Error("String must not contain RandALCat and LCat at the same time, see https://tools.ietf.org/html/rfc3454#section-6");const y=a.get(p(f(o))),g=a.get(p(h(o)));if(d&&(!y||!g))throw new Error("Bidirectional RandALCat character must be the first and the last character of the string, see https://tools.ietf.org/html/rfc3454#section-6");return o};const u=s,l=o,p=e=>e.codePointAt(0),f=e=>e[0],h=e=>e[e.length-1]},function(e,t,n){"use strict";(function(t){const r=n(34),o=n(33),s=n(129),i=r.readFileSync(o.resolve(t,"../code-points.mem"));let a=0;function c(){const e=i.readUInt32BE(a);a+=4;const t=i.slice(a,a+e);return a+=e,s({buffer:t})}const u=c(),l=c(),p=c(),f=c(),h=c(),d=c();e.exports={unassigned_code_points:u,commonly_mapped_to_nothing:l,non_ASCII_space_characters:p,prohibited_characters:f,bidirectional_r_al:h,bidirectional_l:d}}).call(this,"/")},function(e,t,n){var r=n(130);function o(e){if(!(this instanceof o))return new o(e);if(e||(e={}),Buffer.isBuffer(e)&&(e={buffer:e}),this.pageOffset=e.pageOffset||0,this.pageSize=e.pageSize||1024,this.pages=e.pages||r(this.pageSize),this.byteLength=this.pages.length*this.pageSize,this.length=8*this.byteLength,!function(e){return!(e&e-1)}(this.pageSize))throw new Error("The page size should be a power of two");if(this._trackUpdates=!!e.trackUpdates,this._pageMask=this.pageSize-1,e.buffer){for(var t=0;t<e.buffer.length;t+=this.pageSize)this.pages.set(t/this.pageSize,e.buffer.slice(t,t+this.pageSize));this.byteLength=e.buffer.length,this.length=8*this.byteLength}}e.exports=o,o.prototype.get=function(e){var t=7&e,n=(e-t)/8;return!!(this.getByte(n)&128>>t)},o.prototype.getByte=function(e){var t=e&this._pageMask,n=(e-t)/this.pageSize,r=this.pages.get(n,!0);return r?r.buffer[t+this.pageOffset]:0},o.prototype.set=function(e,t){var n=7&e,r=(e-n)/8,o=this.getByte(r);return this.setByte(r,t?o|128>>n:o&(255^128>>n))},o.prototype.toBuffer=function(){for(var e=function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t}(this.pages.length*this.pageSize),t=0;t<this.pages.length;t++){var n=this.pages.get(t,!0),r=t*this.pageSize;n&&n.buffer.copy(e,r,this.pageOffset,this.pageOffset+this.pageSize)}return e},o.prototype.setByte=function(e,t){var n=e&this._pageMask,r=(e-n)/this.pageSize,o=this.pages.get(r,!1);return n+=this.pageOffset,o.buffer[n]!==t&&(o.buffer[n]=t,e>=this.byteLength&&(this.byteLength=e+1,this.length=8*this.byteLength),this._trackUpdates&&this.pages.updated(o),!0)}},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this.length=0,this.updates=[],this.pages=new Array(16),this.pageSize=e||1024,this.deduplicate=t?t.deduplicate:null}function r(e,t,n){for(var r=2*e.length;r<=t;)r*=2;for(var o=new Array(r),s=0;s<n;s++)o[s]=e[s];return o}function o(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t}function s(e,t){this.offset=e*t.length,this.buffer=t,this.updated=!1,this.deduplicate=0}e.exports=n,n.prototype.updated=function(e){for(;this.deduplicate&&e.buffer[e.deduplicate]===this.deduplicate[e.deduplicate];)if(e.deduplicate++,e.deduplicate===this.deduplicate.length){e.deduplicate=0,e.buffer.equals&&e.buffer.equals(this.deduplicate)&&(e.buffer=this.deduplicate);break}!e.updated&&this.updates&&(e.updated=!0,this.updates.push(e))},n.prototype.lastUpdate=function(){if(!this.updates||!this.updates.length)return null;var e=this.updates.pop();return e.updated=!1,e},n.prototype.get=function(e,t){if(e>=this.pages.length){if(t)return;this.pages=r(this.pages,e,this.length)}var n=this.pages[e];return n||t||(n=this.pages[e]=new s(e,o(this.pageSize)),e>=this.length&&(this.length=e+1)),n&&n.buffer===this.deduplicate&&this.deduplicate&&!t&&(n.buffer=function(e){var t=Buffer.allocUnsafe?Buffer.allocUnsafe(e.length):new Buffer(e.length);return e.copy(t),t}(n.buffer),n.deduplicate=0),n},n.prototype.set=function(e,t){if(e>=this.pages.length&&(this.pages=r(this.pages,e,this.length)),e>=this.length&&(this.length=e+1),t){this.deduplicate&&t.equals&&t.equals(this.deduplicate)&&(t=this.deduplicate);var n=this.pages[e],i=function(e,t){if(e.length===t)return e;if(e.length>t)return e.slice(0,t);var n=o(t);return e.copy(n),n}(t,this.pageSize);n?n.buffer=i:this.pages[e]=new s(e,i)}else this.pages[e]=void 0},n.prototype.toBuffer=function(){for(var e=new Array(this.length),t=o(this.pageSize),n=0;n<e.length;n++)e[n]=this.pages[n]?this.pages[n].buffer:t;return Buffer.concat(e)}},function(e,t,n){"use strict";var r=n(13).copy,o=n(13).retrieveBSON,s=n(12).KillCursor,i=n(12).GetMore,a=n(12).Query,c=n(1).format,u=n(4).MongoError,l=n(21).getReadPreference,p=o().Long,f=function(){},h=function(e,t,n,r,o,s,i,l){if(0===s.length)throw new u("insert must contain at least one document");"function"==typeof i&&(l=i,i=(i={})||{});var p=o.split("."),f=p.shift(),h="boolean"!=typeof i.ordered||i.ordered,d=i.writeConcern,m={};m[n]=p.join("."),m[r]=s,m.ordered=h,d&&Object.keys(d).length>0&&(m.writeConcern=d),!0===i.bypassDocumentValidation&&(m.bypassDocumentValidation=i.bypassDocumentValidation);var y={command:!0};void 0!==i.session&&(y.session=i.session);var g={checkKeys:!1,numberToSkip:0,numberToReturn:1};"insert"===n&&(g.checkKeys=!0),"boolean"==typeof i.checkKeys&&(g.checkKeys=i.checkKeys),i.serializeFunctions&&(g.serializeFunctions=i.serializeFunctions),i.ignoreUndefined&&(g.ignoreUndefined=i.ignoreUndefined);try{var b=new a(t,c("%s.$cmd",f),m,g);e.write(b,y,l)}catch(e){l(e)}};f.prototype.insert=function(e,t,n,r,o,s){h(e,n,"insert","documents",t,r,o,s)},f.prototype.update=function(e,t,n,r,o,s){h(e,n,"update","updates",t,r,o,s)},f.prototype.remove=function(e,t,n,r,o,s){h(e,n,"delete","deletes",t,r,o,s)},f.prototype.killCursor=function(e,t,n,r,o){var i=n.cursorId,a=new s(e,t,[i]);const c={immediateRelease:!0,noResponse:!0};if("object"==typeof n.session&&(c.session=n.session),r&&r.isConnected())try{r.write(a,c,o)}catch(e){"function"==typeof o?o(e,null):console.warn(e)}},f.prototype.getMore=function(e,t,n,r,o,s,a,c){var l=new i(e,t,n.cursorId,{numberToReturn:r}),f={};o&&(f.raw=o),"boolean"==typeof n.promoteLongs&&(f.promoteLongs=n.promoteLongs),"boolean"==typeof n.promoteValues&&(f.promoteValues=n.promoteValues),"boolean"==typeof n.promoteBuffers&&(f.promoteBuffers=n.promoteBuffers),"object"==typeof n.session&&(f.session=n.session),s.write(l,f,function(e,t){if(e)return c(e);var r=t.message;if(0!=(1&r.responseFlags))return c(new u("cursor does not exist, was killed or timed out"),null);var o="number"==typeof r.cursorId?p.fromNumber(r.cursorId):r.cursorId;n.documents=r.documents,n.cursorId=o,c(null,null,r.connection)})},f.prototype.command=function(e,t,n,r,o,s){if(n.find)return d(e,t,n,r,o,s);if(null==r.cursorId){if(n)return m(e,t,n,r,o,s);throw new u(c("command %s does not return a cursor",JSON.stringify(n)))}};var d=function(e,t,n,o,s,i){var p=l(n,i=i||{});o.batchSize=n.batchSize||o.batchSize;var f=0;f=0===o.limit?o.batchSize:o.limit<0||o.limit<o.batchSize||o.limit>0&&0===o.batchSize?o.limit:o.batchSize;var h=o.skip||0,d={};if("mongos"===s.type&&p&&(d.$readPreference=p.toJSON()),n.sort&&(d.$orderby=n.sort),n.hint&&(d.$hint=n.hint),n.snapshot&&(d.$snapshot=n.snapshot),void 0!==n.returnKey&&(d.$returnKey=n.returnKey),n.maxScan&&(d.$maxScan=n.maxScan),n.min&&(d.$min=n.min),n.max&&(d.$max=n.max),void 0!==n.showDiskLoc&&(d.$showDiskLoc=n.showDiskLoc),n.comment&&(d.$comment=n.comment),n.maxTimeMS&&(d.$maxTimeMS=n.maxTimeMS),n.explain&&(f=-Math.abs(n.limit||0),d.$explain=!0),d.$query=n.query,n.readConcern&&"local"!==n.readConcern.level)throw new u(c("server find command does not support a readConcern level of %s",n.readConcern.level));n.readConcern&&delete(n=r(n)).readConcern;var m="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,y="boolean"==typeof i.ignoreUndefined&&i.ignoreUndefined,g=new a(e,t,d,{numberToSkip:h,numberToReturn:f,pre32Limit:void 0!==n.limit?n.limit:void 0,checkKeys:!1,returnFieldSelector:n.fields,serializeFunctions:m,ignoreUndefined:y});return g.slaveOk=p.slaveOk(),"boolean"==typeof n.tailable&&(g.tailable=n.tailable),"boolean"==typeof n.oplogReplay&&(g.oplogReplay=n.oplogReplay),"boolean"==typeof n.noCursorTimeout&&(g.noCursorTimeout=n.noCursorTimeout),"boolean"==typeof n.awaitData&&(g.awaitData=n.awaitData),"boolean"==typeof n.partial&&(g.partial=n.partial),g},m=function(e,t,n,r,o,s){var i=l(n,s=s||{}),p={};for(var f in n)p[f]=n[f];var h=t.split(/\./),d="boolean"==typeof s.serializeFunctions&&s.serializeFunctions,m="boolean"==typeof s.ignoreUndefined&&s.ignoreUndefined;if(n.readConcern&&"local"!==n.readConcern.level)throw new u(c("server %s command does not support a readConcern level of %s",JSON.stringify(n),n.readConcern.level));n.readConcern&&delete n.readConcern,"mongos"===o.type&&i&&"primary"!==i.preference&&(p={$query:p,$readPreference:i.toJSON()});var y=new a(e,c("%s.$cmd",h.shift()),p,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,serializeFunctions:d,ignoreUndefined:m});return y.slaveOk=i.slaveOk(),y};e.exports=f},function(e,t,n){"use strict";const r=n(12).Query,o=n(13).retrieveBSON,s=n(4).MongoError,i=n(4).MongoNetworkError,a=n(21).getReadPreference,c=o(),u=c.Long,l=n(22),p=n(64).TxnState,f=function(){};function h(e,t,n){if(!t)return;const r=t.serverSession,o=t.inTransaction()||function(e){return!(!e.commitTransaction&&!e.abortTransaction)}(e),i=n.willRetryWrite;if(r.txnNumber&&(i||o)&&(e.txnNumber=c.Long.fromNumber(r.txnNumber)),!o)return t.transaction.state!==p.NO_TRANSACTION&&t.transaction.transition(p.NO_TRANSACTION),void(t.supports.causalConsistency&&t.operationTime&&(e.readConcern=e.readConcern||{},Object.assign(e.readConcern,{afterClusterTime:t.operationTime})));if(n.readPreference&&!n.readPreference.equals(l.primary))return new s(`Read preference in a transaction must be primary, not: ${n.readPreference.mode}`);if(e.autocommit=!1,t.transaction.state===p.STARTING_TRANSACTION){t.transaction.transition(p.TRANSACTION_IN_PROGRESS),e.startTransaction=!0;const n=t.transaction.options.readConcern||t.clientOptions.readConcern;n&&(e.readConcern=n),t.supports.causalConsistency&&t.operationTime&&(e.readConcern=e.readConcern||{},Object.assign(e.readConcern,{afterClusterTime:t.operationTime}))}}function d(e,t,n,o,i,a,c,u){if(0===a.length)throw new s("insert must contain at least one document");"function"==typeof c&&(u=c,c=(c={})||{});const l=i.split("."),p=l.shift(),f="boolean"!=typeof c.ordered||c.ordered,d=c.writeConcern,m={};if(m[n]=l.join("."),m[o]=a,m.ordered=f,d&&Object.keys(d).length>0&&(m.writeConcern=d),c.collation)for(let e=0;e<m[o].length;e++)m[o][e].collation||(m[o][e].collation=c.collation);!0===c.bypassDocumentValidation&&(m.bypassDocumentValidation=c.bypassDocumentValidation);const y=h(m,c.session,c);if(y)return u(y,null);const g={command:!0};void 0!==c.session&&(g.session=c.session);const b={checkKeys:!1,numberToSkip:0,numberToReturn:1};"insert"===n&&(b.checkKeys=!0),"boolean"==typeof c.checkKeys&&(b.checkKeys=c.checkKeys),c.serializeFunctions&&(b.serializeFunctions=c.serializeFunctions),c.ignoreUndefined&&(b.ignoreUndefined=c.ignoreUndefined);try{const n=new r(t,`${p}.$cmd`,m,b);e.write(n,g,u)}catch(y){u(y)}}f.prototype.insert=function(e,t,n,r,o,s){d(e,n,"insert","documents",t,r,o,s)},f.prototype.update=function(e,t,n,r,o,s){d(e,n,"update","updates",t,r,o,s)},f.prototype.remove=function(e,t,n,r,o,s){d(e,n,"delete","deletes",t,r,o,s)},f.prototype.killCursor=function(e,t,n,o,a){const c=t.split(/\./),u=`${c.shift()}.$cmd`,l=n.cursorId,p={killCursors:c.join("."),cursors:[l]},f=new r(e,u,p,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,returnFieldSelector:null});function h(e,t){if(e){if("function"!=typeof a)return;return a(e)}const n=t.message;if(0!=(1&n.responseFlags)){if("function"!=typeof a)return;return a(new i("cursor killed or timed out"),null)}if(!Array.isArray(n.documents)||0===n.documents.length){if("function"!=typeof a)return;return a(new s(`invalid killCursors result returned for cursor id ${l}`))}"function"==typeof a&&a(null,n.documents[0])}const d={command:!0};if("object"==typeof n.session&&(d.session=n.session),o&&o.isConnected())try{o.write(f,d,h)}catch(e){h(e,null)}else"function"==typeof a&&a(null,null)},f.prototype.getMore=function(e,t,n,o,a,c,l,p){l=l||{};const f=t.split(/\./),d=`${f.shift()}.$cmd`,m={getMore:n.cursorId,collection:f.join("."),batchSize:Math.abs(o)},y=h(m,l.session,l);if(y)return p(y,null);n.cmd.tailable&&"number"==typeof n.cmd.maxAwaitTimeMS&&(m.maxTimeMS=n.cmd.maxAwaitTimeMS);const g=new r(e,d,m,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,returnFieldSelector:null});const b={command:!0};a&&(b.raw=a),b.documentsReturnedIn="nextBatch","boolean"==typeof n.promoteLongs&&(b.promoteLongs=n.promoteLongs),"boolean"==typeof n.promoteValues&&(b.promoteValues=n.promoteValues),"boolean"==typeof n.promoteBuffers&&(b.promoteBuffers=n.promoteBuffers),"object"==typeof n.session&&(b.session=n.session),c.write(g,b,function(e,t){if(e)return p(e);const r=t.message;if(0!=(1&r.responseFlags))return p(new i("cursor killed or timed out"),null);if(a)return n.documents=r.documents,n.cursorId=r.cursorId,p(null,r.documents);if(0===r.documents[0].ok)return p(new s(r.documents[0]));const o="number"==typeof r.documents[0].cursor.id?u.fromNumber(r.documents[0].cursor.id):r.documents[0].cursor.id;n.documents=r.documents[0].cursor.nextBatch,n.cursorId=o,p(null,r.documents[0],r.connection)})},f.prototype.command=function(e,t,n,o,i,c){const u="boolean"!=typeof(c=c||{}).wireProtocolCommand||c.wireProtocolCommand;let l;if(n.find&&u)l=function(e,t,n,o,s,i){const c=a(n,i=i||{});o.batchSize=n.batchSize||o.batchSize;const u=t.split(/\./),l=`${u.shift()}.$cmd`;let p={find:u.join(".")};n.query&&(n.query.$query?p.filter=n.query.$query:p.filter=n.query);let f=n.sort;if(Array.isArray(f)){const e={};if(f.length>0&&!Array.isArray(f[0])){let t=f[1];"asc"===t?t=1:"desc"===t&&(t=-1),e[f[0]]=t}else for(var d=0;d<f.length;d++){let t=f[d][1];"asc"===t?t=1:"desc"===t&&(t=-1),e[f[d][0]]=t}f=e}n.sort&&(p.sort=f);n.fields&&(p.projection=n.fields);n.hint&&(p.hint=n.hint);n.skip&&(p.skip=n.skip);n.limit&&(p.limit=n.limit);n.limit<0&&(p.limit=Math.abs(n.limit),p.singleBatch=!0);"number"==typeof n.batchSize&&(n.batchSize<0&&(0!==n.limit&&Math.abs(n.batchSize)<Math.abs(n.limit)&&(p.limit=Math.abs(n.batchSize)),p.singleBatch=!0),p.batchSize=Math.abs(n.batchSize));n.comment&&(p.comment=n.comment);n.maxScan&&(p.maxScan=n.maxScan);n.maxTimeMS&&(p.maxTimeMS=n.maxTimeMS);n.min&&(p.min=n.min);n.max&&(p.max=n.max);p.returnKey=!!n.returnKey&&n.returnKey,p.showRecordId=!!n.showDiskLoc&&n.showDiskLoc,n.snapshot&&(p.snapshot=n.snapshot);n.tailable&&(p.tailable=n.tailable);n.oplogReplay&&(p.oplogReplay=n.oplogReplay);n.noCursorTimeout&&(p.noCursorTimeout=n.noCursorTimeout);n.awaitData&&(p.awaitData=n.awaitData);n.awaitdata&&(p.awaitData=n.awaitdata);n.partial&&(p.partial=n.partial);n.collation&&(p.collation=n.collation);n.explain&&(p={explain:p});n.readConcern&&(p.readConcern=n.readConcern);const m="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,y="boolean"==typeof i.ignoreUndefined&&i.ignoreUndefined;"mongos"===s.type&&c&&"primary"!==c.preference&&(p={$query:p,$readPreference:c.toJSON()});const g=h(p,i.session,i);if(g)return g;const b=new r(e,l,p,{numberToSkip:0,numberToReturn:1,checkKeys:!1,returnFieldSelector:null,serializeFunctions:m,ignoreUndefined:y});return b.slaveOk=c.slaveOk(),b}(e,t,n,o,i,c),n.virtual=!1,l.documentsReturnedIn="firstBatch";else{if(null!=o.cursorId)return;if(!n)return new s(`command ${JSON.stringify(n)} does not return a cursor`);l=function(e,t,n,o,s,i){const c=a(n,i=i||{});let u={};for(let e in n)u[e]=n[e];const l=t.split(/\./),p="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,f="boolean"==typeof i.ignoreUndefined&&i.ignoreUndefined;"mongos"===s.type&&c&&"primary"!==c.preference&&(u={$query:u,$readPreference:c.toJSON()});const d=h(u,i.session,i);if(d)return d;const m=new r(e,`${l.shift()}.$cmd`,u,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,serializeFunctions:p,ignoreUndefined:f});return m.slaveOk=c.slaveOk(),m}(e,t,n,0,i,c)}if(l instanceof s)return l;const p=h(l.query,c.session,c);return p||l},e.exports=f},function(e,t,n){"use strict";const r=n(1).inherits,o=n(1).format,s=n(9).EventEmitter,i=n(22),a=n(49),c=n(13).retrieveBSON,u=n(23),l=n(4).MongoError,p=n(62),f=n(134),h=n(10).clone,d=n(10).Timeout,m=n(10).Interval,y=n(10).createClientInfo,g=n(10).SessionMixins,b=n(10).isRetryableWritesSupported,v=n(16).relayEvents,S=n(4).isRetryableError,w=n(47).defaultAuthProviders;var O=c(),_="disconnected",T="connecting",C="connected",E="unreferenced",N="destroyed";function I(e,t){var n={disconnected:[T,N,_],connecting:[T,N,C,_],connected:[C,_,N,E],unreferenced:[E,N],destroyed:[N]}[e.state];n&&-1!==n.indexOf(t)?e.state=t:e.s.logger.error(o("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}var x=1,A=["connect","close","error","timeout","parseError"],k=function(e,t){var n=this;if(t=t||{},!Array.isArray(e))throw new l("seedlist must be an array");if(0===e.length)throw new l("seedlist must contain at least one entry");e.forEach(function(e){if("string"!=typeof e.host||"number"!=typeof e.port)throw new l("seedlist entry must contain a host and port")}),s.call(this),this.id=x++;var r=t.localThresholdMS||15;t.acceptableLatency&&(r=t.acceptableLatency);var i=u("ReplSet",t);this.s={options:Object.assign({},t),bson:t.bson||new O([O.Binary,O.Code,O.DBRef,O.Decimal128,O.Double,O.Int32,O.Long,O.Map,O.MaxKey,O.MinKey,O.ObjectId,O.BSONRegExp,O.Symbol,O.Timestamp]),Cursor:t.cursorFactory||a,logger:i,seedlist:e,replicaSetState:new f({id:this.id,setName:t.setName,acceptableLatency:r,heartbeatFrequencyMS:t.haInterval?t.haInterval:1e4,logger:i}),connectingServers:[],haInterval:t.haInterval?t.haInterval:1e4,minHeartbeatFrequencyMS:500,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof t.debug&&t.debug,clientInfo:y(t),authenticationContexts:[]},this.s.replicaSetState.on("topologyDescriptionChanged",function(e){n.emit("topologyDescriptionChanged",e)}),this.s.logger.isWarn()&&0!==this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(o("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval)),this.authProviders=t.authProviders||w(this.s.bson);["joined","left"].forEach(function(e){n.s.replicaSetState.on(e,function(t,r){n.emit(e,t,r)})}),this.initialConnectState={connect:!1,fullsetup:!1,all:!1},this.state=_,this.haTimeoutId=null,this.authenticating=!1,this.ismaster=null,this.intervalIds=[],this.clusterTime=null};function B(e){e.s.replicaSetState.hasPrimaryAndSecondary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute():e.s.replicaSetState.hasPrimary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute({executePrimary:!0}):e.s.replicaSetState.hasSecondary()&&e.s.disconnectHandler&&e.s.disconnectHandler.execute({executeSecondary:!0})}function M(e,t,n){var r=t.length,o=null,s=function(e,t){return function(s){var i=this;if(r-=1,e.state===N||e.state===E)return this.destroy({force:!0});if("connect"!==t||e.authenticating)"connect"===t&&e.authenticating?this.destroy({force:!0}):"error"===t&&(o=s);else{if(e.state===N||e.state===E)return i.destroy({force:!0});j(e,i,function(){if(e.state===N||e.state===E)return i.destroy({force:!0});if(e.s.replicaSetState.update(i)){i.lastIsMaster()&&i.lastIsMaster().ismaster&&(e.ismaster=i.lastIsMaster());for(var t=0;t<A.length;t++)i.removeAllListeners(A[t]);i.on("error",L(e,"error")),i.on("close",L(e,"close")),i.on("timeout",L(e,"timeout")),i.on("parseError",L(e,"parseError")),D(i.lastIsMaster().me,e,{}),B(e)}else i.destroy({force:!0})})}B(e),0===r&&n(o)}};if(0===r)return n();function i(t,n){setTimeout(function(){if(e.state!==N&&e.state!==E){var n=new p(Object.assign({},e.s.options,{host:t.split(":")[0],port:parseInt(t.split(":")[1],10),authProviders:e.authProviders,reconnect:!1,monitoring:!1,parent:e,clientInfo:h(e.s.clientInfo)}));n.once("connect",s(e,"connect")),n.once("close",s(e,"close")),n.once("timeout",s(e,"timeout")),n.once("error",s(e,"error")),n.once("parseError",s(e,"parseError")),n.on("serverOpening",t=>e.emit("serverOpening",t)),n.on("serverDescriptionChanged",t=>e.emit("serverDescriptionChanged",t)),n.on("serverClosed",t=>e.emit("serverClosed",t)),v(n,e,["commandStarted","commandSucceeded","commandFailed"]),n.connect(e.s.connectOptions)}},n)}for(var a=0;a<t.length;a++)i(t[a],a)}r(k,s),Object.assign(k.prototype,g),Object.defineProperty(k.prototype,"type",{enumerable:!0,get:function(){return"replset"}}),Object.defineProperty(k.prototype,"parserType",{enumerable:!0,get:function(){return O.native?"c++":"js"}}),Object.defineProperty(k.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.replicaSetState.logicalSessionTimeoutMinutes||null}});var D=function(e,t,n){if(!n.haInterval)for(var r=0;r<t.intervalIds.length;r++)if(t.intervalIds[r].__host===e)return;var o=n.haInterval?d:m,s=n.haInterval?n.haInterval:t.s.haInterval,i=new o(function(){if(t.state!==N&&t.state!==E){var n=t.s.replicaSetState.get(e);return n?function(e,t,n){var r=(new Date).getTime();z(e,"serverHeartbeatStarted",{connectionId:t.name}),t.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:e.s.options.connectionTimeout||2e3},function(o,s){if(e.state===N||e.state===E)return t.destroy({force:!0}),n(o,s);var i=(new Date).getTime()-r,a=process.hrtime();t.lastUpdateTime=1e3*a[0]+Math.round(a[1]/1e3),o?(z(e,"serverHeartbeatFailed",{durationMS:i,failure:o,connectionId:t.name}),e.s.replicaSetState.remove(t)):(t.ismaster=s.result,t.ismaster.lastWrite&&t.ismaster.lastWrite.lastWriteDate&&(t.lastWriteDate=t.ismaster.lastWrite.lastWriteDate.getTime()),-1===t.lastIsMasterMS?t.lastIsMasterMS=i:t.lastIsMasterMS&&(t.lastIsMasterMS=.2*i+.8*t.lastIsMasterMS),e.s.replicaSetState.update(t)&&t.lastIsMaster()&&t.lastIsMaster().ismaster&&(e.ismaster=t.lastIsMaster()),z(e,"serverHeartbeatSucceeded",{durationMS:i,reply:s.result,connectionId:t.name})),e.s.replicaSetState.updateServerMaxStaleness(t,e.s.haInterval),n(o,s)})}(t,n,function(e){e||(t.state!==N&&t.state!==E?(t.intervalIds=t.intervalIds.filter(function(e){return e.isRunning()}),o===d?t.state===T&&(t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed||t.s.replicaSetState.hasPrimary())&&(t.state=C,process.nextTick(function(){t.emit("connect",t)}),R(t,{})):t.state===_&&(t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed||t.s.replicaSetState.hasPrimary())&&(t.state=C,B(t),process.nextTick(function(){t.emit("reconnect",t)})),t.initialConnectState.connect&&!t.initialConnectState.fullsetup&&t.s.replicaSetState.hasPrimaryAndSecondary()&&(t.initialConnectState.fullsetup=!0,t.initialConnectState.all=!0,process.nextTick(function(){t.emit("fullsetup",t),t.emit("all",t)}))):i.stop())}):void 0}i.stop()},s);i.start(),i.__host=e,t.intervalIds.push(i)};function R(e,t){if(e.state!==N&&e.state!==E){t=t||{};var n=Object.keys(e.s.replicaSetState.set),r=t.haInterval?d:m,o=t.haInterval?t.haInterval:e.s.haInterval;if(r===d)return M(e,e.s.replicaSetState.unknownServers,function(r){if(e.state!==N&&e.state!==E){if(!e.s.replicaSetState.hasPrimary()&&!e.s.options.secondaryOnlyConnectionAllowed)return r?e.emit("error",r):(e.emit("error",new l("no primary found in replicaset or invalid replica set name")),e.destroy({force:!0}));if(!e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed)return r?e.emit("error",r):(e.emit("error",new l("no secondary found in replicaset or invalid replica set name")),e.destroy({force:!0}));for(var o=0;o<n.length;o++)D(n[o],e,t)}});for(var s=0;s<n.length;s++)D(n[s],e,t);var i=e.s.replicaSetState.hasPrimary()?o:e.s.minHeartbeatFrequencyMS;e.intervalIds.push(new d(function e(t){return function(){t.state!==N&&t.state!==E&&M(t,t.s.replicaSetState.unknownServers,function(){var n=t.s.replicaSetState.hasPrimary()?o:t.s.minHeartbeatFrequencyMS;t.intervalIds.push(new d(e(t),n).start())})}}(e),i).start())}}function P(e,t){for(var n=0;n<e.length;n++)if(e[n].name.toLowerCase()===t.name.toLowerCase())return!0;e.push(t)}function L(e,t){return function(){e.state!==N&&e.state!==E&&(e.s.logger.isDebug()&&e.s.logger.debug(o("handleEvent %s from server %s in replset with id %s",t,this.name,e.id)),e.s.replicaSetState.remove(this),e.state!==N&&e.state!==E&&((e.s.replicaSetState.hasPrimary()||e.s.replicaSetState.hasSecondary()||!e.s.options.secondaryOnlyConnectionAllowed)&&e.s.replicaSetState.hasPrimary()||I(e,_),P(e.s.connectingServers,this)))}}function j(e,t,n){if(0===e.s.authenticationContexts.length)return n();if(t.lastIsMaster()&&t.lastIsMaster().arbiterOnly)return n();!function e(t,n,r){if(0===t.length)return r();var o=t.shift().slice(0);o.push(function(){e(t,n,r)}),n.auth.apply(n,o)}(e.s.authenticationContexts.slice(0),t,n)}function U(e,t){return function(){var n=this;if(e.s.logger.isDebug()&&e.s.logger.debug(o("handleInitialConnectEvent %s from server %s in replset with id %s",t,this.name,e.id)),e.state===N||e.state===E)return this.destroy({force:!0});"connect"===t?j(e,n,function(){if(e.state===N||e.state===E)return n.destroy({force:!0});var r=e.s.replicaSetState.update(n);if(!0===r){n.lastIsMaster()&&n.lastIsMaster().ismaster&&(e.ismaster=n.lastIsMaster()),e.s.logger.isDebug()&&e.s.logger.debug(o("handleInitialConnectEvent %s from server %s in replset with id %s has state [%s]",t,n.name,e.id,JSON.stringify(e.s.replicaSetState.set)));for(var s=0;s<A.length;s++)n.removeAllListeners(A[s]);n.on("error",L(e,"error")),n.on("close",L(e,"close")),n.on("timeout",L(e,"timeout")),n.on("parseError",L(e,"parseError")),function(e){const t=e.state===T,n=e.s.replicaSetState.hasPrimary(),r=e.s.replicaSetState.hasSecondary(),o=e.s.options.secondaryOnlyConnectionAllowed,s=e.s.connectOptions.readPreference&&e.s.connectOptions.readPreference.equals(i.secondary);return t&&(s&&r||!s&&n)||r&&o}(e)&&(e.state=C,e.initialConnectState.connect=!0,process.nextTick(function(){e.emit("connect",e)}),R(e,{}))}else{if(r instanceof l)return n.destroy({force:!0}),e.destroy({force:!0}),e.emit("error",r);n.destroy({force:!0})}}):(e.emit("failed",this),P(e.s.connectingServers,this),e.s.replicaSetState.remove(this)),e.initialConnectState.connect&&!e.initialConnectState.fullsetup&&e.s.replicaSetState.hasPrimaryAndSecondary()&&(e.initialConnectState.fullsetup=!0,e.initialConnectState.all=!0,process.nextTick(function(){e.emit("fullsetup",e),e.emit("all",e)}));for(var r=0;r<e.s.connectingServers.length;r++)e.s.connectingServers[r].equals(this)&&e.s.connectingServers.splice(r,1);0===e.s.connectingServers.length&&e.state===T&&R(e,{haInterval:1})}}function z(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}function q(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};const r=e.self,s=e.op,i=e.ns,a=e.ops;if(r.state===N)return n(new l(o("topology was destroyed")));const c=!e.retrying&&!!t.retryWrites&&t.session&&b(r)&&!t.session.inTransaction();if(!r.s.replicaSetState.hasPrimary()){if(r.s.disconnectHandler)return r.s.disconnectHandler.add(s,i,a,t,n);if(!c)return n(new l("no primary server found"))}const u=(o,s)=>{if(!o)return n(null,s);if(!S(o))return n(o);if(c){return q(Object.assign({},e,{retrying:!0}),t,n)}return r.s.replicaSetState.primary&&r.s.replicaSetState.remove(r.s.replicaSetState.primary,{force:!0}),n(o)};n.operationId&&(u.operationId=n.operationId),c&&(t.session.incrementTransactionNumber(),t.willRetryWrite=c),r.s.replicaSetState.primary[s](i,a,t,u)}k.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{},I(this,T);var n=this.s.seedlist.map(function(e){return new p(Object.assign({},t.s.options,e,{authProviders:t.authProviders,reconnect:!1,monitoring:!1,parent:t,clientInfo:h(t.s.clientInfo)}))});if(this.s.options.socketTimeout>0&&this.s.options.socketTimeout<=this.s.options.haInterval)return t.emit("error",new l(o("haInterval [%s] MS must be set to less than socketTimeout [%s] MS",this.s.options.haInterval,this.s.options.socketTimeout)));z(this,"topologyOpening",{topologyId:this.id}),function(e,t){e.s.connectingServers=e.s.connectingServers.concat(t);var n=0;function r(t,n){setTimeout(function(){e.s.replicaSetState.update(t)&&t.lastIsMaster()&&t.lastIsMaster().ismaster&&(e.ismaster=t.lastIsMaster()),t.once("close",U(e,"close")),t.once("timeout",U(e,"timeout")),t.once("parseError",U(e,"parseError")),t.once("error",U(e,"error")),t.once("connect",U(e,"connect")),t.on("serverOpening",t=>e.emit("serverOpening",t)),t.on("serverDescriptionChanged",t=>e.emit("serverDescriptionChanged",t)),t.on("serverClosed",t=>e.emit("serverClosed",t)),v(t,e,["commandStarted","commandSucceeded","commandFailed"]),t.connect(e.s.connectOptions)},n)}for(;t.length>0;)r(t.shift(),n++)}(t,n)},k.prototype.destroy=function(e){e=e||{},I(this,N),this.haTimeoutId&&clearTimeout(this.haTimeoutId),this.s.replicaSetState.destroy(e),this.s.authenticationContexts=[],this.s.connectingServers.forEach(function(t){t.destroy(e)});for(var t=0;t<this.intervalIds.length;t++)this.intervalIds[t].stop();this.intervalIds=[],z(this,"topologyClosed",{topologyId:this.id})},k.prototype.unref=function(){I(this,E),this.s.replicaSetState.allServers().forEach(function(e){e.unref()}),clearTimeout(this.haTimeoutId)},k.prototype.lastIsMaster=function(){return this.s.options.secondaryOnlyConnectionAllowed&&!this.s.replicaSetState.hasPrimary()&&this.s.replicaSetState.hasSecondary()?this.s.replicaSetState.secondaries[0].lastIsMaster():this.s.replicaSetState.primary?this.s.replicaSetState.primary.lastIsMaster():this.ismaster},k.prototype.connections=function(){for(var e=this.s.replicaSetState.allServers(),t=[],n=0;n<e.length;n++)t=t.concat(e[n].connections());return t},k.prototype.isConnected=function(e){return e=e||{},!this.authenticating&&(e.readPreference&&e.readPreference.equals(i.secondary)?this.s.replicaSetState.hasSecondary():e.readPreference&&e.readPreference.equals(i.primary)?this.s.replicaSetState.hasPrimary():e.readPreference&&e.readPreference.equals(i.primaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():e.readPreference&&e.readPreference.equals(i.secondaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():!(!this.s.options.secondaryOnlyConnectionAllowed||!this.s.replicaSetState.hasSecondary())||this.s.replicaSetState.hasPrimary())},k.prototype.isDestroyed=function(){return this.state===N},k.prototype.selectServer=function(e,t,n){"function"==typeof e&&void 0===n&&(n=e,e=void 0,t={}),"function"==typeof t&&(n=t,t=e,e=void 0),t=t||{};const r=this.s.replicaSetState.pickServer(t.readPreference);this.s.debug&&this.emit("pickedServer",t.readPreference,r),n(null,r)},k.prototype.getServers=function(){return this.s.replicaSetState.allServers()},k.prototype.insert=function(e,t,n,r){q({self:this,op:"insert",ns:e,ops:t},n,r)},k.prototype.update=function(e,t,n,r){q({self:this,op:"update",ns:e,ops:t},n,r)},k.prototype.remove=function(e,t,n,r){q({self:this,op:"remove",ns:e,ops:t},n,r)};const $=["findAndModify","insert","update","delete"];k.prototype.command=function(e,t,n,r){if("function"==typeof n&&(r=n,n=(n={})||{}),this.state===N)return r(new l(o("topology was destroyed")));var s=n.readPreference?n.readPreference:i.primary;if("primary"===s.preference&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,r);if("secondary"===s.preference&&!this.s.replicaSetState.hasSecondary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,r);if("primary"!==s.preference&&!this.s.replicaSetState.hasSecondary()&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,r);var a=this.s.replicaSetState.pickServer(s);if(!(a instanceof p))return r(a);if(this.s.debug&&this.emit("pickedServer",i.primary,a),null==a)return r(new l(o("no server found that matches the provided readPreference %s",s)));const c=!n.retrying&&!!n.retryWrites&&n.session&&b(this)&&!n.session.inTransaction()&&function(e){return $.some(t=>e[t])}(t);c&&(n.session.incrementTransactionNumber(),n.willRetryWrite=c),a.command(e,t,n,(o,s)=>{if(!o)return r(null,s);if(!S(o))return r(o);if(c){const o=Object.assign({},n,{retrying:!0});return this.command(e,t,o,r)}return this.s.replicaSetState.primary&&this.s.replicaSetState.remove(this.s.replicaSetState.primary,{force:!0}),r(o)})},k.prototype.auth=function(e,t){var n=Array.prototype.slice.call(arguments,0).slice(0),r=this,s=Array.prototype.slice.call(arguments,2),i=s.pop(),a=0;if(null==this.authProviders[e]&&"default"!==e)return i(new l(o("auth provider %s does not exist",e)));if(this.authenticating)return i(new l("authentication or logout allready in process"));if(!this.isConnected()&&null!=r.s.disconnectHandler){if(!r.s.replicaSetState.hasPrimary()&&!r.s.options.secondaryOnlyConnectionAllowed)return r.s.disconnectHandler.add("auth",t,n,{},i);if(!r.s.replicaSetState.hasSecondary()&&r.s.options.secondaryOnlyConnectionAllowed)return r.s.disconnectHandler.add("auth",t,n,{},i)}this.authenticating=!0;var c=[],u=this.s.replicaSetState.allServers();function p(n){var o=[e,t].concat(s.slice(0)).concat([function(e){if(f-=1,e&&c.push({name:n.name,err:e}),0===f){if(r.authenticating=!1,c.length)return r.s.authenticationContexts.splice(a,0),i(new l({message:"authentication fail",errors:c}),!1);i(null,r)}}]);n.lastIsMaster().arbiterOnly?o.pop()(null):n.auth.apply(n,o)}0===u.length&&(this.authenticating=!1,i(null,!0));var f=u.length;for(a=this.s.authenticationContexts.length,this.s.authenticationContexts.push([e,t].concat(s.slice(0)));u.length>0;)p(u.shift())},k.prototype.logout=function(e,t){var n=this;if(this.authenticating)throw new l("authentication or logout allready in process");this.authenticating=!0;for(var r=Object.keys(this.authProviders),s=0;s<r.length;s++)this.authProviders[r[s]].logout(e);n.s.authenticationContexts=n.s.authenticationContexts.filter(function(t){return t[1]!==e});var i=this.s.replicaSetState.allServers(),a=i.length;if(0===a)return t();var c=[];function u(t,n){t.logout(e,function(e){e&&c.push({name:t.name,err:e}),n()})}for(s=0;s<i.length;s++)u(i[s],function(){if(0===(a-=1)){if(n.authenticating=!1,c.length)return t(new l({message:o("logout failed against db %s",e),errors:c}),!1);t()}})},k.prototype.cursor=function(e,t,n){const r=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(this.s.bson,e,t,n,r,this.s.options)},e.exports=k},function(e,t,n){"use strict";var r=n(1).inherits,o=n(1).format,s=n(10).diff,i=n(9).EventEmitter,a=n(23),c=n(22),u=n(4).MongoError,l=n(19).Buffer,p="ReplicaSetNoPrimary",f="ReplicaSetWithPrimary",h="Unknown",d="PossiblePrimary",m="RSPrimary",y="RSSecondary",g="RSArbiter",b="RSOther",v="RSGhost",S="Unknown",w=function(e){e=e||{},i.call(this),this.topologyType=p,this.setName=e.setName,this.set={},this.id=e.id,this.setName=e.setName,this.logger=e.logger||a("ReplSet",e),this.index=0,this.acceptableLatency=e.acceptableLatency||15,this.heartbeatFrequencyMS=e.heartbeatFrequencyMS||1e4,this.primary=null,this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.maxElectionId=null,this.maxSetVersion=0,this.replicasetDescription={topologyType:"Unknown",servers:[]},this.logicalSessionTimeoutMinutes=void 0};r(w,i),w.prototype.hasPrimaryAndSecondary=function(){return null!=this.primary&&this.secondaries.length>0},w.prototype.hasPrimaryOrSecondary=function(){return this.hasPrimary()||this.hasSecondary()},w.prototype.hasPrimary=function(){return null!=this.primary},w.prototype.hasSecondary=function(){return this.secondaries.length>0},w.prototype.get=function(e){for(var t=this.allServers(),n=0;n<t.length;n++)if(t[n].name.toLowerCase()===e.toLowerCase())return t[n];return null},w.prototype.allServers=function(e){e=e||{};var t=this.primary?[this.primary]:[];return t=t.concat(this.secondaries),e.ignoreArbiters||(t=t.concat(this.arbiters)),t=t.concat(this.passives)},w.prototype.destroy=function(e){this.primary&&this.primary.destroy(e),this.secondaries.forEach(function(t){t.destroy(e)}),this.arbiters.forEach(function(t){t.destroy(e)}),this.passives.forEach(function(t){t.destroy(e)}),this.ghosts.forEach(function(t){t.destroy(e)}),this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.primary=null,A(this)},w.prototype.remove=function(e,t){t=t||{};var n=e.name.toLowerCase(),r=this.primary?[this.primary]:[];r=(r=(r=r.concat(this.secondaries)).concat(this.arbiters)).concat(this.passives);for(var o=0;o<r.length;o++)if(!t.force&&r[o].equals(e)&&r[o].isConnected&&r[o].isConnected())return;this.set[n]&&(this.set[n].type=S,this.set[n].electionId=null,this.set[n].setName=null,this.set[n].setVersion=null);var s=null;this.primary&&this.primary.equals(e)&&(this.primary=null,this.topologyType=p,s="primary"),s=x(e,this.secondaries)?"secondary":s,s=x(e,this.arbiters)?"arbiter":s,s=x(e,this.passives)?"secondary":s,x(e,this.ghosts),x(e,this.unknownServers),this.unknownServers.push(n),s&&this.emit("left",s,e)};const O=e=>e.arbiterOnly&&e.setName;w.prototype.update=function(e){var t=e.lastIsMaster(),n=e.name.toLowerCase();if(t){var r=Array.isArray(t.hosts)?t.hosts:[];r=(r=(r=r.concat(Array.isArray(t.arbiters)?t.arbiters:[])).concat(Array.isArray(t.passives)?t.passives:[])).map(function(e){return e.toLowerCase()});for(var s=0;s<r.length;s++)-1!==this.unknownServers.indexOf(r[s])||this.set[r[s]]&&this.set[r[s]].type!==S||this.unknownServers.push(r[s].toLowerCase()),this.set[r[s]]||(this.set[r[s]]={type:S,electionId:null,setName:null,setVersion:null})}if(!t&&!E(t,e,this.unknownServers))return this.set[n]={type:S,setVersion:null,electionId:null,setName:null},this.set[n].type=S,this.set[n].electionId=t?t.electionId:t,this.set[n].setName=t?t.setName:t,this.set[n].setVersion=t?t.setVersion:t,-1===this.unknownServers.indexOf(e.name)&&this.unknownServers.push(n),!1;if(void 0===t.logicalSessionTimeoutMinutes||O(t)||(void 0===this.logicalSessionTimeoutMinutes||null===t.logicalSessionTimeoutMinutes?this.logicalSessionTimeoutMinutes=t.logicalSessionTimeoutMinutes:this.logicalSessionTimeoutMinutes=Math.min(this.logicalSessionTimeoutMinutes,t.logicalSessionTimeoutMinutes)),t&&"isdbgrid"===t.msg)return!1;if(t.setName&&t.hidden||t.setName&&!t.ismaster&&!t.secondary&&!t.arbiterOnly&&!t.passive)return this.set[n]={type:b,setVersion:null,electionId:null,setName:t.setName},this.topologyType=this.primary?f:p,t.setName&&(this.setName=t.setName),!1;if(t.isreplicaset)return this.set[n]={type:v,setVersion:null,electionId:null,setName:null},this.topologyType=this.primary?f:p,t.setName&&(this.setName=t.setName),!1;if(t&&t.ismaster&&!t.setName)return this.topologyType=this.primary?f:h,this.remove(e,{force:!0}),!1;if(t&&!t.ismaster&&!t.secondary&&!t.arbiterOnly)return this.remove(e,{force:!0}),!1;if(t.me&&t.me.toLowerCase()!==n)return this.logger.isWarn()&&this.logger.warn(o("the seedlist server was removed due to its address %s not matching its ismaster.me address %s",e.name,t.me)),delete this.set[n],x(e,this.unknownServers),e.destroy(),this.primary&&!this.primary.equals(e)?this.topologyType=f:this.topologyType=p,!this.primary&&t.primary&&(this.set[t.primary.toLowerCase()]={type:d,setName:null,electionId:null,setVersion:null}),!1;if(!this.primary&&t.ismaster&&t.setName){var i=e.lastIsMaster().electionId;if(this.setName&&this.setName!==t.setName)return this.topologyType=p,new u(o("setName from ismaster does not match provided connection setName [%s] != [%s]",t.setName,this.setName));if(!this.maxElectionId&&i)this.maxElectionId=i;else if(this.maxElectionId&&i){var a=I(this.maxElectionId,i),c=e.lastIsMaster().setVersion;if(1===a)return this.topologyType=p,!1;if(0===a&&c&&c<this.maxSetVersion)return this.topologyType=p,!1;this.maxSetVersion=c,this.maxElectionId=i}return-1!==t.hosts.map(function(e){return e.toLowerCase()}).indexOf(n)?(this.primary=e,this.set[n]={type:m,setVersion:t.setVersion,electionId:t.electionId,setName:t.setName},this.topologyType=f,t.setName&&(this.setName=t.setName),x(e,this.unknownServers),x(e,this.secondaries),x(e,this.passives),this.emit("joined","primary",e)):this.topologyType=p,A(this),!0}if(t.ismaster&&t.setName){var l=this.set[this.primary.name.toLowerCase()].electionId,w=this.set[this.primary.name.toLowerCase()].setVersion,_=this.set[this.primary.name.toLowerCase()].setName;i=e.lastIsMaster().electionId,c=e.lastIsMaster().setVersion;var T=e.lastIsMaster().setName;if(this.primary.equals(e)&&_===T)return!1;if(_&&_!==T)return this.primary.equals(e)?this.topologyType=p:this.topologyType=f,!1;if(l&&i){if(1===(a=I(l,i)))return!1;if(0===a&&w>c)return!1}else if(!l&&i&&c&&c<this.maxSetVersion)return!1;if(!this.maxElectionId&&i)this.maxElectionId=i;else if(this.maxElectionId&&i){if(1===(a=I(this.maxElectionId,i)))return!1;if(0===a&&w&&c){if(c<this.maxSetVersion)return!1}else if(c<this.maxSetVersion)return!1;this.maxElectionId=i,this.maxSetVersion=c}else this.maxSetVersion=c;return this.set[this.primary.name.toLowerCase()]={type:S,setVersion:null,electionId:null,setName:null},this.emit("left","primary",this.primary),this.primary.destroy(),this.primary=e,this.set[n]={type:m,setVersion:t.setVersion,electionId:t.electionId,setName:t.setName},this.topologyType=f,t.setName&&(this.setName=t.setName),x(e,this.unknownServers),x(e,this.secondaries),x(e,this.passives),this.emit("joined","primary",e),A(this),!0}return!this.primary&&t.primary&&(this.set[t.primary.toLowerCase()]={type:d,setVersion:null,electionId:null,setName:null}),t.secondary&&t.setName&&!E(t,e,this.secondaries)&&this.setName&&this.setName===t.setName?(N(this,y,t,e,this.secondaries),this.topologyType=this.primary?f:p,t.setName&&(this.setName=t.setName),x(e,this.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(e.destroy(),this.primary=null,this.emit("left","primary",e)),this.emit("joined","secondary",e),A(this),!0):O(t)&&!E(t,e,this.arbiters)&&this.setName&&this.setName===t.setName?(N(this,g,t,e,this.arbiters),this.topologyType=this.primary?f:p,t.setName&&(this.setName=t.setName),x(e,this.unknownServers),this.emit("joined","arbiter",e),A(this),!0):t.passive&&t.setName&&!E(t,e,this.passives)&&this.setName&&this.setName===t.setName?(N(this,y,t,e,this.passives),this.topologyType=this.primary?f:p,t.setName&&(this.setName=t.setName),x(e,this.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(e.destroy(),this.primary=null,this.emit("left","primary",e)),this.emit("joined","secondary",e),A(this),!0):this.set[n]&&this.set[n].type===m?(this.emit("left","primary",this.primary),this.primary.destroy(),this.primary=null,this.topologyType=p,!1):(this.topologyType=this.primary?f:p,!1)},w.prototype.updateServerMaxStaleness=function(e,t){for(var n=0,r=0;r<this.secondaries.length;r++)n=Math.max(n,this.secondaries[r].lastWriteDate);e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&this.hasPrimary()?e.staleness=e.lastUpdateTime-e.lastWriteDate-(this.primary.lastUpdateTime-this.primary.lastWriteDate)+t:e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&(e.staleness=n-e.lastWriteDate+t)},w.prototype.updateSecondariesMaxStaleness=function(e){for(var t=0;t<this.secondaries.length;t++)this.updateServerMaxStaleness(this.secondaries[t],e)},w.prototype.pickServer=function(e){if("primary"===(e=e||c.primary).preference&&null!=e.maxStalenessSeconds)return new u("primary readPreference incompatible with maxStalenessSeconds");var t=this.primary?[this.primary]:[];if(t=t.concat(this.secondaries),null!=e.maxStalenessSeconds)for(var n=0;n<t.length;n++)if(t[n].ismaster.maxWireVersion<5)return new u("maxStalenessSeconds not supported by at least one of the replicaset members");if("nearest"===e.preference&&null==e.maxStalenessSeconds)return C(this,e);if("nearest"===e.preference&&null!=e.maxStalenessSeconds)return T(this,e);var r=this.secondaries;if(e.equals(c.secondary)&&0===r.length)return new u("no secondary server available");if(e.equals(c.secondaryPreferred)&&0===r.length&&null==this.primary)return new u("no secondary or primary server available");if(e.equals(c.primary)&&null==this.primary)return new u("no primary server available");if(e.equals(c.secondaryPreferred)||e.equals(c.secondary)){if(r.length>0&&null==e.maxStalenessSeconds){var o=C(this,e);if(o)return o}else if(r.length>0&&null!=e.maxStalenessSeconds&&(o=T(this,e)))return o;return e.equals(c.secondaryPreferred)?this.primary:null}if(e.equals(c.primaryPreferred)){if(o=null,this.primary)return this.primary;if(r.length>0&&null==e.maxStalenessSeconds?o=C(this,e):r.length>0&&null!=e.maxStalenessSeconds&&(o=T(this,e)),o)return o}return this.primary};var _=function(e,t){if(null==e.tags)return t;for(var n=[],r=Array.isArray(e.tags)?e.tags:[e.tags],o=0;o<r.length;o++)for(var s=r[o],i=0;i<t.length;i++){var a=t[i].lastIsMaster().tags||{},c=!0;for(var u in s)a[u]!==s[u]&&(c=!1);c&&n.push(t[i])}return n};function T(e,t){var n=[],r=1e3*t.maxStalenessSeconds;if(r<9e4)return new u("maxStalenessSeconds must be set to at least 90 seconds");e.primary&&"secondary"!==t.preference&&"secondaryPreferred"!==t.preference&&n.push(e.primary);for(var o=0;o<e.secondaries.length;o++)n.push(e.secondaries[o]);if(e.primary&&0===n.length&&"secondaryPreferred"!==t.preference&&n.push(e.primary),(n=(n=_(t,n)).filter(function(e){return e.staleness<=r})).sort(function(e,t){return e.lastIsMasterMS-t.lastIsMasterMS}),0===n.length)return null;e.index=e.index%n.length;var s=n[e.index];return e.index=e.index+1,s}function C(e,t){var n=[];e.primary&&"secondary"!==t.preference&&"secondaryPreferred"!==t.preference&&n.push(e.primary);for(var r=0;r<e.secondaries.length;r++)n.push(e.secondaries[r]);0===n.length&&e.primary&&"secondaryPreferred"!==t.preference&&n.push(e.primary),(n=_(t,n)).sort(function(e,t){return e.lastIsMasterMS-t.lastIsMasterMS});var o=n.length>0?n[0].lastIsMasterMS:0;if(0===(n=n.filter(function(t){return t.lastIsMasterMS<=o+e.acceptableLatency})).length)return null;e.index=e.index%n.length;var s=n[e.index];return e.index=e.index+1,s}function E(e,t,n){for(var r=0;r<n.length;r++)if(n[r]&&n[r].name&&n[r].name.toLowerCase()===t.name.toLowerCase())return!0;return!1}function N(e,t,n,r,o){var s=r.name.toLowerCase();e.set[s].type=t,e.set[s].electionId=n?n.electionId:n,e.set[s].setName=n?n.setName:n,e.set[s].setVersion=n?n.setVersion:n,o.push(r)}function I(e,t){var n=l.from(e.toHexString(),"hex"),r=l.from(t.toHexString(),"hex");if(n===r)return 0;if("function"==typeof l.compare)return l.compare(n,r);for(var o=n.length,s=r.length,i=Math.min(o,s),a=0;a<i&&n[a]===r[a];a++);return a!==i&&(o=n[a],s=r[a]),o<s?-1:s<o?1:0}function x(e,t){for(var n=0;n<t.length;n++){if(t[n].equals&&t[n].equals(e))return t.splice(n,1),!0;if("string"==typeof t[n]&&t[n].toLowerCase()===e.name.toLowerCase())return t.splice(n,1),!0}return!1}function A(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown",n=e.setName;e.hasPrimaryAndSecondary()?t="ReplicaSetWithPrimary":!e.hasPrimary()&&e.hasSecondary()&&(t="ReplicaSetNoPrimary");var r={topologyType:t,setName:n,servers:[]};if(e.hasPrimary()){var o=e.primary.getDescription();o.type="RSPrimary",r.servers.push(o)}r.servers=r.servers.concat(e.secondaries.map(function(e){var t=e.getDescription();return t.type="RSSecondary",t})),r.servers=r.servers.concat(e.arbiters.map(function(e){var t=e.getDescription();return t.type="RSArbiter",t})),r.servers=r.servers.concat(e.passives.map(function(e){var t=e.getDescription();return t.type="RSSecondary",t}));var i=s(e.replicasetDescription,r),a={topologyId:e.id,previousDescription:e.replicasetDescription,newDescription:r,diff:i};e.emit("topologyDescriptionChanged",a),e.replicasetDescription=r}}e.exports=w},function(e,t,n){"use strict";const r=n(1).inherits,o=n(1).format,s=n(9).EventEmitter,i=n(49),a=n(23),c=n(13).retrieveBSON,u=n(4).MongoError,l=n(62),p=n(10).clone,f=n(10).diff,h=n(10).cloneOptions,d=n(10).createClientInfo,m=n(10).SessionMixins,y=n(10).isRetryableWritesSupported,g=n(16).relayEvents,b=n(4).isRetryableError,v=c(),S=n(47).defaultAuthProviders;var w="disconnected",O="connecting",_="connected",T="unreferenced",C="destroyed";function E(e,t){var n={disconnected:[O,C,w],connecting:[O,C,_,w],connected:[_,w,C,T],unreferenced:[T,C],destroyed:[C]}[e.state];n&&-1!==n.indexOf(t)?e.state=t:e.logger.error(o("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}var N=1,I=["connect","close","error","timeout","parseError"],x=function(e,t){t=t||{},this.id=N++,this.s={options:Object.assign({},t),bson:t.bson||new v([v.Binary,v.Code,v.DBRef,v.Decimal128,v.Double,v.Int32,v.Long,v.Map,v.MaxKey,v.MinKey,v.ObjectId,v.BSONRegExp,v.Symbol,v.Timestamp]),Cursor:t.cursorFactory||i,logger:a("Mongos",t),seedlist:e,haInterval:t.haInterval?t.haInterval:1e4,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof t.debug&&t.debug,localThresholdMS:t.localThresholdMS||15,clientInfo:d(t),authenticationContexts:[]},this.s.options.clientInfo=d(t),this.s.logger.isWarn()&&0!==this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(o("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval)),this.authProviders=t.authProviders||S(this.s.bson),this.state=w,this.connectingProxies=[],this.connectedProxies=[],this.disconnectedProxies=[],this.authenticating=!1,this.index=0,this.haTimeoutId=null,this.ismaster=null,this.topologyDescription={topologyType:"Unknown",servers:[]},this.clusterTime=null,s.call(this)};function A(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}r(x,s),Object.assign(x.prototype,m),Object.defineProperty(x.prototype,"type",{enumerable:!0,get:function(){return"mongos"}}),Object.defineProperty(x.prototype,"parserType",{enumerable:!0,get:function(){return v.native?"c++":"js"}}),Object.defineProperty(x.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}});const k=["serverDescriptionChanged","error","close","timeout","parseError"];function B(e,t){t=t||{},k.forEach(t=>e.removeAllListeners(t)),e.destroy(t)}function M(e){return function(){e.state!==C&&(P(e.connectedProxies,e.disconnectedProxies,this),$(e),e.emit("left","mongos",this),e.emit("serverClosed",{topologyId:e.id,address:this.name}))}}function D(e,t){return function(){var n=this;if(e.state===C)return $(e),P(e.connectingProxies,e.disconnectedProxies,this),this.destroy();if("connect"===t?U(e,n,function(){if(e.ismaster=n.lastIsMaster(),"isdbgrid"===e.ismaster.msg){for(var t=0;t<e.connectedProxies.length;t++)if(e.connectedProxies[t].name===n.name)return P(e.connectingProxies,e.disconnectedProxies,n),$(e),n.destroy(),e.emit("failed",n);for(t=0;t<I.length;t++)n.removeAllListeners(I[t]);n.on("error",M(e)),n.on("close",M(e)),n.on("timeout",M(e)),n.on("parseError",M(e)),P(e.connectingProxies,e.connectedProxies,n),e.emit("joined","mongos",n)}else{if(e.s.logger.isWarn()){var r="expected mongos proxy, but found replicaset member mongod for server %s";e.ismaster.hosts||(r="expected mongos proxy, but found standalone mongod for server %s"),e.s.logger.warn(o(r,n.name))}L(e.connectingProxies,n),e.emit("left","server",n),e.emit("failed",n)}}):(P(e.connectingProxies,e.disconnectedProxies,this),e.emit("left","mongos",this),e.emit("failed",this)),$(e),0===e.connectingProxies.length){if(e.connectedProxies.length>0&&e.state===O)E(e,_),e.emit("connect",e),e.emit("fullsetup",e),e.emit("all",e);else if(0===e.disconnectedProxies.length)return e.s.logger.isWarn()&&e.s.logger.warn(o("no mongos proxies found in seed list, did you mean to connect to a replicaset")),e.emit("error",new u("no mongos proxies found in seed list"));!function e(t,n){n=n||{};t.haTimeoutId=setTimeout(function(){if(t.state!==C&&t.state!==T){t.isConnected()&&t.s.disconnectHandler&&t.s.disconnectHandler.execute();var r=t.connectedProxies.slice(0),o=r.length;if(0===r.length)return t.listeners("close").length>0&&t.state===O?t.emit("error",new u("no mongos proxy available")):t.emit("close",t),j(t,t.disconnectedProxies,function(){t.state!==C&&t.state!==T&&(t.state===O&&n.firstConnect?(t.emit("connect",t),t.emit("fullsetup",t),t.emit("all",t)):t.isConnected()?t.emit("reconnect",t):!t.isConnected()&&t.listeners("close").length>0&&t.emit("close",t),e(t))});for(var s=0;s<r.length;s++)i(t,r[s],function(){if(0===(o-=1)){if(t.state===C||t.state===T)return;j(t,t.disconnectedProxies,function(){t.state!==C&&t.state!==T&&e(t)})}})}function i(e,n,r){var o=(new Date).getTime();A(t,"serverHeartbeatStarted",{connectionId:n.name}),n.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:t.s.options.connectionTimeout||2e3},function(e,s){if(t.state===C||t.state===T)return P(t.connectedProxies,t.disconnectedProxies,n),n.destroy(),r(e,s);var i=(new Date).getTime()-o;e?(A(t,"serverHeartbeatFailed",{durationMS:i,failure:e,connectionId:n.name}),P(t.connectedProxies,t.disconnectedProxies,n)):(n.ismaster=s.result,n.lastIsMasterMS=i,A(t,"serverHeartbeatSucceeded",{durationMS:i,reply:s.result,connectionId:n.name})),r(e,s)})}},t.s.haInterval)}(e,{firstConnect:!0})}}}function R(e){for(var t=e.connectedProxies.slice(0),n=Number.MAX_VALUE,r=0;r<t.length;r++)t[r].lastIsMasterMS<n&&(n=t[r].lastIsMasterMS);if(0===(t=t.filter(function(t){if(t.lastIsMasterMS<=n+e.s.localThresholdMS&&t.isConnected())return!0})).length)return e.connectedProxies[0];var o=t[e.index%t.length];return e.index=(e.index+1)%t.length,o}function P(e,t,n){for(var r=0;r<e.length;r++)e[r].name===n.name&&e.splice(r,1);for(r=0;r<t.length;r++)t[r].name===n.name&&t.splice(r,1);t.push(n)}function L(e,t){for(var n=0;n<e.length;n++)e[n].name===t.name&&e.splice(n,1)}function j(e,t,n){var r=t.length,o=function(e,t){return function(){var o=this;if(r-=1,e.state===C||e.state===T)return P(e.connectingProxies,e.disconnectedProxies,o),this.destroy();"connect"!==t||e.authenticating?(P(e.connectingProxies,e.disconnectedProxies,o),this.destroy()):U(e,o,function(){if(e.state===C||e.state===T)return P(e.connectingProxies,e.disconnectedProxies,o),o.destroy();for(var t=0;t<I.length;t++)o.removeAllListeners(I[t]);o.on("error",M(e)),o.on("close",M(e)),o.on("timeout",M(e)),o.on("parseError",M(e)),P(e.connectingProxies,e.connectedProxies,o),$(e),e.emit("joined","mongos",o)}),0===r&&n()}};if(0===r)return n();function s(t,n){setTimeout(function(){if(e.state!==C&&e.state!==T){var n=new l(Object.assign({},e.s.options,{host:t.name.split(":")[0],port:parseInt(t.name.split(":")[1],10),authProviders:e.authProviders,reconnect:!1,monitoring:!1,parent:e,clientInfo:p(e.s.clientInfo)}));B(t),L(e.disconnectedProxies,t),g(n,e,["serverDescriptionChanged"]),e.emit("serverOpening",{topologyId:-1!==n.s.topologyId?n.s.topologyId:e.id,address:n.name}),n.once("connect",o(e,"connect")),n.once("close",o(e,"close")),n.once("timeout",o(e,"timeout")),n.once("error",o(e,"error")),n.once("parseError",o(e,"parseError")),g(n,e,["commandStarted","commandSucceeded","commandFailed"]),e.connectingProxies.push(n),n.connect(e.s.connectOptions)}},n)}for(var i=0;i<t.length;i++)s(t[i],i)}function U(e,t,n){if(0===e.s.authenticationContexts.length)return n();!function e(t,n,r){if(0===t.length)return r();var o=t.shift().slice(0);o.push(function(){e(t,n,r)}),n.auth.apply(n,o)}(e.s.authenticationContexts.slice(0),t,n)}x.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{},E(this,O);var n=this.s.seedlist.map(function(e){const n=new l(Object.assign({},t.s.options,e,{authProviders:t.authProviders,reconnect:!1,monitoring:!1,parent:t,clientInfo:p(t.s.clientInfo)}));return g(n,t,["serverDescriptionChanged"]),n});A(this,"topologyOpening",{topologyId:this.id}),function(e,t){e.connectingProxies=e.connectingProxies.concat(t);var n=0;function r(t,n){setTimeout(function(){e.emit("serverOpening",{topologyId:e.id,address:t.name}),$(e),t.once("close",D(e,"close")),t.once("timeout",D(e,"timeout")),t.once("parseError",D(e,"parseError")),t.once("error",D(e,"error")),t.once("connect",D(e,"connect")),g(t,e,["commandStarted","commandSucceeded","commandFailed"]),t.connect(e.s.connectOptions)},n)}for(;t.length>0;)r(t.shift(),n++)}(t,n)},x.prototype.lastIsMaster=function(){return this.ismaster},x.prototype.unref=function(){E(this,T),this.connectedProxies.concat(this.connectingProxies).forEach(function(e){e.unref()}),clearTimeout(this.haTimeoutId)},x.prototype.destroy=function(e){var t=this;E(this,C);var n=this.connectedProxies.concat(this.connectingProxies);this.haTimeoutId&&clearTimeout(this.haTimeoutId),this.s.authenticationContexts=[],n.forEach(function(n){t.emit("serverClosed",{topologyId:t.id,address:n.name}),B(n,e),P(t.connectedProxies,t.disconnectedProxies,n)}),$(t),A(this,"topologyClosed",{topologyId:this.id})},x.prototype.isConnected=function(){return this.connectedProxies.length>0},x.prototype.isDestroyed=function(){return this.state===C};var z=function(e,t,n,r,o,s){"function"==typeof o&&(s=o,o={}),o=o||{};let i=R(e);return i?o.retryWrites&&o.session&&y(e)?(o.willRetryWrite=!0,o.session.incrementTransactionNumber(),void i[t](n,r,o,(a,c)=>a?b(a)&&(i=R(e))&&y(i)?void i[t](n,r,o,s):s(a):s(null,c))):i[t](n,r,o,s):s(new u("no mongos proxy available"))};x.prototype.insert=function(e,t,n,r){return"function"==typeof n&&(r=n,n=(n={})||{}),this.state===C?r(new u(o("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void z(this,"insert",e,t,n,r):r(new u("no mongos proxy available")):this.s.disconnectHandler.add("insert",e,t,n,r)},x.prototype.update=function(e,t,n,r){return"function"==typeof n&&(r=n,n=(n={})||{}),this.state===C?r(new u(o("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void z(this,"update",e,t,n,r):r(new u("no mongos proxy available")):this.s.disconnectHandler.add("update",e,t,n,r)},x.prototype.remove=function(e,t,n,r){return"function"==typeof n&&(r=n,n=(n={})||{}),this.state===C?r(new u(o("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void z(this,"remove",e,t,n,r):r(new u("no mongos proxy available")):this.s.disconnectHandler.add("remove",e,t,n,r)};const q=["findAndModify","insert","update","delete"];function $(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown";e.connectedProxies.length>0&&(t="Sharded");var n={topologyType:t,servers:[]},r=e.disconnectedProxies.concat(e.connectingProxies);n.servers=n.servers.concat(r.map(function(e){var t=e.getDescription();return t.type="Unknown",t})),n.servers=n.servers.concat(e.connectedProxies.map(function(e){var t=e.getDescription();return t.type="Mongos",t}));var o=f(e.topologyDescription,n),s={topologyId:e.id,previousDescription:e.topologyDescription,newDescription:n,diff:o};o.servers.length>0&&e.emit("topologyDescriptionChanged",s),e.topologyDescription=n}}x.prototype.command=function(e,t,n,r){if("function"==typeof n&&(r=n,n=(n={})||{}),this.state===C)return r(new u(o("topology was destroyed")));var s=R(this);if((null==s||!s.isConnected())&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,r);if(null==s)return r(new u("no mongos proxy available"));var i=h(n);i.topology=this;const a=!n.retrying&&n.retryWrites&&n.session&&y(this)&&!n.session.inTransaction()&&function(e){return q.some(t=>e[t])}(t);a&&(n.session.incrementTransactionNumber(),n.willRetryWrite=a),s.command(e,t,i,(n,o)=>{if(!n)return r(null,o);if(!b(n))return r(n);if(a){const n=Object.assign({},i,{retrying:!0});return this.command(e,t,n,r)}return r(n)})},x.prototype.cursor=function(e,t,n){const r=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(this.s.bson,e,t,n,r,this.s.options)},x.prototype.auth=function(e,t){var n=Array.prototype.slice.call(arguments,0).slice(0),r=this,s=Array.prototype.slice.call(arguments,2),i=s.pop(),a=0;if(null==this.authProviders[e]&&"default"!==e)return i(new u(o("auth provider %s does not exist",e)));if(this.authenticating)return i(new u("authentication or logout allready in process"));if(!r.isConnected()&&null!=r.s.disconnectHandler)return r.s.disconnectHandler.add("auth",t,n,{},i);this.authenticating=!0;var c=[],l=this.connectedProxies.slice(0);function p(n){var o=[e,t].concat(s.slice(0)).concat([function(e){if(f-=1,e&&c.push({name:n.name,err:e}),0===f){if(r.authenticating=!1,c.length)return r.s.authenticationContexts.splice(a,0),i(new u({message:"authentication fail",errors:c}),!1);i(null,r)}}]);n.lastIsMaster().arbiterOnly||n.auth.apply(n,o)}0===l.length&&(this.authenticating=!1,i(null,!0)),a=this.s.authenticationContexts.length,this.s.authenticationContexts.push([e,t].concat(s.slice(0)));for(var f=l.length;l.length>0;)p(l.shift())},x.prototype.logout=function(e,t){var n=this;if(this.authenticating)throw new u("authentication or logout allready in process");this.authenticating=!0;for(var r=Object.keys(this.authProviders),s=0;s<r.length;s++)this.authProviders[r[s]].logout(e);var i=this.connectedProxies.slice(0),a=i.length;if(0===a)return t();var c=[];function l(t,n){t.logout(e,function(e){e&&c.push({name:t.name,err:e}),n()})}for(s=0;s<i.length;s++)l(i[s],function(){if(0===(a-=1)){if(n.authenticating=!1,c.length)return t(new u({message:o("logout failed against db %s",e),errors:c}),!1);t()}})},x.prototype.selectServer=function(e,t,n){"function"==typeof e&&void 0===n&&(n=e,e=void 0,t={}),"function"==typeof t&&(n=t,t=e,e=void 0),t=t||{};const r=R(this);this.s.debug&&this.emit("pickedServer",null,r),n(null,r)},x.prototype.connections=function(){for(var e=[],t=0;t<this.connectedProxies.length;t++)e=e.concat(this.connectedProxies[t].connections());return e},e.exports=x},function(e,t,n){"use strict";const r=n(13).retrieveBSON,o=n(9),s=r().Binary,i=n(16).uuidV4,a=n(4).MongoError,c=n(4).isRetryableError,u=n(4).MongoNetworkError,l=n(4).MongoWriteConcernError,p=n(64).Transaction,f=n(64).TxnState;function h(e,t){if(null==e.serverSession){const e=new a("Cannot use a session that has ended");if("function"==typeof t)return t(e,null),!1;throw e}return!0}class d extends o{constructor(e,t,n,r){if(super(),null==e)throw new Error("ClientSession requires a topology");if(null==t||!(t instanceof g))throw new Error("ClientSession requires a ServerSessionPool");n=n||{},this.topology=e,this.sessionPool=t,this.hasEnded=!1,this.serverSession=t.acquire(),this.clientOptions=r,this.supports={causalConsistency:void 0===n.causalConsistency||n.causalConsistency},void 0!==(n=n||{}).initialClusterTime?this.clusterTime=n.initialClusterTime:this.clusterTime=null,this.operationTime=null,this.explicit=!!n.explicit,this.owner=n.owner,this.defaultTransactionOptions=Object.assign({},n.defaultTransactionOptions),this.transaction=new p}get id(){return this.serverSession.id}endSession(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},this.hasEnded?"function"==typeof t&&t(null,null):(this.serverSession&&this.inTransaction()&&this.abortTransaction(),this.hasEnded=!0,this.emit("ended",this),this.sessionPool.release(this.serverSession),"function"==typeof t&&t(null,null))}advanceOperationTime(e){null!=this.operationTime?e.greaterThan(this.operationTime)&&(this.operationTime=e):this.operationTime=e}equals(e){return e instanceof d&&this.id.id.buffer.equals(e.id.id.buffer)}incrementTransactionNumber(){this.serverSession.txnNumber++}inTransaction(){return this.transaction.isActive}startTransaction(e){if(h(this),this.inTransaction())throw new a("Transaction already in progress");this.incrementTransactionNumber(),this.transaction=new p(Object.assign({},this.clientOptions,e||this.defaultTransactionOptions)),this.transaction.transition(f.STARTING_TRANSACTION)}commitTransaction(e){if("function"!=typeof e)return new Promise((e,t)=>{m(this,"commitTransaction",(n,r)=>n?t(n):e(r))});m(this,"commitTransaction",e)}abortTransaction(e){if("function"!=typeof e)return new Promise((e,t)=>{m(this,"abortTransaction",(n,r)=>n?t(n):e(r))});m(this,"abortTransaction",e)}toBSON(){throw new Error("ClientSession cannot be serialized to BSON.")}}function m(e,t,n){if(!h(e,n))return;let r=e.transaction.state;if(r===f.NO_TRANSACTION)return void n(new a("No transaction started"));if("commitTransaction"===t){if(r===f.STARTING_TRANSACTION||r===f.TRANSACTION_COMMITTED_EMPTY)return e.transaction.transition(f.TRANSACTION_COMMITTED_EMPTY),void n(null,null);if(r===f.TRANSACTION_ABORTED)return void n(new a("Cannot call commitTransaction after calling abortTransaction"))}else{if(r===f.STARTING_TRANSACTION)return e.transaction.transition(f.TRANSACTION_ABORTED),void n(null,null);if(r===f.TRANSACTION_ABORTED)return void n(new a("Cannot call abortTransaction twice"));if(r===f.TRANSACTION_COMMITTED||r===f.TRANSACTION_COMMITTED_EMPTY)return void n(new a("Cannot call abortTransaction after calling commitTransaction"))}const o={[t]:1};function s(r,o){if("commitTransaction"===t){if(e.transaction.transition(f.TRANSACTION_COMMITTED),r&&(r instanceof u||r instanceof l||c(r))){if(r.errorLabels){const e=r.errorLabels.indexOf("TransientTransactionError");-1!==e&&r.errorLabels.splice(e,1)}else r.errorLabels=[];r.errorLabels.push("UnknownTransactionCommitResult")}}else e.transaction.transition(f.TRANSACTION_ABORTED);n(r,o)}function i(e){return"commitTransaction"===t?e:null}e.transaction.options.writeConcern?Object.assign(o,{writeConcern:e.transaction.options.writeConcern}):e.clientOptions&&e.clientOptions.w&&Object.assign(o,{writeConcern:{w:e.clientOptions.w}}),e.topology.command("admin.$cmd",o,{session:e},(t,n)=>{if(t&&c(t))return e.topology.command("admin.$cmd",o,{session:e},(e,t)=>s(i(e),t));s(i(t),n)})}class y{constructor(){this.id={id:new s(i(),s.SUBTYPE_UUID)},this.lastUse=Date.now(),this.txnNumber=0}hasTimedOut(e){return Math.round((Date.now()-this.lastUse)%864e5%36e5/6e4)>e-1}}class g{constructor(e){if(null==e)throw new Error("ServerSessionPool requires a topology");this.topology=e,this.sessions=[]}endAllPooledSessions(){this.sessions.length&&(this.topology.endSessions(this.sessions.map(e=>e.id)),this.sessions=[])}acquire(){const e=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){const t=this.sessions.shift();if(!t.hasTimedOut(e))return t}return new y}release(e){const t=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){if(!this.sessions[this.sessions.length-1].hasTimedOut(t))break;this.sessions.pop()}e.hasTimedOut(t)||this.sessions.unshift(e)}}e.exports={ClientSession:d,ServerSession:y,ServerSessionPool:g,TxnState:f}},function(e,t,n){"use strict";const r=n(65),o=n(96),s=n(66),i=n(4).MongoParseError,a=n(22),c=/(mongodb(?:\+srv|)):\/\/(?: (?:[^:]*) (?: : ([^@]*) )? @ )?([^/?]*)(?:\/|)(.*)/;function u(e,t){const n=/^.*?\./,r=`.${e.replace(n,"")}`,o=`.${t.replace(n,"")}`;return r.endsWith(o)}function l(e,t){if(Array.isArray(t))1===(t=t.filter((e,n)=>t.indexOf(e)===n)).length&&(t=t[0]);else if(t.indexOf(":")>0)t=t.split(",").reduce((t,n)=>{const r=n.split(":");return t[r[0]]=l(e,r[1]),t},{});else if(t.indexOf(",")>0)t=t.split(",").map(t=>l(e,t));else if("true"===t.toLowerCase()||"false"===t.toLowerCase())t="true"===t.toLowerCase();else if(!Number.isNaN(t)&&!f.has(e)){const e=parseFloat(t);Number.isNaN(e)||(t=parseFloat(t))}return t}const p=new Set(["slaveok","slave_ok","sslvalidate","fsync","safe","retrywrites","j"]),f=new Set(["authsource","replicaset"]),h=new Set(["GSSAPI","MONGODB-X509","MONGODB-CR","DEFAULT","SCRAM-SHA-1","SCRAM-SHA-256","PLAIN"]),d={replicaset:"replicaSet",connecttimeoutms:"connectTimeoutMS",sockettimeoutms:"socketTimeoutMS",maxpoolsize:"maxPoolSize",minpoolsize:"minPoolSize",maxidletimems:"maxIdleTimeMS",waitqueuemultiple:"waitQueueMultiple",waitqueuetimeoutms:"waitQueueTimeoutMS",wtimeoutms:"wtimeoutMS",readconcern:"readConcern",readconcernlevel:"readConcernLevel",readpreference:"readPreference",maxstalenessseconds:"maxStalenessSeconds",readpreferencetags:"readPreferenceTags",authsource:"authSource",authmechanism:"authMechanism",authmechanismproperties:"authMechanismProperties",gssapiservicename:"gssapiServiceName",localthresholdms:"localThresholdMS",serverselectiontimeoutms:"serverSelectionTimeoutMS",serverselectiontryonce:"serverSelectionTryOnce",heartbeatfrequencyms:"heartbeatFrequencyMS",appname:"appName",retrywrites:"retryWrites",uuidrepresentation:"uuidRepresentation",zlibcompressionlevel:"zlibCompressionLevel"};function m(e,t,n,r){if("journal"===t?t="j":"wtimeoutms"===t&&(t="wtimeout"),p.has(t)?n="true"===n||!0===n:"appname"===t?n=decodeURIComponent(n):"readconcernlevel"===t&&(t="readconcern",n={level:n}),"compressors"===t&&!(n=Array.isArray(n)?n:[n]).every(e=>"snappy"===e||"zlib"===e))throw new i("Value for `compressors` must be at least one of: `snappy`, `zlib`");if("authmechanism"===t&&!h.has(n))throw new i("Value for `authMechanism` must be one of: `DEFAULT`, `GSSAPI`, `PLAIN`, `MONGODB-X509`, `SCRAM-SHA-1`, `SCRAM-SHA-256`");if("readpreference"===t&&!a.isValid(n))throw new i("Value for `readPreference` must be one of: `primary`, `primaryPreferred`, `secondary`, `secondaryPreferred`, `nearest`");if("zlibcompressionlevel"===t&&(n<-1||n>9))throw new i("zlibCompressionLevel must be an integer between -1 and 9");"compressors"!==t&&"zlibcompressionlevel"!==t||(e.compression=e.compression||{},e=e.compression),"authmechanismproperties"===t&&("string"==typeof n.SERVICE_NAME&&(e.gssapiServiceName=n.SERVICE_NAME),"string"==typeof n.SERVICE_REALM&&(e.gssapiServiceRealm=n.SERVICE_REALM),void 0!==n.CANONICALIZE_HOST_NAME&&(e.gssapiCanonicalizeHostName=n.CANONICALIZE_HOST_NAME)),r.caseTranslate&&d[t]?e[d[t]]=n:e[t]=n}const y=new Set(["GSSAPI","MONGODB-CR","PLAIN","SCRAM-SHA-1","SCRAM-SHA-256"]);const g="mongodb+srv",b=["mongodb",g];function v(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({},{caseTranslate:!0},t);try{r.parse(e)}catch(e){return n(new i("URI malformed, cannot be parsed"))}const a=e.match(c);if(!a)return n(new i("Invalid connection string"));const p=a[1];if(-1===b.indexOf(p))return n(new i("Invalid protocol provided"));if(p===g)return function(e,t,n){const a=r.parse(e,!0);if(a.hostname.split(".").length<3)return n(new i("URI does not have hostname, domain name and tld"));if(a.domainLength=a.hostname.split(".").length,a.pathname&&a.pathname.match(","))return n(new i("Invalid URI, cannot contain multiple hostnames"));if(a.port)return n(new i(`Ports not accepted with '${g}' URIs`));const c=a.host;s.resolveSrv(`_mongodb._tcp.${c}`,(e,l)=>{if(e)return n(e);if(0===l.length)return n(new i("No addresses found at host"));for(let e=0;e<l.length;e++)if(!u(l[e].name,a.hostname,a.domainLength))return n(new i("Server record does not share hostname with parent URI"));a.protocol="mongodb",a.host=l.map(e=>`${e.name}:${e.port}`).join(","),"ssl"in t||a.search&&"ssl"in a.query&&null!==a.query.ssl||(a.query.ssl=!0),s.resolveTxt(c,(e,s)=>{if(e){if("ENODATA"!==e.code)return n(e);s=null}if(s){if(s.length>1)return n(new i("Multiple text records not allowed"));if(s=o.parse(s[0].join("")),Object.keys(s).some(e=>"authSource"!==e&&"replicaSet"!==e))return n(new i("Text record must only set `authSource` or `replicaSet`"));Object.assign(a.query,s)}a.search=o.stringify(a.query),v(r.format(a),t,n)})})}(e,t,n);const f=a[4].split("?"),h=f.length>0?f[0]:null,d=f.length>1?f[1]:null;let S;try{S=function(e,t){const n={};let r=o.parse(e);for(const e in r){const o=r[e];if(""===o||null==o)throw new i("Incomplete key value pair for option");const s=e.toLowerCase();m(n,s,l(s,o),t)}return n.wtimeout&&n.wtimeoutms&&(delete n.wtimeout,console.warn("Unsupported option `wtimeout` specified")),Object.keys(n).length?n:null}(d,t)}catch(e){return n(e)}S=Object.assign({},S,t);const w={username:null,password:null,db:h&&""!==h?o.unescape(h):null};if(S.auth&&(S.auth.username&&(w.username=S.auth.username),S.auth.user&&(w.username=S.auth.user),S.auth.password&&(w.password=S.auth.password)),-1!==a[4].split("?")[0].indexOf("@"))return n(new i("Unescaped slash in userinfo section"));const O=a[3].split("@");if(O.length>2)return n(new i("Unescaped at-sign in authority section"));if(O.length>1){const e=O.shift().split(":");if(e.length>2)return n(new i("Unescaped colon in authority section"));w.username=o.unescape(e[0]),w.password=e[1]?o.unescape(e[1]):null}let _=null;const T=O.shift().split(",").map(e=>{let t=r.parse(`mongodb://${e}`);if("/:"===t.path)return _=new i("Double colon in host identifier"),null;if(e.match(/\.sock/)&&(t.hostname=o.unescape(e),t.port=null),Number.isNaN(t.port))return void(_=new i("Invalid port (non-numeric string)"));const n={host:t.hostname,port:t.port?parseInt(t.port):27017};if(0!==n.port)if(n.port>65535)_=new i("Invalid port (larger than 65535) with hostname");else{if(!(n.port<0))return n;_=new i("Invalid port (negative number)")}else _=new i("Invalid port (zero) with hostname")}).filter(e=>!!e);if(_)return n(_);if(0===T.length||""===T[0].host||null===T[0].host)return n(new i("No hostname or hostnames provided in connection string"));const C={hosts:T,auth:w.db||w.username?w:null,options:Object.keys(S).length?S:null};C.auth&&C.auth.db&&(C.defaultDatabase=C.auth.db);try{!function(e){if(null==e.options)return;const t=e.options,n=t.authsource||t.authSource;null!=n&&(e.auth=Object.assign({},e.auth,{db:n}));const r=t.authmechanism||t.authMechanism;if(null!=r){if(y.has(r)&&(!e.auth||null==e.auth.username))throw new i(`Username required for mechanism \`${r}\``);if("GSSAPI"===r){if(null!=n&&"$external"!==n)throw new i(`Invalid source \`${n}\` for mechanism \`${r}\` specified.`);e.auth=Object.assign({},e.auth,{db:"$external"})}if("MONGODB-X509"===r){if(e.auth&&null!=e.auth.password)throw new i(`Password not allowed for mechanism \`${r}\``);if(null!=n&&"$external"!==n)throw new i(`Invalid source \`${n}\` for mechanism \`${r}\` specified.`);e.auth=Object.assign({},e.auth,{db:"$external"})}"PLAIN"===r&&e.auth&&null==e.auth.db&&(e.auth=Object.assign({},e.auth,{db:"$external"}))}e.auth&&null==e.auth.db&&(e.auth=Object.assign({},e.auth,{db:"admin"}))}(C)}catch(e){return n(e)}n(null,C)}e.exports=v},function(e,t,n){"use strict";const r=n(9).EventEmitter;e.exports=class extends r{constructor(){super()}instrument(e,t){this.$MongoClient=e;const n=this.$prototypeConnect=e.prototype.connect,r=this;e.prototype.connect=function(e){return this.s.options.monitorCommands=!0,this.on("commandStarted",e=>r.emit("started",e)),this.on("commandSucceeded",e=>r.emit("succeeded",e)),this.on("commandFailed",e=>r.emit("failed",e)),n.call(this,e)},"function"==typeof t&&t(null,this)}uninstrument(){this.$MongoClient.prototype.connect=this.$prototypeConnect}}},function(e,t,n){"use strict";const r=n(2).MongoNetworkError,o=n(2).mongoErrorContextSymbol,s=new Set([136,237,11601]);e.exports={GET_MORE_NON_RESUMABLE_CODES:s,isResumableError:function(e){return!!function(e){if(e[o])return e[o].isGetMore}(e)&&!!(e instanceof r||!s.has(e.code)||e.message.match(/not master/)||e.message.match(/node is recovering/))}}},function(e,t,n){"use strict";const r=n(51),o=r.BulkOperationBase,s=n(0),i=s.toError,a=s.handleCallback,c=r.BulkWriteResult,u=r.Batch,l=r.mergeBatchResults,p=s.executeOperation,f=n(2).MongoWriteConcernError,h=n(51).handleMongoWriteConcernError,d=r.bson;function m(e,t,n){const o=d.calculateObjectSize(n,{checkKeys:!1});if(o>=e.s.maxBatchSizeBytes)throw i("document is larger than the maximum size "+e.s.maxBatchSizeBytes);if(e.s.currentBatch=null,t===r.INSERT?e.s.currentBatch=e.s.currentInsertBatch:t===r.UPDATE?e.s.currentBatch=e.s.currentUpdateBatch:t===r.REMOVE&&(e.s.currentBatch=e.s.currentRemoveBatch),null==e.s.currentBatch&&(e.s.currentBatch=new u(t,e.s.currentIndex)),(e.s.currentBatch.size+1>=e.s.maxWriteBatchSize||e.s.currentBatch.sizeBytes+o>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!==t)&&(e.s.batches.push(e.s.currentBatch),e.s.currentBatch=new u(t,e.s.currentIndex)),Array.isArray(n))throw i("operation passed in cannot be an Array");return e.s.currentBatch.operations.push(n),e.s.currentBatch.originalIndexes.push(e.s.currentIndex),e.s.currentIndex=e.s.currentIndex+1,t===r.INSERT?(e.s.currentInsertBatch=e.s.currentBatch,e.s.bulkResult.insertedIds.push({index:e.s.bulkResult.insertedIds.length,_id:n._id})):t===r.UPDATE?e.s.currentUpdateBatch=e.s.currentBatch:t===r.REMOVE&&(e.s.currentRemoveBatch=e.s.currentBatch),e.s.currentBatch.size=e.s.currentBatch.size+1,e.s.currentBatch.sizeBytes=e.s.currentBatch.sizeBytes+o,e}class y extends o{constructor(e,t,n){n=n||{},super(e,t,n=Object.assign(n,{addToOperationsList:m}),!1)}execute(e,t,n){const r=this.bulkExecute(e,t,n);return t=r.options,n=r.callback,p(this.s.topology,b,[this,t,n])}}function g(e,t,n,r){e.finalOptionsHandler({options:n,batch:t,resultHandler:function(n,o){return!(n&&n.driver||n&&n.message)||n instanceof f?(n&&(n.ok=0),n instanceof f?h(t,e.s.bulkResult,!1,n,r):void a(r,null,l(!1,t,e.s.bulkResult,n,o))):a(r,n)}},r)}function b(e,t,n){let r=e.s.batches.length;for(let o=0;o<e.s.batches.length;o++)g(e,e.s.batches[o],t,function(t){if(0===(r-=1)){if(t)return a(n,t);const r=new c(e.s.bulkResult);if(e.handleWriteError(n,r))return;return a(n,null,r)}})}function v(e,t,n){return new y(e,t,n)}v.UnorderedBulkOperation=y,e.exports=v,e.exports.Bulk=y},function(e,t,n){"use strict";const r=n(51),o=r.BulkOperationBase,s=n(0),i=s.toError,a=s.handleCallback,c=r.BulkWriteResult,u=r.Batch,l=r.mergeBatchResults,p=s.executeOperation,f=n(2).MongoWriteConcernError,h=n(51).handleMongoWriteConcernError,d=r.bson;function m(e,t,n){const o=d.calculateObjectSize(n,{checkKeys:!1});if(o>=e.s.maxBatchSizeBytes)throw i("document is larger than the maximum size "+e.s.maxBatchSizeBytes);if(null==e.s.currentBatch&&(e.s.currentBatch=new u(t,e.s.currentIndex)),e.s.currentBatchSize+1>=e.s.maxWriteBatchSize||e.s.currentBatchSizeBytes+e.s.currentBatchSizeBytes>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!==t?(e.s.batches.push(e.s.currentBatch),e.s.currentBatch=new u(t,e.s.currentIndex),e.s.currentBatchSize=0,e.s.currentBatchSizeBytes=0):(e.s.currentBatchSize=e.s.currentBatchSize+1,e.s.currentBatchSizeBytes=e.s.currentBatchSizeBytes+o),t===r.INSERT&&e.s.bulkResult.insertedIds.push({index:e.s.currentIndex,_id:n._id}),Array.isArray(n))throw i("operation passed in cannot be an Array");return e.s.currentBatch.originalIndexes.push(e.s.currentIndex),e.s.currentBatch.operations.push(n),e.s.currentBatchSizeBytes=e.s.currentBatchSizeBytes+o,e.s.currentIndex=e.s.currentIndex+1,e}class y extends o{constructor(e,t,n){n=n||{},super(e,t,n=Object.assign(n,{addToOperationsList:m}),!0)}execute(e,t,n){const r=this.bulkExecute(e,t,n);return t=r.options,n=r.callback,p(this.s.topology,g,[this,t,n])}}function g(e,t,n){if(0===e.s.batches.length)return a(n,null,new c(e.s.bulkResult));const r=e.s.batches.shift();e.finalOptionsHandler({options:t,batch:r,resultHandler:function(o,s){if((o&&o.driver||o&&o.message)&&!(o instanceof f))return a(n,o);if(o&&(o.ok=0),o instanceof f)return h(r,e.s.bulkResult,!0,o,n);const i=new c(e.s.bulkResult);if(null!=l(!0,r,e.s.bulkResult,o,s))return a(n,null,i);e.handleWriteError(n,i)||g(e,t,n)}},n)}function b(e,t,n){return new y(e,t,n)}b.OrderedBulkOperation=y,e.exports=b,e.exports.Bulk=y},function(e,t,n){"use strict";var r=n(0).shallowClone,o=n(0).handleCallback,s=n(2).MongoError,i=n(1).format,a=function(e,t,n,r,a){if(e.topology&&e.topology.isDestroyed())return a(new s("topology was destroyed"));var c=r.dbName;c=r.authdb?r.authdb:c,c=r.authSource?r.authSource:c;var u=function(t,n){e.listeners("authenticated").length>0&&e.emit("authenticated",t,n),o(a,t,n)},l=r.authMechanism||"";"MONGODB-CR"===(l=l.toUpperCase())?e.topology.auth("mongocr",c,t,n,function(e){if(e)return o(a,e,!1);u(null,!0)}):"PLAIN"===l?e.topology.auth("plain",c,t,n,function(e){if(e)return o(a,e,!1);u(null,!0)}):"MONGODB-X509"===l?e.topology.auth("x509",c,t,n,function(e){if(e)return o(a,e,!1);u(null,!0)}):"SCRAM-SHA-1"===l?e.topology.auth("scram-sha-1",c,t,n,function(e){if(e)return o(a,e,!1);u(null,!0)}):"SCRAM-SHA-256"===l?e.topology.auth("scram-sha-256",c,t,n,function(e){if(e)return o(a,e,!1);u(null,!0)}):"GSSAPI"===l?"win32"===process.platform?e.topology.auth("sspi",c,t,n,r,function(e){if(e)return o(a,e,!1);u(null,!0)}):e.topology.auth("gssapi",c,t,n,r,function(e){if(e)return o(a,e,!1);u(null,!0)}):"DEFAULT"===l?e.topology.auth("default",c,t,n,function(e){if(e)return o(a,e,!1);u(null,!0)}):o(a,s.create({message:i("authentication mechanism %s not supported",r.authMechanism),driver:!0}))};e.exports=function(e,t,n,i,c){if("function"==typeof i&&(c=i,i={}),(i=r(i=i||{})).authMechanism){if("GSSAPI"!==i.authMechanism&&"DEFAULT"!==i.authMechanism&&"MONGODB-CR"!==i.authMechanism&&"MONGODB-X509"!==i.authMechanism&&"SCRAM-SHA-1"!==i.authMechanism&&"SCRAM-SHA-256"!==i.authMechanism&&"PLAIN"!==i.authMechanism)return o(c,s.create({message:"only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, or SCRAM-SHA-1 is supported by authMechanism",driver:!0}))}else i.authMechanism="DEFAULT";return"function"==typeof c?a(e,t,n,i,function(e,t){if(e&&e.message&&-1!==e.message.indexOf("saslStart")&&(e.code=59),e)return c(e,t);c(null,t)}):new e.s.promiseLibrary(function(r,o){a(e,t,n,i,function(e,t){if(e&&e.message&&-1!==e.message.indexOf("saslStart")&&(e.code=59),e)return o(e);r(t)})})}},function(e){e.exports={_from:"mongodb",_id:"mongodb@3.1.10",_inBundle:!1,_integrity:"sha512-Uml42GeFxhTGQVml1XQ4cD0o/rp7J2ROy0fdYUcVitoE7vFqEhKH4TYVqRDpQr/bXtCJVxJdNQC1ntRxNREkPQ==",_location:"/mongodb",_phantomChildren:{},_requested:{type:"tag",registry:!0,raw:"mongodb",name:"mongodb",escapedName:"mongodb",rawSpec:"",saveSpec:null,fetchSpec:"latest"},_requiredBy:["#USER","/","/mongoose"],_resolved:"https://registry.npmjs.org/mongodb/-/mongodb-3.1.10.tgz",_shasum:"45ad9b74ea376f4122d0881b75e5489b9e504ed7",_spec:"mongodb",_where:"/Users/zubinpratap/Documents/DevProjects/Practice_Projects/visiJAM/src/functions",bugs:{url:"https://github.com/mongodb/node-mongodb-native/issues"},bundleDependencies:!1,dependencies:{"mongodb-core":"3.1.9","safe-buffer":"^5.1.2"},deprecated:!1,description:"The official MongoDB driver for Node.js",devDependencies:{bluebird:"3.5.0",bson:"^1.0.4",chai:"^4.1.1","chai-subset":"^1.6.0",co:"4.6.0",coveralls:"^2.11.6",eslint:"^4.5.0","eslint-plugin-prettier":"^2.2.0",istanbul:"^0.4.5",jsdoc:"3.5.5","lodash.camelcase":"^4.3.0","mocha-sinon":"^2.1.0","mongodb-extjson":"^2.1.1","mongodb-mock-server":"^1.0.0","mongodb-test-runner":"^1.1.18",prettier:"~1.12.0",semver:"^5.5.0",sinon:"^4.3.0","sinon-chai":"^3.2.0","standard-version":"^4.4.0","worker-farm":"^1.5.0"},engines:{node:">=4"},files:["index.js","lib"],homepage:"https://github.com/mongodb/node-mongodb-native",keywords:["mongodb","driver","official"],license:"Apache-2.0",main:"index.js",name:"mongodb",repository:{type:"git",url:"git+ssh://git@github.com/mongodb/node-mongodb-native.git"},scripts:{bench:"node test/driverBench/",coverage:"istanbul cover mongodb-test-runner -- -t 60000  test/unit test/functional",format:"prettier --print-width 100 --tab-width 2 --single-quote --write 'test/**/*.js' 'lib/**/*.js'","generate-evergreen":"node .evergreen/generate_evergreen_tasks.js",lint:"eslint lib test",release:"standard-version -i HISTORY.md",test:"npm run lint && mongodb-test-runner -t 60000 test/unit test/functional"},version:"3.1.10"}},function(e,t,n){"use strict";const r=n(2).ReadPreference,o=n(65),s=n(1).format,i=n(2).Logger,a=n(66);function c(e,t){let n=/^.*?\./,r=`.${e.replace(n,"")}`,o=`.${t.replace(n,"")}`;return!!r.endsWith(o)}function u(e,t,n){let a,c;try{a=function(e,t){let n="",a="",c="",u="admin",l=o.parse(e,!0);if((null==l.hostname||""===l.hostname)&&-1===e.indexOf(".sock"))throw new Error("No hostname or hostnames provided in connection string");if("0"===l.port)throw new Error("Invalid port (zero) with hostname");if(!isNaN(parseInt(l.port,10))&&parseInt(l.port,10)>65535)throw new Error("Invalid port (larger than 65535) with hostname");if(l.path&&l.path.length>0&&"/"!==l.path[0]&&-1===e.indexOf(".sock"))throw new Error("Missing delimiting slash between hosts and options");if(l.query)for(let e in l.query){if(-1!==e.indexOf("::"))throw new Error("Double colon in host identifier");if(""===l.query[e])throw new Error("Query parameter "+e+" is an incomplete value pair")}if(l.auth){let t=l.auth.split(":");if(-1!==e.indexOf(l.auth)&&t.length>2)throw new Error("Username with password containing an unescaped colon");if(-1!==e.indexOf(l.auth)&&-1!==l.auth.indexOf("@"))throw new Error("Username containing an unescaped at-sign")}let p=e.split("?").shift().split(","),f=[];for(let e=0;e<p.length;e++){let t=p[e];-1!==t.indexOf("mongodb")?-1!==t.indexOf("@")?f.push(t.split("@").pop()):f.push(t.substr("mongodb://".length)):-1!==t.indexOf("/")?f.push(t.split("/").shift()):-1===t.indexOf("/")&&f.push(t.trim())}for(let e=0;e<f.length;e++){let t=o.parse(s("mongodb://%s",f[e].trim()));if((!t.path||-1===t.path.indexOf(".sock"))&&(t.path&&-1!==t.path.indexOf(":")))throw t.path.split("/").length>1&&-1===t.path.indexOf("::")?new Error("Slash in host identifier"):new Error("Double colon in host identifier")}-1!==e.indexOf("?")?(c=e.substr(e.indexOf("?")+1),n=e.substring("mongodb://".length,e.indexOf("?"))):n=e.substring("mongodb://".length);-1!==n.indexOf("@")&&(a=n.split("@")[0],n=n.split("@")[1]);if(n.split("/").length>2)throw new Error("Unsupported host '"+n.split("?")[0]+"', hosts must be URL encoded and contain at most one unencoded slash");if(-1!==n.indexOf(".sock")){if(-1!==n.indexOf(".sock/")){if(-1!==(u=n.split(".sock/")[1]).indexOf("/")){if(2===u.split("/").length&&0===u.split("/")[1].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}n=n.split("/",n.indexOf(".sock")+".sock".length)}}else if(-1!==n.indexOf("/")){if(n.split("/").length>2){if(0===n.split("/")[2].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}u=n.split("/")[1],n=n.split("/")[0]}n=decodeURIComponent(n);let h,d,m,y,g={},b=a||"",v=b.split(":",2),S=decodeURIComponent(v[0]);if(v[0]!==encodeURIComponent(S))throw new Error("Username contains an illegal unescaped character");if(v[0]=S,v[1]){let e=decodeURIComponent(v[1]);if(v[1]!==encodeURIComponent(e))throw new Error("Password contains an illegal unescaped character");v[1]=e}2===v.length&&(g.auth={user:v[0],password:v[1]});t&&null!=t.auth&&(g.auth=t.auth);let w={socketOptions:{}},O={read_preference_tags:[]},_={socketOptions:{}},T={socketOptions:{}};if(g.server_options=w,g.db_options=O,g.rs_options=_,g.mongos_options=T,e.match(/\.sock/)){let t=e.substring(e.indexOf("mongodb://")+"mongodb://".length,e.lastIndexOf(".sock")+".sock".length);-1!==t.indexOf("@")&&(t=t.split("@")[1]),t=decodeURIComponent(t),m=[{domain_socket:t}]}else{let e={};m=(h=n).split(",").map(function(t){let n,r,o;if(o=/\[([^\]]+)\](?::(.+))?/.exec(t))n=o[1],r=parseInt(o[2],10)||27017;else{let e=t.split(":",2);n=e[0]||"localhost",r=null!=e[1]?parseInt(e[1],10):27017,-1!==n.indexOf("?")&&(n=n.split(/\?/)[0])}return e[n+"_"+r]?null:(e[n+"_"+r]=1,{host:n,port:r})}).filter(function(e){return null!=e})}g.dbName=u||"admin",(d=(c||"").split(/[&;]/)).forEach(function(e){if(e){var t=e.split("="),n=t[0],o=t[1];switch(n){case"slaveOk":case"slave_ok":w.slave_ok="true"===o,O.slaveOk="true"===o;break;case"maxPoolSize":case"poolSize":w.poolSize=parseInt(o,10),_.poolSize=parseInt(o,10);break;case"appname":g.appname=decodeURIComponent(o);break;case"autoReconnect":case"auto_reconnect":w.auto_reconnect="true"===o;break;case"ssl":if("prefer"===o){w.ssl=o,_.ssl=o,T.ssl=o;break}w.ssl="true"===o,_.ssl="true"===o,T.ssl="true"===o;break;case"sslValidate":w.sslValidate="true"===o,_.sslValidate="true"===o,T.sslValidate="true"===o;break;case"replicaSet":case"rs_name":_.rs_name=o;break;case"reconnectWait":_.reconnectWait=parseInt(o,10);break;case"retries":_.retries=parseInt(o,10);break;case"readSecondary":case"read_secondary":_.read_secondary="true"===o;break;case"fsync":O.fsync="true"===o;break;case"journal":O.j="true"===o;break;case"safe":O.safe="true"===o;break;case"nativeParser":case"native_parser":O.native_parser="true"===o;break;case"readConcernLevel":O.readConcern={level:o};break;case"connectTimeoutMS":w.socketOptions.connectTimeoutMS=parseInt(o,10),_.socketOptions.connectTimeoutMS=parseInt(o,10),T.socketOptions.connectTimeoutMS=parseInt(o,10);break;case"socketTimeoutMS":w.socketOptions.socketTimeoutMS=parseInt(o,10),_.socketOptions.socketTimeoutMS=parseInt(o,10),T.socketOptions.socketTimeoutMS=parseInt(o,10);break;case"w":O.w=parseInt(o,10),isNaN(O.w)&&(O.w=o);break;case"authSource":O.authSource=o;break;case"gssapiServiceName":O.gssapiServiceName=o;break;case"authMechanism":if("GSSAPI"===o)if(null==g.auth){let e=decodeURIComponent(b);if(-1===e.indexOf("@"))throw new Error("GSSAPI requires a provided principal");g.auth={user:e,password:null}}else g.auth.user=decodeURIComponent(g.auth.user);else"MONGODB-X509"===o&&(g.auth={user:decodeURIComponent(b)});if("GSSAPI"!==o&&"MONGODB-X509"!==o&&"MONGODB-CR"!==o&&"DEFAULT"!==o&&"SCRAM-SHA-1"!==o&&"SCRAM-SHA-256"!==o&&"PLAIN"!==o)throw new Error("Only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, or SCRAM-SHA-1 is supported by authMechanism");O.authMechanism=o;break;case"authMechanismProperties":{let e={};o.split(",").forEach(function(t){let n=t.split(":");e[n[0]]=n[1]}),O.authMechanismProperties=e,"string"==typeof e.SERVICE_NAME&&(O.gssapiServiceName=e.SERVICE_NAME),"string"==typeof e.SERVICE_REALM&&(O.gssapiServiceRealm=e.SERVICE_REALM),"string"==typeof e.CANONICALIZE_HOST_NAME&&(O.gssapiCanonicalizeHostName="true"===e.CANONICALIZE_HOST_NAME)}break;case"wtimeoutMS":O.wtimeout=parseInt(o,10);break;case"readPreference":if(!r.isValid(o))throw new Error("readPreference must be either primary/primaryPreferred/secondary/secondaryPreferred/nearest");O.readPreference=o;break;case"maxStalenessSeconds":O.maxStalenessSeconds=parseInt(o,10);break;case"readPreferenceTags":{let e={};if(null==(o=decodeURIComponent(o))||""===o){O.read_preference_tags.push(e);break}let t=o.split(/,/);for(let n=0;n<t.length;n++){let r=t[n].trim().split(/:/);e[r[0]]=r[1]}O.read_preference_tags.push(e)}break;case"compressors":{y=w.compression||{};let e=o.split(",");if(!e.every(function(e){return"snappy"===e||"zlib"===e}))throw new Error("Compressors must be at least one of snappy or zlib");y.compressors=e,w.compression=y}break;case"zlibCompressionLevel":{y=w.compression||{};let e=parseInt(o,10);if(e<-1||e>9)throw new Error("zlibCompressionLevel must be an integer between -1 and 9");y.zlibCompressionLevel=e,w.compression=y}break;case"retryWrites":O.retryWrites="true"===o;break;case"minSize":O.minSize=parseInt(o,10);break;default:i("URL Parser").warn(`${n} is not supported as a connection string option`)}}}),0===O.read_preference_tags.length&&(O.read_preference_tags=null);if(!(-1!==O.w&&0!==O.w||!0!==O.journal&&!0!==O.fsync&&!0!==O.safe))throw new Error("w set to -1 or 0 cannot be combined with safe/w/journal/fsync");O.readPreference||(O.readPreference="primary");return O=Object.assign(O,t),g.servers=m,g}(e,t)}catch(e){c=e}return c?n(c,null):n(null,a)}e.exports=function(e,t,n){let r;"function"==typeof t&&(n=t,t={}),t=t||{};try{r=o.parse(e,!0)}catch(e){return n(new Error("URL malformed, cannot be parsed"))}if("mongodb:"!==r.protocol&&"mongodb+srv:"!==r.protocol)return n(new Error("Invalid schema, expected `mongodb` or `mongodb+srv`"));if("mongodb:"===r.protocol)return u(e,t,n);if(r.hostname.split(".").length<3)return n(new Error("URI does not have hostname, domain name and tld"));if(r.domainLength=r.hostname.split(".").length,r.pathname&&r.pathname.match(","))return n(new Error("Invalid URI, cannot contain multiple hostnames"));if(r.port)return n(new Error("Ports not accepted with `mongodb+srv` URIs"));let s=`_mongodb._tcp.${r.host}`;a.resolveSrv(s,function(e,o){if(e)return n(e);if(0===o.length)return n(new Error("No addresses found at host"));for(let e=0;e<o.length;e++)if(!c(o[e].name,r.hostname,r.domainLength))return n(new Error("Server record does not share hostname with parent URI"));let s=r.auth?`mongodb://${r.auth}@`:"mongodb://",i=o.map(function(e,t){return 0===t?`${s}${e.name}:${e.port}`:`${e.name}:${e.port}`}).join(",")+"/",l=[];if(r.path){let e=r.path.slice(1);-1!==e.indexOf("?")&&(e=e.slice(0,e.indexOf("?"))),i+=e}(t.ssl||r.search)&&(t.ssl||!r.search||r.search.match("ssl"))||l.push("ssl=true"),r.search&&l.push(r.search.replace("?","")),a.resolveTxt(r.host,function(e,r){if(e&&"ENODATA"!==e.code)return n(e);if(e&&"ENODATA"===e.code&&(r=null),r){if(r.length>1)return n(new Error("Multiple text records not allowed"));if(!(r=(r=r[0]).length>1?r.join(""):r[0]).includes("authSource")&&!r.includes("replicaSet"))return n(new Error("Text record must only set `authSource` or `replicaSet`"));l.push(r)}l.length&&(i+=`?${l.join("&")}`),u(i,t,n)})})}},function(e,t,n){"use strict";const r=n(87),o=n(2).BSON.ObjectID,s=n(2).ReadPreference,i=n(19).Buffer,a=n(34),c=n(1).format,u=n(1),l=n(2).MongoError,p=u.inherits,f=n(15).Duplex,h=n(0).shallowClone,d=n(0).executeOperation;const m=(0,n(1).deprecate)(()=>{},"GridStore is deprecated, and will be removed in a future version. Please use GridFSBucket instead");var y=function e(t,n,i,a,c){if(m(),!(this instanceof e))return new e(t,n,i,a,c);this.db=t,void 0===c&&(c={}),void 0===a?(a=i,i=void 0):"object"==typeof a&&(c=a,a=i,i=void 0),n&&"ObjectID"===n._bsontype?(this.referenceBy=1,this.fileId=n,this.filename=i):void 0===i?(this.referenceBy=0,this.filename=n,null!=a.indexOf("w")&&(this.fileId=new o)):(this.referenceBy=1,this.fileId=n,this.filename=i),this.mode=null==a?"r":a,this.options=c||{},this.isOpen=!1,this.root=null==this.options.root?e.DEFAULT_ROOT_COLLECTION:this.options.root,this.position=0,this.readPreference=this.options.readPreference||t.options.readPreference||s.primary,this.writeConcern=U(t,this.options),this.internalChunkSize=null==this.options.chunkSize?r.DEFAULT_CHUNK_SIZE:this.options.chunkSize;var u=this.options.promiseLibrary||Promise;this.promiseLibrary=u,Object.defineProperty(this,"chunkSize",{enumerable:!0,get:function(){return this.internalChunkSize},set:function(e){"w"!==this.mode[0]||0!==this.position||null!=this.uploadDate?this.internalChunkSize=this.internalChunkSize:this.internalChunkSize=e}}),Object.defineProperty(this,"md5",{enumerable:!0,get:function(){return this.internalMd5}}),Object.defineProperty(this,"chunkNumber",{enumerable:!0,get:function(){return this.currentChunk&&this.currentChunk.chunkNumber?this.currentChunk.chunkNumber:null}})};y.prototype.open=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},"w"!==this.mode&&"w+"!==this.mode&&"r"!==this.mode)throw l.create({message:"Illegal mode "+this.mode,driver:!0});return d(this.db.s.topology,g,[this,e,t],{skipSessions:!0})};var g=function(e,t,n){var r=U(e.db,e.options);"w"===e.mode||"w+"===e.mode?e.collection().ensureIndex([["filename",1]],r,function(){var t=e.chunkCollection(),o=h(r);o.unique=!0,t.ensureIndex([["files_id",1],["n",1]],o,function(){E(e,r,function(t,r){if(t)return n(t);e.isOpen=!0,n(t,r)})})}):E(e,r,function(t,r){if(t)return n(t);e.isOpen=!0,n(t,r)})};y.prototype.eof=function(){return this.position===this.length},y.prototype.getc=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},d(this.db.s.topology,b,[this,e,t],{skipSessions:!0})};var b=function(e,t,n){e.eof()?n(null,null):e.currentChunk.eof()?x(e,e.currentChunk.chunkNumber+1,function(t,r){e.currentChunk=r,e.position=e.position+1,n(t,e.currentChunk.getc())}):(e.position=e.position+1,n(null,e.currentChunk.getc()))};y.prototype.puts=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};var r=null==e.match(/\n$/)?e+"\n":e;return d(this.db.s.topology,this.write.bind(this),[r,t,n],{skipSessions:!0})},y.prototype.stream=function(){return new z(this)},y.prototype.write=function(e,t,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},d(this.db.s.topology,L,[this,e,t,n,r],{skipSessions:!0})},y.prototype.destroy=function(){this.writable&&(this.readable=!1,this.writable&&(this.writable=!1,this._q.length=0,this.emit("close")))},y.prototype.writeFile=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},d(this.db.s.topology,v,[this,e,t,n],{skipSessions:!0})};var v=function(e,t,n,o){"string"!=typeof t?e.open(function(e,n){if(e)return o(e,n);a.fstat(t,function(e,s){if(e)return o(e,n);var c=0,u=0,l=function(){var e=i.alloc(n.chunkSize);a.read(t,e,0,e.length,c,function(e,i,p){if(e)return o(e,n);c+=i,new r(n,{n:u++},n.writeConcern).write(p.slice(0,i),function(e,r){if(e)return o(e,n);r.save({},function(e){return e?o(e,n):(n.position=n.position+i,n.currentChunk=r,c>=s.size?void a.close(t,function(e){if(e)return o(e);n.close(function(e){return o(e||null,n)})}):process.nextTick(l))})})})};process.nextTick(l)})}):a.open(t,"r",function(t,n){if(t)return o(t);e.writeFile(n,o)})};y.prototype.close=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},d(this.db.s.topology,S,[this,e,t],{skipSessions:!0})};var S=function(e,t,n){"w"===e.mode[0]?(t=Object.assign({},e.writeConcern,t),null!=e.currentChunk&&e.currentChunk.position>0?e.currentChunk.save({},function(r){if(r&&"function"==typeof n)return n(r);e.collection(function(r,o){if(r&&"function"==typeof n)return n(r);null!=e.uploadDate?I(e,function(e,r){if(e){if("function"==typeof n)return n(e);throw e}o.save(r,t,function(e){"function"==typeof n&&n(e,r)})}):(e.uploadDate=new Date,I(e,function(e,r){if(e){if("function"==typeof n)return n(e);throw e}o.save(r,t,function(e){"function"==typeof n&&n(e,r)})}))})}):e.collection(function(r,o){if(r&&"function"==typeof n)return n(r);e.uploadDate=new Date,I(e,function(e,r){if(e){if("function"==typeof n)return n(e);throw e}o.save(r,t,function(e){"function"==typeof n&&n(e,r)})})})):"r"===e.mode[0]?"function"==typeof n&&n(null,null):"function"==typeof n&&n(l.create({message:c("Illegal mode %s",e.mode),driver:!0}))};y.prototype.chunkCollection=function(e){return"function"==typeof e?this.db.collection(this.root+".chunks",e):this.db.collection(this.root+".chunks")},y.prototype.unlink=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},d(this.db.s.topology,w,[this,e,t],{skipSessions:!0})};var w=function(e,t,n){k(e,function(t){if(null!==t)return t.message="at deleteChunks: "+t.message,n(t);e.collection(function(t,r){if(null!==t)return t.message="at collection: "+t.message,n(t);r.remove({_id:e.fileId},e.writeConcern,function(t){n(t,e)})})})};y.prototype.collection=function(e){return"function"==typeof e&&this.db.collection(this.root+".files",e),this.db.collection(this.root+".files")},y.prototype.readlines=function(e,t,n){var r=Array.prototype.slice.call(arguments,0);return n="function"==typeof r[r.length-1]?r.pop():void 0,e=(e=r.length?r.shift():"\n")||"\n",t=r.length?r.shift():{},d(this.db.s.topology,O,[this,e,t,n],{skipSessions:!0})};var O=function(e,t,n,r){e.read(function(e,n){if(e)return r(e);var o=n.toString().split(t);o=o.length>0?o.splice(0,o.length-1):[];for(var s=0;s<o.length;s++)o[s]=o[s]+t;r(null,o)})};y.prototype.rewind=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},d(this.db.s.topology,_,[this,e,t],{skipSessions:!0})};var _=function(e,t,n){0!==e.currentChunk.chunkNumber?"w"===e.mode[0]?k(e,function(t){if(t)return n(t);e.currentChunk=new r(e,{n:0},e.writeConcern),e.position=0,n(null,e)}):e.currentChunk(0,function(t,r){if(t)return n(t);e.currentChunk=r,e.currentChunk.rewind(),e.position=0,n(null,e)}):(e.currentChunk.rewind(),e.position=0,n(null,e))};y.prototype.read=function(e,t,n,r){var o=Array.prototype.slice.call(arguments,0);return r="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length?o.shift():null,t=o.length?o.shift():null,n=o.length?o.shift():{},d(this.db.s.topology,T,[this,e,t,n,r],{skipSessions:!0})};var T=function(e,t,n,r,o){var s=null==t?e.length-e.position:t,a=null==n?i.alloc(s):n;if(a._index=null!=n&&null!=n._index?n._index:0,e.currentChunk.length()-e.currentChunk.position+a._index>=s){var c=e.currentChunk.readSlice(s-a._index);return c.copy(a,a._index),e.position=e.position+a.length,0===s&&0===a.length?o(l.create({message:"File does not exist",driver:!0}),null):o(null,a)}(c=e.currentChunk.readSlice(e.currentChunk.length()-e.currentChunk.position)).copy(a,a._index),a._index+=c.length,x(e,e.currentChunk.chunkNumber+1,function(n,r){if(n)return o(n);r.length()>0?(e.currentChunk=r,e.read(t,a,o)):a._index>0?o(null,a):o(l.create({message:"no chunks found for file, possibly corrupt",driver:!0}),null)})};y.prototype.tell=function(e){var t=this;return"function"==typeof e?e(null,this.position):new t.promiseLibrary(function(e){e(t.position)})},y.prototype.seek=function(e,t,n,r){var o=Array.prototype.slice.call(arguments,1);return r="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():null,n=o.length?o.shift():{},d(this.db.s.topology,C,[this,e,t,n,r],{skipSessions:!0})};var C=function(e,t,n,r,o){if("r"!==e.mode)return o(l.create({message:"seek is only supported for mode r",driver:!0}));var s=null==n?y.IO_SEEK_SET:n,i=t,a=0;a=s===y.IO_SEEK_CUR?e.position+i:s===y.IO_SEEK_END?e.length+i:i;var c=Math.floor(a/e.chunkSize);x(e,c,function(t,n){return t?o(t,null):null==n?o(new Error("no chunk found")):(e.currentChunk=n,e.position=a,e.currentChunk.position=e.position%e.chunkSize,void o(t,e))})},E=function(e,t,n){var s=e.collection(),i=1===e.referenceBy?{_id:e.fileId}:{filename:e.filename};function a(e){a.err||n(a.err=e)}i=null==e.fileId&&null==e.filename?null:i,t.readPreference=e.readPreference,null!=i?s.findOne(i,t,function(s,i){if(s)return a(s);if(null!=i)e.fileId=i._id,e.filename="r"===e.mode||void 0===e.filename?i.filename:e.filename,e.contentType=i.contentType,e.internalChunkSize=i.chunkSize,e.uploadDate=i.uploadDate,e.aliases=i.aliases,e.length=i.length,e.metadata=i.metadata,e.internalMd5=i.md5;else{if("r"===e.mode){e.length=0;var u="ObjectID"===e.fileId._bsontype?e.fileId.toHexString():e.fileId;return a(l.create({message:c("file with id %s not opened for writing",1===e.referenceBy?u:e.filename),driver:!0}))}e.fileId=null==e.fileId?new o:e.fileId,e.contentType=y.DEFAULT_CONTENT_TYPE,e.internalChunkSize=null==e.internalChunkSize?r.DEFAULT_CHUNK_SIZE:e.internalChunkSize,e.length=0}"r"===e.mode?x(e,0,t,function(t,r){if(t)return a(t);e.currentChunk=r,e.position=0,n(null,e)}):"w"===e.mode&&i?k(e,t,function(t){if(t)return a(t);e.currentChunk=new r(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)}):"w"===e.mode?(e.currentChunk=new r(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)):"w+"===e.mode&&x(e,A(e),t,function(t,o){if(t)return a(t);e.currentChunk=null==o?new r(e,{n:0},e.writeConcern):o,e.currentChunk.position=e.currentChunk.data.length(),e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=e.length,n(null,e)})}):(e.fileId=null==e.fileId?new o:e.fileId,e.contentType=y.DEFAULT_CONTENT_TYPE,e.internalChunkSize=null==e.internalChunkSize?r.DEFAULT_CHUNK_SIZE:e.internalChunkSize,e.length=0,"w"===e.mode?k(e,t,function(t){if(t)return a(t);e.currentChunk=new r(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)}):"w+"===e.mode&&x(e,A(e),t,function(t,o){if(t)return a(t);e.currentChunk=null==o?new r(e,{n:0},e.writeConcern):o,e.currentChunk.position=e.currentChunk.data.length(),e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=e.length,n(null,e)}))},N=function(e,t,n,o){"function"==typeof n&&(o=n,n=null);var s="boolean"==typeof n&&n;if("w"!==e.mode)o(l.create({message:c("file with id %s not opened for writing",1===e.referenceBy?e.referenceBy:e.filename),driver:!0}),null);else{if(!(e.currentChunk.position+t.length>=e.chunkSize))return e.position=e.position+t.length,e.currentChunk.write(t),s?e.close(function(t){o(t,e)}):o(null,e);for(var i=e.currentChunk.chunkNumber,a=e.chunkSize-e.currentChunk.position,u=t.slice(0,a),p=t.slice(a),f=[e.currentChunk.write(u)];p.length>=e.chunkSize;){var h=new r(e,{n:i+1},e.writeConcern);u=p.slice(0,e.chunkSize),p=p.slice(e.chunkSize),i+=1,h.write(u),f.push(h)}e.currentChunk=new r(e,{n:i+1},e.writeConcern),p.length>0&&e.currentChunk.write(p),e.position=e.position+t.length;for(var d=f.length,m=0;m<f.length;m++)f[m].save({},function(t){return t?o(t):(d-=1)<=0?s?e.close(function(t){o(t,e)}):o(null,e):void 0})}},I=function(e,t){var n={_id:e.fileId,filename:e.filename,contentType:e.contentType,length:e.position?e.position:0,chunkSize:e.chunkSize,uploadDate:e.uploadDate,aliases:e.aliases,metadata:e.metadata},r={filemd5:e.fileId,root:e.root};e.db.command(r,function(e,r){if(e)return t(e);n.md5=r.md5,t(null,n)})},x=function(e,t,n,o){"function"==typeof n&&(o=n,n={}),(n=n||e.writeConcern).readPreference=e.readPreference,e.chunkCollection().findOne({files_id:e.fileId,n:t},n,function(t,n){if(t)return o(t);o(null,new r(e,null==n?{}:n,e.writeConcern))})},A=function(e){return Math.floor((e.length?e.length-1:0)/e.chunkSize)},k=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||e.writeConcern,null!=e.fileId?e.chunkCollection().remove({files_id:e.fileId},t,function(e){if(e)return n(e,!1);n(null,!0)}):n(null,!0)};y.DEFAULT_ROOT_COLLECTION="fs",y.DEFAULT_CONTENT_TYPE="binary/octet-stream",y.IO_SEEK_SET=0,y.IO_SEEK_CUR=1,y.IO_SEEK_END=2,y.exist=function(e,t,n,r,o){var s=Array.prototype.slice.call(arguments,2);return o="function"==typeof s[s.length-1]?s.pop():void 0,n=s.length?s.shift():null,r=(r=s.length?s.shift():{})||{},d(e.s.topology,B,[e,t,n,r,o],{skipSessions:!0})};var B=function(e,t,n,r,o){var i=r.readPreference||s.PRIMARY,a=null!=n?n:y.DEFAULT_ROOT_COLLECTION;e.collection(a+".files",function(e,n){if(e)return o(e);var r="string"==typeof t||"[object RegExp]"===Object.prototype.toString.call(t)?{filename:t}:{_id:t};null!=t&&"object"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)&&(r=t),n.findOne(r,{readPreference:i},function(e,t){if(e)return o(e);o(null,null!=t)})})};y.list=function(e,t,n,r){var o=Array.prototype.slice.call(arguments,1);return r="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():null,n=(n=o.length?o.shift():{})||{},d(e.s.topology,M,[e,t,n,r],{skipSessions:!0})};var M=function(e,t,n,r){null!=t&&"object"==typeof t&&(n=t,t=null);var o=n.readPreference||s.primary,i=null!=n.id&&n.id,a=null!=t?t:y.DEFAULT_ROOT_COLLECTION,c=[];e.collection(a+".files",function(e,t){if(e)return r(e);t.find({},{readPreference:o},function(e,t){if(e)return r(e);t.each(function(e,t){null!=t?c.push(i?t._id:t.filename):r(e,c)})})})};y.read=function(e,t,n,r,o,s){var i=Array.prototype.slice.call(arguments,2);return s="function"==typeof i[i.length-1]?i.pop():void 0,n=i.length?i.shift():null,r=i.length?i.shift():null,o=(o=i.length?i.shift():null)||{},d(e.s.topology,D,[e,t,n,r,o,s],{skipSessions:!0})};var D=function(e,t,n,r,o,s){new y(e,t,"r",o).open(function(e,t){return e?s(e):r&&r>=t.length?s("offset larger than size of file",null):n&&n>t.length?s("length is larger than the size of the file",null):r&&n&&r+n>t.length?s("offset and length is larger than the size of the file",null):void(null!=r?t.seek(r,function(e,t){if(e)return s(e);t.read(n,s)}):t.read(n,s))})};y.readlines=function(e,t,n,r,o){var s=Array.prototype.slice.call(arguments,2);return o="function"==typeof s[s.length-1]?s.pop():void 0,n=s.length?s.shift():null,r=(r=s.length?s.shift():null)||{},d(e.s.topology,R,[e,t,n,r,o],{skipSessions:!0})};var R=function(e,t,n,r,o){var s=null==n?"\n":n;new y(e,t,"r",r).open(function(e,t){if(e)return o(e);t.readlines(s,o)})};y.unlink=function(e,t,n,r){var o=Array.prototype.slice.call(arguments,2);return r="function"==typeof o[o.length-1]?o.pop():void 0,n=(n=o.length?o.shift():{})||{},d(e.s.topology,P,[this,e,t,n,r],{skipSessions:!0})};var P=function(e,t,n,r,o){var s=U(t,r);if(n.constructor===Array)for(var i=0,a=0;a<n.length;a++)++i,y.unlink(t,n[a],r,function(){0==--i&&o(null,e)});else new y(t,n,"w",r).open(function(t,n){if(t)return o(t);k(n,function(t){if(t)return o(t);n.collection(function(t,r){if(t)return o(t);r.remove({_id:n.fileId},s,function(t){o(t,e)})})})})},L=function(e,t,n,r,o){return i.isBuffer(t)?N(e,t,n,o):N(e,i.from(t,"binary"),n,o)},j=function(e){var t={};return null!=e.w&&(t.w=e.w),!0===e.journal&&(t.j=e.journal),!0===e.j&&(t.j=e.j),!0===e.fsync&&(t.fsync=e.fsync),null!=e.wtimeout&&(t.wtimeout=e.wtimeout),t},U=function(e,t){var n={w:1};if(null!=(t=t||{}).w||"boolean"==typeof t.j||"boolean"==typeof t.journal||"boolean"==typeof t.fsync?n=j(t):null!=t.safe&&"object"==typeof t.safe?n=j(t.safe):"boolean"==typeof t.safe?n={w:t.safe?1:0}:null!=e.options.w||"boolean"==typeof e.options.j||"boolean"==typeof e.options.journal||"boolean"==typeof e.options.fsync?n=j(e.options):!e.safe||null==e.safe.w&&"boolean"!=typeof e.safe.j&&"boolean"!=typeof e.safe.journal&&"boolean"!=typeof e.safe.fsync?"boolean"==typeof e.safe&&(n={w:e.safe?1:0}):n=j(e.safe),n.w<1&&(!0===n.journal||!0===n.j||!0===n.fsync))throw l.create({message:"No acknowledgement using w < 1 cannot be combined with journal:true or fsync:true",driver:!0});return n},z=function(e){f.call(this),this.gs=e,this.endCalled=!1,this.totalBytesToRead=this.gs.length-this.gs.position,this.seekPosition=this.gs.position};p(z,f),z.prototype._pipe=z.prototype.pipe,z.prototype.pipe=function(e){var t=this;return t.gs.isOpen?(t.totalBytesToRead=t.gs.length-t.gs.position,t._pipe.apply(t,[e])):t.gs.open(function(n){if(n)return t.emit("error",n);t.totalBytesToRead=t.gs.length-t.gs.position,t._pipe.apply(t,[e])}),e},z.prototype._read=function(){var e=this,t=function(){e.gs.read(n,function(t,n){return t&&!e.endCalled?e.emit("error",t):e.endCalled||null==n?e.push(null):(n.length<=e.totalBytesToRead?(e.totalBytesToRead=e.totalBytesToRead-n.length,e.push(n)):n.length>e.totalBytesToRead&&(e.totalBytesToRead=e.totalBytesToRead-n._index,e.push(n.slice(0,n._index))),void(e.totalBytesToRead<=0&&(e.endCalled=!0)))})},n=e.gs.length<e.gs.chunkSize?e.gs.length-e.seekPosition:e.gs.chunkSize;e.gs.isOpen?t():e.gs.open(function(n){if(e.totalBytesToRead=e.gs.length-e.gs.position,n)return e.emit("error",n);t()})},z.prototype.destroy=function(){this.pause(),this.endCalled=!0,this.gs.close(),this.emit("end")},z.prototype.write=function(e){var t=this;return t.endCalled?t.emit("error",l.create({message:"attempting to write to stream after end called",driver:!0})):t.gs.isOpen?(t.gs.write(e,function(){t.emit("drain")}),!0):(t.gs.open(function(){t.gs.isOpen=!0,t.gs.write(e,function(){process.nextTick(function(){t.emit("drain")})})}),!1)},z.prototype.end=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,0);n="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length?o.shift():null,o.length&&o.shift(),r.endCalled=!0,e&&r.gs.write(e,function(){r.gs.close(function(){"function"==typeof n&&n(),r.emit("end")})}),r.gs.close(function(){"function"==typeof n&&n(),r.emit("end")})},e.exports=y},function(e,t,n){"use strict";var r=n(9).EventEmitter,o=n(147),s=n(148),i=n(0).shallowClone,a=n(0).toError,c=n(1),u=n(0).executeOperation,l={bucketName:"fs",chunkSizeBytes:261120};function p(e,t){if(r.apply(this),this.setMaxListeners(0),t&&"object"==typeof t){t=i(t);for(var n=Object.keys(l),o=0;o<n.length;++o)t[n[o]]||(t[n[o]]=l[n[o]])}else t=l;this.s={db:e,options:t,_chunksCollection:e.collection(t.bucketName+".chunks"),_filesCollection:e.collection(t.bucketName+".files"),checkedIndexes:!1,calledOpenUploadStream:!1,promiseLibrary:e.s.promiseLibrary||Promise}}function f(e,t,n){e.s._filesCollection.deleteOne({_id:t},function(r,o){if(r)return n(r);e.s._chunksCollection.deleteMany({files_id:t},function(e){return e?n(e):o.result.n?void n():n(new Error("FileNotFound: no file with id "+t+" found"))})})}function h(e,t,n,r){var o={_id:t},s={$set:{filename:n}};e.s._filesCollection.updateOne(o,s,function(e,n){return e?r(e):n.result.n?void r():r(a("File with id "+t+" not found"))})}function d(e,t){e.s._filesCollection.drop(function(n){if(n)return t(n);e.s._chunksCollection.drop(function(e){return e?t(e):t()})})}e.exports=p,c.inherits(p,r),p.prototype.openUploadStream=function(e,t){return(t=t?i(t):{}).chunkSizeBytes||(t.chunkSizeBytes=this.s.options.chunkSizeBytes),new s(this,e,t)},p.prototype.openUploadStreamWithId=function(e,t,n){return(n=n?i(n):{}).chunkSizeBytes||(n.chunkSizeBytes=this.s.options.chunkSizeBytes),n.id=e,new s(this,t,n)},p.prototype.openDownloadStream=function(e,t){var n={_id:e};return t={start:t&&t.start,end:t&&t.end},new o(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,n,t)},p.prototype.delete=function(e,t){return u(this.s.db.s.topology,f,[this,e,t],{skipSessions:!0})},p.prototype.find=function(e,t){e=e||{},t=t||{};var n=this.s._filesCollection.find(e);return null!=t.batchSize&&n.batchSize(t.batchSize),null!=t.limit&&n.limit(t.limit),null!=t.maxTimeMS&&n.maxTimeMS(t.maxTimeMS),null!=t.noCursorTimeout&&n.addCursorFlag("noCursorTimeout",t.noCursorTimeout),null!=t.skip&&n.skip(t.skip),null!=t.sort&&n.sort(t.sort),n},p.prototype.openDownloadStreamByName=function(e,t){var n={uploadDate:-1},r=null;t&&null!=t.revision&&(t.revision>=0?(n={uploadDate:1},r=t.revision):r=-t.revision-1);var s={filename:e};return t={sort:n,skip:r,start:t&&t.start,end:t&&t.end},new o(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,s,t)},p.prototype.rename=function(e,t,n){return u(this.s.db.s.topology,h,[this,e,t,n],{skipSessions:!0})},p.prototype.drop=function(e){return u(this.s.db.s.topology,d,[this,e],{skipSessions:!0})},p.prototype.getLogger=function(){return this.s.db.s.logger}},function(e,t,n){"use strict";var r=n(15),o=n(1);function s(e,t,n,o,s){this.s={bytesRead:0,chunks:e,cursor:null,expected:0,files:t,filter:o,init:!1,expectedEnd:0,file:null,options:s,readPreference:n},r.Readable.call(this)}function i(e){if(e.s.init)throw new Error("You cannot change options after the stream has enteredflowing mode!")}function a(e,t){e.emit("error",t)}e.exports=s,o.inherits(s,r.Readable),s.prototype._read=function(){var e=this;this.destroyed||function(e,t){if(e.s.file)return t();e.s.init||(!function(e){var t={};e.s.readPreference&&(t.readPreference=e.s.readPreference);e.s.options&&e.s.options.sort&&(t.sort=e.s.options.sort);e.s.options&&e.s.options.skip&&(t.skip=e.s.options.skip);e.s.files.findOne(e.s.filter,t,function(t,n){if(t)return a(e,t);if(!n){var r=e.s.filter._id?e.s.filter._id.toString():e.s.filter.filename,o="FileNotFound: file "+r+" was not found",s=new Error(o);return s.code="ENOENT",a(e,s)}if(n.length<=0)e.push(null);else if(e.destroyed)e.emit("close");else{e.s.bytesToSkip=function(e,t,n){if(n&&null!=n.start){if(n.start>t.length)throw new Error("Stream start ("+n.start+") must not be more than the length of the file ("+t.length+")");if(n.start<0)throw new Error("Stream start ("+n.start+") must not be negative");if(null!=n.end&&n.end<n.start)throw new Error("Stream start ("+n.start+") must not be greater than stream end ("+n.end+")");return e.s.bytesRead=Math.floor(n.start/t.chunkSize)*t.chunkSize,e.s.expected=Math.floor(n.start/t.chunkSize),n.start-e.s.bytesRead}}(e,n,e.s.options);var i={files_id:n._id};if(e.s.options&&null!=e.s.options.start){var c=Math.floor(e.s.options.start/n.chunkSize);c>0&&(i.n={$gte:c})}e.s.cursor=e.s.chunks.find(i).sort({n:1}),e.s.readPreference&&e.s.cursor.setReadPreference(e.s.readPreference),e.s.expectedEnd=Math.ceil(n.length/n.chunkSize),e.s.file=n,e.s.bytesToTrim=function(e,t,n,r){if(r&&null!=r.end){if(r.end>t.length)throw new Error("Stream end ("+r.end+") must not be more than the length of the file ("+t.length+")");if(r.start<0)throw new Error("Stream end ("+r.end+") must not be negative");var o=null!=r.start?Math.floor(r.start/t.chunkSize):0;return n.limit(Math.ceil(r.end/t.chunkSize)-o),e.s.expectedEnd=Math.ceil(r.end/t.chunkSize),Math.ceil(r.end/t.chunkSize)*t.chunkSize-r.end}}(e,n,e.s.cursor,e.s.options),e.emit("file",n)}})}(e),e.s.init=!0);e.once("file",function(){t()})}(e,function(){!function(e){if(e.destroyed)return;e.s.cursor.next(function(t,n){if(!e.destroyed){if(t)return a(e,t);if(!n)return e.push(null),e.s.cursor.close(function(t){if(t)return a(e,t);e.emit("close")});var r=e.s.file.length-e.s.bytesRead,o=e.s.expected++,s=Math.min(e.s.file.chunkSize,r);if(n.n>o){var i="ChunkIsMissing: Got unexpected n: "+n.n+", expected: "+o;return a(e,new Error(i))}if(n.n<o)return i="ExtraChunk: Got unexpected n: "+n.n+", expected: "+o,a(e,new Error(i));var c=Buffer.isBuffer(n.data)?n.data:n.data.buffer;if(c.length!==s)return r<=0?(i="ExtraChunk: Got unexpected n: "+n.n,a(e,new Error(i))):(i="ChunkIsWrongSize: Got unexpected length: "+c.length+", expected: "+s,a(e,new Error(i)));if(e.s.bytesRead+=c.length,0===c.length)return e.push(null);var u=null,l=null;null!=e.s.bytesToSkip&&(u=e.s.bytesToSkip,e.s.bytesToSkip=0),o===e.s.expectedEnd&&null!=e.s.bytesToTrim&&(l=e.s.bytesToTrim),e.s.options.end&&e.s.options.end-e.s.bytesToSkip<c.length&&(l=e.s.options.end-e.s.bytesToSkip),null==u&&null==l||(c=c.slice(u||0,l||c.length)),e.push(c)}})}(e)})},s.prototype.start=function(e){return i(this),this.s.options.start=e,this},s.prototype.end=function(e){return i(this),this.s.options.end=e,this},s.prototype.abort=function(e){var t=this;this.push(null),this.destroyed=!0,this.s.cursor?this.s.cursor.close(function(n){t.emit("close"),e&&e(n)}):(this.s.init||t.emit("close"),e&&e())}},function(e,t,n){"use strict";var r=n(2),o=n(18),s=n(15),i=n(1),a=n(19).Buffer,c=26;function u(e,t,n){if(n=n||{},this.bucket=e,this.chunks=e.s._chunksCollection,this.filename=t,this.files=e.s._filesCollection,this.options=n,this.done=!1,this.id=n.id?n.id:r.BSON.ObjectId(),this.chunkSizeBytes=this.options.chunkSizeBytes,this.bufToStore=a.alloc(this.chunkSizeBytes),this.length=0,this.md5=!n.disableMD5&&o.createHash("md5"),this.n=0,this.pos=0,this.state={streamEnd:!1,outstandingRequests:0,errored:!1,aborted:!1,promiseLibrary:this.bucket.s.promiseLibrary},!this.bucket.s.calledOpenUploadStream){this.bucket.s.calledOpenUploadStream=!0;var s=this;!function(e,t){e.files.findOne({},{_id:1},function(n,r){return n?t(n):r?t():void e.files.listIndexes().toArray(function(n,r){if(n){if(n.code===c){var o={filename:1,uploadDate:1};return void e.files.createIndex(o,{background:!1},function(n){if(n)return t(n);f(e,t)})}return t(n)}var s=!1;if(r.forEach(function(e){var t=Object.keys(e.key);2===t.length&&1===e.key.filename&&1===e.key.uploadDate&&(s=!0)}),s)f(e,t);else{o={filename:1,uploadDate:1};var i=d(e);i.background=!1,e.files.createIndex(o,i,function(n){if(n)return t(n);f(e,t)})}})})}(this,function(){s.bucket.s.checkedIndexes=!0,s.bucket.emit("index")})}}function l(e,t,n){if(!e.state.errored){if(e.state.errored=!0,n)return n(t);e.emit("error",t)}}function p(e,t,n){return{_id:r.BSON.ObjectId(),files_id:e,n:t,data:n}}function f(e,t){e.chunks.listIndexes().toArray(function(n,r){if(n){if(n.code===c){var o={files_id:1,n:1};return void e.chunks.createIndex(o,{background:!1,unique:!0},function(e){if(e)return t(e);t()})}return t(n)}var s=!1;if(r.forEach(function(e){e.key&&(2===Object.keys(e.key).length&&1===e.key.files_id&&1===e.key.n&&(s=!0))}),s)t();else{o={files_id:1,n:1};var i=d(e);i.background=!1,i.unique=!0,e.chunks.createIndex(o,i,function(e){if(e)return t(e);t()})}})}function h(e,t){if(e.done)return!0;if(e.state.streamEnd&&0===e.state.outstandingRequests&&!e.state.errored){e.done=!0;var n=function(e,t,n,r,o,s,i,a){var c={_id:e,length:t,chunkSize:n,uploadDate:new Date,filename:o};r&&(c.md5=r);s&&(c.contentType=s);i&&(c.aliases=i);a&&(c.metadata=a);return c}(e.id,e.length,e.chunkSizeBytes,e.md5&&e.md5.digest("hex"),e.filename,e.options.contentType,e.options.aliases,e.options.metadata);return!g(e,t)&&(e.files.insertOne(n,d(e),function(r){if(r)return l(e,r,t);e.emit("finish",n)}),!0)}return!1}function d(e){var t={};return e.options.writeConcern&&(t.w=e.options.writeConcern.w,t.wtimeout=e.options.writeConcern.wtimeout,t.j=e.options.writeConcern.j),t}function m(e,t){return e.bucket.s.checkedIndexes?t(!1):(e.bucket.once("index",function(){t(!0)}),!0)}function y(e,t){if(0===e.pos)return h(e,t);++e.state.outstandingRequests;var n=a.alloc(e.pos);e.bufToStore.copy(n,0,0,e.pos),e.md5&&e.md5.update(n);var r=p(e.id,e.n,n);if(g(e,t))return!1;e.chunks.insertOne(r,d(e),function(t){if(t)return l(e,t);--e.state.outstandingRequests,h(e)})}function g(e,t){return!!e.state.aborted&&("function"==typeof t&&t(new Error("this stream has been aborted")),!0)}e.exports=u,i.inherits(u,s.Writable),u.prototype.write=function(e,t,n){var r=this;return m(this,function(){return function(e,t,n,r){if(g(e,r))return!1;var o=a.isBuffer(t)?t:a.from(t,n);if(e.length+=o.length,e.pos+o.length<e.chunkSizeBytes)return o.copy(e.bufToStore,e.pos),e.pos+=o.length,r&&r(),!0;var s=o.length,i=e.chunkSizeBytes-e.pos,c=Math.min(i,o.length),u=0;for(;s>0;){var f=o.length-s;if(o.copy(e.bufToStore,e.pos,f,f+c),e.pos+=c,0===(i-=c)){e.md5&&e.md5.update(e.bufToStore);var m=p(e.id,e.n,e.bufToStore);if(++e.state.outstandingRequests,++u,g(e,r))return!1;e.chunks.insertOne(m,d(e),function(t){if(t)return l(e,t);--e.state.outstandingRequests,--u||(e.emit("drain",m),r&&r(),h(e))}),i=e.chunkSizeBytes,e.pos=0,++e.n}s-=c,c=Math.min(i,s)}return!1}(r,e,t,n)})},u.prototype.abort=function(e){if(this.state.streamEnd){var t=new Error("Cannot abort a stream that has already completed");return"function"==typeof e?e(t):this.state.promiseLibrary.reject(t)}if(this.state.aborted)return t=new Error("Cannot call abort() on a stream twice"),"function"==typeof e?e(t):this.state.promiseLibrary.reject(t);this.state.aborted=!0,this.chunks.deleteMany({files_id:this.id},function(t){"function"==typeof e&&e(t)})},u.prototype.end=function(e,t,n){var r=this;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),g(this,n)||(this.state.streamEnd=!0,n&&this.once("finish",function(e){n(null,e)}),e?this.write(e,t,function(){y(r)}):m(this,function(){y(r)}))}},function(e,t,n){"use strict";if(void 0!==global.Map)e.exports=global.Map,e.exports.Map=global.Map;else{var r=function(e){this._keys=[],this._values={};for(var t=0;t<e.length;t++)if(null!=e[t]){var n=e[t],r=n[0],o=n[1];this._keys.push(r),this._values[r]={v:o,i:this._keys.length-1}}};r.prototype.clear=function(){this._keys=[],this._values={}},r.prototype.delete=function(e){var t=this._values[e];return null!=t&&(delete this._values[e],this._keys.splice(t.i,1),!0)},r.prototype.entries=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?[n,e._values[n].v]:void 0,done:void 0===n}}}},r.prototype.forEach=function(e,t){t=t||this;for(var n=0;n<this._keys.length;n++){var r=this._keys[n];e.call(t,this._values[r].v,r,t)}},r.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},r.prototype.has=function(e){return null!=this._values[e]},r.prototype.keys=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?n:void 0,done:void 0===n}}}},r.prototype.set=function(e,t){return this._values[e]?(this._values[e].v=t,this):(this._keys.push(e),this._values[e]={v:t,i:this._keys.length-1},this)},r.prototype.values=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?e._values[n].v:void 0,done:void 0===n}}}},Object.defineProperty(r.prototype,"size",{enumerable:!0,get:function(){return this._keys.length}}),e.exports=r,e.exports.Map=r}},function(e,t){var n=function(e){if(!(this instanceof n))return new n(e);this._bsontype="Int32",this.value=e};n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},e.exports=n,e.exports.Int32=n},function(e,t,n){(function(e){var t=n(33),r=n(34),o=n(1).format,s=n(182),i=n(183),a=r.existsSync||t.existsSync,c=function(e){for(var n=!1;!n;)if(a(e+"/package.json"))n=e;else{if("/"===e)return!1;e=t.dirname(e)}return e},u=function(t,a){(a=a||{}).strict="boolean"!=typeof a.strict||a.strict;var u=function(t){for(var n=e,s=!1;n;){i=n.filename;var i=c(i);if(i){var a=JSON.parse(r.readFileSync(o("%s/package.json",i))),u=t.split(/\//);if(a.peerOptionalDependencies&&(!a.peerOptionalDependencies||a.peerOptionalDependencies[u[0]])){s=!0;break}n=n.parent}else n=n.parent}if(!s)throw new Error(o("no optional dependency [%s] defined in peerOptionalDependencies in any package.json",u[0]));return{object:a,parts:u}}(t),l=u.object,p=u.parts,f=l.peerOptionalDependencies[p[0]],h=void 0,d=t;try{h=n(152)(d)}catch(e){try{if(null==(d=s(process.cwd(),t)))return;h=n(152)(d)}catch(e){if("MODULE_NOT_FOUND"===e.code)return}}var m=c(n(152).resolve(d));if(!m)throw new Error("package.json can not be located");var y=JSON.parse(r.readFileSync(o("%s/package.json",m))).version;if(0==i.satisfies(y,f)&&a.strict){var g=new Error(o("optional dependency [%s] found but version [%s] did not satisfy constraint [%s]",p[0],y,f));throw g.code="OPTIONAL_MODULE_NOT_FOUND",g}return h};u.exists=function(e){try{return void 0!==u(e)}catch(e){return!1}},e.exports=u}).call(this,n(91)(e))},function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=152},function(e,t,n){"use strict";var r=n(1).inherits,o=n(1).format,s=n(9).EventEmitter,i=n(55),a=n(56),c=n(25).debugOptions,u=n(25).retrieveBSON,l=n(184),p=n(24).Query,f=n(11).MongoError,h=n(11).MongoNetworkError,d=n(193),m=n(194),y=n(110),g=n(20),b=n(20).createClientInfo,v=n(20).createCompressionInfo,S=n(20).resolveClusterTime,w=n(20).SessionMixins,O=n(35).relayEvents;const _=n(35).collationNotSupported;var T=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","singleBufferSerializtion","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","servername"],C=0,E=!1,N={},I=u(),x=function(e){e=e||{},s.call(this),this.id=C++,this.s={options:e,logger:a("Server",e),Cursor:e.cursorFactory||y,bson:e.bson||new I([I.Binary,I.Code,I.DBRef,I.Decimal128,I.Double,I.Int32,I.Long,I.Map,I.MaxKey,I.MinKey,I.ObjectId,I.BSONRegExp,I.Symbol,I.Timestamp]),pool:null,disconnectHandler:e.disconnectHandler,monitoring:"boolean"!=typeof e.monitoring||e.monitoring,inTopology:!!e.parent,monitoringInterval:"number"==typeof e.monitoringInterval?e.monitoringInterval:5e3,topologyId:-1,compression:{compressors:v(e)},parent:e.parent},this.s.parent||(this.s.clusterTime=null),this.ismaster=null,this.lastIsMasterMS=-1,this.monitoringProcessId=null,this.initialConnect=!0,this.wireProtocolHandler=new d,this._type="server",this.clientInfo=b(e),this.lastUpdateTime=0,this.lastWriteDate=0,this.staleness=0};function A(e,t,n,r,s,i){return e.s.pool.isConnected()||!e.s.options.reconnect||null==e.s.disconnectHandler||s.monitoring?e.s.pool.isConnected()?void 0:(i(new f(o("no connection available to server %s",e.name))),!0):(e.s.disconnectHandler.add(t,n,r,s,i),!0)}r(x,s),Object.assign(x.prototype,w),Object.defineProperty(x.prototype,"type",{enumerable:!0,get:function(){return this._type}}),Object.defineProperty(x.prototype,"parserType",{enumerable:!0,get:function(){return I.native?"c++":"js"}}),Object.defineProperty(x.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}}),Object.defineProperty(x.prototype,"clusterTime",{enumerable:!0,set:function(e){const t=this.s.parent?this.s.parent:this.s;S(t,e)},get:function(){return(this.s.parent?this.s.parent:this.s).clusterTime||null}}),x.enableServerAccounting=function(){E=!0,N={}},x.disableServerAccounting=function(){E=!1},x.servers=function(){return N},Object.defineProperty(x.prototype,"name",{enumerable:!0,get:function(){return this.s.options.host+":"+this.s.options.port}});var k=function(e,t){return function(n){if(e.s.logger.isInfo()){var r=n instanceof f?JSON.stringify(n):{};e.s.logger.info(o("server %s fired event %s out with message %s",e.name,t,r))}if("connect"===t){var s=e.s.compression&&e.s.compression.compressors?e.s.compression.compressors:[],i=new p(e.s.bson,"admin.$cmd",Object.assign({ismaster:!0,client:e.clientInfo,compression:s},function(e){if(!e)return{};const t=e.auth||[],n=t[0]||e.authMechanism,r=t[1]||e.authSource||e.dbName||"admin",o=t[2]||e.user;return"string"==typeof n&&"DEFAULT"!==n.toUpperCase()?{}:o?{saslSupportedMechs:`${r}.${o}`}:{}}(e.s.options)),{numberToSkip:0,numberToReturn:-1,checkKeys:!1,slaveOk:!0}),a=(new Date).getTime();e.s.pool.write(i,{socketTimeout:e.s.options.connectionTimeout||2e3},function(t,n){e.lastIsMasterMS=(new Date).getTime()-a;const r=function(e,t){return e||(t&&t.result&&0===t.result.ok?new f(t.result):void 0)}(t,n);if(r)return e.destroy(),e.emit("error",r);if(!function(e){return e&&"number"==typeof e.maxWireVersion&&e.maxWireVersion>=2}(n.result)){e.destroy();const t="2.6",r="Server at "+e.s.options.host+":"+e.s.options.port+" reports wire version "+(n.result.maxWireVersion||0)+", but this version of Node.js Driver requires at least 2 (MongoDB"+t+").";return e.emit("error",new f(r),e)}if(n.result&&n.result.compression){for(var s=0;s<e.s.compression.compressors.length;s++)if(n.result.compression.indexOf(e.s.compression.compressors[s])>-1){e.s.pool.options.agreedCompressor=e.s.compression.compressors[s];break}e.s.compression.zlibCompressionLevel&&(e.s.pool.options.zlibCompressionLevel=e.s.compression.zlibCompressionLevel)}e.initialConnect=!1,e.ismaster=n.result,"isdbgrid"===e.ismaster.msg&&(e._type="mongos"),e.wireProtocolHandler=function(e,t){return t.maxWireVersion>=4?new m:new d}(0,e.ismaster),e.s.monitoring&&(e.monitoringProcessId=setTimeout(function e(t){return function(){if(!t.s.pool.isDestroyed()){t.emit("monitoring",t);var n=new p(t.s.bson,"admin.$cmd",{ismaster:!0},{numberToSkip:0,numberToReturn:-1,checkKeys:!1,slaveOk:!0}),r=(new Date).getTime();t.s.pool.write(n,{socketTimeout:"number"!=typeof t.s.options.connectionTimeout?2e3:t.s.options.connectionTimeout,monitoring:!0},function(n,o){t.lastIsMasterMS=(new Date).getTime()-r,t.s.pool.isDestroyed()||(o&&(t.ismaster=o.result),t.monitoringProcessId=setTimeout(e(t),t.s.monitoringInterval))})}}}(e),e.s.monitoringInterval)),g.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:g.getTopologyType(e)}),e.s.inTopology||g.emitTopologyDescriptionChanged(e,{topologyType:"Single",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:g.getTopologyType(e)}]}),e.s.logger.isInfo()&&e.s.logger.info(o("server %s connected with ismaster [%s]",e.name,JSON.stringify(e.ismaster))),e.emit("connect",e)})}else{if(E&&-1!==["close","timeout","error","parseError","reconnectFailed"].indexOf(t)&&(e.s.inTopology||e.emit("topologyOpening",{topologyId:e.id}),delete N[e.id]),"close"===t&&g.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),"reconnectFailed"===t)return e.emit("reconnectFailed",n),void(e.listeners("error").length>0&&e.emit("error",n));if("disconnected"===e.s.pool.state&&e.initialConnect&&-1!==["close","timeout","error","parseError"].indexOf(t))return e.initialConnect=!1,e.emit("error",new h(o("failed to connect to server [%s] on first connect [%s]",e.name,n)));if("reconnect"===t)return g.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:g.getTopologyType(e)}),e.emit(t,e);e.emit(t,n)}}};function B(e){return e.s.pool?e.s.pool.isDestroyed()?new f("server instance pool was destroyed"):void 0:new f("server instance is not connected")}x.prototype.connect=function(e){if(e=e||{},E&&(N[this.id]=this),this.s.pool&&!this.s.pool.isDisconnected()&&!this.s.pool.isDestroyed())throw new f(o("server instance in invalid state %s",this.s.pool.state));this.s.pool=new l(this,Object.assign(this.s.options,e,{bson:this.s.bson})),this.s.pool.on("close",k(this,"close")),this.s.pool.on("error",k(this,"error")),this.s.pool.on("timeout",k(this,"timeout")),this.s.pool.on("parseError",k(this,"parseError")),this.s.pool.on("connect",k(this,"connect")),this.s.pool.on("reconnect",k(this,"reconnect")),this.s.pool.on("reconnectFailed",k(this,"reconnectFailed")),O(this.s.pool,this,["commandStarted","commandSucceeded","commandFailed"]),this.s.inTopology||this.emit("topologyOpening",{topologyId:this.id}),this.emit("serverOpening",{topologyId:-1!==this.s.topologyId?this.s.topologyId:this.id,address:this.name}),e.auth?this.s.pool.connect.apply(this.s.pool,e.auth):this.s.pool.connect()},x.prototype.getDescription=function(){var e=this.ismaster||{},t={type:g.getTopologyType(this),address:this.name};return e.hosts&&(t.hosts=e.hosts),e.arbiters&&(t.arbiters=e.arbiters),e.passives&&(t.passives=e.passives),e.setName&&(t.setName=e.setName),t},x.prototype.lastIsMaster=function(){return this.ismaster},x.prototype.unref=function(){this.s.pool.unref()},x.prototype.isConnected=function(){return!!this.s.pool&&this.s.pool.isConnected()},x.prototype.isDestroyed=function(){return!!this.s.pool&&this.s.pool.isDestroyed()},x.prototype.command=function(e,t,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var s=function(e,t){if(B(e),t.readPreference&&!(t.readPreference instanceof i))throw new Error("readPreference must be an instance of ReadPreference")}(this,n);if(s)return r(s);if(n=Object.assign({},n,{wireProtocolCommand:!1}),this.s.logger.isDebug()&&this.s.logger.debug(o("executing command [%s] against %s",JSON.stringify({ns:e,cmd:t,options:c(T,n)}),this.name)),!A(this,"command",e,t,n,r)){if(_(this,t))return r(new f(`server ${this.name} does not support collation`));var a=n.topology||{},u=this.wireProtocolHandler.command(this.s.bson,e,t,{},a,n);if(u instanceof f)return r(u,null);u.slaveOk=!!n.readPreference&&n.readPreference.slaveOk();var l={raw:"boolean"==typeof n.raw&&n.raw,promoteLongs:"boolean"!=typeof n.promoteLongs||n.promoteLongs,promoteValues:"boolean"!=typeof n.promoteValues||n.promoteValues,promoteBuffers:"boolean"==typeof n.promoteBuffers&&n.promoteBuffers,command:!0,monitoring:"boolean"==typeof n.monitoring&&n.monitoring,fullResult:"boolean"==typeof n.fullResult&&n.fullResult,requestId:u.requestId,socketTimeout:"number"==typeof n.socketTimeout?n.socketTimeout:null,session:n.session||null};this.s.pool.write(u,l,r)}},x.prototype.insert=function(e,t,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var o=B(this);return o?r(o):A(this,"insert",e,t,n,r)?void 0:(t=Array.isArray(t)?t:[t],this.wireProtocolHandler.insert(this.s.pool,e,this.s.bson,t,n,r))},x.prototype.update=function(e,t,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var o=B(this);return o?r(o):A(this,"update",e,t,n,r)?void 0:_(this,n)?r(new f(`server ${this.name} does not support collation`)):(t=Array.isArray(t)?t:[t],this.wireProtocolHandler.update(this.s.pool,e,this.s.bson,t,n,r))},x.prototype.remove=function(e,t,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var o=B(this);return o?r(o):A(this,"remove",e,t,n,r)?void 0:_(this,n)?r(new f(`server ${this.name} does not support collation`)):(t=Array.isArray(t)?t:[t],this.wireProtocolHandler.remove(this.s.pool,e,this.s.bson,t,n,r))},x.prototype.cursor=function(e,t,n){const r=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(this.s.bson,e,t,n,r,this.s.options)},x.prototype.logout=function(e,t){this.s.pool.logout(e,t)},x.prototype.auth=function(e,t){"default"===e&&(e=function(e){if(e){if(Array.isArray(e.saslSupportedMechs))return e.saslSupportedMechs.indexOf("SCRAM-SHA-256")>=0?"scram-sha-256":"scram-sha-1";if(e.maxWireVersion>=3)return"scram-sha-1"}return"mongocr"}(this.ismaster));var n=Array.prototype.slice.call(arguments,0);n[0]=e;var r=n[n.length-1];if(!A(this,"auth",t,n,{},r))return this.lastIsMaster()&&this.lastIsMaster().arbiterOnly?r(null,!0):void this.s.pool.auth.apply(this.s.pool,n)},x.prototype.equals=function(e){return"string"==typeof e?this.name.toLowerCase()===e.toLowerCase():!!e.name&&this.name.toLowerCase()===e.name.toLowerCase()},x.prototype.connections=function(){return this.s.pool.allConnections()},x.prototype.selectServer=function(e,t,n){"function"==typeof e&&void 0===n&&(n=e,e=void 0,t={}),"function"==typeof t&&(n=t,t=e,e=void 0),n(null,this)};var M=["close","error","timeout","parseError","connect"];x.prototype.destroy=function(e){if(!this._destroyed){e=e||{};var t=this;E&&delete N[this.id],this.monitoringProcessId&&clearTimeout(this.monitoringProcessId),t.s.pool?(e.emitClose&&t.emit("close",t),e.emitDestroy&&t.emit("destroy",t),M.forEach(function(e){t.s.pool.removeAllListeners(e)}),t.listeners("serverClosed").length>0&&t.emit("serverClosed",{topologyId:-1!==t.s.topologyId?t.s.topologyId:t.id,address:t.name}),t.listeners("topologyClosed").length>0&&!t.s.inTopology&&t.emit("topologyClosed",{topologyId:t.id}),t.s.logger.isDebug()&&t.s.logger.debug(o("destroy called on server %s",t.name)),this.s.pool.destroy(e.force),this._destroyed=!0):this._destroyed=!0}},e.exports=x},function(e,t,n){"use strict";const r=n(11).MongoError;let o,s;o={NO_TRANSACTION:"NO_TRANSACTION",STARTING_TRANSACTION:"STARTING_TRANSACTION",TRANSACTION_IN_PROGRESS:"TRANSACTION_IN_PROGRESS",TRANSACTION_COMMITTED:"TRANSACTION_COMMITTED",TRANSACTION_COMMITTED_EMPTY:"TRANSACTION_COMMITTED_EMPTY",TRANSACTION_ABORTED:"TRANSACTION_ABORTED"},s={NO_TRANSACTION:["NO_TRANSACTION","STARTING_TRANSACTION"],STARTING_TRANSACTION:["TRANSACTION_IN_PROGRESS","TRANSACTION_COMMITTED","TRANSACTION_COMMITTED_EMPTY","TRANSACTION_ABORTED"],TRANSACTION_IN_PROGRESS:["TRANSACTION_IN_PROGRESS","TRANSACTION_COMMITTED","TRANSACTION_ABORTED"],TRANSACTION_COMMITTED:["TRANSACTION_COMMITTED","TRANSACTION_COMMITTED_EMPTY","STARTING_TRANSACTION","NO_TRANSACTION"],TRANSACTION_ABORTED:["STARTING_TRANSACTION","NO_TRANSACTION"],TRANSACTION_COMMITTED_EMPTY:["TRANSACTION_COMMITTED_EMPTY","NO_TRANSACTION"]};e.exports={TxnState:o,Transaction:class{constructor(e){if(e=e||{},this.state=o.NO_TRANSACTION,this.options={},e.writeConcern||void 0!==e.w){if((e.writeConcern?e.writeConcern.w:e.w)<=0)throw new r("Transactions do not support unacknowledged write concern");this.options.writeConcern=e.writeConcern?e.writeConcern:{w:e.w}}e.readConcern&&(this.options.readConcern=e.readConcern),e.readPreference&&(this.options.readPreference=e.readPreference)}get isActive(){return-1!==[o.STARTING_TRANSACTION,o.TRANSACTION_IN_PROGRESS].indexOf(this.state)}transition(e){const t=s[this.state];if(!t||-1===t.indexOf(e))throw new r(`Attempted illegal state transition from [${this.state}] to [${e}]`);this.state=e}}}},function(e,t,n){"use strict";const r=n(9),o=n(201).isResumableError,s=n(6).MongoError;var i=["maxAwaitTimeMS","collation","readPreference"];const a={COLLECTION:Symbol("Collection"),DATABASE:Symbol("Database"),CLUSTER:Symbol("Cluster")};var c=function(e){e.resumeToken&&(e.options.resumeAfter=e.resumeToken);var t=p(e);if(e.listenerCount("change")>0&&t.on("data",function(t){d({changeStream:e,change:t,eventEmitter:!0})}),t.on("close",function(){e.emit("close")}),t.on("end",function(){e.emit("end")}),t.on("error",function(t){d({changeStream:e,error:t,eventEmitter:!0})}),e.pipeDestinations){const n=t.stream(e.streamOptions);for(let t in e.pipeDestinations)n.pipe(t)}return t};function u(e){return e.resumeToken||e.options.resumeAfter}function l(e){const t=e.topology.lastIsMaster()||{};return t.maxWireVersion&&t.maxWireVersion>=7&&e.options.startAtOperationTime}var p=function(e){const t=e.topology,n=e.namespace,r=e.pipeline,o=e.options,s=e.cursorNamespace;var c={fullDocument:o.fullDocument||"default"};const p=u(e),f=l(e);p&&(c.resumeAfter=p),f&&(c.startAtOperationTime=f);var h={};i.forEach(function(e){o[e]&&(h[e]=o[e])}),e.type===a.CLUSTER&&(c.allChangesForCluster=!0);var d=[{$changeStream:c}];d=d.concat(r);var m={aggregate:e.type===a.COLLECTION?n.collection:1,pipeline:d,readConcern:{level:"majority"},cursor:{batchSize:o.batchSize||1}};return t.cursor(s,m,h)};const f=3e4;function h(e,t,n){setTimeout(()=>{t&&null==t.start&&(t.start=process.hrtime());const r=t.start||process.hrtime(),o=t.timeout||f,i=t.readPreference;if(e.isConnected({readPreference:i}))return n(null,null);const a=process.hrtime(r);if((1e9*a[0]+a[1])/1e6>o)return n(new s("Timed out waiting for connection"));h(e,t,n)},3e3)}function d(e){const t=e.changeStream,n=e.error,r=e.change,s=e.callback,i=e.eventEmitter||!1,a=t.topology,p=t.cursor.options;if(n){if(o(n)&&!t.attemptingResume){if(t.attemptingResume=!0,!u(t)&&!l(t)){const e=t.cursor.cursorState.operationTime;t.options=Object.assign({startAtOperationTime:e},t.options)}return["data","close","end","error"].forEach(e=>t.cursor.removeAllListeners(e)),t.cursor.close(),i?void h(a,{readPreference:p.readPreference},e=>{if(e)return t.emit("error",e);t.cursor=c(t)}):s?void h(a,{readPreference:p.readPreference},e=>{if(e)return s(e,null);t.cursor=c(t),t.next(s)}):new Promise((e,t)=>{h(a,{readPreference:p.readPreference},n=>{if(n)return t(n);e()})}).then(()=>t.cursor=c(t)).then(()=>t.next())}return i?t.emit("error",n):"function"==typeof s?s(n,null):t.promiseLibrary.reject(n)}if(t.attemptingResume=!1,!r||!r._id){var f=new Error("A change stream document has been received that lacks a resume token (_id).");return i?t.emit("error",f):"function"==typeof s?s(f,null):t.promiseLibrary.reject(f)}return t.resumeToken=r._id,i?t.emit("change",r):"function"==typeof s?s(n,r):t.promiseLibrary.resolve(r)}e.exports=class extends r{constructor(e,t,r){super();const o=n(72),i=n(73),u=n(111);if(this.pipeline=t||[],this.options=r||{},this.cursorNamespace=void 0,this.namespace={},e instanceof o)this.type=a.COLLECTION,this.topology=e.s.db.serverConfig,this.namespace={collection:e.collectionName,database:e.s.db.databaseName},this.cursorNamespace=`${this.namespace.database}.${this.namespace.collection}`;else if(e instanceof i)this.type=a.DATABASE,this.namespace={collection:"",database:e.databaseName},this.cursorNamespace=this.namespace.database,this.topology=e.serverConfig;else{if(!(e instanceof u))throw new TypeError("changeDomain provided to ChangeStream constructor is not an instance of Collection, Db, or MongoClient");this.type=a.CLUSTER,this.namespace={collection:"",database:"admin"},this.cursorNamespace=this.namespace.database,this.topology=e.topology}this.promiseLibrary=e.s.promiseLibrary,!this.options.readPreference&&e.s.readPreference&&(this.options.readPreference=e.s.readPreference);const l=this.topology.lastIsMaster();if(!l)throw new s("Topology does not have an ismaster yet.");this.operationTime=l.operationTime,this.cursor=c(this),this.on("newListener",e=>{"change"===e&&this.cursor&&0===this.listenerCount("change")&&this.cursor.on("data",e=>d({changeStream:this,change:e,eventEmitter:!0}))}),this.on("removeListener",e=>{"change"===e&&0===this.listenerCount("change")&&this.cursor&&this.cursor.removeAllListeners("data")})}hasNext(e){return this.cursor.hasNext(e)}next(e){var t=this;return this.isClosed()?e?e(new Error("Change Stream is not open."),null):t.promiseLibrary.reject(new Error("Change Stream is not open.")):this.cursor.next().then(n=>d({changeStream:t,change:n,callback:e})).catch(n=>d({changeStream:t,error:n,callback:e}))}isClosed(){return!this.cursor||this.cursor.isClosed()}close(e){if(!this.cursor)return e?e():this.promiseLibrary.resolve();var t=this.cursor;return delete this.cursor,t.close(e)}pipe(e,t){return this.pipeDestinations||(this.pipeDestinations=[]),this.pipeDestinations.push(e),this.cursor.pipe(e,t)}unpipe(e){return this.pipeDestinations&&this.pipeDestinations.indexOf(e)>-1&&this.pipeDestinations.splice(this.pipeDestinations.indexOf(e),1),this.cursor.unpipe(e)}stream(e){return this.streamOptions=e,this.cursor.stream(e)}pause(){return this.cursor.pause()}resume(){return this.cursor.resume()}}},function(e,t,n){"use strict";const r=n(1).inherits,o=n(6).ReadPreference,s=n(6).MongoError,i=n(15).Readable,a=n(36);var c=function(e,t,n,r,o,s){a.apply(this,Array.prototype.slice.call(arguments,0));var u=c.INIT,l=r.promiseLibrary||Promise;i.call(this,{objectMode:!0}),this.s={maxTimeMS:null,state:u,streamOptions:{},bson:e,ns:t,cmd:n,options:r,topology:o,topologyOptions:s,promiseLibrary:l,session:r.session}};r(c,i);for(var u=["_next","next","hasNext","each","forEach","toArray","rewind","bufferedCount","readBufferedDocuments","close","isClosed","kill","setCursorBatchSize","_find","_getmore","_killcursor","isDead","explain","isNotified","isKilled","_endSession","_initImplicitSession"],l=0;l<u.length;l++)c.prototype[u[l]]=a.prototype[u[l]];c.prototype.setReadPreference=function(e){if(this.s.state===c.CLOSED||this.isDead())throw s.create({message:"Cursor is closed",driver:!0});if(this.s.state!==c.INIT)throw s.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(e instanceof o)this.s.options.readPreference=e;else{if("string"!=typeof e)throw new TypeError("Invalid read preference: "+e);this.s.options.readPreference=new o(e)}return this},c.prototype.batchSize=function(e){if(this.s.state===c.CLOSED||this.isDead())throw s.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw s.create({message:"batchSize requires an integer",driver:!0});return this.s.cmd.cursor&&(this.s.cmd.cursor.batchSize=e),this.setCursorBatchSize(e),this},c.prototype.maxTimeMS=function(e){return this.s.topology.lastIsMaster().minWireVersion>2&&(this.s.cmd.maxTimeMS=e),this},c.prototype.getLogger=function(){return this.logger},c.prototype.get=c.prototype.toArray,c.INIT=0,c.OPEN=1,c.CLOSED=2,e.exports=c},function(e,t,n){"use strict";const r=n(14).executeCommand,o=n(14).executeDbAdminCommand;e.exports={replSetGetStatus:function(e,t,n){o(e.s.db,{replSetGetStatus:1},t,n)},serverStatus:function(e,t,n){o(e.s.db,{serverStatus:1},t,n)},validateCollection:function(e,t,n,o){const s={validate:t},i=Object.keys(n);for(let e=0;e<i.length;e++)n.hasOwnProperty(i[e])&&"session"!==i[e]&&(s[i[e]]=n[i[e]]);r(e.s.db,s,n,(e,n)=>null!=e?o(e,null):0===n.ok?o(new Error("Error with validate command"),null):null!=n.result&&n.result.constructor!==String?o(new Error("Error with validation data"),null):null!=n.result&&null!=n.result.match(/exception|corrupt/)?o(new Error("Error: invalid collection "+t),null):null==n.valid||n.valid?o(null,n):o(new Error("Error: invalid collection "+t),null))}}},function(e,t,n){"use strict";const r=n(204),o=n(1).deprecate,s=n(6).Logger,i=n(6).MongoError,a=n(169),c=n(6).parseConnectionString,u=n(6).ReadPreference,l=n(170),p=n(113),f=n(6).Sessions.ServerSessionPool,h=["timeout","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha","all","fullsetup","open"],d=["native_parser"],m=["server","replset","replSet","mongos","db"],y=o(n(206),"current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option { useNewUrlParser: true } to MongoClient.connect."),g=["poolSize","ssl","sslValidate","sslCA","sslCert","sslKey","sslPass","sslCRL","autoReconnect","noDelay","keepAlive","keepAliveInitialDelay","connectTimeoutMS","family","socketTimeoutMS","reconnectTries","reconnectInterval","ha","haInterval","replicaSet","secondaryAcceptableLatencyMS","acceptableLatencyMS","connectWithNoPrimary","authSource","w","wtimeout","j","forceServerObjectId","serializeFunctions","ignoreUndefined","raw","bufferMaxEntries","readPreference","pkFactory","promiseLibrary","readConcern","maxStalenessSeconds","loggerLevel","logger","promoteValues","promoteBuffers","promoteLongs","domainsEnabled","checkServerIdentity","validateOptions","appname","auth","user","password","authMechanism","compression","fsync","readPreferenceTags","numberOfRetries","auto_reconnect","minSize","monitorCommands","retryWrites","useNewUrlParser"];function b(e,t){t.on("authenticated",O(e,"authenticated")),t.on("error",O(e,"error")),t.on("timeout",O(e,"timeout")),t.on("close",O(e,"close")),t.on("parseError",O(e,"parseError")),t.once("open",O(e,"open")),t.once("fullsetup",O(e,"fullsetup")),t.once("all",O(e,"all")),t.on("reconnect",O(e,"reconnect"))}function v(e,t){e.topology=t,t.s.sessionPool=new f(t.s.coreTopology)}function S(e,t,o,f){if(o=Object.assign({},o),null==f)throw new Error("no callback function provided");const d=s("MongoClient",o);if(t instanceof p||t instanceof l||t instanceof a)return function(e,t,n,o){v(e,t),b(e,t),I(e,t);let s=Object.assign({},n);"string"!=typeof n.readPreference&&"string"!=typeof n.read_preference||(s.readPreference=new u(n.readPreference||n.read_preference));return t.connect(s,w(e,s,(t,n)=>t?o(t,n):s.user||s.password||s.authMechanism?r(e,s.user,s.password,s,e=>{if(e)return o(e,n);o(e,n)}):void o(t,n)))}(e,t,o,S);const m=o.useNewUrlParser?c:y,g=o.useNewUrlParser?A:E;function S(e,t){const n="seed list contains no mongos proxies, replicaset connections requires the parameter replicaSet to be supplied in the URI or options object, mongodb://server:port/db?replicaSet=name";if(e&&"no mongos proxies found in seed list"===e.message)return d.isWarn()&&d.warn(n),f(new i(n));f(e,t)}m(t,o,(t,r)=>{if(t)return f(t);const s=g(r),i=T(s,o);return null==i.socketTimeoutMS&&(i.socketTimeoutMS=36e4),null==i.connectTimeoutMS&&(i.connectTimeoutMS=3e4),i.db_options&&i.db_options.auth&&delete i.db_options.auth,e.s.options=i,0===s.servers.length?f(new Error("connection string must contain at least one seed host")):i.replicaSet||i.rs_name?_(e,"replicaset",i,w(e,i,S)):s.servers.length>1?_(e,"mongos",i,w(e,i,S)):function(e,t,r){t.promiseLibrary=e.s.promiseLibrary;const o=k(t)[0],s=function(e,t){const r=n(111),o=[];return e instanceof r&&h.forEach(n=>{t.on(n,(t,r)=>{"open"===n?o.push({event:n,object1:e}):o.push({event:n,object1:t,object2:r})})}),o}(e,o);o.connect(t,(n,i)=>{if(n)return o.close(!0),r(n);!function(e){h.forEach(t=>e.removeAllListeners(t))}(o),I(e,o),b(e,o);const a=i.lastIsMaster();if(v(e,i),a&&"isdbgrid"===a.msg)return i.close(),_(e,"mongos",t,r);!function(e,t){for(let n=0;n<t.length;n++)e.emit(t[n].event,t[n].object1,t[n].object2)}(e,s),r(n,i)})}(e,i,w(e,i,S))})}function w(e,t,n){return(o,s)=>o?C(o,s,n):t.auth?void r(e,t.user,t.password,t,(e,r)=>{if(r)C(null,s,n);else{s&&s.close(),C(e||new Error("Could not authenticate user "+t.auth[0]),s,n)}}):C(o,s,n)}function O(e,t){const n=new Set(["all","fullsetup","open","reconnect"]);return(r,o)=>{if(n.has(t))return e.emit(t,e);e.emit(t,r,o)}}function _(e,t,n,r){n.promiseLibrary=e.s.promiseLibrary;const o={};"unified"===t&&(o.createServers=!1);const s=k(n,o);let i;"mongos"===t?i=new a(s,n):"replicaset"===t&&(i=new l(s,n)),b(e,i),I(e,i),i.connect(n,(t,n)=>{if(t)return i.close(!0),r(t);v(e,n),r(null,n)})}function T(e,t){const n=["mongos","server","db","replset","db_options","server_options","rs_options","mongos_options"],r=["readconcern","compression"];for(const o in t)-1!==r.indexOf(o.toLowerCase())?e[o]=t[o]:-1!==n.indexOf(o.toLowerCase())?e=N(e,t[o],!1):!t[o]||"object"!=typeof t[o]||Buffer.isBuffer(t[o])||Array.isArray(t[o])?e[o]=t[o]:e=N(e,t[o],!0);return e}function C(e,t,n){return process.nextTick(()=>{try{n(e,t)}catch(e){throw t&&t.close(),e}})}function E(e){return N(T({},e),e,!1)}function N(e,t,n){for(const r in t)t[r]&&"object"==typeof t[r]&&n?e=N(e,t[r],n):e[r]=t[r];return e}function I(e,t){["serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha"].forEach(n=>{t.on(n,(t,r)=>{e.emit(n,t,r)})})}const x=g.reduce((e,t)=>(e[t.toLowerCase()]=t,e),{});function A(e){let t=Object.assign({servers:e.hosts},e.options);for(let e in t){const n=x[e];n&&(t[n]=t[e])}if(e.auth){const n=e.auth;for(let e in n)n[e]&&(t[e]=n[e]);n.username&&(t.auth=n,t.user=n.username),n.db&&(t.authSource=t.authSource||n.db)}return e.defaultDatabase&&(t.dbName=e.defaultDatabase),t.maxpoolsize&&(t.poolSize=t.maxpoolsize),t.readconcernlevel&&(t.readConcern={level:t.readconcernlevel}),t.wtimeoutms&&(t.wtimeout=t.wtimeoutms),t}function k(e,t){if(t=Object.assign({},{createServers:!0},t),"string"!=typeof e.readPreference&&"string"!=typeof e.read_preference||(e.readPreference=new u(e.readPreference||e.read_preference)),e.readPreference&&(e.readPreferenceTags||e.read_preference_tags)&&(e.readPreference.tags=e.readPreferenceTags||e.read_preference_tags),e.maxStalenessSeconds&&(e.readPreference.maxStalenessSeconds=e.maxStalenessSeconds),null==e.socketTimeoutMS&&(e.socketTimeoutMS=36e4),null==e.connectTimeoutMS&&(e.connectTimeoutMS=3e4),t.createServers)return e.servers.map(t=>t.domain_socket?new p(t.domain_socket,27017,e):new p(t.host,t.port,e))}e.exports={connectOp:function(e,t,n){if(t)return n(t);S(e,e.s.url,e.s.options,t=>{if(t)return n(t);n(null,e)})},logout:function(e,t,n){e.topology.logout(t,e=>{if(e)return n(e);n(null,!0)})},validOptions:function(e){const t=g.concat(m);for(const n in e)if(-1===d.indexOf(n)){if(-1===t.indexOf(n)&&e.validateOptions)return new i(`option ${n} is not supported`);-1===t.indexOf(n)&&console.warn(`the options [${n}] is not supported`),-1!==m.indexOf(n)&&console.warn("the server/replset/mongos/db options are deprecated, "+`all their options are supported at the top level of the options object [${g}]`)}}}},function(e,t,n){var r=n(177),o=n(89),s=n(103),i=n(106),a=n(104),c=n(98),u=n(150),l=n(71),p=n(149),f=n(105),h=n(88),d=n(100),m=n(101),y=n(102),g=n(99);r.BSON_INT32_MAX=2147483647,r.BSON_INT32_MIN=-2147483648,r.BSON_INT64_MAX=Math.pow(2,63)-1,r.BSON_INT64_MIN=-Math.pow(2,63),r.JS_INT_MAX=9007199254740992,r.JS_INT_MIN=-9007199254740992,r.Binary=o,r.Code=s,r.DBRef=i,r.Decimal128=a,r.Double=c,r.Int32=u,r.Long=l,r.Map=p,r.MaxKey=f,r.MinKey=h,r.ObjectId=d,r.ObjectID=d,r.BSONRegExp=m,r.Symbol=y,r.Timestamp=g,e.exports=r},function(e,t,n){"use strict";e.exports={normalizedFunctionString:function(e){return e.toString().replace(/function *\(/,"function (")}}},function(e,t,n){"use strict";var r=n(1).inherits,o=n(9).EventEmitter,s=n(93),i=n(94),a=n(18),c=n(1).format,u=n(25).debugOptions,l=n(54).parseHeader,p=n(107).decompress,f=n(24).Response,h=n(11).MongoNetworkError,d=n(56),m=n(54).opcodes.OP_COMPRESSED,y=n(54).MESSAGE_HEADER_SIZE,g=n(53).Buffer,b=0,v=["host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","socketTimeout","singleBufferSerializtion","ssl","ca","crl","cert","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","checkServerIdentity"],S=void 0,w=!1,O={},_=function(e,t){if(o.call(this),this.options=t||{},this.id=b++,this.logger=d("Connection",t),!t.bson)throw new Error("must pass in valid bson parser");this.bson=t.bson,this.tag=t.tag,this.messageHandler=e,this.maxBsonMessageSize=t.maxBsonMessageSize||67108864,this.logger.isDebug()&&this.logger.debug(c("creating connection %s with options [%s]",this.id,JSON.stringify(u(v,t)))),this.port=t.port||27017,this.host=t.host||"localhost",this.family="number"==typeof t.family?t.family:void 0,this.keepAlive="boolean"!=typeof t.keepAlive||t.keepAlive,this.keepAliveInitialDelay="number"==typeof t.keepAliveInitialDelay?t.keepAliveInitialDelay:3e5,this.noDelay="boolean"!=typeof t.noDelay||t.noDelay,this.connectionTimeout="number"==typeof t.connectionTimeout?t.connectionTimeout:3e4,this.socketTimeout="number"==typeof t.socketTimeout?t.socketTimeout:36e4,this.keepAliveInitialDelay>this.socketTimeout&&(this.keepAliveInitialDelay=Math.round(this.socketTimeout/2)),this.destroyed=!1,this.domainSocket=-1!==this.host.indexOf("/"),this.singleBufferSerializtion="boolean"!=typeof t.singleBufferSerializtion||t.singleBufferSerializtion,this.serializationFunction=this.singleBufferSerializtion?"toBinUnified":"toBin",this.ca=t.ca||null,this.crl=t.crl||null,this.cert=t.cert||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.ciphers=t.ciphers||null,this.ecdhCurve=t.ecdhCurve||null,this.ssl="boolean"==typeof t.ssl&&t.ssl,this.rejectUnauthorized="boolean"!=typeof t.rejectUnauthorized||t.rejectUnauthorized,this.checkServerIdentity="boolean"!=typeof t.checkServerIdentity&&"function"!=typeof t.checkServerIdentity||t.checkServerIdentity,this.ssl||(this.rejectUnauthorized=!1),this.responseOptions={promoteLongs:"boolean"!=typeof t.promoteLongs||t.promoteLongs,promoteValues:"boolean"!=typeof t.promoteValues||t.promoteValues,promoteBuffers:"boolean"==typeof t.promoteBuffers&&t.promoteBuffers},this.flushing=!1,this.queue=[],this.connection=null,this.writeStream=null;var n=a.createHash("sha1");n.update(c("%s:%s",this.host,this.port)),this.hashedName=n.digest("hex"),this.workItems=[]};function T(e){delete O[e],S&&S.deleteConnection(e)}r(_,o),_.prototype.setSocketTimeout=function(e){this.connection&&this.connection.setTimeout(e)},_.prototype.resetSocketTimeout=function(){this.connection&&this.connection.setTimeout(this.socketTimeout)},_.enableConnectionAccounting=function(e){e&&(S=e),w=!0,O={}},_.disableConnectionAccounting=function(){w=!1,S=void 0},_.connections=function(){return O};var C=function(e){return function(){w&&T(e.id),e.logger.isDebug()&&e.logger.debug(c("connection %s for [%s:%s] timed out",e.id,e.host,e.port)),e.emit("timeout",new h(c("connection %s to %s:%s timed out",e.id,e.host,e.port)),e)}},E=function(e){return function(t){w&&T(e.id),e.logger.isDebug()&&e.logger.debug(c("connection %s with for [%s:%s] closed",e.id,e.host,e.port)),t||e.emit("close",new h(c("connection %s to %s:%s closed",e.id,e.host,e.port)),e)}},N=function(e,t){var n=l(t);if(n.opCode===m){n.fromCompressed=!0;var r=y;n.opCode=t.readInt32LE(r),r+=4,n.length=t.readInt32LE(r);var o=t[r+=4];r++,p(o,t.slice(r),function(r,o){if(r)throw r;if(o.length!==n.length)throw new Error("Decompressing a compressed message from the server failed. The message is corrupt.");e.messageHandler(new f(e.bson,t,n,o,e.responseOptions),e)})}else e.messageHandler(new f(e.bson,t,n,t.slice(y),e.responseOptions),e)},I=function(e){return function(t){for(;t.length>0;)if(e.bytesRead>0&&e.sizeOfMessage>0){var n=e.sizeOfMessage-e.bytesRead;if(n>t.length)t.copy(e.buffer,e.bytesRead),e.bytesRead=e.bytesRead+t.length,t=g.alloc(0);else{t.copy(e.buffer,e.bytesRead,0,n),t=t.slice(n);try{var r=e.buffer;e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,N(e,r)}catch(t){var o={err:"socketHandler",trace:t,bin:e.buffer,parseState:{sizeOfMessage:e.sizeOfMessage,bytesRead:e.bytesRead,stubBuffer:e.stubBuffer}};e.emit("parseError",o,e)}}}else if(null!=e.stubBuffer&&e.stubBuffer.length>0)if(e.stubBuffer.length+t.length>4){var s=g.alloc(e.stubBuffer.length+t.length);e.stubBuffer.copy(s,0),t.copy(s,e.stubBuffer.length),t=s,e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null}else{var i=g.alloc(e.stubBuffer.length+t.length);e.stubBuffer.copy(i,0),t.copy(i,e.stubBuffer.length),t=g.alloc(0)}else if(t.length>4){var a=t[0]|t[1]<<8|t[2]<<16|t[3]<<24;if(a<0||a>e.maxBsonMessageSize)return o={err:"socketHandler",trace:"",bin:e.buffer,parseState:{sizeOfMessage:a,bytesRead:e.bytesRead,stubBuffer:e.stubBuffer}},void e.emit("parseError",o,e);if(a>4&&a<e.maxBsonMessageSize&&a>t.length)e.buffer=g.alloc(a),t.copy(e.buffer,0),e.bytesRead=t.length,e.sizeOfMessage=a,e.stubBuffer=null,t=g.alloc(0);else if(a>4&&a<e.maxBsonMessageSize&&a===t.length)try{r=t,e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=g.alloc(0),N(e,r)}catch(t){e.emit("parseError",t,e)}else a<=4||a>e.maxBsonMessageSize?(o={err:"socketHandler",trace:null,bin:t,parseState:{sizeOfMessage:a,bytesRead:0,buffer:null,stubBuffer:null}},e.emit("parseError",o,e),e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=g.alloc(0)):(r=t.slice(0,a),e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=t.slice(a),N(e,r))}else e.stubBuffer=g.alloc(t.length),t.copy(e.stubBuffer,0),t=g.alloc(0)}},x=["pfx","key","passphrase","cert","ca","ciphers","NPNProtocols","ALPNProtocols","servername","ecdhCurve","secureProtocol","secureContext","session","minDHSize"];function A(e,t){for(var n in t)null!=t[n]&&-1!==x.indexOf(n)&&(e[n]=t[n])}function k(e,t,n,r){e.connection=e.ssl?function(e,t){let n={socket:e.connection,rejectUnauthorized:e.rejectUnauthorized};A(n,e.options),A(n,t),e.ca&&(n.ca=e.ca),e.crl&&(n.crl=e.crl),e.cert&&(n.cert=e.cert),e.key&&(n.key=e.key),e.passphrase&&(n.passphrase=e.passphrase),!1===e.checkServerIdentity?n.checkServerIdentity=function(){}:"function"==typeof e.checkServerIdentity&&(n.checkServerIdentity=e.checkServerIdentity),null==n.servername&&(n.servername=e.host);const r=i.connect(e.port,e.host,n,function(){if(r.authorizationError&&e.rejectUnauthorized)return e.emit("error",r.authorizationError,e,{ssl:!0});r.setTimeout(e.socketTimeout),e.emit("connect",e)});return r.setKeepAlive(e.keepAlive,e.keepAliveInitialDelay),r.setTimeout(e.connectionTimeout),r.setNoDelay(e.noDelay),r}(e,n):function(e,t){let n;e.domainSocket?n={path:e.host}:(n={port:e.port,host:e.host}).family=t;const r=s.createConnection(n);return r.setKeepAlive(e.keepAlive,e.keepAliveInitialDelay),r.setTimeout(e.connectionTimeout),r.setNoDelay(e.noDelay),r.once("connect",function(){r.setTimeout(e.socketTimeout),e.emit("connect",e)}),r}(e,t),e.connection.once("error",r),e.connection.once("timeout",C(e)),e.connection.once("close",E(e)),e.connection.on("data",I(e))}_.prototype.connect=function(e){e=e||{},w&&function(e,t){O[e]=t,S&&S.addConnection(e,t)}(this.id,this),"boolean"==typeof e.promoteLongs&&(this.responseOptions.promoteLongs=e.promoteLongs,this.responseOptions.promoteValues=e.promoteValues,this.responseOptions.promoteBuffers=e.promoteBuffers);const t=function(e){return function(t){w&&T(e.id),e.logger.isDebug()&&e.logger.debug(c("connection %s for [%s:%s] errored out with [%s]",e.id,e.host,e.port,JSON.stringify(t))),e.listeners("error").length>0&&e.emit("error",new h(t),e)}}(this);return void 0!==this.family?k(this,this.family,e,t):k(this,6,e,n=>(this.logger.isDebug()&&this.logger.debug(c("connection %s for [%s:%s] errored out with [%s]",this.id,this.host,this.port,JSON.stringify(n))),this.connection.removeAllListeners("error"),this.connection.removeAllListeners("timeout"),this.connection.removeAllListeners("close"),this.connection.removeAllListeners("data"),this.connection=void 0,k(this,4,e,t)))},_.prototype.unref=function(){if(this.connection)this.connection.unref();else{var e=this;this.once("connect",function(){e.connection.unref()})}},_.prototype.destroy=function(){if(w&&T(this.id),this.connection){try{this.connection.end()}catch(e){}this.connection.destroy()}this.destroyed=!0},_.prototype.write=function(e){var t;if(this.logger.isDebug())if(Array.isArray(e))for(t=0;t<e.length;t++)this.logger.debug(c("writing buffer [%s] to %s:%s",e[t].toString("hex"),this.host,this.port));else this.logger.debug(c("writing buffer [%s] to %s:%s",e.toString("hex"),this.host,this.port));if(!1===this.connection.destroyed){if(!Array.isArray(e))return this.connection.write(e,"binary"),!0;for(t=0;t<e.length;t++)this.connection.write(e[t],"binary");return!0}return!1},_.prototype.toString=function(){return""+this.id},_.prototype.toJSON=function(){return{id:this.id,host:this.host,port:this.port}},_.prototype.isConnected=function(){return!this.destroyed&&(!this.connection.destroyed&&this.connection.writable)},e.exports=_},function(e,t,n){"use strict";var r=n(1).format,o=n(18),s=n(24).Query,i=n(11).MongoError,a=function(e,t,n){this.db=e,this.username=t,this.password=n};a.prototype.equal=function(e){return e.db===this.db&&e.username===this.username&&e.password===this.password};var c=function(e){this.bson=e,this.authStore=[]},u=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};c.prototype.auth=function(e,t,n,c,l,p){var f=this,h=t.length;if(0===h)return p(null,null);for(var d=0,m=null;t.length>0;){!function(t){process.nextTick(function(){!function(t){e(t,new s(f.bson,r("%s.$cmd",n),{getnonce:1},{numberToSkip:0,numberToReturn:1}),function(y,g){var b=null,v=null;if(null==y){b=g.result.nonce;var S=o.createHash("md5");S.update(c+":mongo:"+l,"utf8");var w=S.digest("hex");(S=o.createHash("md5")).update(b+c+w,"utf8"),v=S.digest("hex")}e(t,new s(f.bson,r("%s.$cmd",n),{authenticate:1,user:c,nonce:b,key:v},{numberToSkip:0,numberToReturn:1}),function(e,t){h-=1,e?m=e:t.result.$err?m=t.result:t.result.errmsg?m=t.result:d+=1,0===h&&d>0?(u(f.authStore,new a(n,c,l)),p(null,!0)):0===h&&(null==m&&(m=new i(r("failed to authenticate using mongocr"))),p(m,!1))})})}(t)})}(t.shift())}},c.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!==e})},c.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var s=0;s<r.length;s++)this.auth(e,t,r[s].db,r[s].username,r[s].password,function(e){0===(o-=1)&&n(e,null)})},e.exports=c},function(e,t,n){"use strict";var r=n(1).format,o=n(24).Query,s=n(11).MongoError,i=function(e,t,n){this.db=e,this.username=t,this.password=n};i.prototype.equal=function(e){return e.db===this.db&&e.username===this.username&&e.password===this.password};var a=function(e){this.bson=e,this.authStore=[]};a.prototype.auth=function(e,t,n,a,u,l){var p=this,f=t.length;if(0===f)return l(null,null);for(var h=0,d=null;t.length>0;){!function(t){process.nextTick(function(){!function(t){var m={authenticate:1,mechanism:"MONGODB-X509"};a&&(m.user=a),e(t,new o(p.bson,"$external.$cmd",m,{numberToSkip:0,numberToReturn:1}),function(e,t){f-=1,e?d=e:t.result.$err?d=t.result:t.result.errmsg?d=t.result:h+=1,0===f&&h>0?(c(p.authStore,new i(n,a,u)),l(null,!0)):0===f&&(null==d&&(d=new s(r("failed to authenticate using mongocr"))),l(d,!1))})}(t)})}(t.shift())}};var c=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};a.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!==e})},a.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var s=0;s<r.length;s++)this.auth(e,t,r[s].db,r[s].username,r[s].password,function(e){0===(o-=1)&&n(e,null)})},e.exports=a},function(e,t,n){"use strict";var r=n(1).format,o=n(25).retrieveBSON,s=n(24).Query,i=n(11).MongoError,a=o().Binary,c=function(e,t,n){this.db=e,this.username=t,this.password=n};c.prototype.equal=function(e){return e.db===this.db&&e.username===this.username&&e.password===this.password};var u=function(e){this.bson=e,this.authStore=[]};u.prototype.auth=function(e,t,n,o,u,p){var f=this,h=t.length;if(0===h)return p(null,null);for(var d=0,m=null;t.length>0;){!function(t){process.nextTick(function(){!function(t){var y={saslStart:1,mechanism:"PLAIN",payload:new a(r("\0%s\0%s",o,u)),autoAuthorize:1};e(t,new s(f.bson,"$external.$cmd",y,{numberToSkip:0,numberToReturn:1}),function(e,t){h-=1,e?m=e:t.result.$err?m=t.result:t.result.errmsg?m=t.result:d+=1,0===h&&d>0?(l(f.authStore,new c(n,o,u)),p(null,!0)):0===h&&(null==m&&(m=new i(r("failed to authenticate using mongocr"))),p(m,!1))})}(t)})}(t.shift())}};var l=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};u.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!==e})},u.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var s=0;s<r.length;s++)this.auth(e,t,r[s].db,r[s].username,r[s].password,function(e){0===(o-=1)&&n(e,null)})},e.exports=u},function(e,t,n){"use strict";const r=n(1).format,o=n(24).Query,s=n(11).MongoError,i=n(35).retrieveKerberos;var a=function(e,t,n,r){this.db=e,this.username=t,this.password=n,this.options=r};a.prototype.equal=function(e){return e.db===this.db&&e.username===this.username&&e.password===this.password};var c=function(e){this.bson=e,this.authStore=[]};c.prototype.auth=function(e,t,n,o,c,l,p){var f=this;let d;try{d=i()}catch(e){return p(e,null)}var m=l.gssapiservicename||l.gssapiServiceName||"mongodb",y=t.length;if(0===y)return p(null,null);for(var g=0,b=null;t.length>0;){!function(t){process.nextTick(function(){!function(t){u(f,d.processes.MongoAuthProcess,n,o,c,n,m,e,t,l,function(e,t){y-=1,e?b=e:t.result.$err?b=t.result:t.result.errmsg?b=t.result:g+=1,0===y&&g>0?(h(f.authStore,new a(n,o,c,l)),p(null,!0)):0===y&&(null==b&&(b=new s(r("failed to authenticate using mongocr"))),p(b,!1))})}(t)})}(t.shift())}};var u=function(e,t,n,r,o,s,i,a,c,u,p){var f=new t(c.host,c.port,i,u);f.init(r,o,function(t){if(t)return p(t,!1);f.transition("",function(t,i){if(t)return p(t,!1);l(e,f,i,n,r,o,s,a,c,p)})})},l=function(e,t,n,r,s,i,a,c,u,l){var f={saslStart:1,mechanism:"GSSAPI",payload:n,autoAuthorize:1};c(u,new o(e.bson,"$external.$cmd",f,{numberToSkip:0,numberToReturn:1}),function(n,o){if(n)return l(n,!1);var f=o.result;t.transition(o.result.payload,function(n,o){if(n)return l(n,!1);p(e,t,o,f,r,s,i,a,c,u,l)})})},p=function(e,t,n,r,s,i,a,c,u,l,p){var h={saslContinue:1,conversationId:r.conversationId,payload:n};u(l,new o(e.bson,"$external.$cmd",h,{numberToSkip:0,numberToReturn:1}),function(n,r){if(n)return p(n,!1);var o=r.result;t.transition(o.payload,function(n,r){if(n)return p(n,!1);f(e,t,r,o,s,i,a,c,u,l,p)})})},f=function(e,t,n,r,s,i,a,c,u,l,p){var f={saslContinue:1,conversationId:r.conversationId,payload:n};u(l,new o(e.bson,"$external.$cmd",f,{numberToSkip:0,numberToReturn:1}),function(e,n){if(e)return p(e,!1);t.transition(null,function(e){if(e)return p(e,null);p(null,n)})})},h=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};c.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!==e})},c.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var s=0;s<r.length;s++)this.auth(e,t,r[s].db,r[s].username,r[s].password,r[s].options,function(e){0===(o-=1)&&n(e,null)})},e.exports=c},function(e,t,n){"use strict";const r=n(1).inherits,o=n(6).MongoError,s=n(15).Readable,i=n(36);var a=function(e,t,n,r,o,c){i.apply(this,Array.prototype.slice.call(arguments,0));var u=a.INIT,l=r.promiseLibrary||Promise;s.call(this,{objectMode:!0}),this.s={maxTimeMS:null,state:u,streamOptions:{},bson:e,ns:t,cmd:n,options:r,topology:o,topologyOptions:c,promiseLibrary:l,session:r.session}};for(var c in r(a,s),i.prototype)a.prototype[c]=i.prototype[c];a.prototype.batchSize=function(e){if(this.s.state===a.CLOSED||this.isDead())throw o.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw o.create({message:"batchSize requires an integer",drvier:!0});return this.s.cmd.cursor&&(this.s.cmd.cursor.batchSize=e),this.setCursorBatchSize(e),this},a.prototype.geoNear=function(e){return this.s.cmd.pipeline.push({$geoNear:e}),this},a.prototype.group=function(e){return this.s.cmd.pipeline.push({$group:e}),this},a.prototype.limit=function(e){return this.s.cmd.pipeline.push({$limit:e}),this},a.prototype.match=function(e){return this.s.cmd.pipeline.push({$match:e}),this},a.prototype.maxTimeMS=function(e){return this.s.topology.lastIsMaster().minWireVersion>2&&(this.s.cmd.maxTimeMS=e),this},a.prototype.out=function(e){return this.s.cmd.pipeline.push({$out:e}),this},a.prototype.project=function(e){return this.s.cmd.pipeline.push({$project:e}),this},a.prototype.lookup=function(e){return this.s.cmd.pipeline.push({$lookup:e}),this},a.prototype.redact=function(e){return this.s.cmd.pipeline.push({$redact:e}),this},a.prototype.skip=function(e){return this.s.cmd.pipeline.push({$skip:e}),this},a.prototype.sort=function(e){return this.s.cmd.pipeline.push({$sort:e}),this},a.prototype.unwind=function(e){return this.s.cmd.pipeline.push({$unwind:e}),this},a.prototype.getLogger=function(){return this.logger},a.prototype.get=a.prototype.toArray,a.INIT=0,a.OPEN=1,a.CLOSED=2,e.exports=a},function(e,t,n){"use strict";e.exports={SYSTEM_NAMESPACE_COLLECTION:"system.namespaces",SYSTEM_INDEX_COLLECTION:"system.indexes",SYSTEM_PROFILE_COLLECTION:"system.profile",SYSTEM_USER_COLLECTION:"system.users",SYSTEM_COMMAND_COLLECTION:"$cmd",SYSTEM_JS_COLLECTION:"system.js"}},function(e,t,n){"use strict";const r=n(5).executeOperation,o=n(5).applyWriteConcern,s=n(14).addUser,i=n(14).executeDbAdminCommand,a=n(14).removeUser,c=n(157).replSetGetStatus,u=n(157).serverStatus,l=n(157).validateCollection;function p(e,t,n){if(!(this instanceof p))return new p(e,t);this.s={db:e,topology:t,promiseLibrary:n}}p.prototype.command=function(e,t,n){const o=Array.prototype.slice.call(arguments,1);return n="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():{},r(this.s.db.s.topology,i.bind(this.s.db),[this.s.db,e,t,n])},p.prototype.buildInfo=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};return r(this.s.db.s.topology,i.bind(this.s.db),[this.s.db,{buildinfo:1},e,t])},p.prototype.serverInfo=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};return r(this.s.db.s.topology,i.bind(this.s.db),[this.s.db,{buildinfo:1},e,t])},p.prototype.serverStatus=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},r(this.s.db.s.topology,u,[this,e,t])},p.prototype.ping=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};return r(this.s.db.s.topology,i.bind(this.s.db),[this.s.db,{ping:1},e,t])},p.prototype.addUser=function(e,t,n,i){const a=Array.prototype.slice.call(arguments,2);return i="function"==typeof a[a.length-1]?a.pop():void 0,n=a.length?a.shift():{},n=Object.assign({},n),(n=o(n,{db:this.s.db})).dbName="admin",r(this.s.db.s.topology,s,[this.s.db,e,t,n,i])},p.prototype.removeUser=function(e,t,n){const s=Array.prototype.slice.call(arguments,1);return n="function"==typeof s[s.length-1]?s.pop():void 0,t=s.length?s.shift():{},t=Object.assign({},t),(t=o(t,{db:this.s.db})).dbName="admin",r(this.s.db.s.topology,a,[this.s.db,e,t,n])},p.prototype.validateCollection=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},r(this.s.db.s.topology,l,[this,e,t,n])},p.prototype.listDatabases=function(e,t){"function"==typeof e&&(t=e,e={});const n={listDatabases:1};return(e=e||{}).nameOnly&&(n.nameOnly=Number(n.nameOnly)),r(this.s.db.s.topology,i.bind(this.s.db),[this.s.db,n,e,t])},p.prototype.replSetGetStatus=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},r(this.s.db.s.topology,c,[this,e,t])},e.exports=p},function(e,t,n){"use strict";const r=n(74).TopologyBase,o=n(6).MongoError,s=n(6).Mongos,i=n(36),a=n(113),c=n(74).Store,u=n(5).MAX_JS_INT,l=n(5).translateOptions,p=n(5).filterOptions,f=n(5).mergeOptions;var h=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","promiseLibrary","monitorCommands"];class d extends r{constructor(e,t){super();t=p(t=t||{},h);for(var n=0;n<e.length;n++)if(!(e[n]instanceof a))throw o.create({message:"all seed list instances must be of the Server type",driver:!0});var r={force:!1,bufferMaxEntries:"number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:u},d=t.store||new c(this,r),m=e.map(function(e){return{host:e.host,port:e.port}}),y="boolean"!=typeof t.auto_reconnect||t.auto_reconnect;y="boolean"==typeof t.autoReconnect?t.autoReconnect:y;var g=f({},{disconnectHandler:d,cursorFactory:i,reconnect:y,emitError:"boolean"!=typeof t.emitError||t.emitError,size:"number"==typeof t.poolSize?t.poolSize:5,monitorCommands:"boolean"==typeof t.monitorCommands&&t.monitorCommands});g=l(g,t);var b=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;(g=l(g,b)).clientInfo=this.clientInfo,t.appname&&(g.clientInfo.application={name:t.appname}),this.s={coreTopology:new s(m,g),sCapabilities:null,debug:g.debug,storeOptions:r,clonedOptions:g,store:d,options:t,sessionPool:null,sessions:[],promiseLibrary:t.promiseLibrary||Promise}}connect(e,t){var n=this;"function"==typeof e&&(t=e,e={}),null==e&&(e={}),"function"!=typeof t&&(t=null),e=Object.assign({},this.s.clonedOptions,e),n.s.options=e,n.s.storeOptions.bufferMaxEntries="number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:-1;var r=function(){return function(e){["timeout","error","close"].forEach(function(e){n.removeListener(e,r)}),n.s.coreTopology.removeListener("connect",r),n.close(!0);try{t(e)}catch(e){process.nextTick(function(){throw e})}}},o=function(e){return function(t){"error"!==e&&n.emit(e,t)}},s=function(e){return function(t,r){n.emit(e,t,r)}};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach(function(e){n.s.coreTopology.removeAllListeners(e)}),n.s.coreTopology.on("serverDescriptionChanged",s("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",s("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",s("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",s("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",s("serverOpening")),n.s.coreTopology.on("serverClosed",s("serverClosed")),n.s.coreTopology.on("topologyOpening",s("topologyOpening")),n.s.coreTopology.on("topologyClosed",s("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",s("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",s("commandStarted")),n.s.coreTopology.on("commandSucceeded",s("commandSucceeded")),n.s.coreTopology.on("commandFailed",s("commandFailed")),n.s.coreTopology.once("timeout",r("timeout")),n.s.coreTopology.once("error",r("error")),n.s.coreTopology.once("close",r("close")),n.s.coreTopology.once("connect",function(){["timeout","error","close","fullsetup"].forEach(function(e){n.s.coreTopology.removeAllListeners(e)}),n.s.coreTopology.on("timeout",o("timeout")),n.s.coreTopology.on("error",o("error")),n.s.coreTopology.on("close",o("close")),n.s.coreTopology.on("fullsetup",function(){n.emit("fullsetup",n)}),n.emit("open",null,n);try{t(null,n)}catch(e){process.nextTick(function(){throw e})}}),n.s.coreTopology.on("joined",s("joined")),n.s.coreTopology.on("left",s("left")),n.s.coreTopology.on("reconnect",function(){n.emit("reconnect"),n.s.store.execute()}),n.s.coreTopology.connect(e)}}Object.defineProperty(d.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}}),e.exports=d},function(e,t,n){"use strict";const r=n(113),o=n(36),s=n(6).MongoError,i=n(74).TopologyBase,a=n(74).Store,c=n(6).ReplSet,u=n(5).MAX_JS_INT,l=n(5).translateOptions,p=n(5).filterOptions,f=n(5).mergeOptions;var h=["ha","haInterval","replicaSet","rs_name","secondaryAcceptableLatencyMS","connectWithNoPrimary","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCert","ciphers","ecdhCurve","sslCRL","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","strategy","debug","family","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","maxStalenessSeconds","promiseLibrary","minSize","monitorCommands"];class d extends i{constructor(e,t){super();var n=this;t=p(t=t||{},h);for(var i=0;i<e.length;i++)if(!(e[i]instanceof r))throw s.create({message:"all seed list instances must be of the Server type",driver:!0});var d={force:!1,bufferMaxEntries:"number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:u},m=t.store||new a(n,d),y=e.map(function(e){return{host:e.host,port:e.port}}),g=f({},{disconnectHandler:m,cursorFactory:o,reconnect:!1,emitError:"boolean"!=typeof t.emitError||t.emitError,size:"number"==typeof t.poolSize?t.poolSize:5,monitorCommands:"boolean"==typeof t.monitorCommands&&t.monitorCommands});g=l(g,t);var b=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;(g=l(g,b)).clientInfo=this.clientInfo,t.appname&&(g.clientInfo.application={name:t.appname});var v=new c(y,g);v.on("reconnect",function(){n.emit("reconnect"),m.execute()}),this.s={coreTopology:v,sCapabilities:null,tag:t.tag,storeOptions:d,clonedOptions:g,store:m,options:t,sessionPool:null,sessions:[],promiseLibrary:t.promiseLibrary||Promise},g.debug&&Object.defineProperty(this,"replset",{enumerable:!0,get:function(){return v}})}connect(e,t){var n=this;"function"==typeof e&&(t=e,e={}),null==e&&(e={}),"function"!=typeof t&&(t=null),e=Object.assign({},this.s.clonedOptions,e),n.s.options=e,n.s.storeOptions.bufferMaxEntries="number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:-1;var r=function(e){return function(t){"error"!==e&&n.emit(e,t)}};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha"].forEach(function(e){n.s.coreTopology.removeAllListeners(e)});var o=function(e){return function(t,r){n.emit(e,t,r)}};n.s.coreTopology.on("joined",function(e){return function(t,r){n.emit(e,t,r.lastIsMaster(),r)}}("joined")),n.s.coreTopology.on("left",o("left")),n.s.coreTopology.on("ping",o("ping")),n.s.coreTopology.on("ha",function(e,t){n.emit("ha",e,t),"start"===e?n.emit("ha_connect",e,t):"end"===e&&n.emit("ha_ismaster",e,t)}),n.s.coreTopology.on("serverDescriptionChanged",o("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",o("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",o("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",o("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",o("serverOpening")),n.s.coreTopology.on("serverClosed",o("serverClosed")),n.s.coreTopology.on("topologyOpening",o("topologyOpening")),n.s.coreTopology.on("topologyClosed",o("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",o("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",o("commandStarted")),n.s.coreTopology.on("commandSucceeded",o("commandSucceeded")),n.s.coreTopology.on("commandFailed",o("commandFailed")),n.s.coreTopology.on("fullsetup",function(){n.emit("fullsetup",n,n)}),n.s.coreTopology.on("all",function(){n.emit("all",null,n)});var s=function(){return function(e){["timeout","error","close"].forEach(function(e){n.s.coreTopology.removeListener(e,s)}),n.s.coreTopology.removeListener("connect",s),n.s.coreTopology.destroy();try{t(e)}catch(e){n.s.coreTopology.isConnected()||process.nextTick(function(){throw e})}}};n.s.coreTopology.once("timeout",s("timeout")),n.s.coreTopology.once("error",s("error")),n.s.coreTopology.once("close",s("close")),n.s.coreTopology.once("connect",function(){n.s.coreTopology.once("timeout",r("timeout")),n.s.coreTopology.once("error",r("error")),n.s.coreTopology.once("close",r("close")),n.emit("open",null,n);try{t(null,n)}catch(e){process.nextTick(function(){throw e})}}),n.s.coreTopology.connect(e)}close(e){super.close(e),["timeout","error","close","joined","left"].forEach(e=>this.removeAllListeners(e))}}Object.defineProperty(d.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}}),e.exports=d},function(e,t,n){"use strict";var r=n(6).BSON.Binary,o=n(6).BSON.ObjectID,s=n(53).Buffer,i=function(e,t,n){if(!(this instanceof i))return new i(e,t);this.file=e;var a=null==t?{}:t;if(this.writeConcern=n||{w:1},this.objectId=null==a._id?new o:a._id,this.chunkNumber=null==a.n?0:a.n,this.data=new r,"string"==typeof a.data){var c=s.alloc(a.data.length);c.write(a.data,0,a.data.length,"binary"),this.data=new r(c)}else if(Array.isArray(a.data)){c=s.alloc(a.data.length);var u=a.data.join("");c.write(u,0,u.length,"binary"),this.data=new r(c)}else if(a.data&&"Binary"===a.data._bsontype)this.data=a.data;else if(!s.isBuffer(a.data)&&null!=a.data)throw Error("Illegal chunk format");this.internalPosition=0};i.prototype.write=function(e,t){return this.data.write(e,this.internalPosition,e.length,"binary"),this.internalPosition=this.data.length(),null!=t?t(null,this):this},i.prototype.read=function(e){if(e=null==e||0===e?this.length():e,this.length()-this.internalPosition+1>=e){var t=this.data.read(this.internalPosition,e);return this.internalPosition=this.internalPosition+e,t}return""},i.prototype.readSlice=function(e){if(this.length()-this.internalPosition>=e){var t=null;return null!=this.data.buffer?t=this.data.buffer.slice(this.internalPosition,this.internalPosition+e):(t=s.alloc(e),e=this.data.readInto(t,this.internalPosition)),this.internalPosition=this.internalPosition+e,t}return null},i.prototype.eof=function(){return this.internalPosition===this.length()},i.prototype.getc=function(){return this.read(1)},i.prototype.rewind=function(){this.internalPosition=0,this.data=new r},i.prototype.save=function(e,t){var n=this;"function"==typeof e&&(t=e,e={}),n.file.chunkCollection(function(r,o){if(r)return t(r);var s={upsert:!0};for(var i in e)s[i]=e[i];for(i in n.writeConcern)s[i]=n.writeConcern[i];n.data.length()>0?n.buildMongoObject(function(e){var r={forceServerObjectId:!0};for(var i in n.writeConcern)r[i]=n.writeConcern[i];o.replaceOne({_id:n.objectId},e,s,function(e){t(e,n)})}):t(null,n)})},i.prototype.buildMongoObject=function(e){var t={files_id:this.file.fileId,n:this.chunkNumber,data:this.data};null!=this.objectId&&(t._id=this.objectId),e(t)},i.prototype.length=function(){return this.data.length()},Object.defineProperty(i.prototype,"position",{enumerable:!0,get:function(){return this.internalPosition},set:function(e){this.internalPosition=e}}),i.DEFAULT_CHUNK_SIZE=261120,e.exports=i},,,function(e,t,n){"use strict";function r(e,t,n,r,o,s,i){try{var a=e[s](i),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}n(114).MongoClient,n(97).URI;const o=n(175);t.handler=function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(o,s){var i=e.apply(t,n);function a(e){r(i,o,s,a,c,"next",e)}function c(e){r(i,o,s,a,c,"throw",e)}a(void 0)})}}(function*(e,t,n){(yield o).collection("users").find({}).toArray().then(e=>{n(null,{statusCode:200,body:JSON.stringify(e)})})});return function(t,n,r){return e.apply(this,arguments)}}()},function(e,t,n){"use strict";const r=n(176).MongoClient,o=n(97).URI;let s=null,i={useNewUrlParser:!0};e.exports=function(e){return console.log("=> connecting to database....\n"),s?(console.log("=> using cached database instance"),Promise.resolve(s.db("visiJAM-DB"))):r.connect(e,i).then(e=>(s=e).db("visiJAM-DB")).catch(e=>console.log(e.message))}(o)},function(e,t,n){"use strict";const r=n(6),o=n(200),s=n(111).connect;s.MongoError=r.MongoError,s.MongoNetworkError=r.MongoNetworkError,s.Admin=n(168),s.MongoClient=n(111),s.Db=n(73),s.Collection=n(72),s.Server=n(113),s.ReplSet=n(170),s.Mongos=n(169),s.ReadPreference=n(6).ReadPreference,s.GridStore=n(207),s.Chunk=n(171),s.Logger=r.Logger,s.AggregationCursor=n(166),s.CommandCursor=n(156),s.Cursor=n(36),s.GridFSBucket=n(208),s.CoreServer=n(6).Server,s.CoreConnection=n(6).Connection,s.Binary=r.BSON.Binary,s.Code=r.BSON.Code,s.Map=r.BSON.Map,s.DBRef=r.BSON.DBRef,s.Double=r.BSON.Double,s.Int32=r.BSON.Int32,s.Long=r.BSON.Long,s.MinKey=r.BSON.MinKey,s.MaxKey=r.BSON.MaxKey,s.ObjectID=r.BSON.ObjectID,s.ObjectId=r.BSON.ObjectID,s.Symbol=r.BSON.Symbol,s.Timestamp=r.BSON.Timestamp,s.BSONRegExp=r.BSON.BSONRegExp,s.Decimal128=r.BSON.Decimal128,s.connect=s,s.instrument=function(e,t){"function"==typeof e&&(t=e,e={});const n=new o;return n.instrument(s.MongoClient,t),n},e.exports=s},function(e,t,n){"use strict";var r=n(149),o=n(71),s=n(98),i=n(99),a=n(100),c=n(101),u=n(102),l=n(150),p=n(103),f=n(104),h=n(88),d=n(105),m=n(106),y=n(89),g=n(178),b=n(179),v=n(181),S=new Buffer(17825792),w=function(){};w.prototype.serialize=function(e,t){var n="boolean"==typeof(t=t||{}).checkKeys&&t.checkKeys,r="boolean"==typeof t.serializeFunctions&&t.serializeFunctions,o="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined,s="number"==typeof t.minInternalBufferSize?t.minInternalBufferSize:17825792;S.length<s&&(S=new Buffer(s));var i=b(S,e,n,0,0,r,o,[]),a=new Buffer(i);return S.copy(a,0,0,a.length),a},w.prototype.serializeWithBufferAndIndex=function(e,t,n){var r="boolean"==typeof(n=n||{}).checkKeys&&n.checkKeys,o="boolean"==typeof n.serializeFunctions&&n.serializeFunctions,s="boolean"!=typeof n.ignoreUndefined||n.ignoreUndefined,i="number"==typeof n.index?n.index:0;return b(t,e,r,i||0,0,o,s)-1},w.prototype.deserialize=function(e,t){return g(e,t)},w.prototype.calculateObjectSize=function(e,t){var n="boolean"==typeof(t=t||{}).serializeFunctions&&t.serializeFunctions,r="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined;return v(e,n,r)},w.prototype.deserializeStream=function(e,t,n,r,o,s){s=null!=s?s:{};for(var i=t,a=0;a<n;a++){var c=e[i]|e[i+1]<<8|e[i+2]<<16|e[i+3]<<24;s.index=i,r[o+a]=this.deserialize(e,s),i+=c}return i},w.BSON_INT32_MAX=2147483647,w.BSON_INT32_MIN=-2147483648,w.BSON_INT64_MAX=Math.pow(2,63)-1,w.BSON_INT64_MIN=-Math.pow(2,63),w.JS_INT_MAX=9007199254740992,w.JS_INT_MIN=-9007199254740992,w.BSON_DATA_NUMBER=1,w.BSON_DATA_STRING=2,w.BSON_DATA_OBJECT=3,w.BSON_DATA_ARRAY=4,w.BSON_DATA_BINARY=5,w.BSON_DATA_OID=7,w.BSON_DATA_BOOLEAN=8,w.BSON_DATA_DATE=9,w.BSON_DATA_NULL=10,w.BSON_DATA_REGEXP=11,w.BSON_DATA_CODE=13,w.BSON_DATA_SYMBOL=14,w.BSON_DATA_CODE_W_SCOPE=15,w.BSON_DATA_INT=16,w.BSON_DATA_TIMESTAMP=17,w.BSON_DATA_LONG=18,w.BSON_DATA_MIN_KEY=255,w.BSON_DATA_MAX_KEY=127,w.BSON_BINARY_SUBTYPE_DEFAULT=0,w.BSON_BINARY_SUBTYPE_FUNCTION=1,w.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,w.BSON_BINARY_SUBTYPE_UUID=3,w.BSON_BINARY_SUBTYPE_MD5=4,w.BSON_BINARY_SUBTYPE_USER_DEFINED=128,e.exports=w,e.exports.Code=p,e.exports.Map=r,e.exports.Symbol=u,e.exports.BSON=w,e.exports.DBRef=m,e.exports.Binary=y,e.exports.ObjectID=a,e.exports.Long=o,e.exports.Timestamp=i,e.exports.Double=s,e.exports.Int32=l,e.exports.MinKey=h,e.exports.MaxKey=d,e.exports.BSONRegExp=c,e.exports.Decimal128=f},function(module,exports,__webpack_require__){"use strict";var Long=__webpack_require__(71).Long,Double=__webpack_require__(98).Double,Timestamp=__webpack_require__(99).Timestamp,ObjectID=__webpack_require__(100).ObjectID,Symbol=__webpack_require__(102).Symbol,Code=__webpack_require__(103).Code,MinKey=__webpack_require__(88).MinKey,MaxKey=__webpack_require__(105).MaxKey,Decimal128=__webpack_require__(104),Int32=__webpack_require__(150),DBRef=__webpack_require__(106).DBRef,BSONRegExp=__webpack_require__(101).BSONRegExp,Binary=__webpack_require__(89).Binary,deserialize=function(e,t,n){var r=(t=null==t?{}:t)&&t.index?t.index:0,o=e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24;if(o<5||e.length<o||o+r>e.length)throw new Error("corrupt bson message");if(0!==e[r+o-1])throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return deserializeObject(e,r,t,n)},deserializeObject=function(e,t,n,r){var o=null!=n.evalFunctions&&n.evalFunctions,s=null!=n.cacheFunctions&&n.cacheFunctions,i=null!=n.cacheFunctionsCrc32&&n.cacheFunctionsCrc32;if(!i)var a=null;var c=null==n.fieldsAsRaw?null:n.fieldsAsRaw,u=null!=n.raw&&n.raw,l="boolean"==typeof n.bsonRegExp&&n.bsonRegExp,p=null!=n.promoteBuffers&&n.promoteBuffers,f=null==n.promoteLongs||n.promoteLongs,h=null==n.promoteValues||n.promoteValues,d=t;if(e.length<5)throw new Error("corrupt bson message < 5 bytes long");var m=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(m<5||m>e.length)throw new Error("corrupt bson message");for(var y=r?[]:{},g=0;;){var b=e[t++];if(0===b)break;for(var v=t;0!==e[v]&&v<e.length;)v++;if(v>=e.length)throw new Error("Bad BSON Document: illegal CString");var S=r?g++:e.toString("utf8",t,v);if(t=v+1,b===BSON.BSON_DATA_STRING){var w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(w<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");y[S]=e.toString("utf8",t,t+w-1),t+=w}else if(b===BSON.BSON_DATA_OID){var O=new Buffer(12);e.copy(O,0,t,t+12),y[S]=new ObjectID(O),t+=12}else if(b===BSON.BSON_DATA_INT&&!1===h)y[S]=new Int32(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24);else if(b===BSON.BSON_DATA_INT)y[S]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;else if(b===BSON.BSON_DATA_NUMBER&&!1===h)y[S]=new Double(e.readDoubleLE(t)),t+=8;else if(b===BSON.BSON_DATA_NUMBER)y[S]=e.readDoubleLE(t),t+=8;else if(b===BSON.BSON_DATA_DATE){var _=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;y[S]=new Date(new Long(_,T).toNumber())}else if(b===BSON.BSON_DATA_BOOLEAN){if(0!==e[t]&&1!==e[t])throw new Error("illegal boolean type value");y[S]=1===e[t++]}else if(b===BSON.BSON_DATA_OBJECT){var C=t,E=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;if(E<=0||E>e.length-t)throw new Error("bad embedded document length in bson");y[S]=u?e.slice(t,t+E):deserializeObject(e,C,n,!1),t+=E}else if(b===BSON.BSON_DATA_ARRAY){C=t;var N=n,I=t+(E=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24);if(c&&c[S]){for(var x in N={},n)N[x]=n[x];N.raw=!0}if(y[S]=deserializeObject(e,C,N,!0),0!==e[(t+=E)-1])throw new Error("invalid array terminator byte");if(t!==I)throw new Error("corrupted array bson")}else if(b===BSON.BSON_DATA_UNDEFINED)y[S]=void 0;else if(b===BSON.BSON_DATA_NULL)y[S]=null;else if(b===BSON.BSON_DATA_LONG){_=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var A=new Long(_,T);y[S]=f&&!0===h&&A.lessThanOrEqual(JS_INT_MAX_LONG)&&A.greaterThanOrEqual(JS_INT_MIN_LONG)?A.toNumber():A}else if(b===BSON.BSON_DATA_DECIMAL128){var k=new Buffer(16);e.copy(k,0,t,t+16),t+=16;var B=new Decimal128(k);y[S]=B.toObject?B.toObject():B}else if(b===BSON.BSON_DATA_BINARY){var M=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,D=M,R=e[t++];if(M<0)throw new Error("Negative binary type element size found");if(M>e.length)throw new Error("Binary type size larger than document size");if(null!=e.slice){if(R===Binary.SUBTYPE_BYTE_ARRAY){if((M=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(M>D-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(M<D-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}y[S]=p&&h?e.slice(t,t+M):new Binary(e.slice(t,t+M),R)}else{var P="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(M)):new Array(M);if(R===Binary.SUBTYPE_BYTE_ARRAY){if((M=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(M>D-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(M<D-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}for(v=0;v<M;v++)P[v]=e[t+v];y[S]=p&&h?P:new Binary(P,R)}t+=M}else if(b===BSON.BSON_DATA_REGEXP&&!1===l){for(v=t;0!==e[v]&&v<e.length;)v++;if(v>=e.length)throw new Error("Bad BSON Document: illegal CString");var L=e.toString("utf8",t,v);for(v=t=v+1;0!==e[v]&&v<e.length;)v++;if(v>=e.length)throw new Error("Bad BSON Document: illegal CString");var j=e.toString("utf8",t,v);t=v+1;var U=new Array(j.length);for(v=0;v<j.length;v++)switch(j[v]){case"m":U[v]="m";break;case"s":U[v]="g";break;case"i":U[v]="i"}y[S]=new RegExp(L,U.join(""))}else if(b===BSON.BSON_DATA_REGEXP&&!0===l){for(v=t;0!==e[v]&&v<e.length;)v++;if(v>=e.length)throw new Error("Bad BSON Document: illegal CString");for(L=e.toString("utf8",t,v),v=t=v+1;0!==e[v]&&v<e.length;)v++;if(v>=e.length)throw new Error("Bad BSON Document: illegal CString");j=e.toString("utf8",t,v),t=v+1,y[S]=new BSONRegExp(L,j)}else if(b===BSON.BSON_DATA_SYMBOL){if((w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");y[S]=new Symbol(e.toString("utf8",t,t+w-1)),t+=w}else if(b===BSON.BSON_DATA_TIMESTAMP)_=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,y[S]=new Timestamp(_,T);else if(b===BSON.BSON_DATA_MIN_KEY)y[S]=new MinKey;else if(b===BSON.BSON_DATA_MAX_KEY)y[S]=new MaxKey;else if(b===BSON.BSON_DATA_CODE){if((w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");var z=e.toString("utf8",t,t+w-1);if(o)if(s){var q=i?a(z):z;y[S]=isolateEvalWithHash(functionCache,q,z,y)}else y[S]=isolateEval(z);else y[S]=new Code(z);t+=w}else if(b===BSON.BSON_DATA_CODE_W_SCOPE){var $=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if($<13)throw new Error("code_w_scope total size shorter minimum expected length");if((w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");z=e.toString("utf8",t,t+w-1),C=t+=w,E=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;var F=deserializeObject(e,C,n,!1);if(t+=E,$<8+E+w)throw new Error("code_w_scope total size is to short, truncating scope");if($>8+E+w)throw new Error("code_w_scope total size is to long, clips outer document");o?(s?(q=i?a(z):z,y[S]=isolateEvalWithHash(functionCache,q,z,y)):y[S]=isolateEval(z),y[S].scope=F):y[S]=new Code(z,F)}else{if(b!==BSON.BSON_DATA_DBPOINTER)throw new Error("Detected unknown BSON type "+b.toString(16)+' for fieldname "'+S+'", are you using the latest BSON parser');if((w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");var W=e.toString("utf8",t,t+w-1);t+=w;var H=new Buffer(12);e.copy(H,0,t,t+12),O=new ObjectID(H),t+=12;var V=W.split("."),Y=V.shift(),K=V.join(".");y[S]=new DBRef(K,O,Y)}}if(m!==t-d){if(r)throw new Error("corrupt array bson");throw new Error("corrupt object bson")}return null!=y.$id&&(y=new DBRef(y.$ref,y.$id,y.$db)),y},isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return null==functionCache[hash]&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},BSON={},functionCache=BSON.functionCache={};BSON.BSON_DATA_NUMBER=1,BSON.BSON_DATA_STRING=2,BSON.BSON_DATA_OBJECT=3,BSON.BSON_DATA_ARRAY=4,BSON.BSON_DATA_BINARY=5,BSON.BSON_DATA_UNDEFINED=6,BSON.BSON_DATA_OID=7,BSON.BSON_DATA_BOOLEAN=8,BSON.BSON_DATA_DATE=9,BSON.BSON_DATA_NULL=10,BSON.BSON_DATA_REGEXP=11,BSON.BSON_DATA_DBPOINTER=12,BSON.BSON_DATA_CODE=13,BSON.BSON_DATA_SYMBOL=14,BSON.BSON_DATA_CODE_W_SCOPE=15,BSON.BSON_DATA_INT=16,BSON.BSON_DATA_TIMESTAMP=17,BSON.BSON_DATA_LONG=18,BSON.BSON_DATA_DECIMAL128=19,BSON.BSON_DATA_MIN_KEY=255,BSON.BSON_DATA_MAX_KEY=127,BSON.BSON_BINARY_SUBTYPE_DEFAULT=0,BSON.BSON_BINARY_SUBTYPE_FUNCTION=1,BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON.BSON_BINARY_SUBTYPE_UUID=3,BSON.BSON_BINARY_SUBTYPE_MD5=4,BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128,BSON.BSON_INT32_MAX=2147483647,BSON.BSON_INT32_MIN=-2147483648,BSON.BSON_INT64_MAX=Math.pow(2,63)-1,BSON.BSON_INT64_MIN=-Math.pow(2,63),BSON.JS_INT_MAX=9007199254740992,BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);module.exports=deserialize},function(e,t,n){"use strict";var r=n(180).writeIEEE754,o=n(71).Long,s=n(88).MinKey,i=n(149),a=n(89).Binary,c=n(160).normalizedFunctionString,u=/\x00/,l=["$db","$ref","$id","$clusterTime"],p=function(e){return"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)},f=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},h=function(e,t,n,r,o){e[r++]=D.BSON_DATA_STRING,e[(r=r+(o?e.write(t,r,"ascii"):e.write(t,r,"utf8"))+1)-1]=0;var s=e.write(n,r+4,"utf8");return e[r+3]=s+1>>24&255,e[r+2]=s+1>>16&255,e[r+1]=s+1>>8&255,e[r]=s+1&255,r=r+4+s,e[r++]=0,r},d=function(e,t,n,s,i){if(Math.floor(n)===n&&n>=D.JS_INT_MIN&&n<=D.JS_INT_MAX)if(n>=D.BSON_INT32_MIN&&n<=D.BSON_INT32_MAX){e[s++]=D.BSON_DATA_INT;var a=i?e.write(t,s,"ascii"):e.write(t,s,"utf8");s+=a,e[s++]=0,e[s++]=255&n,e[s++]=n>>8&255,e[s++]=n>>16&255,e[s++]=n>>24&255}else if(n>=D.JS_INT_MIN&&n<=D.JS_INT_MAX)e[s++]=D.BSON_DATA_NUMBER,s+=a=i?e.write(t,s,"ascii"):e.write(t,s,"utf8"),e[s++]=0,r(e,n,s,"little",52,8),s+=8;else{e[s++]=D.BSON_DATA_LONG,s+=a=i?e.write(t,s,"ascii"):e.write(t,s,"utf8"),e[s++]=0;var c=o.fromNumber(n),u=c.getLowBits(),l=c.getHighBits();e[s++]=255&u,e[s++]=u>>8&255,e[s++]=u>>16&255,e[s++]=u>>24&255,e[s++]=255&l,e[s++]=l>>8&255,e[s++]=l>>16&255,e[s++]=l>>24&255}else e[s++]=D.BSON_DATA_NUMBER,s+=a=i?e.write(t,s,"ascii"):e.write(t,s,"utf8"),e[s++]=0,r(e,n,s,"little",52,8),s+=8;return s},m=function(e,t,n,r,o){return e[r++]=D.BSON_DATA_NULL,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,r},y=function(e,t,n,r,o){return e[r++]=D.BSON_DATA_BOOLEAN,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,e[r++]=n?1:0,r},g=function(e,t,n,r,s){e[r++]=D.BSON_DATA_DATE,r+=s?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var i=o.fromNumber(n.getTime()),a=i.getLowBits(),c=i.getHighBits();return e[r++]=255&a,e[r++]=a>>8&255,e[r++]=a>>16&255,e[r++]=a>>24&255,e[r++]=255&c,e[r++]=c>>8&255,e[r++]=c>>16&255,e[r++]=c>>24&255,r},b=function(e,t,n,r,o){if(e[r++]=D.BSON_DATA_REGEXP,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,n.source&&null!=n.source.match(u))throw Error("value "+n.source+" must not contain null bytes");return r+=e.write(n.source,r,"utf8"),e[r++]=0,n.global&&(e[r++]=115),n.ignoreCase&&(e[r++]=105),n.multiline&&(e[r++]=109),e[r++]=0,r},v=function(e,t,n,r,o){if(e[r++]=D.BSON_DATA_REGEXP,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,null!=n.pattern.match(u))throw Error("pattern "+n.pattern+" must not contain null bytes");return r+=e.write(n.pattern,r,"utf8"),e[r++]=0,r+=e.write(n.options.split("").sort().join(""),r,"utf8"),e[r++]=0,r},S=function(e,t,n,r,o){return e[r++]=null===n?D.BSON_DATA_NULL:n instanceof s?D.BSON_DATA_MIN_KEY:D.BSON_DATA_MAX_KEY,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,r},w=function(e,t,n,r,o){if(e[r++]=D.BSON_DATA_OID,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,"string"==typeof n.id)e.write(n.id,r,"binary");else{if(!n.id||!n.id.copy)throw new Error("object ["+JSON.stringify(n)+"] is not a valid ObjectId");n.id.copy(e,r,0,12)}return r+12},O=function(e,t,n,r,o){e[r++]=D.BSON_DATA_BINARY,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var s=n.length;return e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=D.BSON_BINARY_SUBTYPE_DEFAULT,n.copy(e,r,0,s),r+=s},_=function(e,t,n,r,o,s,i,a,c,u){for(var l=0;l<u.length;l++)if(u[l]===n)throw new Error("cyclic dependency detected");u.push(n),e[r++]=Array.isArray(n)?D.BSON_DATA_ARRAY:D.BSON_DATA_OBJECT,r+=c?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var p=M(e,n,o,r,s+1,i,a,u);return u.pop(),p},T=function(e,t,n,r,o){return e[r++]=D.BSON_DATA_DECIMAL128,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,n.bytes.copy(e,r,0,16),r+16},C=function(e,t,n,r,o){e[r++]="Long"===n._bsontype?D.BSON_DATA_LONG:D.BSON_DATA_TIMESTAMP,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var s=n.getLowBits(),i=n.getHighBits();return e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=255&i,e[r++]=i>>8&255,e[r++]=i>>16&255,e[r++]=i>>24&255,r},E=function(e,t,n,r,o){return e[r++]=D.BSON_DATA_INT,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,e[r++]=255&n,e[r++]=n>>8&255,e[r++]=n>>16&255,e[r++]=n>>24&255,r},N=function(e,t,n,o,s){return e[o++]=D.BSON_DATA_NUMBER,o+=s?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0,r(e,n,o,"little",52,8),o+=8},I=function(e,t,n,r,o,s,i){e[r++]=D.BSON_DATA_CODE,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var a=c(n),u=e.write(a,r+4,"utf8")+1;return e[r]=255&u,e[r+1]=u>>8&255,e[r+2]=u>>16&255,e[r+3]=u>>24&255,r=r+4+u-1,e[r++]=0,r},x=function(e,t,n,r,o,s,i,a,c){if(n.scope&&"object"==typeof n.scope){e[r++]=D.BSON_DATA_CODE_W_SCOPE;var u=c?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=u,e[r++]=0;var l=r,p="string"==typeof n.code?n.code:n.code.toString();r+=4;var f=e.write(p,r+4,"utf8")+1;e[r]=255&f,e[r+1]=f>>8&255,e[r+2]=f>>16&255,e[r+3]=f>>24&255,e[r+4+f-1]=0,r=r+f+4;var h=M(e,n.scope,o,r,s+1,i,a);r=h-1;var d=h-l;e[l++]=255&d,e[l++]=d>>8&255,e[l++]=d>>16&255,e[l++]=d>>24&255,e[r++]=0}else{e[r++]=D.BSON_DATA_CODE,r+=u=c?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,p=n.code.toString();var m=e.write(p,r+4,"utf8")+1;e[r]=255&m,e[r+1]=m>>8&255,e[r+2]=m>>16&255,e[r+3]=m>>24&255,r=r+4+m-1,e[r++]=0}return r},A=function(e,t,n,r,o){e[r++]=D.BSON_DATA_BINARY,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var s=n.value(!0),i=n.position;return n.sub_type===a.SUBTYPE_BYTE_ARRAY&&(i+=4),e[r++]=255&i,e[r++]=i>>8&255,e[r++]=i>>16&255,e[r++]=i>>24&255,e[r++]=n.sub_type,n.sub_type===a.SUBTYPE_BYTE_ARRAY&&(i-=4,e[r++]=255&i,e[r++]=i>>8&255,e[r++]=i>>16&255,e[r++]=i>>24&255),s.copy(e,r,0,n.position),r+=n.position},k=function(e,t,n,r,o){e[r++]=D.BSON_DATA_SYMBOL,r+=o?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var s=e.write(n.value,r+4,"utf8")+1;return e[r]=255&s,e[r+1]=s>>8&255,e[r+2]=s>>16&255,e[r+3]=s>>24&255,r=r+4+s-1,e[r++]=0,r},B=function(e,t,n,r,o,s,i){e[r++]=D.BSON_DATA_OBJECT,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var a,c=r,u=(a=null!=n.db?M(e,{$ref:n.namespace,$id:n.oid,$db:n.db},!1,r,o+1,s):M(e,{$ref:n.namespace,$id:n.oid},!1,r,o+1,s))-c;return e[c++]=255&u,e[c++]=u>>8&255,e[c++]=u>>16&255,e[c++]=u>>24&255,a},M=function(e,t,n,r,o,s,a,c){r=r||0,(c=c||[]).push(t);var M=r+4;if(Array.isArray(t))for(var D=0;D<t.length;D++){var R=""+D,P=t[D];if(P&&P.toBSON){if("function"!=typeof P.toBSON)throw new Error("toBSON is not a function");P=P.toBSON()}var L=typeof P;"string"===L?M=h(e,R,P,M,!0):"number"===L?M=d(e,R,P,M,!0):"boolean"===L?M=y(e,R,P,M,!0):P instanceof Date||p(P)?M=g(e,R,P,M,!0):void 0===P?M=m(e,R,0,M,!0):null===P?M=m(e,R,0,M,!0):"ObjectID"===P._bsontype?M=w(e,R,P,M,!0):Buffer.isBuffer(P)?M=O(e,R,P,M,!0):P instanceof RegExp||f(P)?M=b(e,R,P,M,!0):"object"===L&&null==P._bsontype?M=_(e,R,P,M,n,o,s,a,!0,c):"object"===L&&"Decimal128"===P._bsontype?M=T(e,R,P,M,!0):"Long"===P._bsontype||"Timestamp"===P._bsontype?M=C(e,R,P,M,!0):"Double"===P._bsontype?M=N(e,R,P,M,!0):"function"==typeof P&&s?M=I(e,R,P,M,0,0,s):"Code"===P._bsontype?M=x(e,R,P,M,n,o,s,a,!0):"Binary"===P._bsontype?M=A(e,R,P,M,!0):"Symbol"===P._bsontype?M=k(e,R,P,M,!0):"DBRef"===P._bsontype?M=B(e,R,P,M,o,s,!0):"BSONRegExp"===P._bsontype?M=v(e,R,P,M,!0):"Int32"===P._bsontype?M=E(e,R,P,M,!0):"MinKey"!==P._bsontype&&"MaxKey"!==P._bsontype||(M=S(e,R,P,M,!0))}else if(t instanceof i)for(var j=t.entries(),U=!1;!U;){var z=j.next();if(!(U=z.done)){if(R=z.value[0],L=typeof(P=z.value[1]),"string"==typeof R&&-1===l.indexOf(R)){if(null!=R.match(u))throw Error("key "+R+" must not contain null bytes");if(n){if("$"===R[0])throw Error("key "+R+" must not start with '$'");if(~R.indexOf("."))throw Error("key "+R+" must not contain '.'")}}"string"===L?M=h(e,R,P,M):"number"===L?M=d(e,R,P,M):"boolean"===L?M=y(e,R,P,M):P instanceof Date||p(P)?M=g(e,R,P,M):null===P||void 0===P&&!1===a?M=m(e,R,0,M):"ObjectID"===P._bsontype?M=w(e,R,P,M):Buffer.isBuffer(P)?M=O(e,R,P,M):P instanceof RegExp||f(P)?M=b(e,R,P,M):"object"===L&&null==P._bsontype?M=_(e,R,P,M,n,o,s,a,!1,c):"object"===L&&"Decimal128"===P._bsontype?M=T(e,R,P,M):"Long"===P._bsontype||"Timestamp"===P._bsontype?M=C(e,R,P,M):"Double"===P._bsontype?M=N(e,R,P,M):"Code"===P._bsontype?M=x(e,R,P,M,n,o,s,a):"function"==typeof P&&s?M=I(e,R,P,M,0,0,s):"Binary"===P._bsontype?M=A(e,R,P,M):"Symbol"===P._bsontype?M=k(e,R,P,M):"DBRef"===P._bsontype?M=B(e,R,P,M,o,s):"BSONRegExp"===P._bsontype?M=v(e,R,P,M):"Int32"===P._bsontype?M=E(e,R,P,M):"MinKey"!==P._bsontype&&"MaxKey"!==P._bsontype||(M=S(e,R,P,M))}}else{if(t.toBSON){if("function"!=typeof t.toBSON)throw new Error("toBSON is not a function");if(null!=(t=t.toBSON())&&"object"!=typeof t)throw new Error("toBSON function did not return an object")}for(R in t){if((P=t[R])&&P.toBSON){if("function"!=typeof P.toBSON)throw new Error("toBSON is not a function");P=P.toBSON()}if(L=typeof P,"string"==typeof R&&-1===l.indexOf(R)){if(null!=R.match(u))throw Error("key "+R+" must not contain null bytes");if(n){if("$"===R[0])throw Error("key "+R+" must not start with '$'");if(~R.indexOf("."))throw Error("key "+R+" must not contain '.'")}}"string"===L?M=h(e,R,P,M):"number"===L?M=d(e,R,P,M):"boolean"===L?M=y(e,R,P,M):P instanceof Date||p(P)?M=g(e,R,P,M):void 0===P?!1===a&&(M=m(e,R,0,M)):null===P?M=m(e,R,0,M):"ObjectID"===P._bsontype?M=w(e,R,P,M):Buffer.isBuffer(P)?M=O(e,R,P,M):P instanceof RegExp||f(P)?M=b(e,R,P,M):"object"===L&&null==P._bsontype?M=_(e,R,P,M,n,o,s,a,!1,c):"object"===L&&"Decimal128"===P._bsontype?M=T(e,R,P,M):"Long"===P._bsontype||"Timestamp"===P._bsontype?M=C(e,R,P,M):"Double"===P._bsontype?M=N(e,R,P,M):"Code"===P._bsontype?M=x(e,R,P,M,n,o,s,a):"function"==typeof P&&s?M=I(e,R,P,M,0,0,s):"Binary"===P._bsontype?M=A(e,R,P,M):"Symbol"===P._bsontype?M=k(e,R,P,M):"DBRef"===P._bsontype?M=B(e,R,P,M,o,s):"BSONRegExp"===P._bsontype?M=v(e,R,P,M):"Int32"===P._bsontype?M=E(e,R,P,M):"MinKey"!==P._bsontype&&"MaxKey"!==P._bsontype||(M=S(e,R,P,M))}}c.pop(),e[M++]=0;var q=M-r;return e[r++]=255&q,e[r++]=q>>8&255,e[r++]=q>>16&255,e[r++]=q>>24&255,M},D={BSON_DATA_NUMBER:1,BSON_DATA_STRING:2,BSON_DATA_OBJECT:3,BSON_DATA_ARRAY:4,BSON_DATA_BINARY:5,BSON_DATA_UNDEFINED:6,BSON_DATA_OID:7,BSON_DATA_BOOLEAN:8,BSON_DATA_DATE:9,BSON_DATA_NULL:10,BSON_DATA_REGEXP:11,BSON_DATA_CODE:13,BSON_DATA_SYMBOL:14,BSON_DATA_CODE_W_SCOPE:15,BSON_DATA_INT:16,BSON_DATA_TIMESTAMP:17,BSON_DATA_LONG:18,BSON_DATA_DECIMAL128:19,BSON_DATA_MIN_KEY:255,BSON_DATA_MAX_KEY:127,BSON_BINARY_SUBTYPE_DEFAULT:0,BSON_BINARY_SUBTYPE_FUNCTION:1,BSON_BINARY_SUBTYPE_BYTE_ARRAY:2,BSON_BINARY_SUBTYPE_UUID:3,BSON_BINARY_SUBTYPE_MD5:4,BSON_BINARY_SUBTYPE_USER_DEFINED:128,BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648};D.BSON_INT64_MAX=Math.pow(2,63)-1,D.BSON_INT64_MIN=-Math.pow(2,63),D.JS_INT_MAX=9007199254740992,D.JS_INT_MIN=-9007199254740992,e.exports=M},function(e,t){t.readIEEE754=function(e,t,n,r,o){var s,i,a="big"===n,c=8*o-r-1,u=(1<<c)-1,l=u>>1,p=-7,f=a?0:o-1,h=a?1:-1,d=e[t+f];for(f+=h,s=d&(1<<-p)-1,d>>=-p,p+=c;p>0;s=256*s+e[t+f],f+=h,p-=8);for(i=s&(1<<-p)-1,s>>=-p,p+=r;p>0;i=256*i+e[t+f],f+=h,p-=8);if(0===s)s=1-l;else{if(s===u)return i?NaN:1/0*(d?-1:1);i+=Math.pow(2,r),s-=l}return(d?-1:1)*i*Math.pow(2,s-r)},t.writeIEEE754=function(e,t,n,r,o,s){var i,a,c,u="big"===r,l=8*s-o-1,p=(1<<l)-1,f=p>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,d=u?s-1:0,m=u?-1:1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,i=p):(i=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-i))<1&&(i--,c*=2),(t+=i+f>=1?h/c:h*Math.pow(2,1-f))*c>=2&&(i++,c/=2),i+f>=p?(a=0,i=p):i+f>=1?(a=(t*c-1)*Math.pow(2,o),i+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,o),i=0));o>=8;e[n+d]=255&a,d+=m,a/=256,o-=8);for(i=i<<o|a,l+=o;l>0;e[n+d]=255&i,d+=m,i/=256,l-=8);e[n+d-m]|=128*y}},function(e,t,n){"use strict";var r=n(71).Long,o=n(98).Double,s=n(99).Timestamp,i=n(100).ObjectID,a=n(102).Symbol,c=n(101).BSONRegExp,u=n(103).Code,l=n(104),p=n(88).MinKey,f=n(105).MaxKey,h=n(106).DBRef,d=n(89).Binary,m=n(160).normalizedFunctionString,y=function(e){return"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)},g=function(e,t,n){var r=5;if(Array.isArray(e))for(var o=0;o<e.length;o++)r+=b(o.toString(),e[o],t,!0,n);else for(var s in e.toBSON&&(e=e.toBSON()),e)r+=b(s,e[s],t,!1,n);return r};function b(e,t,n,b,S){switch(t&&t.toBSON&&(t=t.toBSON()),typeof t){case"string":return 1+Buffer.byteLength(e,"utf8")+1+4+Buffer.byteLength(t,"utf8")+1;case"number":return Math.floor(t)===t&&t>=v.JS_INT_MIN&&t<=v.JS_INT_MAX&&t>=v.BSON_INT32_MIN&&t<=v.BSON_INT32_MAX?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+5:(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;case"undefined":return b||!S?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1:0;case"boolean":return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+2;case"object":if(null==t||t instanceof p||t instanceof f||"MinKey"===t._bsontype||"MaxKey"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1;if(t instanceof i||"ObjectID"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+13;if(t instanceof Date||y(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;if("undefined"!=typeof Buffer&&Buffer.isBuffer(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+6+t.length;if(t instanceof r||t instanceof o||t instanceof s||"Long"===t._bsontype||"Double"===t._bsontype||"Timestamp"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;if(t instanceof l||"Decimal128"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+17;if(t instanceof u||"Code"===t._bsontype)return null!=t.scope&&Object.keys(t.scope).length>0?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(t.code.toString(),"utf8")+1+g(t.scope,n,S):(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(t.code.toString(),"utf8")+1;if(t instanceof d||"Binary"===t._bsontype)return t.sub_type===d.SUBTYPE_BYTE_ARRAY?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1+4):(null!=e?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1);if(t instanceof a||"Symbol"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+Buffer.byteLength(t.value,"utf8")+4+1+1;if(t instanceof h||"DBRef"===t._bsontype){var w={$ref:t.namespace,$id:t.oid};return null!=t.db&&(w.$db=t.db),(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+g(w,n,S)}return t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:t instanceof c||"BSONRegExp"===t._bsontype?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.pattern,"utf8")+1+Buffer.byteLength(t.options,"utf8")+1:(null!=e?Buffer.byteLength(e,"utf8")+1:0)+g(t,n,S)+1;case"function":if(t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)||"[object RegExp]"===String.call(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;if(n&&null!=t.scope&&Object.keys(t.scope).length>0)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(m(t),"utf8")+1+g(t.scope,n,S);if(n)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(m(t),"utf8")+1}return 0}var v={BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648,JS_INT_MAX:9007199254740992,JS_INT_MIN:-9007199254740992};e.exports=g},function(e,t,n){"use strict";var r=n(33),o=n(92);e.exports=function(e,t){if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected `fromDir` and `moduleId` to be a string");e=r.resolve(e);var n=r.join(e,"noop.js");try{return o._resolveFilename(t,{id:n,filename:n,paths:o._nodeModulePaths(e)})}catch(e){return null}}},function(e,t){var n;t=e.exports=Y,n="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var r=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,s=t.re=[],i=t.src=[],a=0,c=a++;i[c]="0|[1-9]\\d*";var u=a++;i[u]="[0-9]+";var l=a++;i[l]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var p=a++;i[p]="("+i[c]+")\\.("+i[c]+")\\.("+i[c]+")";var f=a++;i[f]="("+i[u]+")\\.("+i[u]+")\\.("+i[u]+")";var h=a++;i[h]="(?:"+i[c]+"|"+i[l]+")";var d=a++;i[d]="(?:"+i[u]+"|"+i[l]+")";var m=a++;i[m]="(?:-("+i[h]+"(?:\\."+i[h]+")*))";var y=a++;i[y]="(?:-?("+i[d]+"(?:\\."+i[d]+")*))";var g=a++;i[g]="[0-9A-Za-z-]+";var b=a++;i[b]="(?:\\+("+i[g]+"(?:\\."+i[g]+")*))";var v=a++,S="v?"+i[p]+i[m]+"?"+i[b]+"?";i[v]="^"+S+"$";var w="[v=\\s]*"+i[f]+i[y]+"?"+i[b]+"?",O=a++;i[O]="^"+w+"$";var _=a++;i[_]="((?:<|>)?=?)";var T=a++;i[T]=i[u]+"|x|X|\\*";var C=a++;i[C]=i[c]+"|x|X|\\*";var E=a++;i[E]="[v=\\s]*("+i[C]+")(?:\\.("+i[C]+")(?:\\.("+i[C]+")(?:"+i[m]+")?"+i[b]+"?)?)?";var N=a++;i[N]="[v=\\s]*("+i[T]+")(?:\\.("+i[T]+")(?:\\.("+i[T]+")(?:"+i[y]+")?"+i[b]+"?)?)?";var I=a++;i[I]="^"+i[_]+"\\s*"+i[E]+"$";var x=a++;i[x]="^"+i[_]+"\\s*"+i[N]+"$";var A=a++;i[A]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var k=a++;i[k]="(?:~>?)";var B=a++;i[B]="(\\s*)"+i[k]+"\\s+",s[B]=new RegExp(i[B],"g");var M=a++;i[M]="^"+i[k]+i[E]+"$";var D=a++;i[D]="^"+i[k]+i[N]+"$";var R=a++;i[R]="(?:\\^)";var P=a++;i[P]="(\\s*)"+i[R]+"\\s+",s[P]=new RegExp(i[P],"g");var L=a++;i[L]="^"+i[R]+i[E]+"$";var j=a++;i[j]="^"+i[R]+i[N]+"$";var U=a++;i[U]="^"+i[_]+"\\s*("+w+")$|^$";var z=a++;i[z]="^"+i[_]+"\\s*("+S+")$|^$";var q=a++;i[q]="(\\s*)"+i[_]+"\\s*("+w+"|"+i[E]+")",s[q]=new RegExp(i[q],"g");var $=a++;i[$]="^\\s*("+i[E]+")\\s+-\\s+("+i[E]+")\\s*$";var F=a++;i[F]="^\\s*("+i[N]+")\\s+-\\s+("+i[N]+")\\s*$";var W=a++;i[W]="(<|>)?=?\\s*\\*";for(var H=0;H<a;H++)n(H,i[H]),s[H]||(s[H]=new RegExp(i[H]));function V(e,t){if(e instanceof Y)return e;if("string"!=typeof e)return null;if(e.length>r)return null;if(!(t?s[O]:s[v]).test(e))return null;try{return new Y(e,t)}catch(e){return null}}function Y(e,t){if(e instanceof Y){if(e.loose===t)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>r)throw new TypeError("version is longer than "+r+" characters");if(!(this instanceof Y))return new Y(e,t);n("SemVer",e,t),this.loose=t;var i=e.trim().match(t?s[O]:s[v]);if(!i)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<o)return t}return e}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}t.parse=V,t.valid=function(e,t){var n=V(e,t);return n?n.version:null},t.clean=function(e,t){var n=V(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null},t.SemVer=Y,Y.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Y.prototype.toString=function(){return this.version},Y.prototype.compare=function(e){return n("SemVer.compare",this.version,this.loose,e),e instanceof Y||(e=new Y(e,this.loose)),this.compareMain(e)||this.comparePre(e)},Y.prototype.compareMain=function(e){return e instanceof Y||(e=new Y(e,this.loose)),G(this.major,e.major)||G(this.minor,e.minor)||G(this.patch,e.patch)},Y.prototype.comparePre=function(e){if(e instanceof Y||(e=new Y(e,this.loose)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],o=e.prerelease[t];if(n("prerelease compare",t,r,o),void 0===r&&void 0===o)return 0;if(void 0===o)return 1;if(void 0===r)return-1;if(r!==o)return G(r,o)}while(++t)},Y.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);-1===n&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,n,r){"string"==typeof n&&(r=n,n=void 0);try{return new Y(e,n).inc(t,r).version}catch(e){return null}},t.diff=function(e,t){if(Q(e,t))return null;var n=V(e),r=V(t);if(n.prerelease.length||r.prerelease.length){for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==r[o])return"pre"+o;return"prerelease"}for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==r[o])return o},t.compareIdentifiers=G;var K=/^[0-9]+$/;function G(e,t){var n=K.test(e),r=K.test(t);return n&&r&&(e=+e,t=+t),n&&!r?-1:r&&!n?1:e<t?-1:e>t?1:0}function J(e,t,n){return new Y(e,n).compare(new Y(t,n))}function Z(e,t,n){return J(e,t,n)>0}function X(e,t,n){return J(e,t,n)<0}function Q(e,t,n){return 0===J(e,t,n)}function ee(e,t,n){return 0!==J(e,t,n)}function te(e,t,n){return J(e,t,n)>=0}function ne(e,t,n){return J(e,t,n)<=0}function re(e,t,n,r){var o;switch(t){case"===":"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),o=e===n;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),o=e!==n;break;case"":case"=":case"==":o=Q(e,n,r);break;case"!=":o=ee(e,n,r);break;case">":o=Z(e,n,r);break;case">=":o=te(e,n,r);break;case"<":o=X(e,n,r);break;case"<=":o=ne(e,n,r);break;default:throw new TypeError("Invalid operator: "+t)}return o}function oe(e,t){if(e instanceof oe){if(e.loose===t)return e;e=e.value}if(!(this instanceof oe))return new oe(e,t);n("comparator",e,t),this.loose=t,this.parse(e),this.semver===se?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}t.rcompareIdentifiers=function(e,t){return G(t,e)},t.major=function(e,t){return new Y(e,t).major},t.minor=function(e,t){return new Y(e,t).minor},t.patch=function(e,t){return new Y(e,t).patch},t.compare=J,t.compareLoose=function(e,t){return J(e,t,!0)},t.rcompare=function(e,t,n){return J(t,e,n)},t.sort=function(e,n){return e.sort(function(e,r){return t.compare(e,r,n)})},t.rsort=function(e,n){return e.sort(function(e,r){return t.rcompare(e,r,n)})},t.gt=Z,t.lt=X,t.eq=Q,t.neq=ee,t.gte=te,t.lte=ne,t.cmp=re,t.Comparator=oe;var se={};function ie(e,t){if(e instanceof ie)return e.loose===t?e:new ie(e.raw,t);if(e instanceof oe)return new ie(e.value,t);if(!(this instanceof ie))return new ie(e,t);if(this.loose=t,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function ae(e){return!e||"x"===e.toLowerCase()||"*"===e}function ce(e,t,n,r,o,s,i,a,c,u,l,p,f){return((t=ae(n)?"":ae(r)?">="+n+".0.0":ae(o)?">="+n+"."+r+".0":">="+t)+" "+(a=ae(c)?"":ae(u)?"<"+(+c+1)+".0.0":ae(l)?"<"+c+"."+(+u+1)+".0":p?"<="+c+"."+u+"."+l+"-"+p:"<="+a)).trim()}function ue(e,t){for(var r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length){for(r=0;r<e.length;r++)if(n(e[r].semver),e[r].semver!==se&&e[r].semver.prerelease.length>0){var o=e[r].semver;if(o.major===t.major&&o.minor===t.minor&&o.patch===t.patch)return!0}return!1}return!0}function le(e,t,n){try{t=new ie(t,n)}catch(e){return!1}return t.test(e)}function pe(e,t,n,r){var o,s,i,a,c;switch(e=new Y(e,r),t=new ie(t,r),n){case">":o=Z,s=ne,i=X,a=">",c=">=";break;case"<":o=X,s=te,i=Z,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(le(e,t,r))return!1;for(var u=0;u<t.set.length;++u){var l=null,p=null;if(t.set[u].forEach(function(e){e.semver===se&&(e=new oe(">=0.0.0")),l=l||e,p=p||e,o(e.semver,l.semver,r)?l=e:i(e.semver,p.semver,r)&&(p=e)}),l.operator===a||l.operator===c)return!1;if((!p.operator||p.operator===a)&&s(e,p.semver))return!1;if(p.operator===c&&i(e,p.semver))return!1}return!0}oe.prototype.parse=function(e){var t=this.loose?s[U]:s[z],n=e.match(t);if(!n)throw new TypeError("Invalid comparator: "+e);this.operator=n[1],"="===this.operator&&(this.operator=""),n[2]?this.semver=new Y(n[2],this.loose):this.semver=se},oe.prototype.toString=function(){return this.value},oe.prototype.test=function(e){return n("Comparator.test",e,this.loose),this.semver===se||("string"==typeof e&&(e=new Y(e,this.loose)),re(e,this.operator,this.semver,this.loose))},oe.prototype.intersects=function(e,t){if(!(e instanceof oe))throw new TypeError("a Comparator is required");var n;if(""===this.operator)return n=new ie(e.value,t),le(this.value,n,t);if(""===e.operator)return n=new ie(this.value,t),le(e.semver,n,t);var r=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),o=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),s=this.semver.version===e.semver.version,i=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),a=re(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),c=re(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return r||o||s&&i||a||c},t.Range=ie,ie.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},ie.prototype.toString=function(){return this.range},ie.prototype.parseRange=function(e){var t=this.loose;e=e.trim(),n("range",e,t);var r=t?s[F]:s[$];e=e.replace(r,ce),n("hyphen replace",e),e=e.replace(s[q],"$1$2$3"),n("comparator trim",e,s[q]),e=(e=(e=e.replace(s[B],"$1~")).replace(s[P],"$1^")).split(/\s+/).join(" ");var o=t?s[U]:s[z],i=e.split(" ").map(function(e){return function(e,t){return n("comp",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){n("caret",e,t);var r=t?s[j]:s[L];return e.replace(r,function(t,r,o,s,i){var a;return n("caret",e,t,r,o,s,i),ae(r)?a="":ae(o)?a=">="+r+".0.0 <"+(+r+1)+".0.0":ae(s)?a="0"===r?">="+r+"."+o+".0 <"+r+"."+(+o+1)+".0":">="+r+"."+o+".0 <"+(+r+1)+".0.0":i?(n("replaceCaret pr",i),"-"!==i.charAt(0)&&(i="-"+i),a="0"===r?"0"===o?">="+r+"."+o+"."+s+i+" <"+r+"."+o+"."+(+s+1):">="+r+"."+o+"."+s+i+" <"+r+"."+(+o+1)+".0":">="+r+"."+o+"."+s+i+" <"+(+r+1)+".0.0"):(n("no pr"),a="0"===r?"0"===o?">="+r+"."+o+"."+s+" <"+r+"."+o+"."+(+s+1):">="+r+"."+o+"."+s+" <"+r+"."+(+o+1)+".0":">="+r+"."+o+"."+s+" <"+(+r+1)+".0.0"),n("caret return",a),a})}(e,t)}).join(" ")}(e,t),n("caret",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){var r=t?s[D]:s[M];return e.replace(r,function(t,r,o,s,i){var a;return n("tilde",e,t,r,o,s,i),ae(r)?a="":ae(o)?a=">="+r+".0.0 <"+(+r+1)+".0.0":ae(s)?a=">="+r+"."+o+".0 <"+r+"."+(+o+1)+".0":i?(n("replaceTilde pr",i),"-"!==i.charAt(0)&&(i="-"+i),a=">="+r+"."+o+"."+s+i+" <"+r+"."+(+o+1)+".0"):a=">="+r+"."+o+"."+s+" <"+r+"."+(+o+1)+".0",n("tilde return",a),a})}(e,t)}).join(" ")}(e,t),n("tildes",e),e=function(e,t){return n("replaceXRanges",e,t),e.split(/\s+/).map(function(e){return function(e,t){e=e.trim();var r=t?s[x]:s[I];return e.replace(r,function(t,r,o,s,i,a){n("xRange",e,t,r,o,s,i,a);var c=ae(o),u=c||ae(s),l=u||ae(i),p=l;return"="===r&&p&&(r=""),c?t=">"===r||"<"===r?"<0.0.0":"*":r&&p?(u&&(s=0),l&&(i=0),">"===r?(r=">=",u?(o=+o+1,s=0,i=0):l&&(s=+s+1,i=0)):"<="===r&&(r="<",u?o=+o+1:s=+s+1),t=r+o+"."+s+"."+i):u?t=">="+o+".0.0 <"+(+o+1)+".0.0":l&&(t=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0"),n("xRange return",t),t})}(e,t)}).join(" ")}(e,t),n("xrange",e),e=function(e,t){return n("replaceStars",e,t),e.trim().replace(s[W],"")}(e,t),n("stars",e),e}(e,t)}).join(" ").split(/\s+/);return this.loose&&(i=i.filter(function(e){return!!e.match(o)})),i=i.map(function(e){return new oe(e,t)})},ie.prototype.intersects=function(e,t){if(!(e instanceof ie))throw new TypeError("a Range is required");return this.set.some(function(n){return n.every(function(n){return e.set.some(function(e){return e.every(function(e){return n.intersects(e,t)})})})})},t.toComparators=function(e,t){return new ie(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},ie.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new Y(e,this.loose));for(var t=0;t<this.set.length;t++)if(ue(this.set[t],e))return!0;return!1},t.satisfies=le,t.maxSatisfying=function(e,t,n){var r=null,o=null;try{var s=new ie(t,n)}catch(e){return null}return e.forEach(function(e){s.test(e)&&(r&&-1!==o.compare(e)||(o=new Y(r=e,n)))}),r},t.minSatisfying=function(e,t,n){var r=null,o=null;try{var s=new ie(t,n)}catch(e){return null}return e.forEach(function(e){s.test(e)&&(r&&1!==o.compare(e)||(o=new Y(r=e,n)))}),r},t.validRange=function(e,t){try{return new ie(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,n){return pe(e,t,"<",n)},t.gtr=function(e,t,n){return pe(e,t,">",n)},t.outside=pe,t.prerelease=function(e,t){var n=V(e,t);return n&&n.prerelease.length?n.prerelease:null},t.intersects=function(e,t,n){return e=new ie(e,n),t=new ie(t,n),e.intersects(t)},t.coerce=function(e){if(e instanceof Y)return e;if("string"!=typeof e)return null;var t=e.match(s[A]);return null==t?null:V((t[1]||"0")+"."+(t[2]||"0")+"."+(t[3]||"0"))}},function(e,t,n){"use strict";const r=n(1).inherits,o=n(9).EventEmitter,s=n(161),i=n(11).MongoError,a=n(11).MongoNetworkError,c=n(11).MongoWriteConcernError,u=n(56),l=n(1).format,p=n(24).Query,f=n(185),h=n(54).MESSAGE_HEADER_SIZE,d=n(54).opcodes,m=n(107).compress,y=n(107).compressorIDs,g=n(107).uncompressibleCommands,b=n(20).resolveClusterTime,v=n(187),S=n(108).defaultAuthProviders,w=n(53).Buffer;var O="disconnected",_="connecting",T="connected",C="destroying",E="destroyed",N=0;var I=function(e,t){if(o.call(this),this.topology=e,this.options=Object.assign({host:"localhost",port:27017,size:5,minSize:0,connectionTimeout:3e4,socketTimeout:36e4,keepAlive:!0,keepAliveInitialDelay:3e5,noDelay:!0,ssl:!1,checkServerIdentity:!0,ca:null,crl:null,cert:null,key:null,passPhrase:null,rejectUnauthorized:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,reconnect:!0,reconnectInterval:1e3,reconnectTries:30,domainsEnabled:!1},t),this.id=N++,this.retriesLeft=this.options.reconnectTries,this.reconnectId=null,!t.bson||t.bson&&("function"!=typeof t.bson.serialize||"function"!=typeof t.bson.deserialize))throw new Error("must pass in valid bson parser");this.logger=u("Pool",t),this.state=O,this.availableConnections=[],this.inUseConnections=[],this.connectingConnections=[],this.executing=!1,this.queue=[],this.authProviders=t.authProviders||S(t.bson),this.reconnectConnection=null,this.authenticating=!1,this.loggingout=!1,this.nonAuthenticatedConnections=[],this.authenticatingTimestamp=null,this.numberOfConsecutiveTimeouts=0,this.connectionIndex=0};function x(e,t){var n={disconnected:[_,C,O],connecting:[_,C,T,O],connected:[T,O,C],destroying:[C,E],destroyed:[E]}[e.state];n&&-1!==n.indexOf(t)?(e.emit("stateChanged",e.state,t),e.state=t):e.logger.error(l("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}function A(e,t,n,r){if(void 0===t[0])return r(null);var o=t[0],s=t[1];if(!e.authProviders[o])throw new i(l("authMechanism %s not supported",o));var a=e.authProviders[o];a.auth.apply(a,[k(e),[n],s].concat(t.slice(2)).concat([r]))}function k(e){return function(t,n,r){if(e.state===E||e.state===C)return r(new i("pool destroyed"));t.workItems.push({cb:r,command:!0,requestId:n.requestId}),t.write(n.toBin())}}function B(e,t,n){!function e(t,n,r,o){if(0===r.length)return o();t.authProviders[r.pop()].reauthenticate(k(t),[n],function(s){if(s)return o(s);e(t,n,r,o)})}(e,t,Object.keys(e.authProviders),n)}function M(e,t){return function(n){if(this._connectionFailHandled)return;for(this._connectionFailHandled=!0,this.destroy(),$(e,this);this.workItems.length>0;){var r=this.workItems.shift();r.cb&&r.cb(n)}if("timeout"===t&&(e.numberOfConsecutiveTimeouts=e.numberOfConsecutiveTimeouts+1,e.numberOfConsecutiveTimeouts>e.options.reconnectTries))return e.numberOfConsecutiveTimeouts=0,e.destroy(!0),e.emit("close",e);0===e.socketCount()&&(e.state!==E&&e.state!==C&&x(e,O),t="error"===t?"close":t,e.emit(t,n)),!e.reconnectId&&e.options.reconnect&&(e.reconnectId=setTimeout(D(e),e.options.reconnectInterval)),e.availableConnections.length+e.connectingConnections.length+e.inUseConnections.length<e.minSize&&W(e)}}function D(e){return function(){function t(e){return function(){this._connectionFailHandled||(this._connectionFailHandled=!0,this.destroy(),e.retriesLeft=e.retriesLeft-1,e.retriesLeft<=0?(e.destroy(),e.emit("reconnectFailed",new a(l("failed to reconnect after %s attempts with interval %s ms",e.options.reconnectTries,e.options.reconnectInterval)))):e.reconnectId=setTimeout(D(e),e.options.reconnectInterval))}}e.emit("attemptReconnect",e),e.state!==E&&e.state!==C&&(e.isConnected()?e.reconnectId=null:(e.reconnectConnection=new s(P(e),e.options),e.reconnectConnection.on("close",t(e)),e.reconnectConnection.on("error",t(e)),e.reconnectConnection.on("timeout",t(e)),e.reconnectConnection.on("parseError",t(e)),e.reconnectConnection.on("connect",function(e){return function(){var t=this;if(e.state===E||e.state===C)return t.destroy();F.forEach(function(e){t.removeAllListeners(e)}),e.reconnectId=null,t.on("error",M(e,"error")),t.on("close",M(e,"close")),t.on("timeout",M(e,"timeout")),t.on("parseError",M(e,"parseError")),B(e,this,function(){e.retriesLeft=e.options.reconnectTries,e.availableConnections.push(t),e.reconnectConnection=null,e.emit("reconnect",e),V(e)()})}}(e)),e.reconnectConnection.connect()))}}function R(e,t,n){var r=t.indexOf(e);-1!==r&&(t.splice(r,1),n.push(e))}function P(e){return function(t,n){for(var r=null,o=0;o<n.workItems.length;o++)n.workItems[o].requestId===t.responseTo&&(r=n.workItems[o],n.workItems.splice(o,1));function s(e,t,n,r){if(!e.options.domainsEnabled)return process.nextTick(function(){return t(n,r)});t(n,r)}e.numberOfConsecutiveTimeouts=0,r&&r.socketTimeout&&n.resetSocketTimeout(),e.logger.isDebug()&&e.logger.debug(l("message [%s] received from %s:%s",t.raw.toString("hex"),e.options.host,e.options.port)),function(e,t,n){var r=e.nonAuthenticatedConnections.slice(0),o=e.nonAuthenticatedConnections;if(e.nonAuthenticatedConnections=[],1===t.workItems.length&&(!0===t.workItems[0].authenticating||"number"==typeof t.workItems[0].authenticatingTimestamp&&t.workItems[0].authenticatingTimestamp!==e.authenticatingTimestamp)&&r.push(t),0===r.length)return R(t,e.inUseConnections,e.availableConnections),n();for(var s=r.length,i=0;i<s;i++)B(e,r[i],function(){0==(s-=1)&&(e.availableConnections=e.availableConnections.concat(o),R(t,e.inUseConnections,e.availableConnections),n())})}(e,n,function(){if(e.executing||process.nextTick(function(){V(e)()}),r&&!r.immediateRelease){try{t.parse(r)}catch(t){return s(e,r.cb,new i(t))}if(t.documents[0]){if(t.documents[0].$clusterTime){const n=t.documents[0].$clusterTime;e.topology.clusterTime=n,null!=r.session&&b(r.session,n)}t.documents[0].operationTime&&r.session&&r.session.supports.causalConsistency&&r.session.advanceOperationTime(t.documents[0].operationTime)}if(r.command&&t.documents[0]){const n=t.documents[0];if(0===n.ok||n.$err||n.errmsg||n.code)return s(e,r.cb,new i(n));if(n.writeConcernError){const t=1===n.ok?new c(n.writeConcernError,n):new c(n.writeConcernError);return s(e,r.cb,t)}}t.hashedName=n.hashedName,s(e,r.cb,null,new f(r.fullResult?t:t.documents[0],n,t))}})}}r(I,o),Object.defineProperty(I.prototype,"size",{enumerable:!0,get:function(){return this.options.size}}),Object.defineProperty(I.prototype,"minSize",{enumerable:!0,get:function(){return this.options.minSize}}),Object.defineProperty(I.prototype,"connectionTimeout",{enumerable:!0,get:function(){return this.options.connectionTimeout}}),Object.defineProperty(I.prototype,"socketTimeout",{enumerable:!0,get:function(){return this.options.socketTimeout}}),I.prototype.socketCount=function(){return this.availableConnections.length+this.inUseConnections.length},I.prototype.allConnections=function(){return this.availableConnections.concat(this.inUseConnections).concat(this.connectingConnections)},I.prototype.get=function(){return this.allConnections()[0]},I.prototype.isConnected=function(){if(this.state===E||this.state===C)return!1;for(var e=this.availableConnections.concat(this.inUseConnections),t=0;t<e.length;t++)if(e[t].isConnected())return!0;return!(0!==e.length||!this.authenticating)},I.prototype.isDestroyed=function(){return this.state===E||this.state===C},I.prototype.isDisconnected=function(){return this.state===O},I.prototype.connect=function(){if(this.state!==O)throw new i("connection in unlawful state "+this.state);var e=this;x(this,_);var t=Array.prototype.slice.call(arguments,0),n=new s(P(e),this.options);this.connectingConnections.push(n),n.once("connect",function(n){return e.state===E||e.state===C?e.destroy():e.options.inTopology?(x(e,T),R(n,e.connectingConnections,e.availableConnections),e.emit("connect",e)):void B(e,n,function(r){return e.state===E||e.state===C?e.destroy():r?(e.destroy(),e.emit("error",r)):void A(e,t,n,function(t){if(e.state===E||e.state===C)return e.destroy();if(t)return e.destroy(),e.emit("error",t);if(x(e,T),R(n,e.connectingConnections,e.availableConnections),e.minSize)for(let t=0;t<e.minSize;t++)W(e);e.emit("connect",e)})})}),n.once("error",M(this,"error")),n.once("close",M(this,"close")),n.once("timeout",M(this,"timeout")),n.once("parseError",M(this,"parseError"));try{n.connect()}catch(t){process.nextTick(function(){e.emit("error",t)})}},I.prototype.auth=function(e){var t=this,n=Array.prototype.slice.call(arguments,0),r=n.pop();if(null==t.authProviders[e]&&"default"!==e)throw new i(l("auth provider %s does not exist",e));this.authenticating=!0,this.authenticatingTimestamp=(new Date).getTime(),function e(t,n){if(!t.loggingout)return n();setTimeout(function(){e(t,n)},1)}(t,function(){!function(e,t,n){var o=e.allConnections();e.availableConnections=[],e.inUseConnections=[],e.connectingConnections=[];var s=o.length,i=null;if(0===s)return e.authenticating=!1,r(null);for(var a=0;a<o.length;a++)A(e,t,o[a],function(t,r){if(s-=1,t&&(i=t),0===s){if(e.authenticating=!1,e.availableConnections=e.availableConnections.concat(o),i)return e.logger.isError()&&e.logger.error(l("[%s] failed to authenticate against server %s:%s",e.id,e.options.host,e.options.port)),n(i,r);n(null,r)}})}(t,n,function(e,n){t.authenticating=!1,r(e,n)})})},I.prototype.logout=function(e,t){var n=this;if("string"!=typeof e)throw new i("logout method requires a db name as first argument");if("function"!=typeof t)throw new i("logout method requires a callback");this.loggingout=!0;for(var r=n.availableConnections.concat(n.inUseConnections),o=r.length,s=null,a=0;a<r.length;a++)k(n)(r[a],new p(this.options.bson,l("%s.$cmd",e),{logout:1},{numberToSkip:0,numberToReturn:1}),function(e){o-=1,e&&(s=e),0===o&&(n.loggingout=!1,t(s))})},I.prototype.unref=function(){this.availableConnections.concat(this.inUseConnections).concat(this.connectingConnections).forEach(function(e){e.unref()})};var L=["error","close","timeout","parseError","connect"];function j(e,t){t.forEach(function(e){for(var t=0;t<L.length;t++)e.removeAllListeners(L[t]);e.destroy()}),e.inUseConnections=[],e.availableConnections=[],e.nonAuthenticatedConnections=[],e.connectingConnections=[],x(e,E)}I.prototype.destroy=function(e){var t=this;if(this.state!==E&&t.state!==C){if(x(this,C),e){for(var n=t.availableConnections.concat(t.inUseConnections).concat(t.nonAuthenticatedConnections).concat(t.connectingConnections);t.queue.length>0;){var r=t.queue.shift();"function"==typeof r.cb&&r.cb(new i("Pool was force destroyed"))}return j(t,n)}this.reconnectId&&clearTimeout(this.reconnectId),this.reconnectConnection&&this.reconnectConnection.destroy(),function e(){if(H(t.queue),0===t.queue.length){for(var n=t.availableConnections.concat(t.inUseConnections).concat(t.nonAuthenticatedConnections).concat(t.connectingConnections),r=0;r<n.length;r++)if(n[r].workItems.length>0)return setTimeout(e,1);j(t,n)}else V(t)(),setTimeout(e,1)}()}};var U=function(e,t,n,r){if(0===t.length)return r(null,n);var o=t.shift(),s=o.toBin();if(e.options.agreedCompressor&&!z(o)){var i=w.concat(s),a=i.slice(h),c=i.readInt32LE(12);m(e,a,function(s,i){if(s)return r(s,null);var u=w.alloc(h);u.writeInt32LE(h+9+i.length,0),u.writeInt32LE(o.requestId,4),u.writeInt32LE(0,8),u.writeInt32LE(d.OP_COMPRESSED,12);var l=w.alloc(9);l.writeInt32LE(c,0),l.writeInt32LE(a.length,4),l.writeUInt8(y[e.options.agreedCompressor],8),n.push(w.concat([u,l,i])),U(e,t,n,r)})}else n.push(s),U(e,t,n,r)};I.prototype.write=function(e,t,n){var r=this;if("function"==typeof t&&(n=t),t=t||{},"function"!=typeof n&&!t.noResponse)throw new i("write method must provide a callback");if(this.state!==E&&this.state!==C){if(this.options.domainsEnabled&&process.domain&&"function"==typeof n){var o=n;n=process.domain.bind(function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;t++)e[t]=arguments[t];process.nextTick(function(){o.apply(null,e)})})}var s={cb:n,raw:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,fullResult:!1};if(s.promoteLongs="boolean"!=typeof t.promoteLongs||t.promoteLongs,s.promoteValues="boolean"!=typeof t.promoteValues||t.promoteValues,s.promoteBuffers="boolean"==typeof t.promoteBuffers&&t.promoteBuffers,s.raw="boolean"==typeof t.raw&&t.raw,s.immediateRelease="boolean"==typeof t.immediateRelease&&t.immediateRelease,s.documentsReturnedIn=t.documentsReturnedIn,s.command="boolean"==typeof t.command&&t.command,s.fullResult="boolean"==typeof t.fullResult&&t.fullResult,s.noResponse="boolean"==typeof t.noResponse&&t.noResponse,s.session=t.session||null,s.socketTimeout=t.socketTimeout,s.monitoring=t.monitoring,t.socketTimeout&&(s.socketTimeout=t.socketTimeout),Array.isArray(e)||(e=[e]),s.requestId=e[e.length-1].requestId,function(e){return null!=e&&null!=e.ismaster&&e.ismaster.maxWireVersion>=6}(this.topology)){let t={};if(this.topology.clusterTime&&(t={$clusterTime:this.topology.clusterTime}),s.session){if(s.session.hasEnded)return n(new i("Use of expired sessions is not permitted"));s.session.clusterTime&&s.session.clusterTime.clusterTime.greaterThan(t.$clusterTime.clusterTime)&&(t.$clusterTime=s.session.clusterTime),t.lsid=s.session.id,s.session.serverSession.lastUse=Date.now()}e.forEach(e=>{e instanceof p?e.query.$query?Object.assign(e.query.$query,t):Object.assign(e.query,t):Object.assign(e,t)})}if(r.options.monitorCommands){const t=e[0];this.emit("commandStarted",new v.CommandStartedEvent(this,t)),s.started=process.hrtime(),s.cb=((e,o)=>{e?r.emit("commandFailed",new v.CommandFailedEvent(this,t,e,s.started)):o&&o.result&&(0===o.result.ok||o.result.$err)?r.emit("commandFailed",new v.CommandFailedEvent(this,t,o.result,s.started)):r.emit("commandSucceeded",new v.CommandSucceededEvent(this,t,o,s.started)),"function"==typeof n&&n(e,o)})}U(r,e,[],function(e,n){if(e)throw e;s.buffer=n,t.monitoring?r.queue.unshift(s):r.queue.push(s),r.executing||process.nextTick(function(){V(r)()})})}else if(n)try{n(new i("pool destroyed"))}catch(e){process.nextTick(function(){throw e})}};var z=function(e){return g.some(function(t){return e.query.hasOwnProperty(t)})};function q(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return t.splice(n,1),!0}function $(e,t){q(t,e.availableConnections)||q(t,e.inUseConnections)||q(t,e.connectingConnections)||q(t,e.nonAuthenticatedConnections)}var F=["close","message","error","timeout","parseError","connect"];function W(e){if(e.state!==E&&e.state!==C){var t=new s(P(e),e.options);e.connectingConnections.push(t);var n=function(t){return function(){t.destroy(),$(e,t),!e.reconnectId&&e.options.reconnect&&(e.reconnectId=setTimeout(D(e),e.options.reconnectInterval))}};t.once("close",n(t)),t.once("error",n(t)),t.once("timeout",n(t)),t.once("parseError",n(t)),t.once("connect",function(t){return function(){if(e.state===E||e.state===C)return $(e,t),t.destroy();F.forEach(function(e){t.removeAllListeners(e)}),t.once("close",M(e,"close")),t.once("error",M(e,"error")),t.once("timeout",M(e,"timeout")),t.once("parseError",M(e,"parseError")),B(e,t,function(n){return e.state===E||e.state===C?t.destroy():($(e,t),n?t.destroy():void(e.authenticating?e.nonAuthenticatedConnections.push(t):(e.availableConnections.push(t),V(e)())))})}}(t)),t.connect()}}function H(e){for(var t=0;t<e.length;t++)if(e[t].monitoring){var n=e[t];e.splice(t,1),n.cb(new i({message:"no connection available for monitoring",driver:!0}))}}function V(e){return function(){e.state!==E&&(e.executing||(e.executing=!0,function t(n){if(!e.authenticating)return n();setTimeout(function(){t(n)},1)}(function(){if(!(e.connectingConnections.length>0))for(;;){var t=e.availableConnections.length+e.connectingConnections.length+e.inUseConnections.length;if(0===e.availableConnections.length){H(e.queue);break}if(0===e.queue.length)break;for(var n=null,r=[],o=0;o<e.availableConnections.length;o++)0===e.availableConnections[o].workItems.length&&r.push(e.availableConnections[o]);if((n=0===r.length?e.availableConnections[e.connectionIndex++%e.availableConnections.length]:r[e.connectionIndex++%r.length]).isConnected()){var s=e.queue.shift();if(s.monitoring){var i=!1;for(o=0;o<e.availableConnections.length;o++)if(e.availableConnections[o].isConnected()&&0===e.availableConnections[o].workItems.length){i=!0,n=e.availableConnections[o];break}if(!i){e.queue.unshift(s),t<e.options.size&&e.queue.length>0&&W(e),setTimeout(function(){V(e)()},10);break}}if(t<e.options.size&&n.workItems.length>0){e.queue.unshift(s),W(e);break}var a=s.buffer;s.authenticating=e.authenticating,s.authenticatingTimestamp=e.authenticatingTimestamp,s.monitoring&&R(n,e.availableConnections,e.inUseConnections),s.noResponse||n.workItems.push(s),s.immediateRelease||"number"!=typeof s.socketTimeout||n.setSocketTimeout(s.socketTimeout);var c=!0;if(Array.isArray(a))for(o=0;o<a.length;o++)c=n.write(a[o]);else c=n.write(a);s.noResponse&&"function"==typeof s.cb&&s.cb(null,null),c&&s.immediateRelease&&e.authenticating?($(e,n),e.nonAuthenticatedConnections.push(n)):!1===c&&(e.queue.unshift(s),$(e,n),H(e.queue))}else $(e,n),H(e.queue)}}),e.executing=!1))}}I._execute=V,e.exports=I},function(e,t,n){"use strict";var r=function(e,t,n){this.result=e,this.connection=t,this.message=n};r.prototype.toJSON=function(){return this.result},r.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.exports=r},function(e){e.exports={_from:"mongodb-core@3.1.9",_id:"mongodb-core@3.1.9",_inBundle:!1,_integrity:"sha512-MJpciDABXMchrZphh3vMcqu8hkNf/Mi+Gk6btOimVg1XMxLXh87j6FAvRm+KmwD1A9fpu3qRQYcbQe4egj23og==",_location:"/mongodb-core",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"mongodb-core@3.1.9",name:"mongodb-core",escapedName:"mongodb-core",rawSpec:"3.1.9",saveSpec:null,fetchSpec:"3.1.9"},_requiredBy:["/mongodb"],_resolved:"https://registry.npmjs.org/mongodb-core/-/mongodb-core-3.1.9.tgz",_shasum:"c31ee407bf932b0149eaed775c17ee09974e4ca3",_spec:"mongodb-core@3.1.9",_where:"/Users/zubinpratap/Documents/DevProjects/Practice_Projects/visiJAM/node_modules/mongodb",author:{name:"Christian Kvalheim"},bugs:{url:"https://github.com/mongodb-js/mongodb-core/issues"},bundleDependencies:!1,dependencies:{bson:"^1.1.0",require_optional:"^1.0.1","safe-buffer":"^5.1.2",saslprep:"^1.0.0"},deprecated:!1,description:"Core MongoDB driver functionality, no bells and whistles and meant for integration not end applications",devDependencies:{chai:"^4.1.2","chai-subset":"^1.6.0",co:"^4.6.0",eslint:"^4.6.1","eslint-plugin-prettier":"^2.2.0",jsdoc:"3.5.4","mongodb-extjson":"^2.1.2","mongodb-mock-server":"^1.0.0","mongodb-test-runner":"^1.1.18",prettier:"~1.12.0",sinon:"^6.0.0",snappy:"^6.1.1","standard-version":"^4.4.0"},files:["index.js","lib"],homepage:"https://github.com/mongodb-js/mongodb-core",keywords:["mongodb","core"],license:"Apache-2.0",main:"index.js",name:"mongodb-core",optionalDependencies:{saslprep:"^1.0.0"},peerOptionalDependencies:{kerberos:"^1.0.0","mongodb-extjson":"^2.1.2",snappy:"^6.1.1","bson-ext":"^2.0.0"},repository:{type:"git",url:"git://github.com/mongodb-js/mongodb-core.git"},scripts:{atlas:"node ./test/atlas.js",changelog:"conventional-changelog -p angular -i HISTORY.md -s",coverage:"nyc node test/runner.js -t functional -l && node_modules/.bin/nyc report --reporter=text-lcov | node_modules/.bin/coveralls",format:"prettier --print-width 100 --tab-width 2 --single-quote --write index.js 'test/**/*.js' 'lib/**/*.js'",lint:"eslint index.js lib test",release:"standard-version -i HISTORY.md",test:"npm run lint && mongodb-test-runner -t 60000 test/tests"},version:"3.1.9"}},function(e,t,n){"use strict";const r=n(24).KillCursor,o=n(24).GetMore,s=n(35).calculateDurationInMs,i=new Set(["authenticate","saslStart","saslContinue","getnonce","createUser","updateUser","copydbgetnonce","copydbsaslstart","copydb"]),a=e=>Object.keys(e)[0],c=e=>e.ns,u=e=>e.ns.split(".")[0],l=e=>e.ns.split(".")[1],p=e=>`${e.options.host}:${e.options.port}`,f=(e,t)=>i.has(e)?{}:t,h={$query:"filter",$orderby:"sort",$hint:"hint",$comment:"comment",$maxScan:"maxScan",$max:"max",$min:"min",$returnKey:"returnKey",$showDiskLoc:"showRecordId",$maxTimeMS:"maxTimeMS",$snapshot:"snapshot"},d={numberToSkip:"skip",numberToReturn:"batchSize",returnFieldsSelector:"projection"},m=["tailable","oplogReplay","noCursorTimeout","awaitData","partial","exhaust"],y=e=>{if(e instanceof o)return{getMore:e.cursorId,collection:l(e),batchSize:e.numberToReturn};if(e instanceof r)return{killCursors:l(e),cursors:e.cursorIds};if(e.query&&e.query.$query){let t;return"admin.$cmd"===e.ns?t=Object.assign({},e.query.$query):(t={find:l(e)},Object.keys(h).forEach(n=>{void 0!==e.query[n]&&(t[h[n]]=e.query[n])})),Object.keys(d).forEach(n=>{void 0!==e.options[n]&&(t[d[n]]=e.options[n])}),m.forEach(n=>{e[n]&&(t[n]=e[n])}),void 0!==e.pre32Limit&&(t.limit=e.pre32Limit),e.query.$explain?{explain:t}:t}return e.query?e.query:e},g=(e,t)=>e instanceof o?{ok:1,cursor:{id:t.message.cursorId,ns:c(e),nextBatch:t.message.documents}}:e instanceof r?{ok:1,cursorsUnknown:e.cursorIds}:e.query&&void 0!==e.query.$query?{ok:1,cursor:{id:t.message.cursorId,ns:c(e),firstBatch:t.message.documents}}:t.result;e.exports={CommandStartedEvent:class{constructor(e,t){const n=y(t),r=a(n);i.has(r)&&(this.commandObj={},this.commandObj[r]=!0),Object.assign(this,{command:n,databaseName:u(t),commandName:r,requestId:t.requestId,connectionId:p(e)})}},CommandSucceededEvent:class{constructor(e,t,n,r){const o=y(t),i=a(o);Object.assign(this,{duration:s(r),commandName:i,reply:f(i,g(t,n)),requestId:t.requestId,connectionId:p(e)})}},CommandFailedEvent:class{constructor(e,t,n,r){const o=y(t),i=a(o);Object.assign(this,{duration:s(r),commandName:i,failure:f(i,n),requestId:t.requestId,connectionId:p(e)})}}}},function(e,t,n){"use strict";const r=n(1).format,o=n(24).Query,s=n(11).MongoError,i=n(35).retrieveKerberos;var a=function(e,t,n,r){this.db=e,this.username=t,this.password=n,this.options=r};a.prototype.equal=function(e){return e.db===this.db&&e.username===this.username&&e.password===this.password};var c=function(e){this.bson=e,this.authStore=[]};function u(e,t,n,r,s,i,a,c,u){const l=new t(a.host,a.port,s,c);function p(t,n){const r=new o(e.bson,"$external.$cmd",t,{numberToSkip:0,numberToReturn:1});i(a,r,n)}l.init(n,r,e=>{if(e)return u(e,!1);l.transition("",(e,t)=>{if(e)return u(e,!1);p({saslStart:1,mechanism:"GSSAPI",payload:t,autoAuthorize:1},(e,t)=>{if(e)return u(e,!1);const n=t.result;l.transition(n.payload,(e,t)=>{if(e)return u(e,!1);p({saslContinue:1,conversationId:n.conversationId,payload:t},(e,t)=>{if(e)return u(e,!1);const n=t.result;l.transition(n.payload,(e,t)=>{if(e)return u(e,!1);p({saslContinue:1,conversationId:n.conversationId,payload:t},(e,t)=>{if(e)return u(e,!1);l.transition(null,e=>{if(e)return u(e,null);u(null,t)})})})})})})})})}c.prototype.auth=function(e,t,n,o,c,p,f){var h=this;let d;try{d=i()}catch(e){return f(e,null)}var m=p.gssapiServiceName||"mongodb",y=t.length;if(0===y)return f(null,null);for(var g=0,b=null;t.length>0;){!function(t){process.nextTick(function(){!function(t){u(h,d.processes.MongoAuthProcess,o,c,m,e,t,p,function(e,t){y-=1,e?b=e:t&&"object"==typeof t&&t.result.$err?b=t.result:t&&"object"==typeof t&&t.result.errmsg?b=t.result:g+=1,0===y&&g>0?(l(h.authStore,new a(n,o,c,p)),f(null,!0)):0===y&&(null==b&&(b=new s(r("failed to authenticate using mongocr"))),f(b,!1))})}(t)})}(t.shift())}};var l=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};c.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!==e})},c.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var s=0;s<r.length;s++)this.auth(e,t,r[s].db,r[s].username,r[s].password,r[s].options,function(e){0===(o-=1)&&n(e,null)})},e.exports=c},function(e,t,n){"use strict";const{unassigned_code_points:r,commonly_mapped_to_nothing:o,non_ASCII_space_characters:s,prohibited_characters:i,bidirectional_r_al:a,bidirectional_l:c}=n(190);e.exports=function(e,t={}){if("string"!=typeof e)throw new TypeError("Expected string.");if(0===e.length)return"";const n=e.split("").map(p).map(e=>u.get(e)?32:e).filter(e=>!l.get(e)),o=String.fromCodePoint(...n).normalize("NFKC"),s=o.split("").map(p);if(s.some(e=>i.get(e)))throw new Error("Prohibited character, see https://tools.ietf.org/html/rfc4013#section-2.3");if(!0!==t.allowUnassigned){const e=s.some(e=>r.get(e));if(e)throw new Error("Unassigned code point, see https://tools.ietf.org/html/rfc4013#section-2.5")}const d=s.some(e=>a.get(e)),m=s.some(e=>c.get(e));if(d&&m)throw new Error("String must not contain RandALCat and LCat at the same time, see https://tools.ietf.org/html/rfc3454#section-6");const y=a.get(p(f(o))),g=a.get(p(h(o)));if(d&&(!y||!g))throw new Error("Bidirectional RandALCat character must be the first and the last character of the string, see https://tools.ietf.org/html/rfc3454#section-6");return o};const u=s,l=o,p=e=>e.codePointAt(0),f=e=>e[0],h=e=>e[e.length-1]},function(e,t,n){"use strict";(function(t){const r=n(34),o=n(33),s=n(191),i=r.readFileSync(o.resolve(t,"../code-points.mem"));let a=0;function c(){const e=i.readUInt32BE(a);a+=4;const t=i.slice(a,a+e);return a+=e,s({buffer:t})}const u=c(),l=c(),p=c(),f=c(),h=c(),d=c();e.exports={unassigned_code_points:u,commonly_mapped_to_nothing:l,non_ASCII_space_characters:p,prohibited_characters:f,bidirectional_r_al:h,bidirectional_l:d}}).call(this,"/")},function(e,t,n){var r=n(192);function o(e){if(!(this instanceof o))return new o(e);if(e||(e={}),Buffer.isBuffer(e)&&(e={buffer:e}),this.pageOffset=e.pageOffset||0,this.pageSize=e.pageSize||1024,this.pages=e.pages||r(this.pageSize),this.byteLength=this.pages.length*this.pageSize,this.length=8*this.byteLength,!function(e){return!(e&e-1)}(this.pageSize))throw new Error("The page size should be a power of two");if(this._trackUpdates=!!e.trackUpdates,this._pageMask=this.pageSize-1,e.buffer){for(var t=0;t<e.buffer.length;t+=this.pageSize)this.pages.set(t/this.pageSize,e.buffer.slice(t,t+this.pageSize));this.byteLength=e.buffer.length,this.length=8*this.byteLength}}e.exports=o,o.prototype.get=function(e){var t=7&e,n=(e-t)/8;return!!(this.getByte(n)&128>>t)},o.prototype.getByte=function(e){var t=e&this._pageMask,n=(e-t)/this.pageSize,r=this.pages.get(n,!0);return r?r.buffer[t+this.pageOffset]:0},o.prototype.set=function(e,t){var n=7&e,r=(e-n)/8,o=this.getByte(r);return this.setByte(r,t?o|128>>n:o&(255^128>>n))},o.prototype.toBuffer=function(){for(var e=function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t}(this.pages.length*this.pageSize),t=0;t<this.pages.length;t++){var n=this.pages.get(t,!0),r=t*this.pageSize;n&&n.buffer.copy(e,r,this.pageOffset,this.pageOffset+this.pageSize)}return e},o.prototype.setByte=function(e,t){var n=e&this._pageMask,r=(e-n)/this.pageSize,o=this.pages.get(r,!1);return n+=this.pageOffset,o.buffer[n]!==t&&(o.buffer[n]=t,e>=this.byteLength&&(this.byteLength=e+1,this.length=8*this.byteLength),this._trackUpdates&&this.pages.updated(o),!0)}},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this.length=0,this.updates=[],this.pages=new Array(16),this.pageSize=e||1024,this.deduplicate=t?t.deduplicate:null}function r(e,t,n){for(var r=2*e.length;r<=t;)r*=2;for(var o=new Array(r),s=0;s<n;s++)o[s]=e[s];return o}function o(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t}function s(e,t){this.offset=e*t.length,this.buffer=t,this.updated=!1,this.deduplicate=0}e.exports=n,n.prototype.updated=function(e){for(;this.deduplicate&&e.buffer[e.deduplicate]===this.deduplicate[e.deduplicate];)if(e.deduplicate++,e.deduplicate===this.deduplicate.length){e.deduplicate=0,e.buffer.equals&&e.buffer.equals(this.deduplicate)&&(e.buffer=this.deduplicate);break}!e.updated&&this.updates&&(e.updated=!0,this.updates.push(e))},n.prototype.lastUpdate=function(){if(!this.updates||!this.updates.length)return null;var e=this.updates.pop();return e.updated=!1,e},n.prototype.get=function(e,t){if(e>=this.pages.length){if(t)return;this.pages=r(this.pages,e,this.length)}var n=this.pages[e];return n||t||(n=this.pages[e]=new s(e,o(this.pageSize)),e>=this.length&&(this.length=e+1)),n&&n.buffer===this.deduplicate&&this.deduplicate&&!t&&(n.buffer=function(e){var t=Buffer.allocUnsafe?Buffer.allocUnsafe(e.length):new Buffer(e.length);return e.copy(t),t}(n.buffer),n.deduplicate=0),n},n.prototype.set=function(e,t){if(e>=this.pages.length&&(this.pages=r(this.pages,e,this.length)),e>=this.length&&(this.length=e+1),t){this.deduplicate&&t.equals&&t.equals(this.deduplicate)&&(t=this.deduplicate);var n=this.pages[e],i=function(e,t){if(e.length===t)return e;if(e.length>t)return e.slice(0,t);var n=o(t);return e.copy(n),n}(t,this.pageSize);n?n.buffer=i:this.pages[e]=new s(e,i)}else this.pages[e]=void 0},n.prototype.toBuffer=function(){for(var e=new Array(this.length),t=o(this.pageSize),n=0;n<e.length;n++)e[n]=this.pages[n]?this.pages[n].buffer:t;return Buffer.concat(e)}},function(e,t,n){"use strict";var r=n(25).copy,o=n(25).retrieveBSON,s=n(24).KillCursor,i=n(24).GetMore,a=n(24).Query,c=n(1).format,u=n(11).MongoError,l=n(54).getReadPreference,p=o().Long,f=function(){},h=function(e,t,n,r,o,s,i,l){if(0===s.length)throw new u("insert must contain at least one document");"function"==typeof i&&(l=i,i=(i={})||{});var p=o.split("."),f=p.shift(),h="boolean"!=typeof i.ordered||i.ordered,d=i.writeConcern,m={};m[n]=p.join("."),m[r]=s,m.ordered=h,d&&Object.keys(d).length>0&&(m.writeConcern=d),!0===i.bypassDocumentValidation&&(m.bypassDocumentValidation=i.bypassDocumentValidation);var y={command:!0};void 0!==i.session&&(y.session=i.session);var g={checkKeys:!1,numberToSkip:0,numberToReturn:1};"insert"===n&&(g.checkKeys=!0),"boolean"==typeof i.checkKeys&&(g.checkKeys=i.checkKeys),i.serializeFunctions&&(g.serializeFunctions=i.serializeFunctions),i.ignoreUndefined&&(g.ignoreUndefined=i.ignoreUndefined);try{var b=new a(t,c("%s.$cmd",f),m,g);e.write(b,y,l)}catch(e){l(e)}};f.prototype.insert=function(e,t,n,r,o,s){h(e,n,"insert","documents",t,r,o,s)},f.prototype.update=function(e,t,n,r,o,s){h(e,n,"update","updates",t,r,o,s)},f.prototype.remove=function(e,t,n,r,o,s){h(e,n,"delete","deletes",t,r,o,s)},f.prototype.killCursor=function(e,t,n,r,o){var i=n.cursorId,a=new s(e,t,[i]);const c={immediateRelease:!0,noResponse:!0};if("object"==typeof n.session&&(c.session=n.session),r&&r.isConnected())try{r.write(a,c,o)}catch(e){"function"==typeof o?o(e,null):console.warn(e)}},f.prototype.getMore=function(e,t,n,r,o,s,a,c){var l=new i(e,t,n.cursorId,{numberToReturn:r}),f={};o&&(f.raw=o),"boolean"==typeof n.promoteLongs&&(f.promoteLongs=n.promoteLongs),"boolean"==typeof n.promoteValues&&(f.promoteValues=n.promoteValues),"boolean"==typeof n.promoteBuffers&&(f.promoteBuffers=n.promoteBuffers),"object"==typeof n.session&&(f.session=n.session),s.write(l,f,function(e,t){if(e)return c(e);var r=t.message;if(0!=(1&r.responseFlags))return c(new u("cursor does not exist, was killed or timed out"),null);var o="number"==typeof r.cursorId?p.fromNumber(r.cursorId):r.cursorId;n.documents=r.documents,n.cursorId=o,c(null,null,r.connection)})},f.prototype.command=function(e,t,n,r,o,s){if(n.find)return d(e,t,n,r,o,s);if(null==r.cursorId){if(n)return m(e,t,n,r,o,s);throw new u(c("command %s does not return a cursor",JSON.stringify(n)))}};var d=function(e,t,n,o,s,i){var p=l(n,i=i||{});o.batchSize=n.batchSize||o.batchSize;var f=0;f=0===o.limit?o.batchSize:o.limit<0||o.limit<o.batchSize||o.limit>0&&0===o.batchSize?o.limit:o.batchSize;var h=o.skip||0,d={};if("mongos"===s.type&&p&&(d.$readPreference=p.toJSON()),n.sort&&(d.$orderby=n.sort),n.hint&&(d.$hint=n.hint),n.snapshot&&(d.$snapshot=n.snapshot),void 0!==n.returnKey&&(d.$returnKey=n.returnKey),n.maxScan&&(d.$maxScan=n.maxScan),n.min&&(d.$min=n.min),n.max&&(d.$max=n.max),void 0!==n.showDiskLoc&&(d.$showDiskLoc=n.showDiskLoc),n.comment&&(d.$comment=n.comment),n.maxTimeMS&&(d.$maxTimeMS=n.maxTimeMS),n.explain&&(f=-Math.abs(n.limit||0),d.$explain=!0),d.$query=n.query,n.readConcern&&"local"!==n.readConcern.level)throw new u(c("server find command does not support a readConcern level of %s",n.readConcern.level));n.readConcern&&delete(n=r(n)).readConcern;var m="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,y="boolean"==typeof i.ignoreUndefined&&i.ignoreUndefined,g=new a(e,t,d,{numberToSkip:h,numberToReturn:f,pre32Limit:void 0!==n.limit?n.limit:void 0,checkKeys:!1,returnFieldSelector:n.fields,serializeFunctions:m,ignoreUndefined:y});return g.slaveOk=p.slaveOk(),"boolean"==typeof n.tailable&&(g.tailable=n.tailable),"boolean"==typeof n.oplogReplay&&(g.oplogReplay=n.oplogReplay),"boolean"==typeof n.noCursorTimeout&&(g.noCursorTimeout=n.noCursorTimeout),"boolean"==typeof n.awaitData&&(g.awaitData=n.awaitData),"boolean"==typeof n.partial&&(g.partial=n.partial),g},m=function(e,t,n,r,o,s){var i=l(n,s=s||{}),p={};for(var f in n)p[f]=n[f];var h=t.split(/\./),d="boolean"==typeof s.serializeFunctions&&s.serializeFunctions,m="boolean"==typeof s.ignoreUndefined&&s.ignoreUndefined;if(n.readConcern&&"local"!==n.readConcern.level)throw new u(c("server %s command does not support a readConcern level of %s",JSON.stringify(n),n.readConcern.level));n.readConcern&&delete n.readConcern,"mongos"===o.type&&i&&"primary"!==i.preference&&(p={$query:p,$readPreference:i.toJSON()});var y=new a(e,c("%s.$cmd",h.shift()),p,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,serializeFunctions:d,ignoreUndefined:m});return y.slaveOk=i.slaveOk(),y};e.exports=f},function(e,t,n){"use strict";const r=n(24).Query,o=n(25).retrieveBSON,s=n(11).MongoError,i=n(11).MongoNetworkError,a=n(54).getReadPreference,c=o(),u=c.Long,l=n(55),p=n(154).TxnState,f=function(){};function h(e,t,n){if(!t)return;const r=t.serverSession,o=t.inTransaction()||function(e){return!(!e.commitTransaction&&!e.abortTransaction)}(e),i=n.willRetryWrite;if(r.txnNumber&&(i||o)&&(e.txnNumber=c.Long.fromNumber(r.txnNumber)),!o)return t.transaction.state!==p.NO_TRANSACTION&&t.transaction.transition(p.NO_TRANSACTION),void(t.supports.causalConsistency&&t.operationTime&&(e.readConcern=e.readConcern||{},Object.assign(e.readConcern,{afterClusterTime:t.operationTime})));if(n.readPreference&&!n.readPreference.equals(l.primary))return new s(`Read preference in a transaction must be primary, not: ${n.readPreference.mode}`);if(e.autocommit=!1,t.transaction.state===p.STARTING_TRANSACTION){t.transaction.transition(p.TRANSACTION_IN_PROGRESS),e.startTransaction=!0;const n=t.transaction.options.readConcern||t.clientOptions.readConcern;n&&(e.readConcern=n),t.supports.causalConsistency&&t.operationTime&&(e.readConcern=e.readConcern||{},Object.assign(e.readConcern,{afterClusterTime:t.operationTime}))}}function d(e,t,n,o,i,a,c,u){if(0===a.length)throw new s("insert must contain at least one document");"function"==typeof c&&(u=c,c=(c={})||{});const l=i.split("."),p=l.shift(),f="boolean"!=typeof c.ordered||c.ordered,d=c.writeConcern,m={};if(m[n]=l.join("."),m[o]=a,m.ordered=f,d&&Object.keys(d).length>0&&(m.writeConcern=d),c.collation)for(let e=0;e<m[o].length;e++)m[o][e].collation||(m[o][e].collation=c.collation);!0===c.bypassDocumentValidation&&(m.bypassDocumentValidation=c.bypassDocumentValidation);const y=h(m,c.session,c);if(y)return u(y,null);const g={command:!0};void 0!==c.session&&(g.session=c.session);const b={checkKeys:!1,numberToSkip:0,numberToReturn:1};"insert"===n&&(b.checkKeys=!0),"boolean"==typeof c.checkKeys&&(b.checkKeys=c.checkKeys),c.serializeFunctions&&(b.serializeFunctions=c.serializeFunctions),c.ignoreUndefined&&(b.ignoreUndefined=c.ignoreUndefined);try{const n=new r(t,`${p}.$cmd`,m,b);e.write(n,g,u)}catch(y){u(y)}}f.prototype.insert=function(e,t,n,r,o,s){d(e,n,"insert","documents",t,r,o,s)},f.prototype.update=function(e,t,n,r,o,s){d(e,n,"update","updates",t,r,o,s)},f.prototype.remove=function(e,t,n,r,o,s){d(e,n,"delete","deletes",t,r,o,s)},f.prototype.killCursor=function(e,t,n,o,a){const c=t.split(/\./),u=`${c.shift()}.$cmd`,l=n.cursorId,p={killCursors:c.join("."),cursors:[l]},f=new r(e,u,p,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,returnFieldSelector:null});function h(e,t){if(e){if("function"!=typeof a)return;return a(e)}const n=t.message;if(0!=(1&n.responseFlags)){if("function"!=typeof a)return;return a(new i("cursor killed or timed out"),null)}if(!Array.isArray(n.documents)||0===n.documents.length){if("function"!=typeof a)return;return a(new s(`invalid killCursors result returned for cursor id ${l}`))}"function"==typeof a&&a(null,n.documents[0])}const d={command:!0};if("object"==typeof n.session&&(d.session=n.session),o&&o.isConnected())try{o.write(f,d,h)}catch(e){h(e,null)}else"function"==typeof a&&a(null,null)},f.prototype.getMore=function(e,t,n,o,a,c,l,p){l=l||{};const f=t.split(/\./),d=`${f.shift()}.$cmd`,m={getMore:n.cursorId,collection:f.join("."),batchSize:Math.abs(o)},y=h(m,l.session,l);if(y)return p(y,null);n.cmd.tailable&&"number"==typeof n.cmd.maxAwaitTimeMS&&(m.maxTimeMS=n.cmd.maxAwaitTimeMS);const g=new r(e,d,m,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,returnFieldSelector:null});const b={command:!0};a&&(b.raw=a),b.documentsReturnedIn="nextBatch","boolean"==typeof n.promoteLongs&&(b.promoteLongs=n.promoteLongs),"boolean"==typeof n.promoteValues&&(b.promoteValues=n.promoteValues),"boolean"==typeof n.promoteBuffers&&(b.promoteBuffers=n.promoteBuffers),"object"==typeof n.session&&(b.session=n.session),c.write(g,b,function(e,t){if(e)return p(e);const r=t.message;if(0!=(1&r.responseFlags))return p(new i("cursor killed or timed out"),null);if(a)return n.documents=r.documents,n.cursorId=r.cursorId,p(null,r.documents);if(0===r.documents[0].ok)return p(new s(r.documents[0]));const o="number"==typeof r.documents[0].cursor.id?u.fromNumber(r.documents[0].cursor.id):r.documents[0].cursor.id;n.documents=r.documents[0].cursor.nextBatch,n.cursorId=o,p(null,r.documents[0],r.connection)})},f.prototype.command=function(e,t,n,o,i,c){const u="boolean"!=typeof(c=c||{}).wireProtocolCommand||c.wireProtocolCommand;let l;if(n.find&&u)l=function(e,t,n,o,s,i){const c=a(n,i=i||{});o.batchSize=n.batchSize||o.batchSize;const u=t.split(/\./),l=`${u.shift()}.$cmd`;let p={find:u.join(".")};n.query&&(n.query.$query?p.filter=n.query.$query:p.filter=n.query);let f=n.sort;if(Array.isArray(f)){const e={};if(f.length>0&&!Array.isArray(f[0])){let t=f[1];"asc"===t?t=1:"desc"===t&&(t=-1),e[f[0]]=t}else for(var d=0;d<f.length;d++){let t=f[d][1];"asc"===t?t=1:"desc"===t&&(t=-1),e[f[d][0]]=t}f=e}n.sort&&(p.sort=f);n.fields&&(p.projection=n.fields);n.hint&&(p.hint=n.hint);n.skip&&(p.skip=n.skip);n.limit&&(p.limit=n.limit);n.limit<0&&(p.limit=Math.abs(n.limit),p.singleBatch=!0);"number"==typeof n.batchSize&&(n.batchSize<0&&(0!==n.limit&&Math.abs(n.batchSize)<Math.abs(n.limit)&&(p.limit=Math.abs(n.batchSize)),p.singleBatch=!0),p.batchSize=Math.abs(n.batchSize));n.comment&&(p.comment=n.comment);n.maxScan&&(p.maxScan=n.maxScan);n.maxTimeMS&&(p.maxTimeMS=n.maxTimeMS);n.min&&(p.min=n.min);n.max&&(p.max=n.max);p.returnKey=!!n.returnKey&&n.returnKey,p.showRecordId=!!n.showDiskLoc&&n.showDiskLoc,n.snapshot&&(p.snapshot=n.snapshot);n.tailable&&(p.tailable=n.tailable);n.oplogReplay&&(p.oplogReplay=n.oplogReplay);n.noCursorTimeout&&(p.noCursorTimeout=n.noCursorTimeout);n.awaitData&&(p.awaitData=n.awaitData);n.awaitdata&&(p.awaitData=n.awaitdata);n.partial&&(p.partial=n.partial);n.collation&&(p.collation=n.collation);n.explain&&(p={explain:p});n.readConcern&&(p.readConcern=n.readConcern);const m="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,y="boolean"==typeof i.ignoreUndefined&&i.ignoreUndefined;"mongos"===s.type&&c&&"primary"!==c.preference&&(p={$query:p,$readPreference:c.toJSON()});const g=h(p,i.session,i);if(g)return g;const b=new r(e,l,p,{numberToSkip:0,numberToReturn:1,checkKeys:!1,returnFieldSelector:null,serializeFunctions:m,ignoreUndefined:y});return b.slaveOk=c.slaveOk(),b}(e,t,n,o,i,c),n.virtual=!1,l.documentsReturnedIn="firstBatch";else{if(null!=o.cursorId)return;if(!n)return new s(`command ${JSON.stringify(n)} does not return a cursor`);l=function(e,t,n,o,s,i){const c=a(n,i=i||{});let u={};for(let e in n)u[e]=n[e];const l=t.split(/\./),p="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,f="boolean"==typeof i.ignoreUndefined&&i.ignoreUndefined;"mongos"===s.type&&c&&"primary"!==c.preference&&(u={$query:u,$readPreference:c.toJSON()});const d=h(u,i.session,i);if(d)return d;const m=new r(e,`${l.shift()}.$cmd`,u,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,serializeFunctions:p,ignoreUndefined:f});return m.slaveOk=c.slaveOk(),m}(e,t,n,0,i,c)}if(l instanceof s)return l;const p=h(l.query,c.session,c);return p||l},e.exports=f},function(e,t,n){"use strict";const r=n(1).inherits,o=n(1).format,s=n(9).EventEmitter,i=n(55),a=n(110),c=n(25).retrieveBSON,u=n(56),l=n(11).MongoError,p=n(153),f=n(196),h=n(20).clone,d=n(20).Timeout,m=n(20).Interval,y=n(20).createClientInfo,g=n(20).SessionMixins,b=n(20).isRetryableWritesSupported,v=n(35).relayEvents,S=n(11).isRetryableError,w=n(108).defaultAuthProviders;var O=c(),_="disconnected",T="connecting",C="connected",E="unreferenced",N="destroyed";function I(e,t){var n={disconnected:[T,N,_],connecting:[T,N,C,_],connected:[C,_,N,E],unreferenced:[E,N],destroyed:[N]}[e.state];n&&-1!==n.indexOf(t)?e.state=t:e.s.logger.error(o("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}var x=1,A=["connect","close","error","timeout","parseError"],k=function(e,t){var n=this;if(t=t||{},!Array.isArray(e))throw new l("seedlist must be an array");if(0===e.length)throw new l("seedlist must contain at least one entry");e.forEach(function(e){if("string"!=typeof e.host||"number"!=typeof e.port)throw new l("seedlist entry must contain a host and port")}),s.call(this),this.id=x++;var r=t.localThresholdMS||15;t.acceptableLatency&&(r=t.acceptableLatency);var i=u("ReplSet",t);this.s={options:Object.assign({},t),bson:t.bson||new O([O.Binary,O.Code,O.DBRef,O.Decimal128,O.Double,O.Int32,O.Long,O.Map,O.MaxKey,O.MinKey,O.ObjectId,O.BSONRegExp,O.Symbol,O.Timestamp]),Cursor:t.cursorFactory||a,logger:i,seedlist:e,replicaSetState:new f({id:this.id,setName:t.setName,acceptableLatency:r,heartbeatFrequencyMS:t.haInterval?t.haInterval:1e4,logger:i}),connectingServers:[],haInterval:t.haInterval?t.haInterval:1e4,minHeartbeatFrequencyMS:500,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof t.debug&&t.debug,clientInfo:y(t),authenticationContexts:[]},this.s.replicaSetState.on("topologyDescriptionChanged",function(e){n.emit("topologyDescriptionChanged",e)}),this.s.logger.isWarn()&&0!==this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(o("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval)),this.authProviders=t.authProviders||w(this.s.bson);["joined","left"].forEach(function(e){n.s.replicaSetState.on(e,function(t,r){n.emit(e,t,r)})}),this.initialConnectState={connect:!1,fullsetup:!1,all:!1},this.state=_,this.haTimeoutId=null,this.authenticating=!1,this.ismaster=null,this.intervalIds=[],this.clusterTime=null};function B(e){e.s.replicaSetState.hasPrimaryAndSecondary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute():e.s.replicaSetState.hasPrimary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute({executePrimary:!0}):e.s.replicaSetState.hasSecondary()&&e.s.disconnectHandler&&e.s.disconnectHandler.execute({executeSecondary:!0})}function M(e,t,n){var r=t.length,o=null,s=function(e,t){return function(s){var i=this;if(r-=1,e.state===N||e.state===E)return this.destroy({force:!0});if("connect"!==t||e.authenticating)"connect"===t&&e.authenticating?this.destroy({force:!0}):"error"===t&&(o=s);else{if(e.state===N||e.state===E)return i.destroy({force:!0});j(e,i,function(){if(e.state===N||e.state===E)return i.destroy({force:!0});if(e.s.replicaSetState.update(i)){i.lastIsMaster()&&i.lastIsMaster().ismaster&&(e.ismaster=i.lastIsMaster());for(var t=0;t<A.length;t++)i.removeAllListeners(A[t]);i.on("error",L(e,"error")),i.on("close",L(e,"close")),i.on("timeout",L(e,"timeout")),i.on("parseError",L(e,"parseError")),D(i.lastIsMaster().me,e,{}),B(e)}else i.destroy({force:!0})})}B(e),0===r&&n(o)}};if(0===r)return n();function i(t,n){setTimeout(function(){if(e.state!==N&&e.state!==E){var n=new p(Object.assign({},e.s.options,{host:t.split(":")[0],port:parseInt(t.split(":")[1],10),authProviders:e.authProviders,reconnect:!1,monitoring:!1,parent:e,clientInfo:h(e.s.clientInfo)}));n.once("connect",s(e,"connect")),n.once("close",s(e,"close")),n.once("timeout",s(e,"timeout")),n.once("error",s(e,"error")),n.once("parseError",s(e,"parseError")),n.on("serverOpening",t=>e.emit("serverOpening",t)),n.on("serverDescriptionChanged",t=>e.emit("serverDescriptionChanged",t)),n.on("serverClosed",t=>e.emit("serverClosed",t)),v(n,e,["commandStarted","commandSucceeded","commandFailed"]),n.connect(e.s.connectOptions)}},n)}for(var a=0;a<t.length;a++)i(t[a],a)}r(k,s),Object.assign(k.prototype,g),Object.defineProperty(k.prototype,"type",{enumerable:!0,get:function(){return"replset"}}),Object.defineProperty(k.prototype,"parserType",{enumerable:!0,get:function(){return O.native?"c++":"js"}}),Object.defineProperty(k.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.replicaSetState.logicalSessionTimeoutMinutes||null}});var D=function(e,t,n){if(!n.haInterval)for(var r=0;r<t.intervalIds.length;r++)if(t.intervalIds[r].__host===e)return;var o=n.haInterval?d:m,s=n.haInterval?n.haInterval:t.s.haInterval,i=new o(function(){if(t.state!==N&&t.state!==E){var n=t.s.replicaSetState.get(e);return n?function(e,t,n){var r=(new Date).getTime();z(e,"serverHeartbeatStarted",{connectionId:t.name}),t.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:e.s.options.connectionTimeout||2e3},function(o,s){if(e.state===N||e.state===E)return t.destroy({force:!0}),n(o,s);var i=(new Date).getTime()-r,a=process.hrtime();t.lastUpdateTime=1e3*a[0]+Math.round(a[1]/1e3),o?(z(e,"serverHeartbeatFailed",{durationMS:i,failure:o,connectionId:t.name}),e.s.replicaSetState.remove(t)):(t.ismaster=s.result,t.ismaster.lastWrite&&t.ismaster.lastWrite.lastWriteDate&&(t.lastWriteDate=t.ismaster.lastWrite.lastWriteDate.getTime()),-1===t.lastIsMasterMS?t.lastIsMasterMS=i:t.lastIsMasterMS&&(t.lastIsMasterMS=.2*i+.8*t.lastIsMasterMS),e.s.replicaSetState.update(t)&&t.lastIsMaster()&&t.lastIsMaster().ismaster&&(e.ismaster=t.lastIsMaster()),z(e,"serverHeartbeatSucceeded",{durationMS:i,reply:s.result,connectionId:t.name})),e.s.replicaSetState.updateServerMaxStaleness(t,e.s.haInterval),n(o,s)})}(t,n,function(e){e||(t.state!==N&&t.state!==E?(t.intervalIds=t.intervalIds.filter(function(e){return e.isRunning()}),o===d?t.state===T&&(t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed||t.s.replicaSetState.hasPrimary())&&(t.state=C,process.nextTick(function(){t.emit("connect",t)}),R(t,{})):t.state===_&&(t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed||t.s.replicaSetState.hasPrimary())&&(t.state=C,B(t),process.nextTick(function(){t.emit("reconnect",t)})),t.initialConnectState.connect&&!t.initialConnectState.fullsetup&&t.s.replicaSetState.hasPrimaryAndSecondary()&&(t.initialConnectState.fullsetup=!0,t.initialConnectState.all=!0,process.nextTick(function(){t.emit("fullsetup",t),t.emit("all",t)}))):i.stop())}):void 0}i.stop()},s);i.start(),i.__host=e,t.intervalIds.push(i)};function R(e,t){if(e.state!==N&&e.state!==E){t=t||{};var n=Object.keys(e.s.replicaSetState.set),r=t.haInterval?d:m,o=t.haInterval?t.haInterval:e.s.haInterval;if(r===d)return M(e,e.s.replicaSetState.unknownServers,function(r){if(e.state!==N&&e.state!==E){if(!e.s.replicaSetState.hasPrimary()&&!e.s.options.secondaryOnlyConnectionAllowed)return r?e.emit("error",r):(e.emit("error",new l("no primary found in replicaset or invalid replica set name")),e.destroy({force:!0}));if(!e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed)return r?e.emit("error",r):(e.emit("error",new l("no secondary found in replicaset or invalid replica set name")),e.destroy({force:!0}));for(var o=0;o<n.length;o++)D(n[o],e,t)}});for(var s=0;s<n.length;s++)D(n[s],e,t);var i=e.s.replicaSetState.hasPrimary()?o:e.s.minHeartbeatFrequencyMS;e.intervalIds.push(new d(function e(t){return function(){t.state!==N&&t.state!==E&&M(t,t.s.replicaSetState.unknownServers,function(){var n=t.s.replicaSetState.hasPrimary()?o:t.s.minHeartbeatFrequencyMS;t.intervalIds.push(new d(e(t),n).start())})}}(e),i).start())}}function P(e,t){for(var n=0;n<e.length;n++)if(e[n].name.toLowerCase()===t.name.toLowerCase())return!0;e.push(t)}function L(e,t){return function(){e.state!==N&&e.state!==E&&(e.s.logger.isDebug()&&e.s.logger.debug(o("handleEvent %s from server %s in replset with id %s",t,this.name,e.id)),e.s.replicaSetState.remove(this),e.state!==N&&e.state!==E&&((e.s.replicaSetState.hasPrimary()||e.s.replicaSetState.hasSecondary()||!e.s.options.secondaryOnlyConnectionAllowed)&&e.s.replicaSetState.hasPrimary()||I(e,_),P(e.s.connectingServers,this)))}}function j(e,t,n){if(0===e.s.authenticationContexts.length)return n();if(t.lastIsMaster()&&t.lastIsMaster().arbiterOnly)return n();!function e(t,n,r){if(0===t.length)return r();var o=t.shift().slice(0);o.push(function(){e(t,n,r)}),n.auth.apply(n,o)}(e.s.authenticationContexts.slice(0),t,n)}function U(e,t){return function(){var n=this;if(e.s.logger.isDebug()&&e.s.logger.debug(o("handleInitialConnectEvent %s from server %s in replset with id %s",t,this.name,e.id)),e.state===N||e.state===E)return this.destroy({force:!0});"connect"===t?j(e,n,function(){if(e.state===N||e.state===E)return n.destroy({force:!0});var r=e.s.replicaSetState.update(n);if(!0===r){n.lastIsMaster()&&n.lastIsMaster().ismaster&&(e.ismaster=n.lastIsMaster()),e.s.logger.isDebug()&&e.s.logger.debug(o("handleInitialConnectEvent %s from server %s in replset with id %s has state [%s]",t,n.name,e.id,JSON.stringify(e.s.replicaSetState.set)));for(var s=0;s<A.length;s++)n.removeAllListeners(A[s]);n.on("error",L(e,"error")),n.on("close",L(e,"close")),n.on("timeout",L(e,"timeout")),n.on("parseError",L(e,"parseError")),function(e){const t=e.state===T,n=e.s.replicaSetState.hasPrimary(),r=e.s.replicaSetState.hasSecondary(),o=e.s.options.secondaryOnlyConnectionAllowed,s=e.s.connectOptions.readPreference&&e.s.connectOptions.readPreference.equals(i.secondary);return t&&(s&&r||!s&&n)||r&&o}(e)&&(e.state=C,e.initialConnectState.connect=!0,process.nextTick(function(){e.emit("connect",e)}),R(e,{}))}else{if(r instanceof l)return n.destroy({force:!0}),e.destroy({force:!0}),e.emit("error",r);n.destroy({force:!0})}}):(e.emit("failed",this),P(e.s.connectingServers,this),e.s.replicaSetState.remove(this)),e.initialConnectState.connect&&!e.initialConnectState.fullsetup&&e.s.replicaSetState.hasPrimaryAndSecondary()&&(e.initialConnectState.fullsetup=!0,e.initialConnectState.all=!0,process.nextTick(function(){e.emit("fullsetup",e),e.emit("all",e)}));for(var r=0;r<e.s.connectingServers.length;r++)e.s.connectingServers[r].equals(this)&&e.s.connectingServers.splice(r,1);0===e.s.connectingServers.length&&e.state===T&&R(e,{haInterval:1})}}function z(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}function q(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};const r=e.self,s=e.op,i=e.ns,a=e.ops;if(r.state===N)return n(new l(o("topology was destroyed")));const c=!e.retrying&&!!t.retryWrites&&t.session&&b(r)&&!t.session.inTransaction();if(!r.s.replicaSetState.hasPrimary()){if(r.s.disconnectHandler)return r.s.disconnectHandler.add(s,i,a,t,n);if(!c)return n(new l("no primary server found"))}const u=(o,s)=>{if(!o)return n(null,s);if(!S(o))return n(o);if(c){return q(Object.assign({},e,{retrying:!0}),t,n)}return r.s.replicaSetState.primary&&r.s.replicaSetState.remove(r.s.replicaSetState.primary,{force:!0}),n(o)};n.operationId&&(u.operationId=n.operationId),c&&(t.session.incrementTransactionNumber(),t.willRetryWrite=c),r.s.replicaSetState.primary[s](i,a,t,u)}k.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{},I(this,T);var n=this.s.seedlist.map(function(e){return new p(Object.assign({},t.s.options,e,{authProviders:t.authProviders,reconnect:!1,monitoring:!1,parent:t,clientInfo:h(t.s.clientInfo)}))});if(this.s.options.socketTimeout>0&&this.s.options.socketTimeout<=this.s.options.haInterval)return t.emit("error",new l(o("haInterval [%s] MS must be set to less than socketTimeout [%s] MS",this.s.options.haInterval,this.s.options.socketTimeout)));z(this,"topologyOpening",{topologyId:this.id}),function(e,t){e.s.connectingServers=e.s.connectingServers.concat(t);var n=0;function r(t,n){setTimeout(function(){e.s.replicaSetState.update(t)&&t.lastIsMaster()&&t.lastIsMaster().ismaster&&(e.ismaster=t.lastIsMaster()),t.once("close",U(e,"close")),t.once("timeout",U(e,"timeout")),t.once("parseError",U(e,"parseError")),t.once("error",U(e,"error")),t.once("connect",U(e,"connect")),t.on("serverOpening",t=>e.emit("serverOpening",t)),t.on("serverDescriptionChanged",t=>e.emit("serverDescriptionChanged",t)),t.on("serverClosed",t=>e.emit("serverClosed",t)),v(t,e,["commandStarted","commandSucceeded","commandFailed"]),t.connect(e.s.connectOptions)},n)}for(;t.length>0;)r(t.shift(),n++)}(t,n)},k.prototype.destroy=function(e){e=e||{},I(this,N),this.haTimeoutId&&clearTimeout(this.haTimeoutId),this.s.replicaSetState.destroy(e),this.s.authenticationContexts=[],this.s.connectingServers.forEach(function(t){t.destroy(e)});for(var t=0;t<this.intervalIds.length;t++)this.intervalIds[t].stop();this.intervalIds=[],z(this,"topologyClosed",{topologyId:this.id})},k.prototype.unref=function(){I(this,E),this.s.replicaSetState.allServers().forEach(function(e){e.unref()}),clearTimeout(this.haTimeoutId)},k.prototype.lastIsMaster=function(){return this.s.options.secondaryOnlyConnectionAllowed&&!this.s.replicaSetState.hasPrimary()&&this.s.replicaSetState.hasSecondary()?this.s.replicaSetState.secondaries[0].lastIsMaster():this.s.replicaSetState.primary?this.s.replicaSetState.primary.lastIsMaster():this.ismaster},k.prototype.connections=function(){for(var e=this.s.replicaSetState.allServers(),t=[],n=0;n<e.length;n++)t=t.concat(e[n].connections());return t},k.prototype.isConnected=function(e){return e=e||{},!this.authenticating&&(e.readPreference&&e.readPreference.equals(i.secondary)?this.s.replicaSetState.hasSecondary():e.readPreference&&e.readPreference.equals(i.primary)?this.s.replicaSetState.hasPrimary():e.readPreference&&e.readPreference.equals(i.primaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():e.readPreference&&e.readPreference.equals(i.secondaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():!(!this.s.options.secondaryOnlyConnectionAllowed||!this.s.replicaSetState.hasSecondary())||this.s.replicaSetState.hasPrimary())},k.prototype.isDestroyed=function(){return this.state===N},k.prototype.selectServer=function(e,t,n){"function"==typeof e&&void 0===n&&(n=e,e=void 0,t={}),"function"==typeof t&&(n=t,t=e,e=void 0),t=t||{};const r=this.s.replicaSetState.pickServer(t.readPreference);this.s.debug&&this.emit("pickedServer",t.readPreference,r),n(null,r)},k.prototype.getServers=function(){return this.s.replicaSetState.allServers()},k.prototype.insert=function(e,t,n,r){q({self:this,op:"insert",ns:e,ops:t},n,r)},k.prototype.update=function(e,t,n,r){q({self:this,op:"update",ns:e,ops:t},n,r)},k.prototype.remove=function(e,t,n,r){q({self:this,op:"remove",ns:e,ops:t},n,r)};const $=["findAndModify","insert","update","delete"];k.prototype.command=function(e,t,n,r){if("function"==typeof n&&(r=n,n=(n={})||{}),this.state===N)return r(new l(o("topology was destroyed")));var s=n.readPreference?n.readPreference:i.primary;if("primary"===s.preference&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,r);if("secondary"===s.preference&&!this.s.replicaSetState.hasSecondary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,r);if("primary"!==s.preference&&!this.s.replicaSetState.hasSecondary()&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,r);var a=this.s.replicaSetState.pickServer(s);if(!(a instanceof p))return r(a);if(this.s.debug&&this.emit("pickedServer",i.primary,a),null==a)return r(new l(o("no server found that matches the provided readPreference %s",s)));const c=!n.retrying&&!!n.retryWrites&&n.session&&b(this)&&!n.session.inTransaction()&&function(e){return $.some(t=>e[t])}(t);c&&(n.session.incrementTransactionNumber(),n.willRetryWrite=c),a.command(e,t,n,(o,s)=>{if(!o)return r(null,s);if(!S(o))return r(o);if(c){const o=Object.assign({},n,{retrying:!0});return this.command(e,t,o,r)}return this.s.replicaSetState.primary&&this.s.replicaSetState.remove(this.s.replicaSetState.primary,{force:!0}),r(o)})},k.prototype.auth=function(e,t){var n=Array.prototype.slice.call(arguments,0).slice(0),r=this,s=Array.prototype.slice.call(arguments,2),i=s.pop(),a=0;if(null==this.authProviders[e]&&"default"!==e)return i(new l(o("auth provider %s does not exist",e)));if(this.authenticating)return i(new l("authentication or logout allready in process"));if(!this.isConnected()&&null!=r.s.disconnectHandler){if(!r.s.replicaSetState.hasPrimary()&&!r.s.options.secondaryOnlyConnectionAllowed)return r.s.disconnectHandler.add("auth",t,n,{},i);if(!r.s.replicaSetState.hasSecondary()&&r.s.options.secondaryOnlyConnectionAllowed)return r.s.disconnectHandler.add("auth",t,n,{},i)}this.authenticating=!0;var c=[],u=this.s.replicaSetState.allServers();function p(n){var o=[e,t].concat(s.slice(0)).concat([function(e){if(f-=1,e&&c.push({name:n.name,err:e}),0===f){if(r.authenticating=!1,c.length)return r.s.authenticationContexts.splice(a,0),i(new l({message:"authentication fail",errors:c}),!1);i(null,r)}}]);n.lastIsMaster().arbiterOnly?o.pop()(null):n.auth.apply(n,o)}0===u.length&&(this.authenticating=!1,i(null,!0));var f=u.length;for(a=this.s.authenticationContexts.length,this.s.authenticationContexts.push([e,t].concat(s.slice(0)));u.length>0;)p(u.shift())},k.prototype.logout=function(e,t){var n=this;if(this.authenticating)throw new l("authentication or logout allready in process");this.authenticating=!0;for(var r=Object.keys(this.authProviders),s=0;s<r.length;s++)this.authProviders[r[s]].logout(e);n.s.authenticationContexts=n.s.authenticationContexts.filter(function(t){return t[1]!==e});var i=this.s.replicaSetState.allServers(),a=i.length;if(0===a)return t();var c=[];function u(t,n){t.logout(e,function(e){e&&c.push({name:t.name,err:e}),n()})}for(s=0;s<i.length;s++)u(i[s],function(){if(0===(a-=1)){if(n.authenticating=!1,c.length)return t(new l({message:o("logout failed against db %s",e),errors:c}),!1);t()}})},k.prototype.cursor=function(e,t,n){const r=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(this.s.bson,e,t,n,r,this.s.options)},e.exports=k},function(e,t,n){"use strict";var r=n(1).inherits,o=n(1).format,s=n(20).diff,i=n(9).EventEmitter,a=n(56),c=n(55),u=n(11).MongoError,l=n(53).Buffer,p="ReplicaSetNoPrimary",f="ReplicaSetWithPrimary",h="Unknown",d="PossiblePrimary",m="RSPrimary",y="RSSecondary",g="RSArbiter",b="RSOther",v="RSGhost",S="Unknown",w=function(e){e=e||{},i.call(this),this.topologyType=p,this.setName=e.setName,this.set={},this.id=e.id,this.setName=e.setName,this.logger=e.logger||a("ReplSet",e),this.index=0,this.acceptableLatency=e.acceptableLatency||15,this.heartbeatFrequencyMS=e.heartbeatFrequencyMS||1e4,this.primary=null,this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.maxElectionId=null,this.maxSetVersion=0,this.replicasetDescription={topologyType:"Unknown",servers:[]},this.logicalSessionTimeoutMinutes=void 0};r(w,i),w.prototype.hasPrimaryAndSecondary=function(){return null!=this.primary&&this.secondaries.length>0},w.prototype.hasPrimaryOrSecondary=function(){return this.hasPrimary()||this.hasSecondary()},w.prototype.hasPrimary=function(){return null!=this.primary},w.prototype.hasSecondary=function(){return this.secondaries.length>0},w.prototype.get=function(e){for(var t=this.allServers(),n=0;n<t.length;n++)if(t[n].name.toLowerCase()===e.toLowerCase())return t[n];return null},w.prototype.allServers=function(e){e=e||{};var t=this.primary?[this.primary]:[];return t=t.concat(this.secondaries),e.ignoreArbiters||(t=t.concat(this.arbiters)),t=t.concat(this.passives)},w.prototype.destroy=function(e){this.primary&&this.primary.destroy(e),this.secondaries.forEach(function(t){t.destroy(e)}),this.arbiters.forEach(function(t){t.destroy(e)}),this.passives.forEach(function(t){t.destroy(e)}),this.ghosts.forEach(function(t){t.destroy(e)}),this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.primary=null,A(this)},w.prototype.remove=function(e,t){t=t||{};var n=e.name.toLowerCase(),r=this.primary?[this.primary]:[];r=(r=(r=r.concat(this.secondaries)).concat(this.arbiters)).concat(this.passives);for(var o=0;o<r.length;o++)if(!t.force&&r[o].equals(e)&&r[o].isConnected&&r[o].isConnected())return;this.set[n]&&(this.set[n].type=S,this.set[n].electionId=null,this.set[n].setName=null,this.set[n].setVersion=null);var s=null;this.primary&&this.primary.equals(e)&&(this.primary=null,this.topologyType=p,s="primary"),s=x(e,this.secondaries)?"secondary":s,s=x(e,this.arbiters)?"arbiter":s,s=x(e,this.passives)?"secondary":s,x(e,this.ghosts),x(e,this.unknownServers),this.unknownServers.push(n),s&&this.emit("left",s,e)};const O=e=>e.arbiterOnly&&e.setName;w.prototype.update=function(e){var t=e.lastIsMaster(),n=e.name.toLowerCase();if(t){var r=Array.isArray(t.hosts)?t.hosts:[];r=(r=(r=r.concat(Array.isArray(t.arbiters)?t.arbiters:[])).concat(Array.isArray(t.passives)?t.passives:[])).map(function(e){return e.toLowerCase()});for(var s=0;s<r.length;s++)-1!==this.unknownServers.indexOf(r[s])||this.set[r[s]]&&this.set[r[s]].type!==S||this.unknownServers.push(r[s].toLowerCase()),this.set[r[s]]||(this.set[r[s]]={type:S,electionId:null,setName:null,setVersion:null})}if(!t&&!E(t,e,this.unknownServers))return this.set[n]={type:S,setVersion:null,electionId:null,setName:null},this.set[n].type=S,this.set[n].electionId=t?t.electionId:t,this.set[n].setName=t?t.setName:t,this.set[n].setVersion=t?t.setVersion:t,-1===this.unknownServers.indexOf(e.name)&&this.unknownServers.push(n),!1;if(void 0===t.logicalSessionTimeoutMinutes||O(t)||(void 0===this.logicalSessionTimeoutMinutes||null===t.logicalSessionTimeoutMinutes?this.logicalSessionTimeoutMinutes=t.logicalSessionTimeoutMinutes:this.logicalSessionTimeoutMinutes=Math.min(this.logicalSessionTimeoutMinutes,t.logicalSessionTimeoutMinutes)),t&&"isdbgrid"===t.msg)return!1;if(t.setName&&t.hidden||t.setName&&!t.ismaster&&!t.secondary&&!t.arbiterOnly&&!t.passive)return this.set[n]={type:b,setVersion:null,electionId:null,setName:t.setName},this.topologyType=this.primary?f:p,t.setName&&(this.setName=t.setName),!1;if(t.isreplicaset)return this.set[n]={type:v,setVersion:null,electionId:null,setName:null},this.topologyType=this.primary?f:p,t.setName&&(this.setName=t.setName),!1;if(t&&t.ismaster&&!t.setName)return this.topologyType=this.primary?f:h,this.remove(e,{force:!0}),!1;if(t&&!t.ismaster&&!t.secondary&&!t.arbiterOnly)return this.remove(e,{force:!0}),!1;if(t.me&&t.me.toLowerCase()!==n)return this.logger.isWarn()&&this.logger.warn(o("the seedlist server was removed due to its address %s not matching its ismaster.me address %s",e.name,t.me)),delete this.set[n],x(e,this.unknownServers),e.destroy(),this.primary&&!this.primary.equals(e)?this.topologyType=f:this.topologyType=p,!this.primary&&t.primary&&(this.set[t.primary.toLowerCase()]={type:d,setName:null,electionId:null,setVersion:null}),!1;if(!this.primary&&t.ismaster&&t.setName){var i=e.lastIsMaster().electionId;if(this.setName&&this.setName!==t.setName)return this.topologyType=p,new u(o("setName from ismaster does not match provided connection setName [%s] != [%s]",t.setName,this.setName));if(!this.maxElectionId&&i)this.maxElectionId=i;else if(this.maxElectionId&&i){var a=I(this.maxElectionId,i),c=e.lastIsMaster().setVersion;if(1===a)return this.topologyType=p,!1;if(0===a&&c&&c<this.maxSetVersion)return this.topologyType=p,!1;this.maxSetVersion=c,this.maxElectionId=i}return-1!==t.hosts.map(function(e){return e.toLowerCase()}).indexOf(n)?(this.primary=e,this.set[n]={type:m,setVersion:t.setVersion,electionId:t.electionId,setName:t.setName},this.topologyType=f,t.setName&&(this.setName=t.setName),x(e,this.unknownServers),x(e,this.secondaries),x(e,this.passives),this.emit("joined","primary",e)):this.topologyType=p,A(this),!0}if(t.ismaster&&t.setName){var l=this.set[this.primary.name.toLowerCase()].electionId,w=this.set[this.primary.name.toLowerCase()].setVersion,_=this.set[this.primary.name.toLowerCase()].setName;i=e.lastIsMaster().electionId,c=e.lastIsMaster().setVersion;var T=e.lastIsMaster().setName;if(this.primary.equals(e)&&_===T)return!1;if(_&&_!==T)return this.primary.equals(e)?this.topologyType=p:this.topologyType=f,!1;if(l&&i){if(1===(a=I(l,i)))return!1;if(0===a&&w>c)return!1}else if(!l&&i&&c&&c<this.maxSetVersion)return!1;if(!this.maxElectionId&&i)this.maxElectionId=i;else if(this.maxElectionId&&i){if(1===(a=I(this.maxElectionId,i)))return!1;if(0===a&&w&&c){if(c<this.maxSetVersion)return!1}else if(c<this.maxSetVersion)return!1;this.maxElectionId=i,this.maxSetVersion=c}else this.maxSetVersion=c;return this.set[this.primary.name.toLowerCase()]={type:S,setVersion:null,electionId:null,setName:null},this.emit("left","primary",this.primary),this.primary.destroy(),this.primary=e,this.set[n]={type:m,setVersion:t.setVersion,electionId:t.electionId,setName:t.setName},this.topologyType=f,t.setName&&(this.setName=t.setName),x(e,this.unknownServers),x(e,this.secondaries),x(e,this.passives),this.emit("joined","primary",e),A(this),!0}return!this.primary&&t.primary&&(this.set[t.primary.toLowerCase()]={type:d,setVersion:null,electionId:null,setName:null}),t.secondary&&t.setName&&!E(t,e,this.secondaries)&&this.setName&&this.setName===t.setName?(N(this,y,t,e,this.secondaries),this.topologyType=this.primary?f:p,t.setName&&(this.setName=t.setName),x(e,this.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(e.destroy(),this.primary=null,this.emit("left","primary",e)),this.emit("joined","secondary",e),A(this),!0):O(t)&&!E(t,e,this.arbiters)&&this.setName&&this.setName===t.setName?(N(this,g,t,e,this.arbiters),this.topologyType=this.primary?f:p,t.setName&&(this.setName=t.setName),x(e,this.unknownServers),this.emit("joined","arbiter",e),A(this),!0):t.passive&&t.setName&&!E(t,e,this.passives)&&this.setName&&this.setName===t.setName?(N(this,y,t,e,this.passives),this.topologyType=this.primary?f:p,t.setName&&(this.setName=t.setName),x(e,this.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(e.destroy(),this.primary=null,this.emit("left","primary",e)),this.emit("joined","secondary",e),A(this),!0):this.set[n]&&this.set[n].type===m?(this.emit("left","primary",this.primary),this.primary.destroy(),this.primary=null,this.topologyType=p,!1):(this.topologyType=this.primary?f:p,!1)},w.prototype.updateServerMaxStaleness=function(e,t){for(var n=0,r=0;r<this.secondaries.length;r++)n=Math.max(n,this.secondaries[r].lastWriteDate);e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&this.hasPrimary()?e.staleness=e.lastUpdateTime-e.lastWriteDate-(this.primary.lastUpdateTime-this.primary.lastWriteDate)+t:e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&(e.staleness=n-e.lastWriteDate+t)},w.prototype.updateSecondariesMaxStaleness=function(e){for(var t=0;t<this.secondaries.length;t++)this.updateServerMaxStaleness(this.secondaries[t],e)},w.prototype.pickServer=function(e){if("primary"===(e=e||c.primary).preference&&null!=e.maxStalenessSeconds)return new u("primary readPreference incompatible with maxStalenessSeconds");var t=this.primary?[this.primary]:[];if(t=t.concat(this.secondaries),null!=e.maxStalenessSeconds)for(var n=0;n<t.length;n++)if(t[n].ismaster.maxWireVersion<5)return new u("maxStalenessSeconds not supported by at least one of the replicaset members");if("nearest"===e.preference&&null==e.maxStalenessSeconds)return C(this,e);if("nearest"===e.preference&&null!=e.maxStalenessSeconds)return T(this,e);var r=this.secondaries;if(e.equals(c.secondary)&&0===r.length)return new u("no secondary server available");if(e.equals(c.secondaryPreferred)&&0===r.length&&null==this.primary)return new u("no secondary or primary server available");if(e.equals(c.primary)&&null==this.primary)return new u("no primary server available");if(e.equals(c.secondaryPreferred)||e.equals(c.secondary)){if(r.length>0&&null==e.maxStalenessSeconds){var o=C(this,e);if(o)return o}else if(r.length>0&&null!=e.maxStalenessSeconds&&(o=T(this,e)))return o;return e.equals(c.secondaryPreferred)?this.primary:null}if(e.equals(c.primaryPreferred)){if(o=null,this.primary)return this.primary;if(r.length>0&&null==e.maxStalenessSeconds?o=C(this,e):r.length>0&&null!=e.maxStalenessSeconds&&(o=T(this,e)),o)return o}return this.primary};var _=function(e,t){if(null==e.tags)return t;for(var n=[],r=Array.isArray(e.tags)?e.tags:[e.tags],o=0;o<r.length;o++)for(var s=r[o],i=0;i<t.length;i++){var a=t[i].lastIsMaster().tags||{},c=!0;for(var u in s)a[u]!==s[u]&&(c=!1);c&&n.push(t[i])}return n};function T(e,t){var n=[],r=1e3*t.maxStalenessSeconds;if(r<9e4)return new u("maxStalenessSeconds must be set to at least 90 seconds");e.primary&&"secondary"!==t.preference&&"secondaryPreferred"!==t.preference&&n.push(e.primary);for(var o=0;o<e.secondaries.length;o++)n.push(e.secondaries[o]);if(e.primary&&0===n.length&&"secondaryPreferred"!==t.preference&&n.push(e.primary),(n=(n=_(t,n)).filter(function(e){return e.staleness<=r})).sort(function(e,t){return e.lastIsMasterMS-t.lastIsMasterMS}),0===n.length)return null;e.index=e.index%n.length;var s=n[e.index];return e.index=e.index+1,s}function C(e,t){var n=[];e.primary&&"secondary"!==t.preference&&"secondaryPreferred"!==t.preference&&n.push(e.primary);for(var r=0;r<e.secondaries.length;r++)n.push(e.secondaries[r]);0===n.length&&e.primary&&"secondaryPreferred"!==t.preference&&n.push(e.primary),(n=_(t,n)).sort(function(e,t){return e.lastIsMasterMS-t.lastIsMasterMS});var o=n.length>0?n[0].lastIsMasterMS:0;if(0===(n=n.filter(function(t){return t.lastIsMasterMS<=o+e.acceptableLatency})).length)return null;e.index=e.index%n.length;var s=n[e.index];return e.index=e.index+1,s}function E(e,t,n){for(var r=0;r<n.length;r++)if(n[r]&&n[r].name&&n[r].name.toLowerCase()===t.name.toLowerCase())return!0;return!1}function N(e,t,n,r,o){var s=r.name.toLowerCase();e.set[s].type=t,e.set[s].electionId=n?n.electionId:n,e.set[s].setName=n?n.setName:n,e.set[s].setVersion=n?n.setVersion:n,o.push(r)}function I(e,t){var n=l.from(e.toHexString(),"hex"),r=l.from(t.toHexString(),"hex");if(n===r)return 0;if("function"==typeof l.compare)return l.compare(n,r);for(var o=n.length,s=r.length,i=Math.min(o,s),a=0;a<i&&n[a]===r[a];a++);return a!==i&&(o=n[a],s=r[a]),o<s?-1:s<o?1:0}function x(e,t){for(var n=0;n<t.length;n++){if(t[n].equals&&t[n].equals(e))return t.splice(n,1),!0;if("string"==typeof t[n]&&t[n].toLowerCase()===e.name.toLowerCase())return t.splice(n,1),!0}return!1}function A(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown",n=e.setName;e.hasPrimaryAndSecondary()?t="ReplicaSetWithPrimary":!e.hasPrimary()&&e.hasSecondary()&&(t="ReplicaSetNoPrimary");var r={topologyType:t,setName:n,servers:[]};if(e.hasPrimary()){var o=e.primary.getDescription();o.type="RSPrimary",r.servers.push(o)}r.servers=r.servers.concat(e.secondaries.map(function(e){var t=e.getDescription();return t.type="RSSecondary",t})),r.servers=r.servers.concat(e.arbiters.map(function(e){var t=e.getDescription();return t.type="RSArbiter",t})),r.servers=r.servers.concat(e.passives.map(function(e){var t=e.getDescription();return t.type="RSSecondary",t}));var i=s(e.replicasetDescription,r),a={topologyId:e.id,previousDescription:e.replicasetDescription,newDescription:r,diff:i};e.emit("topologyDescriptionChanged",a),e.replicasetDescription=r}}e.exports=w},function(e,t,n){"use strict";const r=n(1).inherits,o=n(1).format,s=n(9).EventEmitter,i=n(110),a=n(56),c=n(25).retrieveBSON,u=n(11).MongoError,l=n(153),p=n(20).clone,f=n(20).diff,h=n(20).cloneOptions,d=n(20).createClientInfo,m=n(20).SessionMixins,y=n(20).isRetryableWritesSupported,g=n(35).relayEvents,b=n(11).isRetryableError,v=c(),S=n(108).defaultAuthProviders;var w="disconnected",O="connecting",_="connected",T="unreferenced",C="destroyed";function E(e,t){var n={disconnected:[O,C,w],connecting:[O,C,_,w],connected:[_,w,C,T],unreferenced:[T,C],destroyed:[C]}[e.state];n&&-1!==n.indexOf(t)?e.state=t:e.logger.error(o("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}var N=1,I=["connect","close","error","timeout","parseError"],x=function(e,t){t=t||{},this.id=N++,this.s={options:Object.assign({},t),bson:t.bson||new v([v.Binary,v.Code,v.DBRef,v.Decimal128,v.Double,v.Int32,v.Long,v.Map,v.MaxKey,v.MinKey,v.ObjectId,v.BSONRegExp,v.Symbol,v.Timestamp]),Cursor:t.cursorFactory||i,logger:a("Mongos",t),seedlist:e,haInterval:t.haInterval?t.haInterval:1e4,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof t.debug&&t.debug,localThresholdMS:t.localThresholdMS||15,clientInfo:d(t),authenticationContexts:[]},this.s.options.clientInfo=d(t),this.s.logger.isWarn()&&0!==this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(o("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval)),this.authProviders=t.authProviders||S(this.s.bson),this.state=w,this.connectingProxies=[],this.connectedProxies=[],this.disconnectedProxies=[],this.authenticating=!1,this.index=0,this.haTimeoutId=null,this.ismaster=null,this.topologyDescription={topologyType:"Unknown",servers:[]},this.clusterTime=null,s.call(this)};function A(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}r(x,s),Object.assign(x.prototype,m),Object.defineProperty(x.prototype,"type",{enumerable:!0,get:function(){return"mongos"}}),Object.defineProperty(x.prototype,"parserType",{enumerable:!0,get:function(){return v.native?"c++":"js"}}),Object.defineProperty(x.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}});const k=["serverDescriptionChanged","error","close","timeout","parseError"];function B(e,t){t=t||{},k.forEach(t=>e.removeAllListeners(t)),e.destroy(t)}function M(e){return function(){e.state!==C&&(P(e.connectedProxies,e.disconnectedProxies,this),$(e),e.emit("left","mongos",this),e.emit("serverClosed",{topologyId:e.id,address:this.name}))}}function D(e,t){return function(){var n=this;if(e.state===C)return $(e),P(e.connectingProxies,e.disconnectedProxies,this),this.destroy();if("connect"===t?U(e,n,function(){if(e.ismaster=n.lastIsMaster(),"isdbgrid"===e.ismaster.msg){for(var t=0;t<e.connectedProxies.length;t++)if(e.connectedProxies[t].name===n.name)return P(e.connectingProxies,e.disconnectedProxies,n),$(e),n.destroy(),e.emit("failed",n);for(t=0;t<I.length;t++)n.removeAllListeners(I[t]);n.on("error",M(e)),n.on("close",M(e)),n.on("timeout",M(e)),n.on("parseError",M(e)),P(e.connectingProxies,e.connectedProxies,n),e.emit("joined","mongos",n)}else{if(e.s.logger.isWarn()){var r="expected mongos proxy, but found replicaset member mongod for server %s";e.ismaster.hosts||(r="expected mongos proxy, but found standalone mongod for server %s"),e.s.logger.warn(o(r,n.name))}L(e.connectingProxies,n),e.emit("left","server",n),e.emit("failed",n)}}):(P(e.connectingProxies,e.disconnectedProxies,this),e.emit("left","mongos",this),e.emit("failed",this)),$(e),0===e.connectingProxies.length){if(e.connectedProxies.length>0&&e.state===O)E(e,_),e.emit("connect",e),e.emit("fullsetup",e),e.emit("all",e);else if(0===e.disconnectedProxies.length)return e.s.logger.isWarn()&&e.s.logger.warn(o("no mongos proxies found in seed list, did you mean to connect to a replicaset")),e.emit("error",new u("no mongos proxies found in seed list"));!function e(t,n){n=n||{};t.haTimeoutId=setTimeout(function(){if(t.state!==C&&t.state!==T){t.isConnected()&&t.s.disconnectHandler&&t.s.disconnectHandler.execute();var r=t.connectedProxies.slice(0),o=r.length;if(0===r.length)return t.listeners("close").length>0&&t.state===O?t.emit("error",new u("no mongos proxy available")):t.emit("close",t),j(t,t.disconnectedProxies,function(){t.state!==C&&t.state!==T&&(t.state===O&&n.firstConnect?(t.emit("connect",t),t.emit("fullsetup",t),t.emit("all",t)):t.isConnected()?t.emit("reconnect",t):!t.isConnected()&&t.listeners("close").length>0&&t.emit("close",t),e(t))});for(var s=0;s<r.length;s++)i(t,r[s],function(){if(0===(o-=1)){if(t.state===C||t.state===T)return;j(t,t.disconnectedProxies,function(){t.state!==C&&t.state!==T&&e(t)})}})}function i(e,n,r){var o=(new Date).getTime();A(t,"serverHeartbeatStarted",{connectionId:n.name}),n.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:t.s.options.connectionTimeout||2e3},function(e,s){if(t.state===C||t.state===T)return P(t.connectedProxies,t.disconnectedProxies,n),n.destroy(),r(e,s);var i=(new Date).getTime()-o;e?(A(t,"serverHeartbeatFailed",{durationMS:i,failure:e,connectionId:n.name}),P(t.connectedProxies,t.disconnectedProxies,n)):(n.ismaster=s.result,n.lastIsMasterMS=i,A(t,"serverHeartbeatSucceeded",{durationMS:i,reply:s.result,connectionId:n.name})),r(e,s)})}},t.s.haInterval)}(e,{firstConnect:!0})}}}function R(e){for(var t=e.connectedProxies.slice(0),n=Number.MAX_VALUE,r=0;r<t.length;r++)t[r].lastIsMasterMS<n&&(n=t[r].lastIsMasterMS);if(0===(t=t.filter(function(t){if(t.lastIsMasterMS<=n+e.s.localThresholdMS&&t.isConnected())return!0})).length)return e.connectedProxies[0];var o=t[e.index%t.length];return e.index=(e.index+1)%t.length,o}function P(e,t,n){for(var r=0;r<e.length;r++)e[r].name===n.name&&e.splice(r,1);for(r=0;r<t.length;r++)t[r].name===n.name&&t.splice(r,1);t.push(n)}function L(e,t){for(var n=0;n<e.length;n++)e[n].name===t.name&&e.splice(n,1)}function j(e,t,n){var r=t.length,o=function(e,t){return function(){var o=this;if(r-=1,e.state===C||e.state===T)return P(e.connectingProxies,e.disconnectedProxies,o),this.destroy();"connect"!==t||e.authenticating?(P(e.connectingProxies,e.disconnectedProxies,o),this.destroy()):U(e,o,function(){if(e.state===C||e.state===T)return P(e.connectingProxies,e.disconnectedProxies,o),o.destroy();for(var t=0;t<I.length;t++)o.removeAllListeners(I[t]);o.on("error",M(e)),o.on("close",M(e)),o.on("timeout",M(e)),o.on("parseError",M(e)),P(e.connectingProxies,e.connectedProxies,o),$(e),e.emit("joined","mongos",o)}),0===r&&n()}};if(0===r)return n();function s(t,n){setTimeout(function(){if(e.state!==C&&e.state!==T){var n=new l(Object.assign({},e.s.options,{host:t.name.split(":")[0],port:parseInt(t.name.split(":")[1],10),authProviders:e.authProviders,reconnect:!1,monitoring:!1,parent:e,clientInfo:p(e.s.clientInfo)}));B(t),L(e.disconnectedProxies,t),g(n,e,["serverDescriptionChanged"]),e.emit("serverOpening",{topologyId:-1!==n.s.topologyId?n.s.topologyId:e.id,address:n.name}),n.once("connect",o(e,"connect")),n.once("close",o(e,"close")),n.once("timeout",o(e,"timeout")),n.once("error",o(e,"error")),n.once("parseError",o(e,"parseError")),g(n,e,["commandStarted","commandSucceeded","commandFailed"]),e.connectingProxies.push(n),n.connect(e.s.connectOptions)}},n)}for(var i=0;i<t.length;i++)s(t[i],i)}function U(e,t,n){if(0===e.s.authenticationContexts.length)return n();!function e(t,n,r){if(0===t.length)return r();var o=t.shift().slice(0);o.push(function(){e(t,n,r)}),n.auth.apply(n,o)}(e.s.authenticationContexts.slice(0),t,n)}x.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{},E(this,O);var n=this.s.seedlist.map(function(e){const n=new l(Object.assign({},t.s.options,e,{authProviders:t.authProviders,reconnect:!1,monitoring:!1,parent:t,clientInfo:p(t.s.clientInfo)}));return g(n,t,["serverDescriptionChanged"]),n});A(this,"topologyOpening",{topologyId:this.id}),function(e,t){e.connectingProxies=e.connectingProxies.concat(t);var n=0;function r(t,n){setTimeout(function(){e.emit("serverOpening",{topologyId:e.id,address:t.name}),$(e),t.once("close",D(e,"close")),t.once("timeout",D(e,"timeout")),t.once("parseError",D(e,"parseError")),t.once("error",D(e,"error")),t.once("connect",D(e,"connect")),g(t,e,["commandStarted","commandSucceeded","commandFailed"]),t.connect(e.s.connectOptions)},n)}for(;t.length>0;)r(t.shift(),n++)}(t,n)},x.prototype.lastIsMaster=function(){return this.ismaster},x.prototype.unref=function(){E(this,T),this.connectedProxies.concat(this.connectingProxies).forEach(function(e){e.unref()}),clearTimeout(this.haTimeoutId)},x.prototype.destroy=function(e){var t=this;E(this,C);var n=this.connectedProxies.concat(this.connectingProxies);this.haTimeoutId&&clearTimeout(this.haTimeoutId),this.s.authenticationContexts=[],n.forEach(function(n){t.emit("serverClosed",{topologyId:t.id,address:n.name}),B(n,e),P(t.connectedProxies,t.disconnectedProxies,n)}),$(t),A(this,"topologyClosed",{topologyId:this.id})},x.prototype.isConnected=function(){return this.connectedProxies.length>0},x.prototype.isDestroyed=function(){return this.state===C};var z=function(e,t,n,r,o,s){"function"==typeof o&&(s=o,o={}),o=o||{};let i=R(e);return i?o.retryWrites&&o.session&&y(e)?(o.willRetryWrite=!0,o.session.incrementTransactionNumber(),void i[t](n,r,o,(a,c)=>a?b(a)&&(i=R(e))&&y(i)?void i[t](n,r,o,s):s(a):s(null,c))):i[t](n,r,o,s):s(new u("no mongos proxy available"))};x.prototype.insert=function(e,t,n,r){return"function"==typeof n&&(r=n,n=(n={})||{}),this.state===C?r(new u(o("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void z(this,"insert",e,t,n,r):r(new u("no mongos proxy available")):this.s.disconnectHandler.add("insert",e,t,n,r)},x.prototype.update=function(e,t,n,r){return"function"==typeof n&&(r=n,n=(n={})||{}),this.state===C?r(new u(o("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void z(this,"update",e,t,n,r):r(new u("no mongos proxy available")):this.s.disconnectHandler.add("update",e,t,n,r)},x.prototype.remove=function(e,t,n,r){return"function"==typeof n&&(r=n,n=(n={})||{}),this.state===C?r(new u(o("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void z(this,"remove",e,t,n,r):r(new u("no mongos proxy available")):this.s.disconnectHandler.add("remove",e,t,n,r)};const q=["findAndModify","insert","update","delete"];function $(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown";e.connectedProxies.length>0&&(t="Sharded");var n={topologyType:t,servers:[]},r=e.disconnectedProxies.concat(e.connectingProxies);n.servers=n.servers.concat(r.map(function(e){var t=e.getDescription();return t.type="Unknown",t})),n.servers=n.servers.concat(e.connectedProxies.map(function(e){var t=e.getDescription();return t.type="Mongos",t}));var o=f(e.topologyDescription,n),s={topologyId:e.id,previousDescription:e.topologyDescription,newDescription:n,diff:o};o.servers.length>0&&e.emit("topologyDescriptionChanged",s),e.topologyDescription=n}}x.prototype.command=function(e,t,n,r){if("function"==typeof n&&(r=n,n=(n={})||{}),this.state===C)return r(new u(o("topology was destroyed")));var s=R(this);if((null==s||!s.isConnected())&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,r);if(null==s)return r(new u("no mongos proxy available"));var i=h(n);i.topology=this;const a=!n.retrying&&n.retryWrites&&n.session&&y(this)&&!n.session.inTransaction()&&function(e){return q.some(t=>e[t])}(t);a&&(n.session.incrementTransactionNumber(),n.willRetryWrite=a),s.command(e,t,i,(n,o)=>{if(!n)return r(null,o);if(!b(n))return r(n);if(a){const n=Object.assign({},i,{retrying:!0});return this.command(e,t,n,r)}return r(n)})},x.prototype.cursor=function(e,t,n){const r=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(this.s.bson,e,t,n,r,this.s.options)},x.prototype.auth=function(e,t){var n=Array.prototype.slice.call(arguments,0).slice(0),r=this,s=Array.prototype.slice.call(arguments,2),i=s.pop(),a=0;if(null==this.authProviders[e]&&"default"!==e)return i(new u(o("auth provider %s does not exist",e)));if(this.authenticating)return i(new u("authentication or logout allready in process"));if(!r.isConnected()&&null!=r.s.disconnectHandler)return r.s.disconnectHandler.add("auth",t,n,{},i);this.authenticating=!0;var c=[],l=this.connectedProxies.slice(0);function p(n){var o=[e,t].concat(s.slice(0)).concat([function(e){if(f-=1,e&&c.push({name:n.name,err:e}),0===f){if(r.authenticating=!1,c.length)return r.s.authenticationContexts.splice(a,0),i(new u({message:"authentication fail",errors:c}),!1);i(null,r)}}]);n.lastIsMaster().arbiterOnly||n.auth.apply(n,o)}0===l.length&&(this.authenticating=!1,i(null,!0)),a=this.s.authenticationContexts.length,this.s.authenticationContexts.push([e,t].concat(s.slice(0)));for(var f=l.length;l.length>0;)p(l.shift())},x.prototype.logout=function(e,t){var n=this;if(this.authenticating)throw new u("authentication or logout allready in process");this.authenticating=!0;for(var r=Object.keys(this.authProviders),s=0;s<r.length;s++)this.authProviders[r[s]].logout(e);var i=this.connectedProxies.slice(0),a=i.length;if(0===a)return t();var c=[];function l(t,n){t.logout(e,function(e){e&&c.push({name:t.name,err:e}),n()})}for(s=0;s<i.length;s++)l(i[s],function(){if(0===(a-=1)){if(n.authenticating=!1,c.length)return t(new u({message:o("logout failed against db %s",e),errors:c}),!1);t()}})},x.prototype.selectServer=function(e,t,n){"function"==typeof e&&void 0===n&&(n=e,e=void 0,t={}),"function"==typeof t&&(n=t,t=e,e=void 0),t=t||{};const r=R(this);this.s.debug&&this.emit("pickedServer",null,r),n(null,r)},x.prototype.connections=function(){for(var e=[],t=0;t<this.connectedProxies.length;t++)e=e.concat(this.connectedProxies[t].connections());return e},e.exports=x},function(e,t,n){"use strict";const r=n(25).retrieveBSON,o=n(9),s=r().Binary,i=n(35).uuidV4,a=n(11).MongoError,c=n(11).isRetryableError,u=n(11).MongoNetworkError,l=n(11).MongoWriteConcernError,p=n(154).Transaction,f=n(154).TxnState;function h(e,t){if(null==e.serverSession){const e=new a("Cannot use a session that has ended");if("function"==typeof t)return t(e,null),!1;throw e}return!0}class d extends o{constructor(e,t,n,r){if(super(),null==e)throw new Error("ClientSession requires a topology");if(null==t||!(t instanceof g))throw new Error("ClientSession requires a ServerSessionPool");n=n||{},this.topology=e,this.sessionPool=t,this.hasEnded=!1,this.serverSession=t.acquire(),this.clientOptions=r,this.supports={causalConsistency:void 0===n.causalConsistency||n.causalConsistency},void 0!==(n=n||{}).initialClusterTime?this.clusterTime=n.initialClusterTime:this.clusterTime=null,this.operationTime=null,this.explicit=!!n.explicit,this.owner=n.owner,this.defaultTransactionOptions=Object.assign({},n.defaultTransactionOptions),this.transaction=new p}get id(){return this.serverSession.id}endSession(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},this.hasEnded?"function"==typeof t&&t(null,null):(this.serverSession&&this.inTransaction()&&this.abortTransaction(),this.hasEnded=!0,this.emit("ended",this),this.sessionPool.release(this.serverSession),"function"==typeof t&&t(null,null))}advanceOperationTime(e){null!=this.operationTime?e.greaterThan(this.operationTime)&&(this.operationTime=e):this.operationTime=e}equals(e){return e instanceof d&&this.id.id.buffer.equals(e.id.id.buffer)}incrementTransactionNumber(){this.serverSession.txnNumber++}inTransaction(){return this.transaction.isActive}startTransaction(e){if(h(this),this.inTransaction())throw new a("Transaction already in progress");this.incrementTransactionNumber(),this.transaction=new p(Object.assign({},this.clientOptions,e||this.defaultTransactionOptions)),this.transaction.transition(f.STARTING_TRANSACTION)}commitTransaction(e){if("function"!=typeof e)return new Promise((e,t)=>{m(this,"commitTransaction",(n,r)=>n?t(n):e(r))});m(this,"commitTransaction",e)}abortTransaction(e){if("function"!=typeof e)return new Promise((e,t)=>{m(this,"abortTransaction",(n,r)=>n?t(n):e(r))});m(this,"abortTransaction",e)}toBSON(){throw new Error("ClientSession cannot be serialized to BSON.")}}function m(e,t,n){if(!h(e,n))return;let r=e.transaction.state;if(r===f.NO_TRANSACTION)return void n(new a("No transaction started"));if("commitTransaction"===t){if(r===f.STARTING_TRANSACTION||r===f.TRANSACTION_COMMITTED_EMPTY)return e.transaction.transition(f.TRANSACTION_COMMITTED_EMPTY),void n(null,null);if(r===f.TRANSACTION_ABORTED)return void n(new a("Cannot call commitTransaction after calling abortTransaction"))}else{if(r===f.STARTING_TRANSACTION)return e.transaction.transition(f.TRANSACTION_ABORTED),void n(null,null);if(r===f.TRANSACTION_ABORTED)return void n(new a("Cannot call abortTransaction twice"));if(r===f.TRANSACTION_COMMITTED||r===f.TRANSACTION_COMMITTED_EMPTY)return void n(new a("Cannot call abortTransaction after calling commitTransaction"))}const o={[t]:1};function s(r,o){if("commitTransaction"===t){if(e.transaction.transition(f.TRANSACTION_COMMITTED),r&&(r instanceof u||r instanceof l||c(r))){if(r.errorLabels){const e=r.errorLabels.indexOf("TransientTransactionError");-1!==e&&r.errorLabels.splice(e,1)}else r.errorLabels=[];r.errorLabels.push("UnknownTransactionCommitResult")}}else e.transaction.transition(f.TRANSACTION_ABORTED);n(r,o)}function i(e){return"commitTransaction"===t?e:null}e.transaction.options.writeConcern?Object.assign(o,{writeConcern:e.transaction.options.writeConcern}):e.clientOptions&&e.clientOptions.w&&Object.assign(o,{writeConcern:{w:e.clientOptions.w}}),e.topology.command("admin.$cmd",o,{session:e},(t,n)=>{if(t&&c(t))return e.topology.command("admin.$cmd",o,{session:e},(e,t)=>s(i(e),t));s(i(t),n)})}class y{constructor(){this.id={id:new s(i(),s.SUBTYPE_UUID)},this.lastUse=Date.now(),this.txnNumber=0}hasTimedOut(e){return Math.round((Date.now()-this.lastUse)%864e5%36e5/6e4)>e-1}}class g{constructor(e){if(null==e)throw new Error("ServerSessionPool requires a topology");this.topology=e,this.sessions=[]}endAllPooledSessions(){this.sessions.length&&(this.topology.endSessions(this.sessions.map(e=>e.id)),this.sessions=[])}acquire(){const e=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){const t=this.sessions.shift();if(!t.hasTimedOut(e))return t}return new y}release(e){const t=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){if(!this.sessions[this.sessions.length-1].hasTimedOut(t))break;this.sessions.pop()}e.hasTimedOut(t)||this.sessions.unshift(e)}}e.exports={ClientSession:d,ServerSession:y,ServerSessionPool:g,TxnState:f}},function(e,t,n){"use strict";const r=n(65),o=n(96),s=n(66),i=n(11).MongoParseError,a=n(55),c=/(mongodb(?:\+srv|)):\/\/(?: (?:[^:]*) (?: : ([^@]*) )? @ )?([^/?]*)(?:\/|)(.*)/;function u(e,t){const n=/^.*?\./,r=`.${e.replace(n,"")}`,o=`.${t.replace(n,"")}`;return r.endsWith(o)}function l(e,t){if(Array.isArray(t))1===(t=t.filter((e,n)=>t.indexOf(e)===n)).length&&(t=t[0]);else if(t.indexOf(":")>0)t=t.split(",").reduce((t,n)=>{const r=n.split(":");return t[r[0]]=l(e,r[1]),t},{});else if(t.indexOf(",")>0)t=t.split(",").map(t=>l(e,t));else if("true"===t.toLowerCase()||"false"===t.toLowerCase())t="true"===t.toLowerCase();else if(!Number.isNaN(t)&&!f.has(e)){const e=parseFloat(t);Number.isNaN(e)||(t=parseFloat(t))}return t}const p=new Set(["slaveok","slave_ok","sslvalidate","fsync","safe","retrywrites","j"]),f=new Set(["authsource","replicaset"]),h=new Set(["GSSAPI","MONGODB-X509","MONGODB-CR","DEFAULT","SCRAM-SHA-1","SCRAM-SHA-256","PLAIN"]),d={replicaset:"replicaSet",connecttimeoutms:"connectTimeoutMS",sockettimeoutms:"socketTimeoutMS",maxpoolsize:"maxPoolSize",minpoolsize:"minPoolSize",maxidletimems:"maxIdleTimeMS",waitqueuemultiple:"waitQueueMultiple",waitqueuetimeoutms:"waitQueueTimeoutMS",wtimeoutms:"wtimeoutMS",readconcern:"readConcern",readconcernlevel:"readConcernLevel",readpreference:"readPreference",maxstalenessseconds:"maxStalenessSeconds",readpreferencetags:"readPreferenceTags",authsource:"authSource",authmechanism:"authMechanism",authmechanismproperties:"authMechanismProperties",gssapiservicename:"gssapiServiceName",localthresholdms:"localThresholdMS",serverselectiontimeoutms:"serverSelectionTimeoutMS",serverselectiontryonce:"serverSelectionTryOnce",heartbeatfrequencyms:"heartbeatFrequencyMS",appname:"appName",retrywrites:"retryWrites",uuidrepresentation:"uuidRepresentation",zlibcompressionlevel:"zlibCompressionLevel"};function m(e,t,n,r){if("journal"===t?t="j":"wtimeoutms"===t&&(t="wtimeout"),p.has(t)?n="true"===n||!0===n:"appname"===t?n=decodeURIComponent(n):"readconcernlevel"===t&&(t="readconcern",n={level:n}),"compressors"===t&&!(n=Array.isArray(n)?n:[n]).every(e=>"snappy"===e||"zlib"===e))throw new i("Value for `compressors` must be at least one of: `snappy`, `zlib`");if("authmechanism"===t&&!h.has(n))throw new i("Value for `authMechanism` must be one of: `DEFAULT`, `GSSAPI`, `PLAIN`, `MONGODB-X509`, `SCRAM-SHA-1`, `SCRAM-SHA-256`");if("readpreference"===t&&!a.isValid(n))throw new i("Value for `readPreference` must be one of: `primary`, `primaryPreferred`, `secondary`, `secondaryPreferred`, `nearest`");if("zlibcompressionlevel"===t&&(n<-1||n>9))throw new i("zlibCompressionLevel must be an integer between -1 and 9");"compressors"!==t&&"zlibcompressionlevel"!==t||(e.compression=e.compression||{},e=e.compression),"authmechanismproperties"===t&&("string"==typeof n.SERVICE_NAME&&(e.gssapiServiceName=n.SERVICE_NAME),"string"==typeof n.SERVICE_REALM&&(e.gssapiServiceRealm=n.SERVICE_REALM),void 0!==n.CANONICALIZE_HOST_NAME&&(e.gssapiCanonicalizeHostName=n.CANONICALIZE_HOST_NAME)),r.caseTranslate&&d[t]?e[d[t]]=n:e[t]=n}const y=new Set(["GSSAPI","MONGODB-CR","PLAIN","SCRAM-SHA-1","SCRAM-SHA-256"]);const g="mongodb+srv",b=["mongodb",g];function v(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({},{caseTranslate:!0},t);try{r.parse(e)}catch(e){return n(new i("URI malformed, cannot be parsed"))}const a=e.match(c);if(!a)return n(new i("Invalid connection string"));const p=a[1];if(-1===b.indexOf(p))return n(new i("Invalid protocol provided"));if(p===g)return function(e,t,n){const a=r.parse(e,!0);if(a.hostname.split(".").length<3)return n(new i("URI does not have hostname, domain name and tld"));if(a.domainLength=a.hostname.split(".").length,a.pathname&&a.pathname.match(","))return n(new i("Invalid URI, cannot contain multiple hostnames"));if(a.port)return n(new i(`Ports not accepted with '${g}' URIs`));const c=a.host;s.resolveSrv(`_mongodb._tcp.${c}`,(e,l)=>{if(e)return n(e);if(0===l.length)return n(new i("No addresses found at host"));for(let e=0;e<l.length;e++)if(!u(l[e].name,a.hostname,a.domainLength))return n(new i("Server record does not share hostname with parent URI"));a.protocol="mongodb",a.host=l.map(e=>`${e.name}:${e.port}`).join(","),"ssl"in t||a.search&&"ssl"in a.query&&null!==a.query.ssl||(a.query.ssl=!0),s.resolveTxt(c,(e,s)=>{if(e){if("ENODATA"!==e.code)return n(e);s=null}if(s){if(s.length>1)return n(new i("Multiple text records not allowed"));if(s=o.parse(s[0].join("")),Object.keys(s).some(e=>"authSource"!==e&&"replicaSet"!==e))return n(new i("Text record must only set `authSource` or `replicaSet`"));Object.assign(a.query,s)}a.search=o.stringify(a.query),v(r.format(a),t,n)})})}(e,t,n);const f=a[4].split("?"),h=f.length>0?f[0]:null,d=f.length>1?f[1]:null;let S;try{S=function(e,t){const n={};let r=o.parse(e);for(const e in r){const o=r[e];if(""===o||null==o)throw new i("Incomplete key value pair for option");const s=e.toLowerCase();m(n,s,l(s,o),t)}return n.wtimeout&&n.wtimeoutms&&(delete n.wtimeout,console.warn("Unsupported option `wtimeout` specified")),Object.keys(n).length?n:null}(d,t)}catch(e){return n(e)}S=Object.assign({},S,t);const w={username:null,password:null,db:h&&""!==h?o.unescape(h):null};if(S.auth&&(S.auth.username&&(w.username=S.auth.username),S.auth.user&&(w.username=S.auth.user),S.auth.password&&(w.password=S.auth.password)),-1!==a[4].split("?")[0].indexOf("@"))return n(new i("Unescaped slash in userinfo section"));const O=a[3].split("@");if(O.length>2)return n(new i("Unescaped at-sign in authority section"));if(O.length>1){const e=O.shift().split(":");if(e.length>2)return n(new i("Unescaped colon in authority section"));w.username=o.unescape(e[0]),w.password=e[1]?o.unescape(e[1]):null}let _=null;const T=O.shift().split(",").map(e=>{let t=r.parse(`mongodb://${e}`);if("/:"===t.path)return _=new i("Double colon in host identifier"),null;if(e.match(/\.sock/)&&(t.hostname=o.unescape(e),t.port=null),Number.isNaN(t.port))return void(_=new i("Invalid port (non-numeric string)"));const n={host:t.hostname,port:t.port?parseInt(t.port):27017};if(0!==n.port)if(n.port>65535)_=new i("Invalid port (larger than 65535) with hostname");else{if(!(n.port<0))return n;_=new i("Invalid port (negative number)")}else _=new i("Invalid port (zero) with hostname")}).filter(e=>!!e);if(_)return n(_);if(0===T.length||""===T[0].host||null===T[0].host)return n(new i("No hostname or hostnames provided in connection string"));const C={hosts:T,auth:w.db||w.username?w:null,options:Object.keys(S).length?S:null};C.auth&&C.auth.db&&(C.defaultDatabase=C.auth.db);try{!function(e){if(null==e.options)return;const t=e.options,n=t.authsource||t.authSource;null!=n&&(e.auth=Object.assign({},e.auth,{db:n}));const r=t.authmechanism||t.authMechanism;if(null!=r){if(y.has(r)&&(!e.auth||null==e.auth.username))throw new i(`Username required for mechanism \`${r}\``);if("GSSAPI"===r){if(null!=n&&"$external"!==n)throw new i(`Invalid source \`${n}\` for mechanism \`${r}\` specified.`);e.auth=Object.assign({},e.auth,{db:"$external"})}if("MONGODB-X509"===r){if(e.auth&&null!=e.auth.password)throw new i(`Password not allowed for mechanism \`${r}\``);if(null!=n&&"$external"!==n)throw new i(`Invalid source \`${n}\` for mechanism \`${r}\` specified.`);e.auth=Object.assign({},e.auth,{db:"$external"})}"PLAIN"===r&&e.auth&&null==e.auth.db&&(e.auth=Object.assign({},e.auth,{db:"$external"}))}e.auth&&null==e.auth.db&&(e.auth=Object.assign({},e.auth,{db:"admin"}))}(C)}catch(e){return n(e)}n(null,C)}e.exports=v},function(e,t,n){"use strict";const r=n(9).EventEmitter;e.exports=class extends r{constructor(){super()}instrument(e,t){this.$MongoClient=e;const n=this.$prototypeConnect=e.prototype.connect,r=this;e.prototype.connect=function(e){return this.s.options.monitorCommands=!0,this.on("commandStarted",e=>r.emit("started",e)),this.on("commandSucceeded",e=>r.emit("succeeded",e)),this.on("commandFailed",e=>r.emit("failed",e)),n.call(this,e)},"function"==typeof t&&t(null,this)}uninstrument(){this.$MongoClient.prototype.connect=this.$prototypeConnect}}},function(e,t,n){"use strict";const r=n(6).MongoNetworkError,o=n(6).mongoErrorContextSymbol,s=new Set([136,237,11601]);e.exports={GET_MORE_NON_RESUMABLE_CODES:s,isResumableError:function(e){return!!function(e){if(e[o])return e[o].isGetMore}(e)&&!!(e instanceof r||!s.has(e.code)||e.message.match(/not master/)||e.message.match(/node is recovering/))}}},function(e,t,n){"use strict";const r=n(112),o=r.BulkOperationBase,s=n(5),i=s.toError,a=s.handleCallback,c=r.BulkWriteResult,u=r.Batch,l=r.mergeBatchResults,p=s.executeOperation,f=n(6).MongoWriteConcernError,h=n(112).handleMongoWriteConcernError,d=r.bson;function m(e,t,n){const o=d.calculateObjectSize(n,{checkKeys:!1});if(o>=e.s.maxBatchSizeBytes)throw i("document is larger than the maximum size "+e.s.maxBatchSizeBytes);if(e.s.currentBatch=null,t===r.INSERT?e.s.currentBatch=e.s.currentInsertBatch:t===r.UPDATE?e.s.currentBatch=e.s.currentUpdateBatch:t===r.REMOVE&&(e.s.currentBatch=e.s.currentRemoveBatch),null==e.s.currentBatch&&(e.s.currentBatch=new u(t,e.s.currentIndex)),(e.s.currentBatch.size+1>=e.s.maxWriteBatchSize||e.s.currentBatch.sizeBytes+o>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!==t)&&(e.s.batches.push(e.s.currentBatch),e.s.currentBatch=new u(t,e.s.currentIndex)),Array.isArray(n))throw i("operation passed in cannot be an Array");return e.s.currentBatch.operations.push(n),e.s.currentBatch.originalIndexes.push(e.s.currentIndex),e.s.currentIndex=e.s.currentIndex+1,t===r.INSERT?(e.s.currentInsertBatch=e.s.currentBatch,e.s.bulkResult.insertedIds.push({index:e.s.bulkResult.insertedIds.length,_id:n._id})):t===r.UPDATE?e.s.currentUpdateBatch=e.s.currentBatch:t===r.REMOVE&&(e.s.currentRemoveBatch=e.s.currentBatch),e.s.currentBatch.size=e.s.currentBatch.size+1,e.s.currentBatch.sizeBytes=e.s.currentBatch.sizeBytes+o,e}class y extends o{constructor(e,t,n){n=n||{},super(e,t,n=Object.assign(n,{addToOperationsList:m}),!1)}execute(e,t,n){const r=this.bulkExecute(e,t,n);return t=r.options,n=r.callback,p(this.s.topology,b,[this,t,n])}}function g(e,t,n,r){e.finalOptionsHandler({options:n,batch:t,resultHandler:function(n,o){return!(n&&n.driver||n&&n.message)||n instanceof f?(n&&(n.ok=0),n instanceof f?h(t,e.s.bulkResult,!1,n,r):void a(r,null,l(!1,t,e.s.bulkResult,n,o))):a(r,n)}},r)}function b(e,t,n){let r=e.s.batches.length;for(let o=0;o<e.s.batches.length;o++)g(e,e.s.batches[o],t,function(t){if(0===(r-=1)){if(t)return a(n,t);const r=new c(e.s.bulkResult);if(e.handleWriteError(n,r))return;return a(n,null,r)}})}function v(e,t,n){return new y(e,t,n)}v.UnorderedBulkOperation=y,e.exports=v,e.exports.Bulk=y},function(e,t,n){"use strict";const r=n(112),o=r.BulkOperationBase,s=n(5),i=s.toError,a=s.handleCallback,c=r.BulkWriteResult,u=r.Batch,l=r.mergeBatchResults,p=s.executeOperation,f=n(6).MongoWriteConcernError,h=n(112).handleMongoWriteConcernError,d=r.bson;function m(e,t,n){const o=d.calculateObjectSize(n,{checkKeys:!1});if(o>=e.s.maxBatchSizeBytes)throw i("document is larger than the maximum size "+e.s.maxBatchSizeBytes);if(null==e.s.currentBatch&&(e.s.currentBatch=new u(t,e.s.currentIndex)),e.s.currentBatchSize+1>=e.s.maxWriteBatchSize||e.s.currentBatchSizeBytes+e.s.currentBatchSizeBytes>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!==t?(e.s.batches.push(e.s.currentBatch),e.s.currentBatch=new u(t,e.s.currentIndex),e.s.currentBatchSize=0,e.s.currentBatchSizeBytes=0):(e.s.currentBatchSize=e.s.currentBatchSize+1,e.s.currentBatchSizeBytes=e.s.currentBatchSizeBytes+o),t===r.INSERT&&e.s.bulkResult.insertedIds.push({index:e.s.currentIndex,_id:n._id}),Array.isArray(n))throw i("operation passed in cannot be an Array");return e.s.currentBatch.originalIndexes.push(e.s.currentIndex),e.s.currentBatch.operations.push(n),e.s.currentBatchSizeBytes=e.s.currentBatchSizeBytes+o,e.s.currentIndex=e.s.currentIndex+1,e}class y extends o{constructor(e,t,n){n=n||{},super(e,t,n=Object.assign(n,{addToOperationsList:m}),!0)}execute(e,t,n){const r=this.bulkExecute(e,t,n);return t=r.options,n=r.callback,p(this.s.topology,g,[this,t,n])}}function g(e,t,n){if(0===e.s.batches.length)return a(n,null,new c(e.s.bulkResult));const r=e.s.batches.shift();e.finalOptionsHandler({options:t,batch:r,resultHandler:function(o,s){if((o&&o.driver||o&&o.message)&&!(o instanceof f))return a(n,o);if(o&&(o.ok=0),o instanceof f)return h(r,e.s.bulkResult,!0,o,n);const i=new c(e.s.bulkResult);if(null!=l(!0,r,e.s.bulkResult,o,s))return a(n,null,i);e.handleWriteError(n,i)||g(e,t,n)}},n)}function b(e,t,n){return new y(e,t,n)}b.OrderedBulkOperation=y,e.exports=b,e.exports.Bulk=y},function(e,t,n){"use strict";var r=n(5).shallowClone,o=n(5).handleCallback,s=n(6).MongoError,i=n(1).format,a=function(e,t,n,r,a){if(e.topology&&e.topology.isDestroyed())return a(new s("topology was destroyed"));var c=r.dbName;c=r.authdb?r.authdb:c,c=r.authSource?r.authSource:c;var u=function(t,n){e.listeners("authenticated").length>0&&e.emit("authenticated",t,n),o(a,t,n)},l=r.authMechanism||"";"MONGODB-CR"===(l=l.toUpperCase())?e.topology.auth("mongocr",c,t,n,function(e){if(e)return o(a,e,!1);u(null,!0)}):"PLAIN"===l?e.topology.auth("plain",c,t,n,function(e){if(e)return o(a,e,!1);u(null,!0)}):"MONGODB-X509"===l?e.topology.auth("x509",c,t,n,function(e){if(e)return o(a,e,!1);u(null,!0)}):"SCRAM-SHA-1"===l?e.topology.auth("scram-sha-1",c,t,n,function(e){if(e)return o(a,e,!1);u(null,!0)}):"SCRAM-SHA-256"===l?e.topology.auth("scram-sha-256",c,t,n,function(e){if(e)return o(a,e,!1);u(null,!0)}):"GSSAPI"===l?"win32"===process.platform?e.topology.auth("sspi",c,t,n,r,function(e){if(e)return o(a,e,!1);u(null,!0)}):e.topology.auth("gssapi",c,t,n,r,function(e){if(e)return o(a,e,!1);u(null,!0)}):"DEFAULT"===l?e.topology.auth("default",c,t,n,function(e){if(e)return o(a,e,!1);u(null,!0)}):o(a,s.create({message:i("authentication mechanism %s not supported",r.authMechanism),driver:!0}))};e.exports=function(e,t,n,i,c){if("function"==typeof i&&(c=i,i={}),(i=r(i=i||{})).authMechanism){if("GSSAPI"!==i.authMechanism&&"DEFAULT"!==i.authMechanism&&"MONGODB-CR"!==i.authMechanism&&"MONGODB-X509"!==i.authMechanism&&"SCRAM-SHA-1"!==i.authMechanism&&"SCRAM-SHA-256"!==i.authMechanism&&"PLAIN"!==i.authMechanism)return o(c,s.create({message:"only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, or SCRAM-SHA-1 is supported by authMechanism",driver:!0}))}else i.authMechanism="DEFAULT";return"function"==typeof c?a(e,t,n,i,function(e,t){if(e&&e.message&&-1!==e.message.indexOf("saslStart")&&(e.code=59),e)return c(e,t);c(null,t)}):new e.s.promiseLibrary(function(r,o){a(e,t,n,i,function(e,t){if(e&&e.message&&-1!==e.message.indexOf("saslStart")&&(e.code=59),e)return o(e);r(t)})})}},function(e){e.exports={_from:"mongodb@^3.1.10",_id:"mongodb@3.1.10",_inBundle:!1,_integrity:"sha512-Uml42GeFxhTGQVml1XQ4cD0o/rp7J2ROy0fdYUcVitoE7vFqEhKH4TYVqRDpQr/bXtCJVxJdNQC1ntRxNREkPQ==",_location:"/mongodb",_phantomChildren:{},_requested:{type:"range",registry:!0,raw:"mongodb@^3.1.10",name:"mongodb",escapedName:"mongodb",rawSpec:"^3.1.10",saveSpec:null,fetchSpec:"^3.1.10"},_requiredBy:["#USER","/"],_resolved:"https://registry.npmjs.org/mongodb/-/mongodb-3.1.10.tgz",_shasum:"45ad9b74ea376f4122d0881b75e5489b9e504ed7",_spec:"mongodb@^3.1.10",_where:"/Users/zubinpratap/Documents/DevProjects/Practice_Projects/visiJAM/src/functions",bugs:{url:"https://github.com/mongodb/node-mongodb-native/issues"},bundleDependencies:!1,dependencies:{"mongodb-core":"3.1.9","safe-buffer":"^5.1.2"},deprecated:!1,description:"The official MongoDB driver for Node.js",devDependencies:{bluebird:"3.5.0",bson:"^1.0.4",chai:"^4.1.1","chai-subset":"^1.6.0",co:"4.6.0",coveralls:"^2.11.6",eslint:"^4.5.0","eslint-plugin-prettier":"^2.2.0",istanbul:"^0.4.5",jsdoc:"3.5.5","lodash.camelcase":"^4.3.0","mocha-sinon":"^2.1.0","mongodb-extjson":"^2.1.1","mongodb-mock-server":"^1.0.0","mongodb-test-runner":"^1.1.18",prettier:"~1.12.0",semver:"^5.5.0",sinon:"^4.3.0","sinon-chai":"^3.2.0","standard-version":"^4.4.0","worker-farm":"^1.5.0"},engines:{node:">=4"},files:["index.js","lib"],homepage:"https://github.com/mongodb/node-mongodb-native",keywords:["mongodb","driver","official"],license:"Apache-2.0",main:"index.js",name:"mongodb",repository:{type:"git",url:"git+ssh://git@github.com/mongodb/node-mongodb-native.git"},scripts:{bench:"node test/driverBench/",coverage:"istanbul cover mongodb-test-runner -- -t 60000  test/unit test/functional",format:"prettier --print-width 100 --tab-width 2 --single-quote --write 'test/**/*.js' 'lib/**/*.js'","generate-evergreen":"node .evergreen/generate_evergreen_tasks.js",lint:"eslint lib test",release:"standard-version -i HISTORY.md",test:"npm run lint && mongodb-test-runner -t 60000 test/unit test/functional"},version:"3.1.10"}},function(e,t,n){"use strict";const r=n(6).ReadPreference,o=n(65),s=n(1).format,i=n(6).Logger,a=n(66);function c(e,t){let n=/^.*?\./,r=`.${e.replace(n,"")}`,o=`.${t.replace(n,"")}`;return!!r.endsWith(o)}function u(e,t,n){let a,c;try{a=function(e,t){let n="",a="",c="",u="admin",l=o.parse(e,!0);if((null==l.hostname||""===l.hostname)&&-1===e.indexOf(".sock"))throw new Error("No hostname or hostnames provided in connection string");if("0"===l.port)throw new Error("Invalid port (zero) with hostname");if(!isNaN(parseInt(l.port,10))&&parseInt(l.port,10)>65535)throw new Error("Invalid port (larger than 65535) with hostname");if(l.path&&l.path.length>0&&"/"!==l.path[0]&&-1===e.indexOf(".sock"))throw new Error("Missing delimiting slash between hosts and options");if(l.query)for(let e in l.query){if(-1!==e.indexOf("::"))throw new Error("Double colon in host identifier");if(""===l.query[e])throw new Error("Query parameter "+e+" is an incomplete value pair")}if(l.auth){let t=l.auth.split(":");if(-1!==e.indexOf(l.auth)&&t.length>2)throw new Error("Username with password containing an unescaped colon");if(-1!==e.indexOf(l.auth)&&-1!==l.auth.indexOf("@"))throw new Error("Username containing an unescaped at-sign")}let p=e.split("?").shift().split(","),f=[];for(let e=0;e<p.length;e++){let t=p[e];-1!==t.indexOf("mongodb")?-1!==t.indexOf("@")?f.push(t.split("@").pop()):f.push(t.substr("mongodb://".length)):-1!==t.indexOf("/")?f.push(t.split("/").shift()):-1===t.indexOf("/")&&f.push(t.trim())}for(let e=0;e<f.length;e++){let t=o.parse(s("mongodb://%s",f[e].trim()));if((!t.path||-1===t.path.indexOf(".sock"))&&(t.path&&-1!==t.path.indexOf(":")))throw t.path.split("/").length>1&&-1===t.path.indexOf("::")?new Error("Slash in host identifier"):new Error("Double colon in host identifier")}-1!==e.indexOf("?")?(c=e.substr(e.indexOf("?")+1),n=e.substring("mongodb://".length,e.indexOf("?"))):n=e.substring("mongodb://".length);-1!==n.indexOf("@")&&(a=n.split("@")[0],n=n.split("@")[1]);if(n.split("/").length>2)throw new Error("Unsupported host '"+n.split("?")[0]+"', hosts must be URL encoded and contain at most one unencoded slash");if(-1!==n.indexOf(".sock")){if(-1!==n.indexOf(".sock/")){if(-1!==(u=n.split(".sock/")[1]).indexOf("/")){if(2===u.split("/").length&&0===u.split("/")[1].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}n=n.split("/",n.indexOf(".sock")+".sock".length)}}else if(-1!==n.indexOf("/")){if(n.split("/").length>2){if(0===n.split("/")[2].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}u=n.split("/")[1],n=n.split("/")[0]}n=decodeURIComponent(n);let h,d,m,y,g={},b=a||"",v=b.split(":",2),S=decodeURIComponent(v[0]);if(v[0]!==encodeURIComponent(S))throw new Error("Username contains an illegal unescaped character");if(v[0]=S,v[1]){let e=decodeURIComponent(v[1]);if(v[1]!==encodeURIComponent(e))throw new Error("Password contains an illegal unescaped character");v[1]=e}2===v.length&&(g.auth={user:v[0],password:v[1]});t&&null!=t.auth&&(g.auth=t.auth);let w={socketOptions:{}},O={read_preference_tags:[]},_={socketOptions:{}},T={socketOptions:{}};if(g.server_options=w,g.db_options=O,g.rs_options=_,g.mongos_options=T,e.match(/\.sock/)){let t=e.substring(e.indexOf("mongodb://")+"mongodb://".length,e.lastIndexOf(".sock")+".sock".length);-1!==t.indexOf("@")&&(t=t.split("@")[1]),t=decodeURIComponent(t),m=[{domain_socket:t}]}else{let e={};m=(h=n).split(",").map(function(t){let n,r,o;if(o=/\[([^\]]+)\](?::(.+))?/.exec(t))n=o[1],r=parseInt(o[2],10)||27017;else{let e=t.split(":",2);n=e[0]||"localhost",r=null!=e[1]?parseInt(e[1],10):27017,-1!==n.indexOf("?")&&(n=n.split(/\?/)[0])}return e[n+"_"+r]?null:(e[n+"_"+r]=1,{host:n,port:r})}).filter(function(e){return null!=e})}g.dbName=u||"admin",(d=(c||"").split(/[&;]/)).forEach(function(e){if(e){var t=e.split("="),n=t[0],o=t[1];switch(n){case"slaveOk":case"slave_ok":w.slave_ok="true"===o,O.slaveOk="true"===o;break;case"maxPoolSize":case"poolSize":w.poolSize=parseInt(o,10),_.poolSize=parseInt(o,10);break;case"appname":g.appname=decodeURIComponent(o);break;case"autoReconnect":case"auto_reconnect":w.auto_reconnect="true"===o;break;case"ssl":if("prefer"===o){w.ssl=o,_.ssl=o,T.ssl=o;break}w.ssl="true"===o,_.ssl="true"===o,T.ssl="true"===o;break;case"sslValidate":w.sslValidate="true"===o,_.sslValidate="true"===o,T.sslValidate="true"===o;break;case"replicaSet":case"rs_name":_.rs_name=o;break;case"reconnectWait":_.reconnectWait=parseInt(o,10);break;case"retries":_.retries=parseInt(o,10);break;case"readSecondary":case"read_secondary":_.read_secondary="true"===o;break;case"fsync":O.fsync="true"===o;break;case"journal":O.j="true"===o;break;case"safe":O.safe="true"===o;break;case"nativeParser":case"native_parser":O.native_parser="true"===o;break;case"readConcernLevel":O.readConcern={level:o};break;case"connectTimeoutMS":w.socketOptions.connectTimeoutMS=parseInt(o,10),_.socketOptions.connectTimeoutMS=parseInt(o,10),T.socketOptions.connectTimeoutMS=parseInt(o,10);break;case"socketTimeoutMS":w.socketOptions.socketTimeoutMS=parseInt(o,10),_.socketOptions.socketTimeoutMS=parseInt(o,10),T.socketOptions.socketTimeoutMS=parseInt(o,10);break;case"w":O.w=parseInt(o,10),isNaN(O.w)&&(O.w=o);break;case"authSource":O.authSource=o;break;case"gssapiServiceName":O.gssapiServiceName=o;break;case"authMechanism":if("GSSAPI"===o)if(null==g.auth){let e=decodeURIComponent(b);if(-1===e.indexOf("@"))throw new Error("GSSAPI requires a provided principal");g.auth={user:e,password:null}}else g.auth.user=decodeURIComponent(g.auth.user);else"MONGODB-X509"===o&&(g.auth={user:decodeURIComponent(b)});if("GSSAPI"!==o&&"MONGODB-X509"!==o&&"MONGODB-CR"!==o&&"DEFAULT"!==o&&"SCRAM-SHA-1"!==o&&"SCRAM-SHA-256"!==o&&"PLAIN"!==o)throw new Error("Only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, or SCRAM-SHA-1 is supported by authMechanism");O.authMechanism=o;break;case"authMechanismProperties":{let e={};o.split(",").forEach(function(t){let n=t.split(":");e[n[0]]=n[1]}),O.authMechanismProperties=e,"string"==typeof e.SERVICE_NAME&&(O.gssapiServiceName=e.SERVICE_NAME),"string"==typeof e.SERVICE_REALM&&(O.gssapiServiceRealm=e.SERVICE_REALM),"string"==typeof e.CANONICALIZE_HOST_NAME&&(O.gssapiCanonicalizeHostName="true"===e.CANONICALIZE_HOST_NAME)}break;case"wtimeoutMS":O.wtimeout=parseInt(o,10);break;case"readPreference":if(!r.isValid(o))throw new Error("readPreference must be either primary/primaryPreferred/secondary/secondaryPreferred/nearest");O.readPreference=o;break;case"maxStalenessSeconds":O.maxStalenessSeconds=parseInt(o,10);break;case"readPreferenceTags":{let e={};if(null==(o=decodeURIComponent(o))||""===o){O.read_preference_tags.push(e);break}let t=o.split(/,/);for(let n=0;n<t.length;n++){let r=t[n].trim().split(/:/);e[r[0]]=r[1]}O.read_preference_tags.push(e)}break;case"compressors":{y=w.compression||{};let e=o.split(",");if(!e.every(function(e){return"snappy"===e||"zlib"===e}))throw new Error("Compressors must be at least one of snappy or zlib");y.compressors=e,w.compression=y}break;case"zlibCompressionLevel":{y=w.compression||{};let e=parseInt(o,10);if(e<-1||e>9)throw new Error("zlibCompressionLevel must be an integer between -1 and 9");y.zlibCompressionLevel=e,w.compression=y}break;case"retryWrites":O.retryWrites="true"===o;break;case"minSize":O.minSize=parseInt(o,10);break;default:i("URL Parser").warn(`${n} is not supported as a connection string option`)}}}),0===O.read_preference_tags.length&&(O.read_preference_tags=null);if(!(-1!==O.w&&0!==O.w||!0!==O.journal&&!0!==O.fsync&&!0!==O.safe))throw new Error("w set to -1 or 0 cannot be combined with safe/w/journal/fsync");O.readPreference||(O.readPreference="primary");return O=Object.assign(O,t),g.servers=m,g}(e,t)}catch(e){c=e}return c?n(c,null):n(null,a)}e.exports=function(e,t,n){let r;"function"==typeof t&&(n=t,t={}),t=t||{};try{r=o.parse(e,!0)}catch(e){return n(new Error("URL malformed, cannot be parsed"))}if("mongodb:"!==r.protocol&&"mongodb+srv:"!==r.protocol)return n(new Error("Invalid schema, expected `mongodb` or `mongodb+srv`"));if("mongodb:"===r.protocol)return u(e,t,n);if(r.hostname.split(".").length<3)return n(new Error("URI does not have hostname, domain name and tld"));if(r.domainLength=r.hostname.split(".").length,r.pathname&&r.pathname.match(","))return n(new Error("Invalid URI, cannot contain multiple hostnames"));if(r.port)return n(new Error("Ports not accepted with `mongodb+srv` URIs"));let s=`_mongodb._tcp.${r.host}`;a.resolveSrv(s,function(e,o){if(e)return n(e);if(0===o.length)return n(new Error("No addresses found at host"));for(let e=0;e<o.length;e++)if(!c(o[e].name,r.hostname,r.domainLength))return n(new Error("Server record does not share hostname with parent URI"));let s=r.auth?`mongodb://${r.auth}@`:"mongodb://",i=o.map(function(e,t){return 0===t?`${s}${e.name}:${e.port}`:`${e.name}:${e.port}`}).join(",")+"/",l=[];if(r.path){let e=r.path.slice(1);-1!==e.indexOf("?")&&(e=e.slice(0,e.indexOf("?"))),i+=e}(t.ssl||r.search)&&(t.ssl||!r.search||r.search.match("ssl"))||l.push("ssl=true"),r.search&&l.push(r.search.replace("?","")),a.resolveTxt(r.host,function(e,r){if(e&&"ENODATA"!==e.code)return n(e);if(e&&"ENODATA"===e.code&&(r=null),r){if(r.length>1)return n(new Error("Multiple text records not allowed"));if(!(r=(r=r[0]).length>1?r.join(""):r[0]).includes("authSource")&&!r.includes("replicaSet"))return n(new Error("Text record must only set `authSource` or `replicaSet`"));l.push(r)}l.length&&(i+=`?${l.join("&")}`),u(i,t,n)})})}},function(e,t,n){"use strict";const r=n(171),o=n(6).BSON.ObjectID,s=n(6).ReadPreference,i=n(53).Buffer,a=n(34),c=n(1).format,u=n(1),l=n(6).MongoError,p=u.inherits,f=n(15).Duplex,h=n(5).shallowClone,d=n(5).executeOperation;const m=(0,n(1).deprecate)(()=>{},"GridStore is deprecated, and will be removed in a future version. Please use GridFSBucket instead");var y=function e(t,n,i,a,c){if(m(),!(this instanceof e))return new e(t,n,i,a,c);this.db=t,void 0===c&&(c={}),void 0===a?(a=i,i=void 0):"object"==typeof a&&(c=a,a=i,i=void 0),n&&"ObjectID"===n._bsontype?(this.referenceBy=1,this.fileId=n,this.filename=i):void 0===i?(this.referenceBy=0,this.filename=n,null!=a.indexOf("w")&&(this.fileId=new o)):(this.referenceBy=1,this.fileId=n,this.filename=i),this.mode=null==a?"r":a,this.options=c||{},this.isOpen=!1,this.root=null==this.options.root?e.DEFAULT_ROOT_COLLECTION:this.options.root,this.position=0,this.readPreference=this.options.readPreference||t.options.readPreference||s.primary,this.writeConcern=U(t,this.options),this.internalChunkSize=null==this.options.chunkSize?r.DEFAULT_CHUNK_SIZE:this.options.chunkSize;var u=this.options.promiseLibrary||Promise;this.promiseLibrary=u,Object.defineProperty(this,"chunkSize",{enumerable:!0,get:function(){return this.internalChunkSize},set:function(e){"w"!==this.mode[0]||0!==this.position||null!=this.uploadDate?this.internalChunkSize=this.internalChunkSize:this.internalChunkSize=e}}),Object.defineProperty(this,"md5",{enumerable:!0,get:function(){return this.internalMd5}}),Object.defineProperty(this,"chunkNumber",{enumerable:!0,get:function(){return this.currentChunk&&this.currentChunk.chunkNumber?this.currentChunk.chunkNumber:null}})};y.prototype.open=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},"w"!==this.mode&&"w+"!==this.mode&&"r"!==this.mode)throw l.create({message:"Illegal mode "+this.mode,driver:!0});return d(this.db.s.topology,g,[this,e,t],{skipSessions:!0})};var g=function(e,t,n){var r=U(e.db,e.options);"w"===e.mode||"w+"===e.mode?e.collection().ensureIndex([["filename",1]],r,function(){var t=e.chunkCollection(),o=h(r);o.unique=!0,t.ensureIndex([["files_id",1],["n",1]],o,function(){E(e,r,function(t,r){if(t)return n(t);e.isOpen=!0,n(t,r)})})}):E(e,r,function(t,r){if(t)return n(t);e.isOpen=!0,n(t,r)})};y.prototype.eof=function(){return this.position===this.length},y.prototype.getc=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},d(this.db.s.topology,b,[this,e,t],{skipSessions:!0})};var b=function(e,t,n){e.eof()?n(null,null):e.currentChunk.eof()?x(e,e.currentChunk.chunkNumber+1,function(t,r){e.currentChunk=r,e.position=e.position+1,n(t,e.currentChunk.getc())}):(e.position=e.position+1,n(null,e.currentChunk.getc()))};y.prototype.puts=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};var r=null==e.match(/\n$/)?e+"\n":e;return d(this.db.s.topology,this.write.bind(this),[r,t,n],{skipSessions:!0})},y.prototype.stream=function(){return new z(this)},y.prototype.write=function(e,t,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},d(this.db.s.topology,L,[this,e,t,n,r],{skipSessions:!0})},y.prototype.destroy=function(){this.writable&&(this.readable=!1,this.writable&&(this.writable=!1,this._q.length=0,this.emit("close")))},y.prototype.writeFile=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},d(this.db.s.topology,v,[this,e,t,n],{skipSessions:!0})};var v=function(e,t,n,o){"string"!=typeof t?e.open(function(e,n){if(e)return o(e,n);a.fstat(t,function(e,s){if(e)return o(e,n);var c=0,u=0,l=function(){var e=i.alloc(n.chunkSize);a.read(t,e,0,e.length,c,function(e,i,p){if(e)return o(e,n);c+=i,new r(n,{n:u++},n.writeConcern).write(p.slice(0,i),function(e,r){if(e)return o(e,n);r.save({},function(e){return e?o(e,n):(n.position=n.position+i,n.currentChunk=r,c>=s.size?void a.close(t,function(e){if(e)return o(e);n.close(function(e){return o(e||null,n)})}):process.nextTick(l))})})})};process.nextTick(l)})}):a.open(t,"r",function(t,n){if(t)return o(t);e.writeFile(n,o)})};y.prototype.close=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},d(this.db.s.topology,S,[this,e,t],{skipSessions:!0})};var S=function(e,t,n){"w"===e.mode[0]?(t=Object.assign({},e.writeConcern,t),null!=e.currentChunk&&e.currentChunk.position>0?e.currentChunk.save({},function(r){if(r&&"function"==typeof n)return n(r);e.collection(function(r,o){if(r&&"function"==typeof n)return n(r);null!=e.uploadDate?I(e,function(e,r){if(e){if("function"==typeof n)return n(e);throw e}o.save(r,t,function(e){"function"==typeof n&&n(e,r)})}):(e.uploadDate=new Date,I(e,function(e,r){if(e){if("function"==typeof n)return n(e);throw e}o.save(r,t,function(e){"function"==typeof n&&n(e,r)})}))})}):e.collection(function(r,o){if(r&&"function"==typeof n)return n(r);e.uploadDate=new Date,I(e,function(e,r){if(e){if("function"==typeof n)return n(e);throw e}o.save(r,t,function(e){"function"==typeof n&&n(e,r)})})})):"r"===e.mode[0]?"function"==typeof n&&n(null,null):"function"==typeof n&&n(l.create({message:c("Illegal mode %s",e.mode),driver:!0}))};y.prototype.chunkCollection=function(e){return"function"==typeof e?this.db.collection(this.root+".chunks",e):this.db.collection(this.root+".chunks")},y.prototype.unlink=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},d(this.db.s.topology,w,[this,e,t],{skipSessions:!0})};var w=function(e,t,n){k(e,function(t){if(null!==t)return t.message="at deleteChunks: "+t.message,n(t);e.collection(function(t,r){if(null!==t)return t.message="at collection: "+t.message,n(t);r.remove({_id:e.fileId},e.writeConcern,function(t){n(t,e)})})})};y.prototype.collection=function(e){return"function"==typeof e&&this.db.collection(this.root+".files",e),this.db.collection(this.root+".files")},y.prototype.readlines=function(e,t,n){var r=Array.prototype.slice.call(arguments,0);return n="function"==typeof r[r.length-1]?r.pop():void 0,e=(e=r.length?r.shift():"\n")||"\n",t=r.length?r.shift():{},d(this.db.s.topology,O,[this,e,t,n],{skipSessions:!0})};var O=function(e,t,n,r){e.read(function(e,n){if(e)return r(e);var o=n.toString().split(t);o=o.length>0?o.splice(0,o.length-1):[];for(var s=0;s<o.length;s++)o[s]=o[s]+t;r(null,o)})};y.prototype.rewind=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},d(this.db.s.topology,_,[this,e,t],{skipSessions:!0})};var _=function(e,t,n){0!==e.currentChunk.chunkNumber?"w"===e.mode[0]?k(e,function(t){if(t)return n(t);e.currentChunk=new r(e,{n:0},e.writeConcern),e.position=0,n(null,e)}):e.currentChunk(0,function(t,r){if(t)return n(t);e.currentChunk=r,e.currentChunk.rewind(),e.position=0,n(null,e)}):(e.currentChunk.rewind(),e.position=0,n(null,e))};y.prototype.read=function(e,t,n,r){var o=Array.prototype.slice.call(arguments,0);return r="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length?o.shift():null,t=o.length?o.shift():null,n=o.length?o.shift():{},d(this.db.s.topology,T,[this,e,t,n,r],{skipSessions:!0})};var T=function(e,t,n,r,o){var s=null==t?e.length-e.position:t,a=null==n?i.alloc(s):n;if(a._index=null!=n&&null!=n._index?n._index:0,e.currentChunk.length()-e.currentChunk.position+a._index>=s){var c=e.currentChunk.readSlice(s-a._index);return c.copy(a,a._index),e.position=e.position+a.length,0===s&&0===a.length?o(l.create({message:"File does not exist",driver:!0}),null):o(null,a)}(c=e.currentChunk.readSlice(e.currentChunk.length()-e.currentChunk.position)).copy(a,a._index),a._index+=c.length,x(e,e.currentChunk.chunkNumber+1,function(n,r){if(n)return o(n);r.length()>0?(e.currentChunk=r,e.read(t,a,o)):a._index>0?o(null,a):o(l.create({message:"no chunks found for file, possibly corrupt",driver:!0}),null)})};y.prototype.tell=function(e){var t=this;return"function"==typeof e?e(null,this.position):new t.promiseLibrary(function(e){e(t.position)})},y.prototype.seek=function(e,t,n,r){var o=Array.prototype.slice.call(arguments,1);return r="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():null,n=o.length?o.shift():{},d(this.db.s.topology,C,[this,e,t,n,r],{skipSessions:!0})};var C=function(e,t,n,r,o){if("r"!==e.mode)return o(l.create({message:"seek is only supported for mode r",driver:!0}));var s=null==n?y.IO_SEEK_SET:n,i=t,a=0;a=s===y.IO_SEEK_CUR?e.position+i:s===y.IO_SEEK_END?e.length+i:i;var c=Math.floor(a/e.chunkSize);x(e,c,function(t,n){return t?o(t,null):null==n?o(new Error("no chunk found")):(e.currentChunk=n,e.position=a,e.currentChunk.position=e.position%e.chunkSize,void o(t,e))})},E=function(e,t,n){var s=e.collection(),i=1===e.referenceBy?{_id:e.fileId}:{filename:e.filename};function a(e){a.err||n(a.err=e)}i=null==e.fileId&&null==e.filename?null:i,t.readPreference=e.readPreference,null!=i?s.findOne(i,t,function(s,i){if(s)return a(s);if(null!=i)e.fileId=i._id,e.filename="r"===e.mode||void 0===e.filename?i.filename:e.filename,e.contentType=i.contentType,e.internalChunkSize=i.chunkSize,e.uploadDate=i.uploadDate,e.aliases=i.aliases,e.length=i.length,e.metadata=i.metadata,e.internalMd5=i.md5;else{if("r"===e.mode){e.length=0;var u="ObjectID"===e.fileId._bsontype?e.fileId.toHexString():e.fileId;return a(l.create({message:c("file with id %s not opened for writing",1===e.referenceBy?u:e.filename),driver:!0}))}e.fileId=null==e.fileId?new o:e.fileId,e.contentType=y.DEFAULT_CONTENT_TYPE,e.internalChunkSize=null==e.internalChunkSize?r.DEFAULT_CHUNK_SIZE:e.internalChunkSize,e.length=0}"r"===e.mode?x(e,0,t,function(t,r){if(t)return a(t);e.currentChunk=r,e.position=0,n(null,e)}):"w"===e.mode&&i?k(e,t,function(t){if(t)return a(t);e.currentChunk=new r(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)}):"w"===e.mode?(e.currentChunk=new r(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)):"w+"===e.mode&&x(e,A(e),t,function(t,o){if(t)return a(t);e.currentChunk=null==o?new r(e,{n:0},e.writeConcern):o,e.currentChunk.position=e.currentChunk.data.length(),e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=e.length,n(null,e)})}):(e.fileId=null==e.fileId?new o:e.fileId,e.contentType=y.DEFAULT_CONTENT_TYPE,e.internalChunkSize=null==e.internalChunkSize?r.DEFAULT_CHUNK_SIZE:e.internalChunkSize,e.length=0,"w"===e.mode?k(e,t,function(t){if(t)return a(t);e.currentChunk=new r(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)}):"w+"===e.mode&&x(e,A(e),t,function(t,o){if(t)return a(t);e.currentChunk=null==o?new r(e,{n:0},e.writeConcern):o,e.currentChunk.position=e.currentChunk.data.length(),e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=e.length,n(null,e)}))},N=function(e,t,n,o){"function"==typeof n&&(o=n,n=null);var s="boolean"==typeof n&&n;if("w"!==e.mode)o(l.create({message:c("file with id %s not opened for writing",1===e.referenceBy?e.referenceBy:e.filename),driver:!0}),null);else{if(!(e.currentChunk.position+t.length>=e.chunkSize))return e.position=e.position+t.length,e.currentChunk.write(t),s?e.close(function(t){o(t,e)}):o(null,e);for(var i=e.currentChunk.chunkNumber,a=e.chunkSize-e.currentChunk.position,u=t.slice(0,a),p=t.slice(a),f=[e.currentChunk.write(u)];p.length>=e.chunkSize;){var h=new r(e,{n:i+1},e.writeConcern);u=p.slice(0,e.chunkSize),p=p.slice(e.chunkSize),i+=1,h.write(u),f.push(h)}e.currentChunk=new r(e,{n:i+1},e.writeConcern),p.length>0&&e.currentChunk.write(p),e.position=e.position+t.length;for(var d=f.length,m=0;m<f.length;m++)f[m].save({},function(t){return t?o(t):(d-=1)<=0?s?e.close(function(t){o(t,e)}):o(null,e):void 0})}},I=function(e,t){var n={_id:e.fileId,filename:e.filename,contentType:e.contentType,length:e.position?e.position:0,chunkSize:e.chunkSize,uploadDate:e.uploadDate,aliases:e.aliases,metadata:e.metadata},r={filemd5:e.fileId,root:e.root};e.db.command(r,function(e,r){if(e)return t(e);n.md5=r.md5,t(null,n)})},x=function(e,t,n,o){"function"==typeof n&&(o=n,n={}),(n=n||e.writeConcern).readPreference=e.readPreference,e.chunkCollection().findOne({files_id:e.fileId,n:t},n,function(t,n){if(t)return o(t);o(null,new r(e,null==n?{}:n,e.writeConcern))})},A=function(e){return Math.floor((e.length?e.length-1:0)/e.chunkSize)},k=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||e.writeConcern,null!=e.fileId?e.chunkCollection().remove({files_id:e.fileId},t,function(e){if(e)return n(e,!1);n(null,!0)}):n(null,!0)};y.DEFAULT_ROOT_COLLECTION="fs",y.DEFAULT_CONTENT_TYPE="binary/octet-stream",y.IO_SEEK_SET=0,y.IO_SEEK_CUR=1,y.IO_SEEK_END=2,y.exist=function(e,t,n,r,o){var s=Array.prototype.slice.call(arguments,2);return o="function"==typeof s[s.length-1]?s.pop():void 0,n=s.length?s.shift():null,r=(r=s.length?s.shift():{})||{},d(e.s.topology,B,[e,t,n,r,o],{skipSessions:!0})};var B=function(e,t,n,r,o){var i=r.readPreference||s.PRIMARY,a=null!=n?n:y.DEFAULT_ROOT_COLLECTION;e.collection(a+".files",function(e,n){if(e)return o(e);var r="string"==typeof t||"[object RegExp]"===Object.prototype.toString.call(t)?{filename:t}:{_id:t};null!=t&&"object"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)&&(r=t),n.findOne(r,{readPreference:i},function(e,t){if(e)return o(e);o(null,null!=t)})})};y.list=function(e,t,n,r){var o=Array.prototype.slice.call(arguments,1);return r="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():null,n=(n=o.length?o.shift():{})||{},d(e.s.topology,M,[e,t,n,r],{skipSessions:!0})};var M=function(e,t,n,r){null!=t&&"object"==typeof t&&(n=t,t=null);var o=n.readPreference||s.primary,i=null!=n.id&&n.id,a=null!=t?t:y.DEFAULT_ROOT_COLLECTION,c=[];e.collection(a+".files",function(e,t){if(e)return r(e);t.find({},{readPreference:o},function(e,t){if(e)return r(e);t.each(function(e,t){null!=t?c.push(i?t._id:t.filename):r(e,c)})})})};y.read=function(e,t,n,r,o,s){var i=Array.prototype.slice.call(arguments,2);return s="function"==typeof i[i.length-1]?i.pop():void 0,n=i.length?i.shift():null,r=i.length?i.shift():null,o=(o=i.length?i.shift():null)||{},d(e.s.topology,D,[e,t,n,r,o,s],{skipSessions:!0})};var D=function(e,t,n,r,o,s){new y(e,t,"r",o).open(function(e,t){return e?s(e):r&&r>=t.length?s("offset larger than size of file",null):n&&n>t.length?s("length is larger than the size of the file",null):r&&n&&r+n>t.length?s("offset and length is larger than the size of the file",null):void(null!=r?t.seek(r,function(e,t){if(e)return s(e);t.read(n,s)}):t.read(n,s))})};y.readlines=function(e,t,n,r,o){var s=Array.prototype.slice.call(arguments,2);return o="function"==typeof s[s.length-1]?s.pop():void 0,n=s.length?s.shift():null,r=(r=s.length?s.shift():null)||{},d(e.s.topology,R,[e,t,n,r,o],{skipSessions:!0})};var R=function(e,t,n,r,o){var s=null==n?"\n":n;new y(e,t,"r",r).open(function(e,t){if(e)return o(e);t.readlines(s,o)})};y.unlink=function(e,t,n,r){var o=Array.prototype.slice.call(arguments,2);return r="function"==typeof o[o.length-1]?o.pop():void 0,n=(n=o.length?o.shift():{})||{},d(e.s.topology,P,[this,e,t,n,r],{skipSessions:!0})};var P=function(e,t,n,r,o){var s=U(t,r);if(n.constructor===Array)for(var i=0,a=0;a<n.length;a++)++i,y.unlink(t,n[a],r,function(){0==--i&&o(null,e)});else new y(t,n,"w",r).open(function(t,n){if(t)return o(t);k(n,function(t){if(t)return o(t);n.collection(function(t,r){if(t)return o(t);r.remove({_id:n.fileId},s,function(t){o(t,e)})})})})},L=function(e,t,n,r,o){return i.isBuffer(t)?N(e,t,n,o):N(e,i.from(t,"binary"),n,o)},j=function(e){var t={};return null!=e.w&&(t.w=e.w),!0===e.journal&&(t.j=e.journal),!0===e.j&&(t.j=e.j),!0===e.fsync&&(t.fsync=e.fsync),null!=e.wtimeout&&(t.wtimeout=e.wtimeout),t},U=function(e,t){var n={w:1};if(null!=(t=t||{}).w||"boolean"==typeof t.j||"boolean"==typeof t.journal||"boolean"==typeof t.fsync?n=j(t):null!=t.safe&&"object"==typeof t.safe?n=j(t.safe):"boolean"==typeof t.safe?n={w:t.safe?1:0}:null!=e.options.w||"boolean"==typeof e.options.j||"boolean"==typeof e.options.journal||"boolean"==typeof e.options.fsync?n=j(e.options):!e.safe||null==e.safe.w&&"boolean"!=typeof e.safe.j&&"boolean"!=typeof e.safe.journal&&"boolean"!=typeof e.safe.fsync?"boolean"==typeof e.safe&&(n={w:e.safe?1:0}):n=j(e.safe),n.w<1&&(!0===n.journal||!0===n.j||!0===n.fsync))throw l.create({message:"No acknowledgement using w < 1 cannot be combined with journal:true or fsync:true",driver:!0});return n},z=function(e){f.call(this),this.gs=e,this.endCalled=!1,this.totalBytesToRead=this.gs.length-this.gs.position,this.seekPosition=this.gs.position};p(z,f),z.prototype._pipe=z.prototype.pipe,z.prototype.pipe=function(e){var t=this;return t.gs.isOpen?(t.totalBytesToRead=t.gs.length-t.gs.position,t._pipe.apply(t,[e])):t.gs.open(function(n){if(n)return t.emit("error",n);t.totalBytesToRead=t.gs.length-t.gs.position,t._pipe.apply(t,[e])}),e},z.prototype._read=function(){var e=this,t=function(){e.gs.read(n,function(t,n){return t&&!e.endCalled?e.emit("error",t):e.endCalled||null==n?e.push(null):(n.length<=e.totalBytesToRead?(e.totalBytesToRead=e.totalBytesToRead-n.length,e.push(n)):n.length>e.totalBytesToRead&&(e.totalBytesToRead=e.totalBytesToRead-n._index,e.push(n.slice(0,n._index))),void(e.totalBytesToRead<=0&&(e.endCalled=!0)))})},n=e.gs.length<e.gs.chunkSize?e.gs.length-e.seekPosition:e.gs.chunkSize;e.gs.isOpen?t():e.gs.open(function(n){if(e.totalBytesToRead=e.gs.length-e.gs.position,n)return e.emit("error",n);t()})},z.prototype.destroy=function(){this.pause(),this.endCalled=!0,this.gs.close(),this.emit("end")},z.prototype.write=function(e){var t=this;return t.endCalled?t.emit("error",l.create({message:"attempting to write to stream after end called",driver:!0})):t.gs.isOpen?(t.gs.write(e,function(){t.emit("drain")}),!0):(t.gs.open(function(){t.gs.isOpen=!0,t.gs.write(e,function(){process.nextTick(function(){t.emit("drain")})})}),!1)},z.prototype.end=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,0);n="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length?o.shift():null,o.length&&o.shift(),r.endCalled=!0,e&&r.gs.write(e,function(){r.gs.close(function(){"function"==typeof n&&n(),r.emit("end")})}),r.gs.close(function(){"function"==typeof n&&n(),r.emit("end")})},e.exports=y},function(e,t,n){"use strict";var r=n(9).EventEmitter,o=n(209),s=n(210),i=n(5).shallowClone,a=n(5).toError,c=n(1),u=n(5).executeOperation,l={bucketName:"fs",chunkSizeBytes:261120};function p(e,t){if(r.apply(this),this.setMaxListeners(0),t&&"object"==typeof t){t=i(t);for(var n=Object.keys(l),o=0;o<n.length;++o)t[n[o]]||(t[n[o]]=l[n[o]])}else t=l;this.s={db:e,options:t,_chunksCollection:e.collection(t.bucketName+".chunks"),_filesCollection:e.collection(t.bucketName+".files"),checkedIndexes:!1,calledOpenUploadStream:!1,promiseLibrary:e.s.promiseLibrary||Promise}}function f(e,t,n){e.s._filesCollection.deleteOne({_id:t},function(r,o){if(r)return n(r);e.s._chunksCollection.deleteMany({files_id:t},function(e){return e?n(e):o.result.n?void n():n(new Error("FileNotFound: no file with id "+t+" found"))})})}function h(e,t,n,r){var o={_id:t},s={$set:{filename:n}};e.s._filesCollection.updateOne(o,s,function(e,n){return e?r(e):n.result.n?void r():r(a("File with id "+t+" not found"))})}function d(e,t){e.s._filesCollection.drop(function(n){if(n)return t(n);e.s._chunksCollection.drop(function(e){return e?t(e):t()})})}e.exports=p,c.inherits(p,r),p.prototype.openUploadStream=function(e,t){return(t=t?i(t):{}).chunkSizeBytes||(t.chunkSizeBytes=this.s.options.chunkSizeBytes),new s(this,e,t)},p.prototype.openUploadStreamWithId=function(e,t,n){return(n=n?i(n):{}).chunkSizeBytes||(n.chunkSizeBytes=this.s.options.chunkSizeBytes),n.id=e,new s(this,t,n)},p.prototype.openDownloadStream=function(e,t){var n={_id:e};return t={start:t&&t.start,end:t&&t.end},new o(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,n,t)},p.prototype.delete=function(e,t){return u(this.s.db.s.topology,f,[this,e,t],{skipSessions:!0})},p.prototype.find=function(e,t){e=e||{},t=t||{};var n=this.s._filesCollection.find(e);return null!=t.batchSize&&n.batchSize(t.batchSize),null!=t.limit&&n.limit(t.limit),null!=t.maxTimeMS&&n.maxTimeMS(t.maxTimeMS),null!=t.noCursorTimeout&&n.addCursorFlag("noCursorTimeout",t.noCursorTimeout),null!=t.skip&&n.skip(t.skip),null!=t.sort&&n.sort(t.sort),n},p.prototype.openDownloadStreamByName=function(e,t){var n={uploadDate:-1},r=null;t&&null!=t.revision&&(t.revision>=0?(n={uploadDate:1},r=t.revision):r=-t.revision-1);var s={filename:e};return t={sort:n,skip:r,start:t&&t.start,end:t&&t.end},new o(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,s,t)},p.prototype.rename=function(e,t,n){return u(this.s.db.s.topology,h,[this,e,t,n],{skipSessions:!0})},p.prototype.drop=function(e){return u(this.s.db.s.topology,d,[this,e],{skipSessions:!0})},p.prototype.getLogger=function(){return this.s.db.s.logger}},function(e,t,n){"use strict";var r=n(15),o=n(1);function s(e,t,n,o,s){this.s={bytesRead:0,chunks:e,cursor:null,expected:0,files:t,filter:o,init:!1,expectedEnd:0,file:null,options:s,readPreference:n},r.Readable.call(this)}function i(e){if(e.s.init)throw new Error("You cannot change options after the stream has enteredflowing mode!")}function a(e,t){e.emit("error",t)}e.exports=s,o.inherits(s,r.Readable),s.prototype._read=function(){var e=this;this.destroyed||function(e,t){if(e.s.file)return t();e.s.init||(!function(e){var t={};e.s.readPreference&&(t.readPreference=e.s.readPreference);e.s.options&&e.s.options.sort&&(t.sort=e.s.options.sort);e.s.options&&e.s.options.skip&&(t.skip=e.s.options.skip);e.s.files.findOne(e.s.filter,t,function(t,n){if(t)return a(e,t);if(!n){var r=e.s.filter._id?e.s.filter._id.toString():e.s.filter.filename,o="FileNotFound: file "+r+" was not found",s=new Error(o);return s.code="ENOENT",a(e,s)}if(n.length<=0)e.push(null);else if(e.destroyed)e.emit("close");else{e.s.bytesToSkip=function(e,t,n){if(n&&null!=n.start){if(n.start>t.length)throw new Error("Stream start ("+n.start+") must not be more than the length of the file ("+t.length+")");if(n.start<0)throw new Error("Stream start ("+n.start+") must not be negative");if(null!=n.end&&n.end<n.start)throw new Error("Stream start ("+n.start+") must not be greater than stream end ("+n.end+")");return e.s.bytesRead=Math.floor(n.start/t.chunkSize)*t.chunkSize,e.s.expected=Math.floor(n.start/t.chunkSize),n.start-e.s.bytesRead}}(e,n,e.s.options);var i={files_id:n._id};if(e.s.options&&null!=e.s.options.start){var c=Math.floor(e.s.options.start/n.chunkSize);c>0&&(i.n={$gte:c})}e.s.cursor=e.s.chunks.find(i).sort({n:1}),e.s.readPreference&&e.s.cursor.setReadPreference(e.s.readPreference),e.s.expectedEnd=Math.ceil(n.length/n.chunkSize),e.s.file=n,e.s.bytesToTrim=function(e,t,n,r){if(r&&null!=r.end){if(r.end>t.length)throw new Error("Stream end ("+r.end+") must not be more than the length of the file ("+t.length+")");if(r.start<0)throw new Error("Stream end ("+r.end+") must not be negative");var o=null!=r.start?Math.floor(r.start/t.chunkSize):0;return n.limit(Math.ceil(r.end/t.chunkSize)-o),e.s.expectedEnd=Math.ceil(r.end/t.chunkSize),Math.ceil(r.end/t.chunkSize)*t.chunkSize-r.end}}(e,n,e.s.cursor,e.s.options),e.emit("file",n)}})}(e),e.s.init=!0);e.once("file",function(){t()})}(e,function(){!function(e){if(e.destroyed)return;e.s.cursor.next(function(t,n){if(!e.destroyed){if(t)return a(e,t);if(!n)return e.push(null),e.s.cursor.close(function(t){if(t)return a(e,t);e.emit("close")});var r=e.s.file.length-e.s.bytesRead,o=e.s.expected++,s=Math.min(e.s.file.chunkSize,r);if(n.n>o){var i="ChunkIsMissing: Got unexpected n: "+n.n+", expected: "+o;return a(e,new Error(i))}if(n.n<o)return i="ExtraChunk: Got unexpected n: "+n.n+", expected: "+o,a(e,new Error(i));var c=Buffer.isBuffer(n.data)?n.data:n.data.buffer;if(c.length!==s)return r<=0?(i="ExtraChunk: Got unexpected n: "+n.n,a(e,new Error(i))):(i="ChunkIsWrongSize: Got unexpected length: "+c.length+", expected: "+s,a(e,new Error(i)));if(e.s.bytesRead+=c.length,0===c.length)return e.push(null);var u=null,l=null;null!=e.s.bytesToSkip&&(u=e.s.bytesToSkip,e.s.bytesToSkip=0),o===e.s.expectedEnd&&null!=e.s.bytesToTrim&&(l=e.s.bytesToTrim),e.s.options.end&&e.s.options.end-e.s.bytesToSkip<c.length&&(l=e.s.options.end-e.s.bytesToSkip),null==u&&null==l||(c=c.slice(u||0,l||c.length)),e.push(c)}})}(e)})},s.prototype.start=function(e){return i(this),this.s.options.start=e,this},s.prototype.end=function(e){return i(this),this.s.options.end=e,this},s.prototype.abort=function(e){var t=this;this.push(null),this.destroyed=!0,this.s.cursor?this.s.cursor.close(function(n){t.emit("close"),e&&e(n)}):(this.s.init||t.emit("close"),e&&e())}},function(e,t,n){"use strict";var r=n(6),o=n(18),s=n(15),i=n(1),a=n(53).Buffer,c=26;function u(e,t,n){if(n=n||{},this.bucket=e,this.chunks=e.s._chunksCollection,this.filename=t,this.files=e.s._filesCollection,this.options=n,this.done=!1,this.id=n.id?n.id:r.BSON.ObjectId(),this.chunkSizeBytes=this.options.chunkSizeBytes,this.bufToStore=a.alloc(this.chunkSizeBytes),this.length=0,this.md5=!n.disableMD5&&o.createHash("md5"),this.n=0,this.pos=0,this.state={streamEnd:!1,outstandingRequests:0,errored:!1,aborted:!1,promiseLibrary:this.bucket.s.promiseLibrary},!this.bucket.s.calledOpenUploadStream){this.bucket.s.calledOpenUploadStream=!0;var s=this;!function(e,t){e.files.findOne({},{_id:1},function(n,r){return n?t(n):r?t():void e.files.listIndexes().toArray(function(n,r){if(n){if(n.code===c){var o={filename:1,uploadDate:1};return void e.files.createIndex(o,{background:!1},function(n){if(n)return t(n);f(e,t)})}return t(n)}var s=!1;if(r.forEach(function(e){var t=Object.keys(e.key);2===t.length&&1===e.key.filename&&1===e.key.uploadDate&&(s=!0)}),s)f(e,t);else{o={filename:1,uploadDate:1};var i=d(e);i.background=!1,e.files.createIndex(o,i,function(n){if(n)return t(n);f(e,t)})}})})}(this,function(){s.bucket.s.checkedIndexes=!0,s.bucket.emit("index")})}}function l(e,t,n){if(!e.state.errored){if(e.state.errored=!0,n)return n(t);e.emit("error",t)}}function p(e,t,n){return{_id:r.BSON.ObjectId(),files_id:e,n:t,data:n}}function f(e,t){e.chunks.listIndexes().toArray(function(n,r){if(n){if(n.code===c){var o={files_id:1,n:1};return void e.chunks.createIndex(o,{background:!1,unique:!0},function(e){if(e)return t(e);t()})}return t(n)}var s=!1;if(r.forEach(function(e){e.key&&(2===Object.keys(e.key).length&&1===e.key.files_id&&1===e.key.n&&(s=!0))}),s)t();else{o={files_id:1,n:1};var i=d(e);i.background=!1,i.unique=!0,e.chunks.createIndex(o,i,function(e){if(e)return t(e);t()})}})}function h(e,t){if(e.done)return!0;if(e.state.streamEnd&&0===e.state.outstandingRequests&&!e.state.errored){e.done=!0;var n=function(e,t,n,r,o,s,i,a){var c={_id:e,length:t,chunkSize:n,uploadDate:new Date,filename:o};r&&(c.md5=r);s&&(c.contentType=s);i&&(c.aliases=i);a&&(c.metadata=a);return c}(e.id,e.length,e.chunkSizeBytes,e.md5&&e.md5.digest("hex"),e.filename,e.options.contentType,e.options.aliases,e.options.metadata);return!g(e,t)&&(e.files.insertOne(n,d(e),function(r){if(r)return l(e,r,t);e.emit("finish",n)}),!0)}return!1}function d(e){var t={};return e.options.writeConcern&&(t.w=e.options.writeConcern.w,t.wtimeout=e.options.writeConcern.wtimeout,t.j=e.options.writeConcern.j),t}function m(e,t){return e.bucket.s.checkedIndexes?t(!1):(e.bucket.once("index",function(){t(!0)}),!0)}function y(e,t){if(0===e.pos)return h(e,t);++e.state.outstandingRequests;var n=a.alloc(e.pos);e.bufToStore.copy(n,0,0,e.pos),e.md5&&e.md5.update(n);var r=p(e.id,e.n,n);if(g(e,t))return!1;e.chunks.insertOne(r,d(e),function(t){if(t)return l(e,t);--e.state.outstandingRequests,h(e)})}function g(e,t){return!!e.state.aborted&&("function"==typeof t&&t(new Error("this stream has been aborted")),!0)}e.exports=u,i.inherits(u,s.Writable),u.prototype.write=function(e,t,n){var r=this;return m(this,function(){return function(e,t,n,r){if(g(e,r))return!1;var o=a.isBuffer(t)?t:a.from(t,n);if(e.length+=o.length,e.pos+o.length<e.chunkSizeBytes)return o.copy(e.bufToStore,e.pos),e.pos+=o.length,r&&r(),!0;var s=o.length,i=e.chunkSizeBytes-e.pos,c=Math.min(i,o.length),u=0;for(;s>0;){var f=o.length-s;if(o.copy(e.bufToStore,e.pos,f,f+c),e.pos+=c,0===(i-=c)){e.md5&&e.md5.update(e.bufToStore);var m=p(e.id,e.n,e.bufToStore);if(++e.state.outstandingRequests,++u,g(e,r))return!1;e.chunks.insertOne(m,d(e),function(t){if(t)return l(e,t);--e.state.outstandingRequests,--u||(e.emit("drain",m),r&&r(),h(e))}),i=e.chunkSizeBytes,e.pos=0,++e.n}s-=c,c=Math.min(i,s)}return!1}(r,e,t,n)})},u.prototype.abort=function(e){if(this.state.streamEnd){var t=new Error("Cannot abort a stream that has already completed");return"function"==typeof e?e(t):this.state.promiseLibrary.reject(t)}if(this.state.aborted)return t=new Error("Cannot call abort() on a stream twice"),"function"==typeof e?e(t):this.state.promiseLibrary.reject(t);this.state.aborted=!0,this.chunks.deleteMany({files_id:this.id},function(t){"function"==typeof e&&e(t)})},u.prototype.end=function(e,t,n){var r=this;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),g(this,n)||(this.state.streamEnd=!0,n&&this.once("finish",function(e){n(null,e)}),e?this.write(e,t,function(){y(r)}):m(this,function(){y(r)}))}}]));